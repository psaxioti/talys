      subroutine ecis97t(ecisinp,ecisout,ecis97cs,ecis97res)            ak000000
c 18/12/87  ibm version convex                                  ecis88  ecis-000
      character*13 ecisinp,ecisout,ecis97cs,ecis97res                   ak000000
      real*8 w(3000000)                                                 ecis-001
      common w                                                          ecis-002
      open(unit=1,status='unknown',file=ecisinp)                        ak000000
      open(unit=2,status='unknown',file=ecisout)                        ak000000
      open(unit=3,status='unknown',file=ecis97cs)                       ak000000
      open(unit=7,status='unknown',file=ecis97res)                      ak000000
      call calc(w,w,w,3000000)                                          ecis-003
      close (unit=1)                                                    ak000000
      close (unit=2)                                                    ak000000
      close (unit=3)                                                    ak000000
      close (unit=7)                                                    ak000000
      return                                                            ak000000
c     stop                                                              ecis-004
      end                                                               ecis-005
c 15/04/88  ibm and cdc version                                 ecis88  memo-000
      subroutine memo(idmt,nplace,nq,ix,lo)                             memo-001
c this subroutine gets the working space.                               memo-002
c idmt     previous space                                               memo-003
c nplace   requested space                                              memo-004
c nq       space to be updated                                          memo-005
c ix: control number ix=1     first call                                memo-006
c                    ix=2     diminution of space                       memo-007
c                    ix=3     request nplace+1000, at least nplace      memo-008
c                    ix=4     request nplace                            memo-009
c                    ix=5     absolute request                          memo-010
c lo: logical controls  if lo(74)=.true. print the size of working spacememo-011
c output variables: idmt  size of working space                         memo-012
c                   lo(216)=.true. if computation cannot continue       memo-013
c***********************************************************************memo-014
      logical lo(250)                                                   memo-015
      lo(216)=(nplace.gt.idmt).and.((ix-5)*(ix-3).eq.0)                 memo-016
      if (.not.lo(216)) return                                          memo-017
      write (2,1000) ix,idmt,nplace                                     memo-018
      return                                                            memo-019
 1000 format (33h not enough place .....   request,i2,i10,8h allowed,i10memo-020
     1,10h requested/)                                                  memo-021
      end                                                               memo-022
c 18/02/97                                                      ecis96  hora-000
      subroutine hora                                                   hora-001
c gives the time elapsed since the first call and since the last call   hora-002
c it uses a function which returns the time left for                    hora-003
c a run of 55 minutes in milliseconds.                                  hora-004
c***********************************************************************hora-005
      data nx,m0,m2 /0,0,0/                                             hora-006
      if (nx.ne.0) go to 1                                              hora-007
      call stim(m0)                                                     hora-008
      m2=m0                                                             hora-009
      nx=1                                                              hora-010
      write (2,1000) m0                                                 hora-011
      return                                                            hora-012
    1 call stim(m1)                                                     hora-013
      n5=m2-m1                                                          hora-014
      nt=m0-m1                                                          hora-015
      m2=m1                                                             hora-016
      ns=nt/1000                                                        hora-017
      nt=nt-1000*ns                                                     hora-018
      nm=ns/60                                                          hora-019
      ns=ns-60*nm                                                       hora-020
      nh=nm/60                                                          hora-021
      nm=nm-60*nh                                                       hora-022
      write (2,1001) nh,nm,ns,nt,n5                                     hora-023
      return                                                            hora-024
 1000 format (19h first call to hora,10x,i10,13h milliseconds)          hora-025
 1001 format (19h *** total time ***,i3,1hh,i3,2hmn,i3,1hs,i4,3h ms,10x,hora-026
     126hdifference since last call,i9,13h milliseconds)                hora-027
      end                                                               hora-028
c 03/04/97                                                      ecis97  stim-000
      subroutine stim(i)                                                stim-001
c returns integer value of cpu time left for a job of 55 minutes        stim-002
c in milliseconds.                                                      stim-003
c***********************************************************************stim-004
      dimension a(2)                                                    stim-005
      b=etime(a)                                                        stim-006
      i=1000.*(3300.-b)                                                 stim-007
      return                                                            stim-008
      end                                                               stim-009
c 03/04/98  ibm version                                         ecis96  calc-000
      subroutine calc(w,nw,dw,idmx)                                     calc-001
c main subroutine of the programme                                      calc-002
c w,nw,dw are the working space in equivalence by call,starting as      calc-003
c real*8. they are respectively real, integer and double precision.     calc-004
c idmx is the length of dw.                                             calc-005
c                                                                       calc-006
c addresses in the working field defined here (for others, see calx)    calc-007
c in common /decou/                                                     calc-008
c 34- nt       here, also reduced nuclear matrix elements               calc-009
c 35- nivq     table of multipoles                                      calc-010
c 36- nivy     table of form factor identification ivy (for computation)calc-011
c 37- nivz     table of form factor identification ivz (for use)        calc-012
c 38- ncoi     address of the table for discretisation of continuum     calc-013
c 39- mipi     same as nipi for the discretisation of continuum         calc-014
c 40- nxd      address of weights and steps of continuum                calc-015
c 41- mwv      same as nwv for the discretisation of continuum          calc-016
c 42- nixt     transmission coefficients of uncoupled states            calc-017
c 43- nty      temporary results of compound nucleus for interpolation  calc-018
c 44- ntx      partial reaction cross sections and compound nucleus     calc-019
c 45- nry      compound nucleus coefficients                            calc-020
c 46- nrco     strength of coulomb central potentials for corrections   calc-021
c 47- nrdo     strength of coulomb transition potentials for correctionscalc-022
c 48- nvc1     real potentials                                          calc-023
c 49- nvc2     imaginary potentials                                     calc-024
c 50- nnc      first free address after computation of potentials       calc-025
c 51- ncx      first free address for computation of potentials         calc-026
c other integer data of common /decou/                                  calc-027
c 52- idmt     total working field length as single precision           calc-028
c 53-98          see calx                                               calc-029
c 99- kxt      number of penetrabilities for uncoupled states           calc-030
c100- nrz      number of results to save for minimum chi2               calc-031
c101- ntz      number of memories to initialise to zero for scattering  calc-032
c              matrix and compound nucleus results                      calc-033
c102- lmax3    effective number of coulomb functions                    calc-034
c103- ipm      number pf j values used for scattering matrix (in cal1)  calc-035
c105- ipk      number pf j values used for compound nucleus (in cal1)   calc-036
c106-111         see calx                                               calc-037
c                                                                       calc-038
c in common /dblpr/  chi2,chi2m:    chi-square and minimum chi-square   calc-039
c                    cm,chb:        nuclear mass and h bar              calc-040
c                    ck,cmb,ccz:    derived constants                   calc-041
c                    xe,xm,xn:      relativistic energy and mass (colf) calc-042
c                    xz:            conversion factor to millibarns     calc-043
c for commons /pote1/ and /pote2/ see redm                              calc-044
c for common /ncomp/ see calx, lect and colf                            calc-045
c                                                                       calc-046
c ******** meaning of the logical controls lo ********                  calc-047
c                                                                       calc-048
c lo(i+100)=.not.lo(i) for i=1,100                                      calc-049
c lo(235+i)=lo(50+i) for i=1,15 during search if lo(51) to lo(65) are   calc-050
c used only for complete output                                         calc-051
c the values of the first 100 lo are read in calx on two data cards     calc-052
c the first data card is for 1-50,the second for 51-100                 calc-053
c only,the values listed on the input description are used              calc-054
c *** for their meaning, see this description *****                     calc-055
c exception if lo(36)=.true.: only the first card is read, the programmecalc-056
c does not take them into account but continue a search saved on tape 8.calc-057
c *** meaning of lo(i) for i greater than 200 ****                      calc-058
c lo(201) is true if there is no real spin-orbit potential              calc-059
c lo(202) is true if there is no imaginary spin-orbit potential         calc-060
c lo(203) is true if there is no coulomb spin-orbit potential           calc-061
c lo(204) is true if convergence is obtained in the iteration           calc-062
c lo(205) is true if convergence is obtained for this equation          calc-063
c lo(206) is true when the iteration is not the last one permitted      calc-064
c lo(207) is true if all the couplings have to be calculated beforehand calc-065
c lo(208) is true if the diagonal coulomb corrections are needed        calc-066
c lo(209) is true for dirac potentials                                  calc-067
c lo(210) is true if derivatives are needed                             calc-068
c lo(211) is true if deformations are changed in search                 calc-069
c lo(212) is true if nuclear parameters are changed in search           calc-070
c lo(213) is true if nuclear matrix elements are changed in search      calc-071
c lo(214) is true if sp.-orb. or comp. nucl. param. is changed in searchcalc-072
c lo(215) is true for no output                                         calc-073
c lo(216) is true for a stop,for example the working field is too small calc-074
c lo(217) is true for all the calculations except the first             calc-075
c lo(218) is true for last results                                      calc-076
c lo(219) is true for results without doing the calculation again       calc-077
c lo(220) is true for output and last calculation is the best one       calc-078
c lo(221) is true for optical model without coupling                    calc-079
c lo(222) is true if it is the first computation for this energy        calc-080
c lo(223) is true if lo(18) is .true. and no spin in the initial state  calc-081
c lo(224) is true for compound nucleus or punch of transmission coeff.  calc-082
c lo(225) is true in cal1 for a call to usual coupled equations subr.   calc-083
c lo(226) is true if there are observables in the laboratory system     calc-084
c lo(227) is true for coulomb corrections with pure regular functions   calc-085
c lo(228) is true for no copy of uncoupled functions and phase-shift    calc-086
c lo(229) is true for real spin-orbit or dirac equation                 calc-087
c lo(230) is true for imaginary spin-orbit or dirac equation            calc-088
c lo(231) is true if lo(18)=.true. with non zero spins for ground state calc-089
c lo(232) is true if the total spin is too large to compute comp. nuc.  calc-090
c lo(233) is true to store intermediate results for compound nucleus    calc-091
c lo(211) to lo(220) are initialised to .false. in calx                 calc-092
c lo(215) to lo(220) are initialised to .false. in eval                 calc-093
c***********************************************************************calc-094
      real*8 chi2,chi2m,cm,ck,chb,cmb,cz,ccz,xe,xm,xn,xz,dw(1)          calc-095
      logical lo(250)                                                   calc-096
      dimension w(1),nw(1)                                              calc-097
      common /decou/ njit,nipp,nipi,nwv,niph,nscn,npar,nniv,nfis,ngam,npcalc-098
     1ot,nbeta,nfm,ntgx,ndonn,nrc,niw,nde,nise,nnvi,nnwi,ncc,mcc,nxa,namcalc-099
     21,nfac,nfam,npad,nfg,nxg,nsm,nres,nxx,nt,nivq,nivy,nivz,ncoi,mipi,calc-100
     3nxd,mwv,nixt,nty,ntx,nry,nrco,nrdo,nvc1,nvc2,nnc,ncx,idmt,ncoll,njcalc-101
     4max,iterm,npp,jdm,jit,nsec,lmd,mcm(2),ncols,ncolt,kmax,kmin,nva,nbcalc-102
     5et,nbt1,lmx,lmax1,nlt,ism,iqm,iqmax,ms1,ms2,nct(6),kba,kab,kbc,kcccalc-103
     6,njc,jtx,jth,ncolr,nrec,ntot,nfa,lmax2,ke,itemm,nplace,kxt,nrz,ntzcalc-104
     7,lmax3,ipm,ipk,h,bjm,eiter,aconv,conj,aspin                       calc-105
      common /dblpr/ chi2,chi2m,cm,ck,chb,cmb,ccz,xe,xm,xn,xz           calc-106
      common /pote1/ itx(16),imax,intc,inls,invc,invd,itxm              calc-107
      common /pote2/ ity(8),invt,intv,insl,npx                          calc-108
      common /ncomp/ nsp(3),nfiss,nrd,ncont,ncoj,acn1,acn2,ncons,nie,ncocalc-109
     1lx,ndp,ndq,az(6),bz1,bz2,bz3,tg0,bn,fnug,egd,ggd,tg1,sgsq         calc-110
c without dynamical allocation of working space                         calc-111
      idmt=2*idmx                                                       calc-112
c constant computed from the atomic mass, hbar*c and alpha              calc-113
      cm=931.5017646d0                                                  calc-114
      chb=197.328604d0                                                  calc-115
      cz=137.0360411d0                                                  calc-116
      cmb=cm/chb                                                        calc-117
      ck=2.d0*cm/chb**2                                                 calc-118
      ccz=chb/cz                                                        calc-119
c main input                                                            calc-120
    1 chi2m=1.d35                                                       calc-121
c     rewind 2                                                          ak000000
      icheck=0                                                          ak000000
      call calx(w,nw,dw,lo,icheck)                                      calc-122
      if (icheck.eq.1) return                                           ak000000
      if (lo(36)) go to 14                                              calc-123
      nnc=nt                                                            calc-124
    2 nnc2=nnc/2+1                                                      calc-125
      call colf(ncolx,ncoll,w,nw(nipi),dw(nwv),dw(nfg),dw(nxg),ism,lmax1calc-126
     1,lmax2,w(nscn),h,nw(nnc),dw(nnc2),idmt-nnc,lmax3,nw(nniv),kxt,nw(ncalc-127
     2ipp),w(nipp),npx,idmt,lo)                                         calc-128
      if (lo(59)) call hora                                             calc-129
c computation of nuclear matrix elements and space for form factors     calc-130
    3 call redm(nw(nniv),nw(nt),w(nt),nw(nipi),ncoll,it,nw(nbeta),w(nbetcalc-131
     1a),nbt1,nw(niph),w(npar),nva,iqmax,aspin,dw(nfac),nfa,npp,im,idmt,calc-132
     2idmt-nt,lo)                                                       calc-133
      if (lo(59)) call hora                                             calc-134
      nivq=nt+4*it                                                      calc-135
      nivy=nivq+3*im                                                    calc-136
      nivz=nivy+7*intc                                                  calc-137
      ncoi=nivz+4*intv                                                  calc-138
      if (lo(107).or.lo(217)) go to 6                                   calc-139
      npot=ncoi                                                         calc-140
      call extp(npp,ncols,ncolx,dw(nwv),nw(nniv),nw(nt),nw(nivy),nw(nivqcalc-141
     1),nw(nipi),dw(nfac),nfa,w(npot),nw(npot),nw(npot+3),idmt-npot,idmtcalc-142
     2,lo)                                                              calc-143
      n=npot+nw(npot+2)-nt+1                                            calc-144
      n1=npot-1                                                         calc-145
      do 4 i=nt,n1                                                      calc-146
    4 nw(i+n)=nw(i)                                                     calc-147
      n2=nt-1                                                           calc-148
      do 5 i=1,n                                                        calc-149
    5 nw(n2+i)=nw(n1+i)                                                 calc-150
      npot=nt                                                           calc-151
      nt=npot+nw(npot+2)+1                                              calc-152
      nivq=nt+4*it                                                      calc-153
      nivy=nivq+3*im                                                    calc-154
      nivz=nivy+7*intc                                                  calc-155
    6 ncoi=nivz+4*intv                                                  calc-156
      mipi=ncoi+2*ncont                                                 calc-157
      nxd=(mipi+1)/2+1                                                  calc-158
      mwv=nxd                                                           calc-159
      nie=0                                                             calc-160
      nixt=mwv+15*nie                                                   calc-161
      if (ncont.eq.0) go to 7                                           calc-162
      call conu(0,w,nw(nipi),dw(nwv),nw(mipi),dw(mwv),nw(ncoi),dw(nxd),wcalc-163
     1(nscn),nw(nipp),w(nipp),kxt,lo)                                   calc-164
      nxd=(mipi+10*nie+1)/2+1                                           calc-165
      mwv=nxd+3*nie                                                     calc-166
      nixt=mwv+15*nie                                                   calc-167
      if (2*nixt.gt.idmt) call memo(idmt,2*nixt,n,3,lo)                 calc-168
      if (lo(216)) go to 13                                             calc-169
      ncolt=ncolx+nie-ncont                                             calc-170
      nsp(1)=nsp(1)+ncolt-ncolx                                         calc-171
      nsp(3)=nsp(3)+ncolt-ncolx                                         calc-172
      call conu(1,w,nw(nipi),dw(nwv),nw(mipi),dw(mwv),nw(ncoi),dw(nxd),wcalc-173
     1(nscn),nw(nipp),w(nipp),kxt,lo)                                   calc-174
    7 ndp=2*ncoll+nsp(1)+1                                              calc-175
      ndq=kba+nsp(3)-nsp(1)                                             calc-176
      nty=nixt+kxt                                                      calc-177
      nsm=nty                                                           calc-178
      if (lo(81).and.lo(233)) nsm=nsm+kmax*(kcc+2+ncolt-ncols)          calc-179
      ntx=nsm+2*njmax*kba                                               calc-180
      nry=ntx+ncols+1                                                   calc-181
      if (lo(81)) nry=ntx+ncoll+ncolt+3                                 calc-182
      nrco=nry                                                          calc-183
      if (lo(81)) nrco=nrco+kmax*ncols                                  calc-184
      nrz=nrco-nsm                                                      calc-185
      ntz=nrco-nty                                                      calc-186
      if (lo(32)) nrco=2*nrco-nsm                                       calc-187
      nrco=2*nrco-1                                                     calc-188
      nrdo=nrco+2*npx                                                   calc-189
      if (lo(100)) nrdo=nrco+2*ncolt                                    calc-190
      nvc1=nrdo+2*intv                                                  calc-191
      nvc2=nvc1+ity(2)*ism                                              calc-192
      nnc=nvc1+itx(1)*ism                                               calc-193
      if (lo(100)) nnc=nvc1+itx(7)*ism                                  calc-194
      ncx=nvc1+itxm*ism                                                 calc-195
      if (lo(54)) write (2,1000) nnc                                    calc-196
      nplace=max0(nplace,ncx,nnc+((nrec+1)*(2*ntot+2+nrec)/2))          calc-197
      if (nplace.gt.idmt) call memo(idmt,nplace,n,3,lo)                 calc-198
      if (lo(216)) go to 13                                             calc-199
      call stim(k1)                                                     calc-200
c main computation                                                      calc-201
    8 call cal1(w,nw,dw,lo)                                             calc-202
      if (lo(177)) call hora                                            calc-203
      if (lo(218).or.lo(132)) go to 15                                  calc-204
c automatic search                                                      calc-205
      if (lo(216)) go to 13                                             calc-206
      call stim(k2)                                                     calc-207
      if (lo(34)) nw(niw+1)=-1+nw(niw+2)+(k1-385*nsec)/(k1-k2)          calc-208
      k1=k2                                                             calc-209
      if (nw(niw+2).gt.1.or.lo(76).or.lo(75)) go to 10                  calc-210
c change of controls if full output was not requested at the first run  calc-211
      do 9 i=51,65                                                      calc-212
      lo(i+185)=lo(i)                                                   calc-213
      lo(i)=.false.                                                     calc-214
    9 lo(i+100)=.true.                                                  calc-215
      lo(215)=.true.                                                    calc-216
c identification of variables                                           calc-217
   10 call vari(1,ke,nw(nise),nrec,w(npot),nw(npot),npp,w(nbeta),nw(nbetcalc-218
     1a),nbet,w(npar),nva,w(nt),(nivq-nt)/4,w(nscn),w(nres),ntot,w(ntgx)calc-219
     2,ncolr,nw(niw),w(nrc),w(nxx),dw(nwv),w(nipp),nw(nivy),lo)         calc-220
c save the search on tape 8.                                            calc-221
      if (lo(35).and.nw(niw+2).ge.nw(niw+1)) call rest(0,nw,w,lo,idmt)  calc-222
c handling of variables                                                 calc-223
   11 call fite(ke,ntot,nrec,w(nres),w(nxx),w(nde),w(nrc),nw(nrc),nw(niwcalc-224
     1),w(nnc),chi2)                                                    calc-225
c transformation of variables into parameters                           calc-226
   12 call vari(0,ke,nw(nise),nrec,w(npot),nw(npot),npp,w(nbeta),nw(nbetcalc-227
     1a),nbet,w(npar),nva,w(nt),(nivq-nt)/4,w(nscn),w(nres),ntot,w(ntgx)calc-228
     2,ncolr,nw(niw),w(nrc),w(nxx),dw(nwv),w(nipp),nw(nivy),lo)         calc-229
      if (ke.eq.1) go to 16                                             calc-230
      if (lo(52).or.lo(61).or.lo(212)) go to 3                          calc-231
      go to 8                                                           calc-232
c the search is stopped and the best results are given if possible      calc-233
   13 write (2,1001) idmt                                               calc-234
      if (nw(niw+2).eq.0.or.(nw(niw+2).eq.1.and.lo(175).and.lo(176))) gocalc-235
     1 to 17                                                            calc-236
      nw(niw+1)=nw(niw+2)                                               calc-237
      go to 10                                                          calc-238
c continuation of a previous search                                     calc-239
   14 call rest(1,nw,w,lo,idmt)                                         calc-240
      if (lo(177)) call hora                                            calc-241
      call stim(k1)                                                     calc-242
      if ((ke.ne.1).and.(nw(niw+2).ne.1)) go to 12                      calc-243
      go to 11                                                          calc-244
   15 n=idmt-nplace                                                     calc-245
      write (2,1002) nplace,n                                           calc-246
      if (lo(35).and.lo(32).and.(ke.eq.0)) call rest(0,nw,w,lo,idmt)    calc-247
      if (lo(137)) go to 17                                             calc-248
      call eval(dw(nwv),nw(nipp),w(npot),nw(npot),npp,w(nbeta),nw(nbeta)calc-249
     1,nbet,w(npar),nva,w(nt),(nivq-nt)/4,w(nscn),w(ncoi),dw(nxd),nw(ncxcalc-250
     2),w(ncx),idmt-ncx,idmt,w(nrc),nw(niw),nw(nivy),lo)                calc-251
      ke=0                                                              calc-252
      if (lo(222)) go to 2                                              calc-253
   16 if (lo(212)) go to 3                                              calc-254
      go to 8                                                           calc-255
   17 call memo(idmt,0,n,2,lo)                                          calc-256
      go to 1                                                           calc-257
 1000 format (10x,22hrequired working field,i10)                        calc-258
 1001 format (//19h **** working field,i9,16h  too small ****//)        calc-259
 1002 format (//39h *** workspace used in this computation,i10,5h  ***,1calc-260
     10x,i10,18h memories not used)                                     calc-261
      end                                                               calc-262
c 11/12/97  ibm version                                         ecis97  calx-000
      subroutine calx(w,nw,dw,lo,icheck)                                calx-001
c calx and the subroutines called by it read all the input except for   calx-002
c reduced nuclear matrix elements and external form factors.            calx-003
c w,nw,dw are the working field in equivalence by call,starting as      calx-004
c double precision.                                                     calx-005
c lo is the table of logical controls (see calc) .                      calx-006
c                                                                       calx-007
c use of some parts of the working array (w,nw,dw):                     calx-008
c  1:   sp(3,ncolx) single precision floating values for the descriptioncalx-009
c            of channels. first index:                                  calx-010
c       1 - spin of incident particle                                   calx-011
c       2 - spin of the target                                          calx-012
c       3 - product of the charges of the particle and the target       calx-013
c  nipi:    ipi(10,ncolx) integer values for the description of channelscalx-014
c       1 - parity (0 for + and 1 for -)                                calx-015
c       2 - multiplicity of incident particle                           calx-016
c       3 - multiplicity of the target                                  calx-017
c       4 - index of potential or model                                 calx-018
c       5,6,7,8 - beginning and end in the two parts of table mf-fm     calx-019
c                           (see deph)                                  calx-020
c       9 - maximum angular momentum                                    calx-021
c      10 - index of potential energy dependent by dispersion relations calx-022
c  nipp:    ipp/pip(11,npp) dispersion parameters                       calx-023
c       1 - first level using this potential                            calx-024
c       2 - nv - |nv| power for volume potential                        calx-025
c       3 - nw - |nw| power for surface potential                       calx-026
c       4 - center of mass energy corresponding to the depths read      calx-027
c       5 - fermi energy                                                calx-028
c       6 - bv parameter for volume potentials                          calx-029
c       7 - second bv' parameter for volume potentials if nv<0          calx-030
c       8 - fraction of volume potentials in the first term if nv<0     calx-031
c       9 - bw parameter for surface potentials                         calx-032
c      10 - exponential decrease or second bw' parameter if nv<0        calx-033
c           for volume potentials                                       calx-034
c      11 - non-locality parameter                                      calx-035
c  nwv:     wv(15,ncolx) ibm-double precision values for the channels   calx-036
c       1 - mass of incident particle                                   calx-037
c       2 - mass of the target                                          calx-038
c       3 - energy in the center of mass in mev                         calx-039
c       4 - k wave number                                               calx-040
c       5 - coulomb parameter                                           calx-041
c       6 - square root of kf/ki (modified by ratio of step sizes)      calx-042
c       7 - energy in the center of mass in mev ( for dirac equation )  calx-043
c       8 - square root of ratio to reduced units                       calx-044
c       9 - k wave number multiplied by ratio of step sizes             calx-045
c      10 - reduced energy term                                         calx-046
c      11 - step size for this level                                    calx-047
c      12,13,14,15 - dispersion corrections (see disp)                  calx-048
c                                                                       calx-049
c addresses in the working field defined here ( common /decou/ )        calx-050
c  1- njit     data for interpolation on total spin (limit/step)        calx-051
c  2- nipp     dispersion parameters (see above)                        calx-052
c  3- nipi     integer values for the channel description (see above)   calx-053
c  4- nwv      ibm-double precision values for the channels (see above) calx-054
c  5- niph     number of phonons for the harmonic vibrational model     calx-055
c  6- nscn     level density description                                calx-056
c  7- npar     nuclear parameters                                       calx-057
c  8- nniv     addresses of reduced nuclear matrix elements and coulomb calx-058
c              integrals in niv(ncoll,ncoll,3)                          calx-059
c  9- nfis     fission data for compound nucleus                        calx-060
c 10- ngam     gamma data for compound nucleus                          calx-061
c 11- npot     optical potential parameters                             calx-062
c 12- nbeta    deformation parameters                                   calx-063
c 13- nfm      helicities and observables (see deph,lecd and obse)      calx-064
c 14- ntgx     beginning of chi2 and normalisation of data              calx-065
c 15- ndonn    experimental data                                        calx-066
c 16- nrc      permanent working field for the search                   calx-067
c 17- niw      integer working field for the search                     calx-068
c 18- nde      search accuracies                                        calx-069
c 19- nise     indexes of the variable parameters                       calx-070
c 20- nnvi     table of addresses of coupling coefficients              calx-071
c 21- nnwi     same as nnvi for symmetrised equations                   calx-072
c 22- ncc      table of energies, l*(l+1) and l*s  (see quan)           calx-073
c 23- mcc      same as ncc for symmetrised equations                    calx-074
c 24- nxa      table of coefficients of symmetrisation                  calx-075
c 25- nam1     computation of observables (see obse)                    calx-076
c 26- nfac     table of log of factorials for geometric coefficients    calx-077
c 27- nfam     matching values (see mtch)                               calx-078
c 28- npad     pade approximants                                        calx-079
c 29- nfg      coulomb functions and finite integrals                   calx-080
c 30- nxg      coulomb phases and infinite integrals                    calx-081
c 31- nsm      standard and helicity scattering matrix elements         calx-082
c 32- nres     functions for the search                                 calx-083
c 33- nxx      variables for the search                                 calx-084
c 34- nt       first free address                                       calx-085
c 35-52          see calc                                               calx-086
c other integer data of common /decou/                                  calx-087
c 53- ncoll    number of coupled channels                               calx-088
c 54- njmax    maximum number of j-values                               calx-089
c 55- iterm    maximum number of iterations                             calx-090
c 56- npp      number of optical potentials                             calx-091
c 57- jdm      minimum number of total spin                             calx-092
c 58- jit      number of rates of interpolation on total spin           calx-093
c 59- nsec     number of hundredths of second saved for final output    calx-094
c 60- lmd      dimension of a table of coefficients: 2 but 3 for dirac  calx-095
c 61- mcm(1)   maximum angular momentum for central coulomb corrections calx-096
c 62- mcm(2)   maximum angular momentum for spin-orbit coulomb correct. calx-097
c 63- ncols    number of channels with angular distributions            calx-098
c 64- ncolt    number of channels including uncoupled states            calx-099
c 65- kmax     maximum number of j values for compound nucleus          calx-100
c 66- kmin     minimum number of j values for compound nucleus          calx-101
c 67- nva      number of nuclear parameters                             calx-102
c 68- nbet     number of different deformations (vibrations+rotations)  calx-103
c 69- nbt1     number of phonons (vibrations)                           calx-104
c 70- lmx      difference between number of j-values and of coul. funct.calx-105
c 71- lmax1    number of l-values for coulomb functions                 calx-106
c 72- nlt      memories needed for legendre polynomials                 calx-107
c 73- ism      number of integration steps                              calx-108
c 74- iqm      maximum l-value of deformation in rotational model       calx-109
c 75- iqmax    maximum l-expansion in rotational model                  calx-110
c 76- ms1      largest particle multiplicity                            calx-111
c 77- ms2      largest target multiplicity                              calx-112
c 78- nct(6)   number of equations for each parity in 1 and 2           calx-113
c              number of solutions for each parity in 3 and 4           calx-114
c              number of comp. nucl. coeff. for each parity in 5 and 6  calx-115
c 84- kba      number of independent amplitudes without uncoupled statescalx-116
c 85- kab      maximum number of equations                              calx-117
c 86- kbc      maximum number of solutions                              calx-118
c 87- kcc      number of independent amplitudes with uncoupled states   calx-119
c 88- njc      maximum number of observables at equidistant angles      calx-120
c 89- jtx      maximum number of calculated values for a plot           calx-121
c 90- jth      maximum number of angles for a plot                      calx-122
c 91- ncolr    number of experimental angular distributions             calx-123
c 92- nrec     number of variables in search                            calx-124
c 93- ntot     number of experimental data                              calx-125
c 94- nfa      number of logarithms of factorials                       calx-126
c 95- lmax2    number of l values for coulomb phases                    calx-127
c 96- ke       control of search (see fite)                             calx-128
c 97- itemm    maximum number of iterations at the beginning of a run   calx-129
c 98- nplace   maximum working field used                               calx-130
c 99-104          see calc                                              calx-131
c other non integer data of common /decou/                              calx-132
c105- h        step size for integration                                calx-133
c106- bjm      convergence coefficient of imaginary potential           calx-134
c107- eiter    convergence criterion for s-matrix                       calx-135
c108- aconv    convergence criterion for potential and function         calx-136
c109- conj     convergence criterion for the scattering amplitudes      calx-137
c110- aspin    k-value of the rotational band                           calx-138
c                                                                       calx-139
c                                                                       calx-140
c common /ncomp/nsp(1) number of uncoupled levels for compound nucleus  calx-141
c                      including discretisation of continuum            calx-142
c               nsp(2) number of these levels with angular distribution calx-143
c               nsp(3) number of these levels without angular distrib.  calx-144
c               nfiss  number of fission transmission coefficients      calx-145
c               nrd    number of gamma transmission coefficients        calx-146
c               ncont: number of continuum for compound nucleus         calx-147
c               ncoj:  number of spins of the target for a continuum    calx-148
c               acn1:  ratio size/step for discretisation of a continuumcalx-149
c               acn2:  maximum number of steps by mev for a continuum   calx-150
c               ncons: number of level densities needed                 calx-151
c               nie:   number of uncoupled states added for discret.    calx-152
c               ncolx: total number of levels without discretisation    calx-153
c               ndp:   address of fission and gamma final results       calx-154
c               ndq:   address of fission and gamma intermediate resultscalx-155
c               az,bz,....: see lect and colf                           calx-156
c common /titr/ title: comment card reproduced in the output            calx-157
c               theta1,theta2,dtheta,dthe    see lect                   calx-158
c               ncj:   number of factorisations of 1/(1-cos)            calx-159
c               jmm:  used between resu and scat                        calx-160
c               nl:   directives for expansion with legendre polynomialscalx-161
c***********************************************************************calx-162
      logical lo(250)                                                   calx-163
      double precision dw(1)                                            calx-164
      dimension w(1),nw(1),ngr(2),npr(2),desc(5),to(100)                calx-165
      common /decou/ njit,nipp,nipi,nwv,niph,nscn,npar,nniv,nfis,ngam,npcalx-166
     1ot,nbeta,nfm,ntgx,ndonn,nrc,niw,nde,nise,nnvi,nnwi,ncc,mcc,nxa,namcalx-167
     21,nfac,nfam,npad,nfg,nxg,nsm,nres,nxx,nt,nivq,nivy,nivz,ncoi,mipi,calx-168
     3nxd,mwv,nixt,nty,ntx,nry,nrco,nrdo,nvc1,nvc2,nnc,ncx,idmt,ncoll,njcalx-169
     4max,iterm,npp,jdm,jit,nsec,lmd,mcm(2),ncols,ncolt,kmax,kmin,nva,nbcalx-170
     5et,nbt1,lmx,lmax1,nlt,ism,iqm,iqmax,ms1,ms2,nct(6),kba,kab,kbc,kcccalx-171
     6,njc,jtx,jth,ncolr,nrec,ntot,nfa,lmax2,ke,itemm,nplace,kxt,nrz,ntzcalx-172
     7,lmax3,ipm,ipk,h,bjm,eiter,aconv,conj,aspin                       calx-173
      common /ncomp/ nsp(3),nfiss,nrd,ncont,ncoj,acn1,acn2,ncons,nie,ncocalx-174
     1lx,ndp,ndq,az(6),bz1,bz2,bz3,tg0,bn,fnug,egd,ggd,tg1,sgsq         calx-175
      common /titr/ title(18),theta1,theta2,dtheta,dthe,ncj,jmm(2),nl(3)calx-176
      data fin,desc /4hfin ,4hdesc,4hript,4hion ,2h t,2h  /             calx-177
    1 read (1,1000) title                                               calx-178
      do 2 j=1,3                                                        calx-179
      if (title(j).ne.desc(j)) go to 3                                  calx-180
    2 continue                                                          calx-181
      call inpa                                                         calx-182
      call inpb                                                         calx-183
      call inpc                                                         calx-184
      go to 1                                                           calx-185
    3 if (title(1).eq.fin) then                                         ak000000
        icheck=1                                                        ak000000
        return                                                          ak000000
      endif                                                             ak000000
      do 4 i=1,100                                                      calx-187
    4 lo(i)=.false.                                                     calx-188
      read (1,1001) (lo(i),i=1,50)                                      calx-189
c if lo(36)=.true. return to restart a search saved on tape 8           calx-190
      if (lo(36)) return                                                calx-191
      read (1,1001) (lo(i),i=51,100)                                    calx-192
      read (1,1002) ncoll,njmax,iterm,npp,ncj,ngr,npr,lmz,jdm,lml,jit,nscalx-193
     1ec                                                                calx-194
c elimination of contradictions between logical controls                calx-195
      if (ncoll.le.1) lo(28)=.true.                                     calx-196
      if (.not.lo(31)) lo(32)=.false.                                   calx-197
      if (lo(14)) lo(13)=.true.                                         calx-198
      if (lo(19)) lo(11)=.true.                                         calx-199
      if (lo(92)) iterm=1                                               calx-200
      if (lo(18)) lo(29)=.true.                                         calx-201
      if (lo(100)) lo(29)=.false.                                       calx-202
      lo(209)=lo(99).or.lo(100)                                         calx-203
      if (lo(82)) lo(84)=.false.                                        calx-204
      if (lo(82)) lo(85)=.false.                                        calx-205
      if (lo(82)) lo(86)=.false.                                        calx-206
      if (lo(82).or.lo(84).or.lo(85).or.lo(86)) lo(81)=.true.           calx-207
      lo(44)=lo(44).and.lo(11)                                          calx-208
      if (.not.lo(99)) go to 5                                          calx-209
      lo(11)=.false.                                                    calx-210
      lo(19)=.false.                                                    calx-211
      if (lo(1)) lo(3)=.false.                                          calx-212
      if (.not.lo(1)) lo(2)=.false.                                     calx-213
      if ((.not.lo(10)).or.(.not.lo(12))) lo(20)=.false.                calx-214
    5 lmd=2                                                             calx-215
      lo(224)=lo(81).or.lo(63)                                          calx-216
      if (lo(100)) lmd=3                                                calx-217
      write (2,1003) idmt                                               calx-218
c output of logical controls                                            calx-219
      if (.not.lo(71)) go to 6                                          calx-220
      write (2,1004) (lo(i),lo(i+43),i=1,2),lo(46),(lo(i),lo(i+48),i=3,9calx-221
     1)                                                                 calx-222
      write (2,1005) (lo(i),lo(i+48),i=10,11),lo(12),(lo(i),lo(i+48),i=1calx-223
     13,20)                                                             calx-224
      write (2,1006) lo(69),lo(21),lo(22),lo(71),lo(72),lo(23),lo(73),(lcalx-225
     1o(i+50),lo(i),i=24,28)                                            calx-226
      write (2,1007) lo(81),lo(29),lo(82),(lo(i+52),lo(i),i=31,35),(lo(icalx-227
     1),lo(i+55),i=36,37),lo(93),lo(94),lo(41),lo(98)                   calx-228
      write (2,1008) (lo(i),lo(i+57),i=42,43)                           calx-229
    6 do 7 i=1,100                                                      calx-230
      to(i)=desc(5)                                                     calx-231
      if (lo(i)) to(i)=desc(4)                                          calx-232
    7 lo(100+i)=.not.lo(i)                                              calx-233
      if (lo(171)) write (2,1009) to                                    calx-234
      write (2,1010) title                                              calx-235
      if (lo(59).or.lo(177)) call hora                                  calx-236
      read (1,1011) h,rm,bjm,eiter,aconv,conj                           calx-237
c defect values of njmax,iterm,npp,ncj,npr,ngr,eiter,aconv,conj         calx-238
c for npr and ngr, see deph                                             calx-239
      if (njmax.eq.0) njmax=20                                          calx-240
      if (iterm.eq.0) iterm=20                                          calx-241
      if (npp.eq.0) npp=1                                               calx-242
      if (npr(1).eq.0) npr(1)=1                                         calx-243
      if (npr(2).eq.0) npr(2)=1                                         calx-244
      if (ngr(1).eq.0) ngr(1)=2                                         calx-245
      if (ngr(2).eq.0) ngr(2)=2                                         calx-246
      if (ncj.le.0) ncj=1                                               calx-247
      if (jit.eq.0) jit=1                                               calx-248
      if (nsec.eq.0) nsec=100                                           calx-249
      if (eiter.eq.0.) eiter=1.e-5                                      calx-250
      if (aconv.eq.0.) aconv=1.e-5                                      calx-251
      if (conj.eq.0.) conj=1.e-5                                        calx-252
c output of title, masses, etc..                                        calx-253
      write (2,1012) njmax,jdm,conj,ngr,npr                             calx-254
      if (lo(41)) write (2,1013) ncj                                    calx-255
      if (lml.ne.0) write (2,1014) lml                                  calx-256
      if (lo(121)) write (2,1015) iterm,eiter,aconv                     calx-257
      lo(228)=lo(21).or.lo(29).or.bjm.ne.0.                             calx-258
      if (bjm.ne.0.) write (2,1016) bjm                                 calx-259
      if (lo(21)) write (2,1017)                                        calx-260
      if (lo(21).and.lo(42)) write (2,1018) iterm                       calx-261
      if (lo(32).and.lo(34)) write (2,1019) nsec                        calx-262
c initialisation of a search or a single run                            calx-263
      do 8 i=211,220                                                    calx-264
    8 lo(i)=.false.                                                     calx-265
      lo(222)=.true.                                                    calx-266
      call memo(idmt,0,m,1,lo)                                          calx-267
      if (lo(216)) go to 23                                             calx-268
c limitation on angular momentum for coulomb corrections                calx-269
      mcm(1)=3                                                          calx-270
      mcm(2)=2                                                          calx-271
      if (lo(145)) go to 9                                              calx-272
      read (1,1002) mc1,mc2                                             calx-273
      if (mc1.gt.0) mcm(1)=min0(mc1,4)                                  calx-274
      if (lo(200).and.(mc2.gt.0)) mcm(2)=min0(mc2,2)                    calx-275
      if (lo(100).and.(mc2.gt.0)) mcm(2)=min0(mc2,3)                    calx-276
      if (mc1.lt.0) mcm(1)=0                                            calx-277
      if (mc2.lt.0) mcm(2)=0                                            calx-278
      write (2,1020) mcm                                                calx-279
    9 nl2=3*njmax                                                       calx-280
      nl3=2*njmax                                                       calx-281
c legendre polynomials data                                             calx-282
      if (lo(165)) go to 10                                             calx-283
      read (1,1002) nl                                                  calx-284
      if (nl(1).eq.0) nl(1)=2                                           calx-285
      if (nl(2).ne.0) nl2=nl(2)                                         calx-286
      if (nl(3).ne.0) nl3=nl(3)                                         calx-287
      if (lo(65)) write (2,1021) nl                                     calx-288
c compound nucleus data                                                 calx-289
   10 nsp(1)=0                                                          calx-290
      nsp(2)=0                                                          calx-291
      nsp(3)=0                                                          calx-292
      nfiss=0                                                           calx-293
      nrd=0                                                             calx-294
      ncont=0                                                           calx-295
      ncons=0                                                           calx-296
      if (lo(184).and.lo(185).and.lo(186)) go to 11                     calx-297
      read (1,1022) nsp(1),nsp(2),nfiss,nrd,ncont,ncoj,kmin,kmax,acn1,accalx-298
     1n2                                                                calx-299
      if (lo(184)) nsp(1)=0                                             calx-300
      nsp(2)=min0(nsp(1),nsp(2))                                        calx-301
      nsp(3)=nsp(1)-nsp(2)                                              calx-302
      if (nsp(3).lt.ncont) go to 21                                     calx-303
      if (lo(185)) nfiss=0                                              calx-304
      if (lo(186)) nrd=0                                                calx-305
      if (nfiss.eq.0) lo(85)=.false.                                    calx-306
      lo(185)=.not.lo(85)                                               calx-307
      if (lo(84).or.lo(85).or.lo(86)) write (2,1023) nsp,nfiss,nrd,ncontcalx-308
      ncons=ncont                                                       calx-309
      if (lo(86).and.nrd.eq.0) ncons=ncons+1                            calx-310
      if (ncont.eq.0) go to 11                                          calx-311
      if (ncoj.le.0) ncoj=30                                            calx-312
      if (acn1.le.1.) acn1=8.                                           calx-313
      if (acn2.le.1.) acn2=8.                                           calx-314
      write (2,1024) ncoj,acn1,acn2                                     calx-315
   11 ncolx=ncoll+nsp(1)                                                calx-316
      ncols=ncoll+nsp(2)                                                calx-317
      ncolt=ncolx                                                       calx-318
      njit=3*ncolx+1                                                    calx-319
      nipp=njit                                                         calx-320
c interpolation data                                                    calx-321
      if (lo(143)) go to 13                                             calx-322
      nipp=njit+2*jit                                                   calx-323
      n=nipp-1                                                          calx-324
      read (1,1002) (nw(i),i=njit,n)                                    calx-325
      write (2,1025) (nw(i),i=njit,n)                                   calx-326
      m=0                                                               calx-327
      l=-1                                                              calx-328
      k=njit                                                            calx-329
      do 12 i=1,jit                                                     calx-330
      if (nw(k).lt.l) go to 22                                          calx-331
      l=nw(k)                                                           calx-332
      nw(k+1)=nw(k+1)-m                                                 calx-333
      m=m+nw(k+1)                                                       calx-334
   12 k=k+2                                                             calx-335
      write (2,1026) (nw(i+1),i=njit,n,2)                               calx-336
c input of level descriptions                                           calx-337
   13 nipi=nipp+11*npp                                                  calx-338
      nwv=(nipi+10*ncolx)/2+1                                           calx-339
      niph=2*(nwv+15*ncolx)-1                                           calx-340
      nfm=niph+6*ncols                                                  calx-341
      if (nfm+20*ncols.gt.idmt) call memo(idmt,nfm+20*ncols,m,2,lo)     calx-342
      if (lo(216)) go to 23                                             calx-343
      nscn=niph                                                         calx-344
      call lecl(ncolx,ncoll,npp,w,nw(nipi),nw(nipp),dw(nwv),nw(niph),npacalx-345
     1r,nva,ncont,nscn,aimax,nbet,w(nfm),lo)                            calx-346
      if (kmin.eq.0) kmin=iabs(nw(nipi+1)-nw(nipi+2))/2+nw(nipi)        calx-347
      if (kmax.eq.0) kmax=njmax                                         calx-348
      lo(233)=lo(43).and.((nw(njit).lt.kmax).or.(nw(njit+1).ne.0))      calx-349
c input of potentials, deformations ......                              calx-350
      nniv=nscn+8*ncons                                                 calx-351
      nbt1=nbet                                                         calx-352
      lmx=aimax+3.1                                                     calx-353
      lmax1=njmax+lmx                                                   calx-354
      if (lml.eq.0) lml=lmax1                                           calx-355
      nw(nipi+8)=lml                                                    calx-356
      nfis=nniv+3*ncoll*ncoll                                           calx-357
      ngam=nfis+2*nfiss                                                 calx-358
      npot=ngam+nrd                                                     calx-359
      nbeta=npot+34*npp                                                 calx-360
      if (lo(7)) nbeta=npot                                             calx-361
      nfm=nbeta                                                         calx-362
      if (nfm+10*nbet.gt.idmt) call memo(idmt,nfm+10*nbet,m,2,lo)       calx-363
      if (lo(216)) go to 23                                             calx-364
      if (w(nwv+4).eq.0.) nl2=nl3                                       calx-365
      nlt=max0(nl2,nl3)                                                 calx-366
      if (lo(165)) nlt=0                                                calx-367
      call lect(nbet,w,nw(nipp),w(nipp),dw(nwv),nw(nbeta),w(nbeta),w(npocalx-368
     1t),w(nfis),w(ngam),npp,nfm,rm,aconv,idmt,idmt-nfm,h,aspin,ism,iqm,calx-369
     2iqmax,w(nscn),lo)                                                 calx-370
      if (lo(59)) call hora                                             calx-371
c helicity amplitudes and observables                                   calx-372
      njx=ncoll                                                         calx-373
      call deph(ncoll,ncols,w,dw(nwv),nw(nipi),nw(nfm),w(nfm),ms1,ms2,nccalx-374
     1t,kcc,kba,kab,kbc,ktgr,ngr,npr,jtx,idmt,nw(nniv),njc,njx,njy,idmt-calx-375
     2nfm,lo)                                                           calx-376
      jth=0                                                             calx-377
      if (lo(166)) jth=int((theta2-theta1)/dtheta+1.5)                  calx-378
      jtx=jtx*jth                                                       calx-379
      ngrm=nfm+9*kcc                                                    calx-380
      nmax=nfm+9*ktgr                                                   calx-381
      ktg=ktgr                                                          calx-382
      nrec=0                                                            calx-383
      ntot=0                                                            calx-384
      if (lo(131)) go to 18                                             calx-385
c number of parameters in search and experimental data                  calx-386
      read (1,1027) ncolr,nrec,nfit,nessai,ech,rap                      calx-387
      write (2,1028) ncolr                                              calx-388
      if (ncolr.le.0) go to 16                                          calx-389
      ndonn=nmax+18*ncolr                                               calx-390
      ktgr=ktgr+ncolr                                                   calx-391
c experimental data                                                     calx-392
      if (idmt.le.ndonn) call memo(idmt,ndonn,n,3,lo)                   calx-393
      if (lo(216)) go to 23                                             calx-394
      call lecd(ncols,ncolr,ktg,nw(nfm),w(nfm),w(ndonn),ngr,ntot,jth,njycalx-395
     1,idmt,idmt-ndonn,lo)                                              calx-396
      jtx=max0(jth,jtx)                                                 calx-397
      nmax=ndonn+6*ntot                                                 calx-398
      if (lo(132)) go to 18                                             calx-399
      if (nrec.le.0) go to 17                                           calx-400
c search conditions                                                     calx-401
c defect values for nessai (maximum number of evaluations) and ech      calx-402
c nfit is the number of functions stored for search beyond nrec+1       calx-403
      nrc=nmax                                                          calx-404
      if (nessai.eq.0) nessai=100                                       calx-405
      if (ech.eq.0.) ech=20.                                            calx-406
      if (rap.lt.1.) rap=1.                                             calx-407
      kfit=nrec+nfit+1                                                  calx-408
      niw=nrc+3+max0(14+nrec+kfit*(ntot+nrec+1),(nrec*(nrec+5))/2)      calx-409
      if (idmt.le.niw) call memo(idmt,niw,n,3,lo)                       calx-410
      if (lo(216)) go to 23                                             calx-411
      nw(niw)=kfit                                                      calx-412
      nw(niw+1)=nessai                                                  calx-413
      nw(niw+2)=1                                                       calx-414
      w(nrc)=ech                                                        calx-415
      w(nrc+1)=rap                                                      calx-416
      w(nrc+2)=0.                                                       calx-417
      write (2,1029) nrec,kfit,nessai,ech,rap                           calx-418
      nde=niw+kfit+4                                                    calx-419
      nise=nde+nrec                                                     calx-420
      read (1,1011) (w(nde-1+j),j=1,nrec)                               calx-421
      read (1,1002) (nw(nise-1+i),i=1,nrec)                             calx-422
      write (2,1030) (i,nw(nise+i-1),w(nde+i-1),i=1,nrec)               calx-423
      nmax=nise+nrec                                                    calx-424
      do 14 i=1,nrec                                                    calx-425
c a negative value -k instead of indexes of parameters means that k     calx-426
c parameters will be kept proportional - input of their indexes         calx-427
      k=nw(nise+i-1)                                                    calx-428
      if (k.gt.0) go to 14                                              calx-429
      k=-k                                                              calx-430
      nw(nmax)=k                                                        calx-431
      read (1,1002) (nw(nmax+j),j=1,k)                                  calx-432
      write (2,1031) i,(nw(nmax+j),j=1,k)                               calx-433
      nw(nise+i-1)=nise-nmax-1                                          calx-434
      nmax=nmax+k+1                                                     calx-435
   14 continue                                                          calx-436
      if (lo(76).or.lo(175)) go to 18                                   calx-437
      do 15 i=51,65                                                     calx-438
      lo(i+185)=lo(i)                                                   calx-439
      lo(i)=.false.                                                     calx-440
   15 lo(i+100)=.true.                                                  calx-441
      lo(215)=.true.                                                    calx-442
      go to 18                                                          calx-443
   16 write (2,1032)                                                    calx-444
      lo(31)=.false.                                                    calx-445
      lo(131)=.true.                                                    calx-446
   17 if (lo(32)) write (2,1033)                                        calx-447
      lo(32)=.false.                                                    calx-448
      lo(132)=.true.                                                    calx-449
   18 if (lo(59)) call hora                                             calx-450
      ntgx=nfm+9*ktgr                                                   calx-451
      nnvi=nmax                                                         calx-452
      nnwi=nnvi                                                         calx-453
      if (lo(231)) nnwi=nnwi+3*kab*kab                                  calx-454
      ncc=nnwi+4*kab*kab                                                calx-455
      mcc=ncc                                                           calx-456
      if (lo(231)) mcc=mcc+6*kab                                        calx-457
      nxa=(mcc+6*kab)/2+1                                               calx-458
      nam1=nxa                                                          calx-459
      if (lo(231)) nam1=nam1+kbc*kbc                                    calx-460
      nam2=nam1+4*(njy+9)                                               calx-461
      if (2*nam2.gt.idmt) call memo(idmt,2*nam2,n,3,lo)                 calx-462
      if (lo(216)) go to 23                                             calx-463
c do loops and cg-coefficients for observables                          calx-464
      call obse(nw(ngrm),ktgr-kcc,ncolr,nw(nipi),dw(nam1),nw(2*nam1-1),dcalx-465
     1w(nam2),nw(2*nam2-1),jcal,idmt-2*nam2,idmt,lo)                    calx-466
      nfa=4*lmax1+10-2*njmax                                            calx-467
      nfac=nam1+jcal                                                    calx-468
      nfam=nfac+nfa+1                                                   calx-469
      npad=nfam+kab*(2*kbc+8)                                           calx-470
      if (lo(224)) npad=nfam+kab*(2*kab+8)                              calx-471
      nfg=npad+2*iterm*(kab+2)                                          calx-472
      if (lo(21).or.lo(22)) nfg=npad                                    calx-473
      lmax2=lmax1                                                       calx-474
      if (.not.lo(208)) go to 19                                        calx-475
      lmax1=lmz+lmx                                                     calx-476
      if (lmz.eq.0) lmax1=lmax2-njmax/2                                 calx-477
      if (lmz.lt.0) lmax1=lmax2                                         calx-478
      write (2,1034) lmax2,lmax1                                        calx-479
   19 nxg=nfg+4*njx*lmax1                                               calx-480
      nres=2*(nxg+njx*lmax2)-1                                          calx-481
      ke=0                                                              calx-482
      nxx=nres+ntot                                                     calx-483
      nt=2*((nxx+nrec)/2)+1                                             calx-484
      itemm=iterm                                                       calx-485
      nplace=nt                                                         calx-486
      if (idmt.le.nplace) call memo(idmt,nplace,n,3,lo)                 calx-487
      if (lo(216)) go to 23                                             calx-488
      dw(nfac)=0.d0                                                     calx-489
      do 20 i=1,nfa                                                     calx-490
      dw(nfac+i)=i                                                      calx-491
   20 dw(nfac+i)=dw(nfac+i-1)+dlog(dw(nfac+i))                          calx-492
      return                                                            calx-493
   21 write (2,1035) nsp(3),ncont                                       calx-494
      go to 23                                                          calx-495
   22 write (2,1036) i,nw(k),l                                          calx-496
   23 write (2,1037)                                                    calx-497
      stop                                                              calx-498
 1000 format (18a4)                                                     calx-499
 1001 format (50l1)                                                     calx-500
 1002 format (14i5)                                                     calx-501
 1003 format (1h1,20x,82he. c. i. s. code for coupled channels calculaticalx-502
     1ons ( 1997 ) working field length =,i10//24x,87hto obtain the inpucalx-503
     2t description, punch 'description ' in columns 1-12 of the first ccalx-504
     3ard//)                                                            calx-505
 1004 format (4h  1-,l2,45h - rotational model-(.f.: vibrational model).calx-506
     1,8x,5h| 44-,l2,23h - coulomb corrections./4h  2-,l2,58h - second ocalx-507
     2rder vibrational model-(.f.: first order) | 45-,l2,50h - angular mcalx-508
     3omentum limit for coulomb corrections./9x,43hor constrained asymmecalx-509
     4tric rotational model.,7x,5h| 46-,l2,34h - restricted coulomb corrcalx-510
     5ections./4h  3-,l2,54h - anharmonic vibrational model-(.f.: harmoncalx-511
     6ic) or   |/9x,45hasymmetric rotational model-(.f.: symmetric).,5x,calx-512
     75h| 51-,l2,24h - output of potentials./4h  4-,l2,58h - parametrisecalx-513
     8d spin-orbit deformation-(.f.:standard)| 52-,l2,45h - output of recalx-514
     9duced nuclear matrix elements./4h  5-,l2,58h - different deformaticalx-515
     aon for each potential(.f.:same)| 53-,l2,38h - output of the numbercalx-516
     b of iterations./4h  6-,l2,30h - use of deformation lengths.,23x,5hcalx-517
     c| 54-,l2,50h - output of the length used in the working field./4h calx-518
     d 7-,l2,58h - nuclear matrix elements and form factors on cards.| 5calx-519
     e5-,l2,31h - output of c-matrix elements./4h  8-,l2,27h - relativiscalx-520
     ftic kinematics.,26x,5h| 56-,l2,51h - output of s-matrix elements acalx-521
     gnd compound nucleus/4h  9-,l2,43h - symmetrised woods-saxon form fcalx-522
     hactors for,10x,1h|,9x,21hintermediate results./9x,30hnegative valucalx-523
     ies of the radius.,20x,5h| 57-,l2,53h - output of phase-shifts at ecalx-524
     jach e.c.i.s. iteration.)                                          calx-525
 1005 format (4h 10-,l2,39h - dispersion relations for potentials.,14x,5calx-526
     1h| 58-,l2,50h - output of the coefficients of each form factor./59calx-527
     2x,1h|,9x,26hfor all sets of equations./4h 11-,l2,30h - deformed cocalx-528
     3ulomb potential.,23x,5h| 59-,l2,39h - output of time differences icalx-529
     4n a run./4h 12-,l2,32h - deformed imaginary potential.,21x,1h|/4h calx-530
     513-,l2,45h - deformed real spin-orbit/tensor potential.,8x,5h| 61-calx-531
     6,l2,52h - reduced nuclear matrix elements punched on cards./4h 14-calx-532
     7,l2,58h - deformed imaginary spin-orbit/tensor potential.   | 62-,calx-533
     8l2,31h - potentials punched on cards./4h 15-,l2,58h - reduced nuclcalx-534
     9ear matrix elements read from cards.  | 63-,l2,36h - penetrabiliticalx-535
     aes punched on cards./4h 16-,l2,58h - heavy-ion definition of radiicalx-536
     b and deformations.   | 64-,l2,50h - results at equidistant angles calx-537
     cpunched on cards./4h 17-,l2,17h - folding model.,36x,5h| 65-,l2,49calx-538
     dh - legendre expansion for cross-sections punched./4h 18-,l2,40h -calx-539
     e projectile-target antisymmetrisation.,13x,5h| 66-,l2,40h - no calcalx-540
     fculation at equidistant angles./4h 19-,l2,41h - deformed coulomb scalx-541
     gpin-orbit potential.,12x,5h| 67-,l2,32h - no plot of experimental calx-542
     hdata./4h 20-,l2,58h - dispersion relations for transition form-faccalx-543
     itors. | 68-,l2,51h - no plot of cross-sections at equidistant anglcalx-544
     jes.)                                                              calx-545
 1006 format (59x,5h| 69-,l2,50h - no plot of polarisations at equidistacalx-546
     1nt angles./4h 21-,l2,45h - usual coupled equations-(.f.: iterationcalx-547
     2s).,8x,1h|/4h 22-,l2,49h - no use of pade approximants for convergcalx-548
     3ence of,4x,5h| 71-,l2,39h - detailed output of logical controls./9calx-549
     4x,15hthe iterations.,35x,5h| 72-,l2,51h - no output of experimentacalx-550
     5l data as they are read./4h 23-,l2,42h - no use of pade approximancalx-551
     6t results when,11x,5h| 73-,l2,53h - no output of external potentiacalx-552
     7ls as they are read./9x,28hconvergence is not obtained.,22x,5h| 74calx-553
     8-,l2,35h - output of variations in storage./4h 24-,l2,58h - couplicalx-554
     9ng potentials computed at each iteration.   | 75-,l2,51h - no compcalx-555
     alete output at the first run of a search./4h 25-,l2,58h - completecalx-556
     b calculation up to the end-(.f.: one ite- | 76-,l2,50h - lo(51) tocalx-557
     c lo(65) are always used-(.f.: only for/9x,51hration only as soon acalx-558
     ds two iterations are enough) |,9x,16hcomplete output)/4h 26-,l2,58calx-559
     eh - integration stabilised for long range potential.  | 77-,l2,51hcalx-560
     f - no output of time differences during the search./4h 27-,l2,58h calx-561
     g- numerov's method for single equations-(.f.: modi- | 78-,l2,48h -calx-562
     h no output of differences between experimental/9x,23hfied numerov'calx-563
     is method).,27x,1h|,9x,22hand calculated values./4h 28-,l2,54h - cocalx-564
     jmputation up to j-convergence-(.f.: stop when   |)                calx-565
 1007 format (9x,43hall the inhomogeneous terms are negligible),7x,5h| 8calx-566
     11-,l2,49h - hauser-feshbach corrections to cross-sections./4h 29-,calx-567
     2l2,38h - no diagonal term in second members.,15x,5h| 82-,l2,39h - calx-568
     3simplest compound nucleus formalism./59x,5h| 83-,l2,47h - no engelcalx-569
     4bretch-weidenmuller transf. in c.-n./4h 31-,l2,58h - input of expecalx-570
     5rimental data and chi2 calculation.  | 84-,l2,41h - uncoupled levecalx-571
     6ls for compound nucleus./4h 32-,l2,39h - automatic search on some calx-572
     7parameters.,14x,5h| 85-,l2,36h - fission data in compound nucleus.calx-573
     8/4h 33-,l2,39h - symmetrised chi2 for cross-sections.,14x,5h| 86-,calx-574
     9l2,43h - gamma emission data in compound nucleus./4h 34-,l2,58h - calx-575
     anumber of evaluations limited by the job card.    | 87-,l2,25h - ncalx-576
     bo width fluctuations./4h 35-,l2,54h - search saved on tape 8 if encalx-577
     cded by lack of time.  |/4h 36-,l2,32h - restart a search from tapecalx-578
     d 8.,21x,5h| 91-,l2,47h - equidistant angles in the laboratory systcalx-579
     eem./4h 37-,l2,47h - next calculation changing energy and/or some,6calx-580
     fx,5h| 92-,l2,25h - pure dwba calculation./9x,11hparameters.,39x,5hcalx-581
     g| 93-,l2,38h - no recoil correction for reactions./59x,5h| 94-,l2,calx-582
     h50h - non standard observables at equidistant angles./4h 41-,l2,58calx-583
     ih - factorisation of 1/(1-cos(theta)) in amplitudes.  | 98-,l2,39hcalx-584
     j - use of rest mass in dirac equations.)                          calx-585
 1008 format (4h 42-,l2,58h - schmidt's orthogonal. in usual coupled equcalx-586
     1ations. | 99-,l2,45h - schroedinger equivalent to dirac equation./calx-587
     24h 43-,l2,31h - interpolation on total spin.,22x,5h|100-,l2,27h - calx-588
     3complete dirac equation./1h1)                                     calx-589
 1009 format (//29h **** first control card ****,2x,2h1 ,9(2h 1),3h 2 ,9calx-590
     1(2h 2),3h 3 ,9(2h 3),3h 4 ,9(2h 4),2h 5/11x,5(21h  1 2 3 4 5 6 7 8calx-591
     2 9 0)/11x,5(1x,10a2)//29h *** second control card ****,2x,2h1 ,9(2calx-592
     3h 1),3h 2 ,9(2h 2),3h 3 ,9(2h 3),3h 4 ,9(2h 4),2h 5/11x,5(21h  1 2calx-593
     4 3 4 5 6 7 8 9 0)/11x,5(1x,10a2)/)                                calx-594
 1010 format (10x,82(1h*)/10x,1h*,80x,1h*/10x,1h*,4x,18a4,4x,1h*/10x,1h*calx-595
     1,80x,1h*/10x,82(1h*)/)                                            calx-596
 1011 format (7f10.3)                                                   calx-597
 1012 format (20h maximum number of j,i6,6h  (min,i3,49h) stop when maxicalx-598
     1mum s-matrix element is less than,e18.4//35h plot conditions for ccalx-599
     2ross-sections,2i5,5x,17hfor polarisations,2i5/)                   calx-600
 1013 format (4x,i3,52h factorisation of 1/(1-cos(theta)) in the amplitucalx-601
     1des)                                                              calx-602
 1014 format (27h angular momenta limited to,i5)                        calx-603
 1015 format (10x,47hiteration method:  maximum number of iterations,i10calx-604
     1/10x,22hconvergence criterion:,e15.2,13h for s-matrix,e15.2,29h focalx-605
     2r potentials and functions/)                                      calx-606
 1016 format (44h imaginary potential increased with a factor,f10.5,23h calx-607
     1for better convergence)                                           calx-608
 1017 format (24h usual coupled equations)                              calx-609
 1018 format (34h schmidt's orthogonalisation every,i5,7h  steps)       calx-610
 1019 format (5x,i5,44h hund of second spared at the end of the job)    calx-611
 1020 format (47h coulomb corrections limited to angular momenta,i2,21h calx-612
     1for central term and,i2,20h for spin-orbit term)                  calx-613
 1021 format (/69h indications for expansion of cross-sections in legendcalx-614
     1re polynomials:,3i5)                                              calx-615
 1022 format (8i5,2f10.5)                                               calx-616
 1023 format (/24h compound nucleus input:,i5,17h uncoupled states,i4,30calx-617
     1h with angular distribution and,i4,29h without angular distributiocalx-618
     2n/24x,i5,23h fission transm. coeff./24x,i5,21h gamma transm. coeffcalx-619
     3./24x,i5,9h continua)                                             calx-620
 1024 format (48h maximum number of spin values in the continuum:,i5/21hcalx-621
     1 discretisation with:,2f10.5)                                     calx-622
 1025 format (26h interpolation of s-matrix,3(2x,4hfrom,i6,13h  by stepscalx-623
     1 of,i4,2h+1))                                                     calx-624
 1026 format (24h uncumulated increases  ,3(27x,i4))                    calx-625
 1027 format (4i5,2f10.5)                                               calx-626
 1028 format (//5x,i5,36h  experimental angular distributions/)         calx-627
 1029 format (//5x,i5,21h parameters in search/5x,i5,15h results stored/calx-628
     15x,i5,23h runs    starting scale,f10.2/12x,21hmultiplication factocalx-629
     2r,f10.2/)                                                         calx-630
 1030 format (5x,i5,5x,i5,5x,f15.8)                                     calx-631
 1031 format (5x,i5,20h variable defined as,20i5/(18x,20i5))            calx-632
 1032 format (48h there are no experimental data   ...  no search)      calx-633
 1033 format (23h no parameter in search)                               calx-634
 1034 format (2x,i10,40h coulomb phases and indefinite integrals/2x,i10,calx-635
     139h coulomb functions and finite integrals)                       calx-636
 1035 format (56h number of uncoupled states without angular distributiocalx-637
     1n,i5,34h less than the number of continua:,i5)                    calx-638
 1036 format (2x,i3,25hth limit of interpolation,i6,26h smaller than precalx-639
     1vious one,i6)                                                     calx-640
 1037 format (22h in calx  ... stop ...)                                calx-641
      end                                                               calx-642
c 04/05/98                                                      ecis97  inpa-000
      subroutine inpa                                                   inpa-001
      write (2,1000)                                                    inpa-002
 1000 format (8h04/05/98,64x,8hecis-000/15x,30hdescription of input of einpa-003
     1cis97,27x,8hecis-001/15x,30h******************************,27x,8heinpa-004
     2cis-002/72x,8hecis-003/72x,8hecis-004/72x,8hecis-005/29hcards readinpa-005
     3 in subroutine calx,43x,8hecis-006/29h****************************inpa-006
     4*,43x,8hecis-007/72x,8hecis-008/6hcard 1,34x,13hformat (18a4),19x,inpa-007
     58hecis-009/6h******,66x,8hecis-010/6x,61htitle of the run which wiinpa-008
     6ll be printed as heading of results.,5x,8hecis-011/72x,8hecis-012/inpa-009
     76x,57hif title='description ' this input description is listed.,9xinpa-010
     8,8hecis-013/4x,62h(1714 lines correctly printed in 30 pages by 'eninpa-011
     9script -2bhr'),6x,8hecis-014/10x,38hafter this listing, go back toinpa-012
     a card 1.,24x,8hecis-015/72x,8hecis-016/6x,43hif title='fin ' the cinpa-013
     balculation is stopped.,23x,8hecis-017/72x,8hecis-018/11x,50hthese inpa-014
     ccontrol words must be punched from column 1.,11x,8hecis-019/72x,8hinpa-015
     decis-020/6hcard 2,34x,13hformat (50l1),19x,8hecis-021/6h******,66xinpa-016
     e,8hecis-022/6x,60h50 first logical controls lo. enter 't' in the cinpa-017
     forresponding,6x,8hecis-023/6x,42hcolumn for .true. and nothing forinpa-018
     g .false..,24x,8hecis-024/72x,8hecis-025/6h model,66x,8hecis-026/7xinpa-019
     h,56h1- lo(1)  rotational model-(inverse: vibrational model).,9x,8hinpa-020
     iecis-027/7x,73h2- lo(2)  second order vibrational model-(inverse: inpa-021
     jfirst order). ecis-028)                                           inpa-022
      write (2,1001)                                                    inpa-023
 1001 format (17x,63hor constrained asymmetric rotational model (band miinpa-024
     1xingecis-029/17x,48hparameters of the first two 2+ computed from tinpa-025
     2he,7x,8hecis-030/17x,50hquadrupole 'gamma' in the davydov-filippovinpa-026
     3 model).,5x,8hecis-031/7x,61h3- lo(3)  anharmonic vibrational modeinpa-027
     4l-(inverse: harmonic) or,4x,8hecis-032/17x,49hasymmetric rotationainpa-028
     5l model-(inverse: symmetric).,6x,8hecis-033/7x,73h4- lo(4)  parameinpa-029
     6trised spin-orbit deformation-(inverse: standard)ecis-034/7x,73h5-inpa-030
     7 lo(5)  different deformation for each potential-(inverse: sameeciinpa-031
     8s-035/17x,13hdeformation).,42x,8hecis-036/7x,73h6- lo(6)  deformatinpa-032
     9ion lengths read instead of deformations for   ecis-037/17x,25hwooinpa-033
     ads-saxon form factors.,30x,8hecis-038/7x,73h7- lo(7)  nuclear matrinpa-034
     bix element and form factors read on cards. ecis-039/17x,50hthis isinpa-035
     c not allowed for schroedinger equivalent of,5x,8hecis-040/17x,48hdinpa-036
     dirac equation. with spin in some channel and no,7x,8hecis-041/17x,inpa-037
     e43hcoulomb spin-orbit, use also lo(46)=.true..,12x,8hecis-042/7x,5inpa-038
     f9h8- lo(8)  relativistic kinematics (reduced mass replaced by,6x,8inpa-039
     ghecis-043/17x,44hsimilar formula with relativistic energies).,11x,inpa-040
     h8hecis-044/7x,73h9- lo(9)  symmetric woods-saxon form factors wheninpa-041
     i the radius is  ecis-045/17x,9hnegative.,46x,8hecis-046/6x,74h10- inpa-042
     jlo(10) energy dependent potentials by dispersion relations.   ecisinpa-043
     k-047)                                                             inpa-044
      write (2,1002)                                                    inpa-045
 1002 format (72x,8hecis-048/12h interaction,60x,8hecis-049/6x,74h11- loinpa-046
     1(11) deformed coulomb potential. with lo(7)=.false., it is  ecis-0inpa-047
     250/17x,45hset .false. by the code if no charge is read.,10x,8hecisinpa-048
     3-051/6x,62h12- lo(12) deformed imaginary potential (volume and surinpa-049
     4face or,4x,8hecis-052/17x,19hscalar and vector).,36x,8hecis-053/6xinpa-050
     5,61h13- lo(13) deformed real spin-orbit or tensor potential. with,inpa-051
     65x,8hecis-054/17x,50hlo(7)=.false., it is set .false. by the code inpa-052
     7if no,5x,8hecis-055/17x,48hnon zero spin and no related potential inpa-053
     8are read.,7x,8hecis-056/6x,74h14- lo(14) deformed imaginary spin-oinpa-054
     9rbit or tensor potential. if  ecis-057/17x,63h.true., lo(13) is seinpa-055
     at .true.. with lo(7)=.false., it isecis-058/17x,38hset .false. by inpa-056
     bthe code as for lo(13).,17x,8hecis-059/1h/6x,59h15- lo(15) reduceinpa-057
     cd nuclear matrix elements read from cards.,7x,8hecis-060/17x,63hitinpa-058
     d is necessary for the anharmonic vibrational model.  ecis-061/6x,7inpa-059
     e4h16- lo(16) heavy-ion definition of reduced radii and deformationinpa-060
     fs.ecis-062/17x,63hwhen there are different masses in different chainpa-061
     gnnels, ecis-063/17x,51hthe masses to be used can be indicated by tinpa-062
     hhe first,4x,8hecis-064/17x,63hinput, but only the masses of the fiinpa-063
     irst level can be   ecis-065/17x,63hused for the back transformatioinpa-064
     jn of the results of a   ecis-066)                                 inpa-065
      write (2,1003)                                                    inpa-066
 1003 format (17x,49hsearch or in the subroutine eval (lo(37)=.true.).,6inpa-067
     1x,8hecis-067/17x,63hif lo(6)=.true., only coulomb deformation lenginpa-068
     2ths are  ecis-068/17x,8hchanged.,47x,8hecis-069/6x,74h17- lo(17) finpa-069
     3olding model. with external form factors the folding  ecis-070/17xinpa-070
     4,50hparameters are used independently of this logical.,5x,8hecis-0inpa-071
     571/6x,74h18- lo(18) projectile-target antisymmetrisation, valid oninpa-072
     6ly for   ecis-072/17x,63hsame spin of the particle and the target inpa-073
     7and positive  ecis-073/17x,49hparity in the schroedinger formalisminpa-074
     8. for spin 0,,6x,8hecis-074/17x,51hthe s-matrix is computed only finpa-075
     9or even total spins.,4x,8hecis-075/17x,51hfor spin non 0., the ampinpa-076
     alitudes are symmetrised but,4x,8hecis-076/17x,47hthis do not correinpa-077
     bct the lack of symmetry of the,8x,8hecis-077/17x,40hinteraction beinpa-078
     ctween particle and target.,15x,8hecis-078/6x,60h19- lo(19) deformeinpa-079
     dd coulomb spin-orbit potential. if .true.,,6x,8hecis-079/17x,51hloinpa-080
     e(11) is set .true.. with lo(7)=.false., it is set,4x,8hecis-080/17inpa-081
     fx,63h.false. by the code as for lo(13). (needs lo(13)=.true.ecis-0inpa-082
     g81/17x,50hwith a real spin-orbit potential, even very small),5x,8hinpa-083
     hecis-082/6x,60h20- lo(20) energy dependence of transition form-facinpa-084
     itors when,6x,8hecis-083/17x,63hlo(10)=.true. . this dependence is inpa-085
     jthe geometric mean  ecis-084)                                     inpa-086
      write (2,1004)                                                    inpa-087
 1004 format (17x,51hvalue of the dependence of the levels between whichinpa-088
     1,4x,8hecis-085/17x,63hthe transition form-factor occurs. it cannotinpa-089
     2 be used   ecis-086/17x,21hwith lo(12)=.false. .,34x,8hecis-087/80inpa-090
     3h  note:  in the rotational models, the optical potentials (for elinpa-091
     4astic  ecis-088/68h  ****  scattering) are always deformed. to avoinpa-092
     5id this, when lo(11),,4x,8hecis-089/8x,59hlo(12),lo(13),lo(14) or inpa-093
     6lo(19) is .false., use lo(5)=.true.,5x,8hecis-090/8x,48hand enter inpa-094
     70. for the corresponding deformations.,16x,8hecis-091/72x,8hecis-0inpa-095
     892/12h integration,60x,8hecis-093/6x,57h21- lo(21) usual coupled einpa-096
     9quations-(inverse: iterations).,9x,8hecis-094/17x,63hnot allowed winpa-097
     aith dirac equation. when it is used with  ecis-095/17x,63hdeformedinpa-098
     b spin-orbit, the derivative terms are not takenecis-096/17x,46hintinpa-099
     co account and the computation is uncorrect.,9x,8hecis-097/6x,61h22inpa-100
     d- lo(22) no use of pade approximants for convergence of the,5x,8heinpa-101
     ecis-098/17x,11hiterations.,44x,8hecis-099/6x,74h23- lo(23) no use inpa-102
     fof pade approximant results and shift to usual  ecis-100/17x,51hcoinpa-103
     gupled equations when convergence is not obtained.,4x,8hecis-101/6xinpa-104
     h,74h24- lo(24) computation of coupling potentials at each iteratioinpa-105
     in.  ecis-102/17x,50h(saves space but loses time, chiefly in rotatiinpa-106
     jonal,5x,8hecis-103/17x,7hmodel).,48x,8hecis-104)                  inpa-107
      write (2,1005)                                                    inpa-108
 1005 format (6x,59h25- lo(25) complete calculation up to the end-(inverinpa-109
     1se: one,7x,8hecis-105/17x,63hiteration only as soon as two iteratiinpa-110
     2ons are enought). ecis-106/6x,74h26- lo(26) stabilisation of integinpa-111
     3ration for long range constant   ecis-107/17x,63hpotentials. an adinpa-112
     4ditional term in h**6 is introduced inecis-108/17x,63hthe truncatiinpa-113
     5on in such a way that the term in h**6 of  ecis-109/17x,63hthe totinpa-114
     6al truncation error cancels out for a constant  ecis-110/17x,10hpoinpa-115
     7tential.,45x,8hecis-111/6x,58h27- lo(27) numerov's method for singinpa-116
     8le equations-(inverse:,8x,8hecis-112/17x,51hmodified numerov's metinpa-117
     9hod). for single equation and,4x,8hecis-113/17x,63hconstant potentinpa-118
     aial, truncation errors are of opposite  ecis-114/17x,5hsign.,50x,8inpa-119
     bhecis-115/6x,74h28- lo(28) computation up to j-convergence-(inversinpa-120
     ce: stop when allecis-116/17x,63hthe inhomogeneous terms are negliginpa-121
     dible). for elastic   ecis-117/1h/17x,63hscattering (only one chaninpa-122
     enel) lo(21) or lo(28) must be ecis-118/17x,63h.true.. in this caseinpa-123
     f lo(28) is set .true. by the code. ecis-119/6x,74h29- lo(29) no diinpa-124
     gagonal terms in second members for iterations of  ecis-120/17x,63hinpa-125
     hschroedinger equations. (inverse: all couplings are in ecis-121/17inpa-126
     ix,63hsecond members. the uncoupled solutions do not depend  ecis-1inpa-127
     j22/17x,63hon the channel spin but convergence can be slower in   einpa-128
     kcis-123)                                                          inpa-129
      write (2,1006)                                                    inpa-130
 1006 format (17x,51hsome problems. no effect in first order vibrationalinpa-131
     1,4x,8hecis-124/17x,63hmodel, no use in dirac equations: if lo(100)inpa-132
     2=.true.,   ecis-125/17x,63hlo(29) is set .false.). for convenienceinpa-133
     3, lo(29) is set ecis-126/17x,26h.false. if lo(18)=.true. .,29x,8heinpa-134
     4cis-127/72x,8hecis-128/7h search,65x,8hecis-129/6x,74h31- lo(31) iinpa-135
     5nput of experimental data and calculation of a chi2.  ecis-130/17xinpa-136
     6,51hit is set .false. if no experimental data are read.,4x,8hecis-inpa-137
     7131/6x,74h32- lo(32) automatic search on some parameters. it is seinpa-138
     8t .false. ecis-132/17x,31hif no parameters are in search.,24x,8hecinpa-139
     9is-133/6x,57h33- lo(33) symmetrised chi2 for cross-sections with finpa-140
     aixed,9x,8hecis-134/17x,45hnormalisation-(inverse: usual chi2). theinpa-141
     b chi2,10x,8hecis-135/17x,42hcontribution is multiplied by the ratiinpa-142
     co of,13x,8hecis-136/17x,33hexperimental to calculated value.,22x,8inpa-143
     dhecis-137/6x,74h34- lo(34) number of evaluations in the search liminpa-144
     eited by the job ecis-138/17x,51hcard. this option can be used onlyinpa-145
     f if the remaining,4x,8hecis-139/17x,51hcpu time is available to thinpa-146
     ge code on your computer.,4x,8hecis-140/17x,49ha maximum running tiinpa-147
     hme can be used, modifying the,6x,8hecis-141/17x,30hsubroutine stiminpa-148
     i to return '0'.,25x,8hecis-142/6x,74h35- lo(35) search saved on tainpa-149
     jpe 8 if correctly ended or stopped byecis-143)                    inpa-150
      write (2,1007)                                                    inpa-151
 1007 format (17x,26hthe number of evaluations.,29x,8hecis-144/6x,40h36-inpa-152
     1 lo(36) restart a search from tape 8.,26x,8hecis-145/6x,74h37- lo(inpa-153
     237) next calculation changing only energy and some optical ecis-14inpa-154
     36/17x,11hparameters.,44x,8hecis-147/72x,8hecis-148/23h long range inpa-155
     4interaction,49x,8hecis-149/6x,74h41- lo(41) factorisation of 1/(1-inpa-156
     5cos(theta)) in the amplitudes. itecis-150/17x,63his needed for dirinpa-157
     6ac equation or with spin-orbit coulombecis-151/17x,10hpotential.,4inpa-158
     75x,8hecis-152/6x,60h42- lo(42) schmidt's orthogonalisation of soluinpa-159
     8tions in usual,6x,8hecis-153/17x,18hcoupled equations.,37x,8hecis-inpa-160
     9154/6x,39h43- lo(43) interpolation on total spin.,27x,8hecis-155/6inpa-161
     ax,74h44- lo(44) coulomb corrections. lo(44) is set .false. if lo(1inpa-162
     b1) isecis-156/17x,63h.false. . outside the dirac formalism it is binpa-163
     cetter to  ecis-157/17x,23huse also lo(29)=.true..,32x,8hecis-158/6inpa-164
     dx,56h45- lo(45) limitation on the angular momenta for coulomb,10x,inpa-165
     e8hecis-159/17x,51hcorrections. default options are 3 for central tinpa-166
     ferm,4x,8hecis-160/17x,45hand 2 for spin-orbit term. maximum valuesinpa-167
     g are,10x,8hecis-161/17x,63hrespectively 4 and 2 for schroedinger einpa-168
     hquations and 4  ecis-162/17x,47hand 3 for dirac equation. expressiinpa-169
     ions have been,8x,8hecis-163/17x,49hobtained to go up to 5 for centinpa-170
     jral term and 4 for,6x,8hecis-164)                                 inpa-171
      write (2,1008)                                                    inpa-172
 1008 format (17x,63hspin-orbit term but involve many cards which has beinpa-173
     1en  ecis-165/17x,47hintroduced in subroutine cora as comment cardsinpa-174
     2.,8x,8hecis-166/6x,59h46- lo(46) restricted coulomb corrections. (inpa-175
     3saves storage).,7x,8hecis-167/17x,50hif lo(44)=.false. the diagonainpa-176
     4l corrections used in,5x,8hecis-168/17x,49hdirac formalism or for inpa-177
     5the coulomb spin-orbit are,6x,8hecis-169/17x,50hsuppressed. if lo(inpa-178
     644)=.true. indications for these,5x,8hecis-170/17x,43hrestrictionsinpa-179
     7 between channels will be read.,12x,8hecis-171/64h  note:  if lo(3inpa-180
     86)=.true. a search saved on tape 8 is restarted;,8x,8hecis-172/80hinpa-181
     9  ****  no other logical control from this card is taken into accoinpa-182
     aunt.  ecis-173/8x,59hinstead of the following cards, go to 'restarinpa-183
     bt input: cards,5x,8hecis-174/8x,25hread in subroutine rest'.,39x,8inpa-184
     checis-175/72x,8hecis-176/1h/6hcard 3,34x,13hformat (50l1),19x,8heinpa-185
     dcis-177/6h******,66x,8hecis-178/6x,55hlogical controls from 51 to inpa-186
     e100 (as for previous card).,11x,8hecis-179/72x,8hecis-180/28h prininpa-187
     fting in complete output,44x,8hecis-181/7x,31h1- lo(51) output of pinpa-188
     gotentials.,34x,8hecis-182/7x,52h2- lo(52) output of reduced nucleainpa-189
     hr matrix elements.,13x,8hecis-183/7x,45h3- lo(53) output of the nuinpa-190
     imber of iterations.,20x,8hecis-184/7x,57h4- lo(54) output of the linpa-191
     jength used in the working field.,8x,8hecis-185)                   inpa-192
      write (2,1009)                                                    inpa-193
 1009 format (7x,38h5- lo(55) output of c-matrix elements.,27x,8hecis-18inpa-194
     16/7x,61h6- lo(56) output of s-matrix elements and of compound nuclinpa-195
     2eus,4x,8hecis-187/17x,21hintermediate results.,34x,8hecis-188/7x,6inpa-196
     30h7- lo(57) output of phase-shifts at each e.c.i.s. iteration.,5x,inpa-197
     48hecis-189/7x,73h8- lo(58) output of the coefficients of each forminpa-198
     5 factor for all ecis-190/17x,18hsets of equations.,37x,8hecis-191/inpa-199
     67x,46h9- lo(59) output of time differences in a run.,19x,8hecis-19inpa-200
     72/72x,8hecis-193/37h punch and results in complete output,35x,8hecinpa-201
     8is-194/6x,60h11- lo(61) reduced nuclear matrix elements punched oninpa-202
     9 cards.,6x,8hecis-195/6x,39h12- lo(62) potentials punched on cardsinpa-203
     a.,27x,8hecis-196/6x,44h13- lo(63) penetrabilities punched on cardsinpa-204
     b.,22x,8hecis-197/17x,63hwith iterations, the code computes all theinpa-205
     c solutions.  ecis-198/6x,58h14- lo(64) results at equidistant anglinpa-206
     des punched on cards.,8x,8hecis-199/6x,74h15- lo(65) coefficients oinpa-207
     ef the expansion in legendre polynomials  ecis-200/17x,17hpunched oinpa-208
     fn cards.,38x,8hecis-201/6x,48h16- lo(66) no calculation at equidisinpa-209
     gtant angles.,18x,8hecis-202/6x,40h17- lo(67) no plot of experimentinpa-210
     hal data.,26x,8hecis-203/6x,59h18- lo(68) no plot of cross-sectionsinpa-211
     i at equidistant angles.,7x,8hecis-204/6x,58h19- lo(69) no plot of inpa-212
     jpolarisations at equidistant angles.,8x,8hecis-205)               inpa-213
      write (2,1010)                                                    inpa-214
 1010 format (80h  note:  in a search, lo(51) to lo(65) are used for theinpa-215
     1 complete resultsecis-206/80h  ****  (at the first calculation if inpa-216
     2lo(75)=.false. and at the end of   ecis-207/8x,11hthe search),53x,inpa-217
     38hecis-208/72x,8hecis-209/42h printing at the beginning and in a sinpa-218
     4earch,30x,8hecis-210/6x,47h21- lo(71) detailed output of logical cinpa-219
     5ontrols.,19x,8hecis-211/6x,61h22- lo(72) no output of experimentalinpa-220
     6 data when they are read.,5x,8hecis-212/6x,74h23- lo(73) no outputinpa-221
     7 of external potentials when they are read.   ecis-213/6x,43h24- linpa-222
     8o(74) output of variations in storage.,23x,8hecis-214/6x,59h25- loinpa-223
     9(75) no complete output at the first run of a search.,7x,8hecis-21inpa-224
     a5/6x,62h26- lo(76) lo(51) to lo(65) are always used-(inverse: onlyinpa-225
     b for,4x,8hecis-216/17x,17hcomplete output).,38x,8hecis-217/6x,59h2inpa-226
     c7- lo(77) no output of time differences during the search.,7x,8hecinpa-227
     dis-218/6x,60h28- lo(78) no output of differences between experimeninpa-228
     etal and,6x,8hecis-219/17x,18hcalculated values.,37x,8hecis-220/72xinpa-229
     f,8hecis-221/17h compound nucleus,55x,8hecis-222/6x,57h31- lo(81) hinpa-230
     gauser-feshbach corrections to cross-sections.,9x,8hecis-223/17x,63inpa-231
     hhwith iterations, the code computes all the solutions.  ecis-224/1inpa-232
     i7x,63hif lo(82), lo(84), lo(85) or lo(86) is .true>, lo(81)  ecis-inpa-233
     j225/17x,14his set .true..,41x,8hecis-226)                         inpa-234
      write (2,1011)                                                    inpa-235
 1011 format (6x,62h32- lo(82) old simplified compound nucleus (excludesinpa-236
     1 uncoupled,4x,8hecis-227/17x,63hstates, fission and gammas; lo(84)inpa-237
     2, lo(85), lo(86) are ecis-228/17x,13hset .false.).,42x,8hecis-229/inpa-238
     36x,74h33- lo(83) no engelbretch-weidenmuller transformation in cominpa-239
     4pound ecis-230/17x,8hnucleus.,47x,8hecis-231/6x,59h34- lo(84) uncoinpa-240
     5upled levels for compound nucleus. it is set,7x,8hecis-232/17x,25hinpa-241
     6.false. if none are read.,30x,8hecis-233/6x,61h35- lo(85) fission inpa-242
     7transmission coefficients (to be read from,5x,8hecis-234/17x,63hcainpa-243
     8rds) for compound nucleus. it is set .false. if none ecis-235/17x,inpa-244
     99hare read.,46x,8hecis-236/1h/6x,46h36- lo(86) gamma emission in inpa-245
     acompound nucleus.,20x,8hecis-237/6x,33h37- lo(87) no width fluctuainpa-246
     btions.,33x,8hecis-238/72x,8hecis-239/14h miscellaneous,58x,8hecis-inpa-247
     c240/6x,60h41- lo(91) angular distribution at equidistant angles ininpa-248
     d the,6x,8hecis-241/17x,17hlaboratory system,38x,8hecis-242/6x,33h4inpa-249
     e2- lo(92) pure dwba calculation.,33x,8hecis-243/6x,46h43- lo(93) ninpa-250
     fo recoil correction for reactions.,20x,8hecis-244/6x,58h44- lo(94)inpa-251
     g non standard observables at equidistant angles.,8x,8hecis-245/6x,inpa-252
     h46h48- lo(98) use of rest mass in dirac equation.,20x,8hecis-246/6inpa-253
     ix,74h49- lo(99) schroedinger equivalent to dirac equation. diffusiinpa-254
     jvity ecis-247)                                                    inpa-255
      write (2,1012)                                                    inpa-256
 1012 format (17x,63hof coulomb potentials must be 0. lo(11) and lo(19) inpa-257
     1are ecis-248/17x,50hset .false.. no asymmetric rotational model aninpa-258
     2d no,5x,8hecis-249/17x,49hsecond order vibrational model: the corrinpa-259
     3esponding,6x,8hecis-250/17x,24hlogical are set .false..,31x,8hecisinpa-260
     4-251/6x,36h50- lo(100) complete dirac equation.,30x,8hecis-252/72xinpa-261
     5,8hecis-253/6hcard 4,34x,13hformat (14i5),19x,8hecis-254/6h******,inpa-262
     666x,8hecis-255/7x,73h1- 5   ncoll  number of nuclear states. it doinpa-263
     7es not include the  ecis-256/21x,59hnumber of uncoupled states forinpa-264
     8 compound nucleus.   ecis-257/7x,73h6-10   njmax  maximum number oinpa-265
     9f channel spin. (default option 20)ecis-258/21x,59hthe maximum valinpa-266
     aue of the total angular momentum j  ecis-259/21x,59hwill be njmax-inpa-267
     b1 when it is integer or njmax-.5 whenecis-260/21x,19hit is half-ininpa-268
     cteger.,32x,8hecis-261/6x,74h11-15   iterm  maximum number of ecis inpa-269
     diterations. (default option ecis-262/21x,37h20). must be 1 for dwbinpa-270
     ea calculations.,14x,8hecis-263/6x,11h16-20   npp,4x,59hnumber of oinpa-271
     fptical potentials. (default option 1).  ecis-264/21x,47hthe first inpa-272
     gone is deformed when the form factors,4x,8hecis-265/21x,22hare notinpa-273
     h read on cards.,29x,8hecis-266/6x,11h21-25   ncj,4x,47hnumber of finpa-274
     iactorisations of 1/(1-cos(theta)) in,4x,8hecis-267/21x,35hthe amplinpa-275
     jitudes. (default option 1).,16x,8hecis-268)                       inpa-276
      write (2,1013)                                                    inpa-277
 1013 format (6x,74h26-30   ngr(1) number of decades in logarithmic scalinpa-278
     1e in plots of ecis-269/21x,45helastic cross-sections in the standainpa-279
     2rd option,6x,8hecis-270/21x,46h(default option 2). for charged parinpa-280
     3ticles, the,5x,8hecis-271/21x,59hcross-section divided by rutherfoinpa-281
     4rd's cross-sectionecis-272/21x,11his plotted.,40x,8hecis-273/6x,74inpa-282
     5h31-35   ngr(2) as ngr(1),for inelastic channels.(default option 2inpa-283
     6)ecis-274/6x,60h36-40   npr(1) plot indications for elastic polariinpa-284
     7sations at,6x,8hecis-275/21x,44hequidistant angles. if there are ninpa-285
     8 different,7x,8hecis-276/21x,59hangular distributions of polarisatinpa-286
     9ions, npr(1) is  ecis-277/21x,45hthe sum for i=1 to n of k(i)*(2**inpa-287
     a(i-1)) where,6x,8hecis-278/21x,47hk(i)=1 for a plot and 0 for no pinpa-288
     blot of the i-th,4x,8hecis-279/21x,31hdistribution.(default option inpa-289
     c1),20x,8hecis-280/14x,43hstandard options: spin 0 - no polarisatioinpa-290
     dn.,15x,8hecis-281/32x,31hspin 1/2 - vector polarisation.,9x,8hecisinpa-291
     e-282/32x,32hspin >1/2 - it11, t20, t21, t22.,8x,8hecis-283/6x,74h4inpa-292
     f1-45   npr(2) as npr(1),for inelastic channels.(default option 1)einpa-293
     gcis-284/14x,43hstandard options: spin 0 - no polarisation.,15x,8heinpa-294
     hcis-285/22x,58hspin 1/2 - vect. ana. power, vect. pol., spin-flipeinpa-295
     icis-286/22x,44hspin >1/2 - it11, vect. pol., t20, t21, t22.,6x,8heinpa-296
     jcis-287)                                                          inpa-297
      write (2,1014)                                                    inpa-298
 1014 format (6x,11h46-50   lmz,4x,59hnumber of j values for which the rinpa-299
     1adial equations  ecis-288/21x,59hare solved when coulomb correctioinpa-300
     2ns are used. this ecis-289/21x,44hnumber can be automatically decrinpa-301
     3eased if the,7x,8hecis-290/21x,59hirregular functions are too larginpa-302
     4e. the asymptotic  ecis-291/21x,42hregion where the phase-shifts ainpa-303
     5re computed,9x,8hecis-292/21x,59hanalytically is above this value.inpa-304
     6 the best value ofecis-293/21x,59hlmz is the maximum value of j neinpa-305
     7eded by the same   ecis-294/21x,59hcomputation without charge and inpa-306
     8without anomalous   ecis-295/21x,59hmagnetic moment. (default optiinpa-307
     9on njmax/2, but enterecis-296/21x,43ha negative value if you want inpa-308
     ato use njmax).,8x,8hecis-297/1h/6x,11h51-55   jdm,4x,47htotal spiinpa-309
     bn above which stop or reduction to one,4x,8hecis-298/21x,59hiteratinpa-310
     cion can occur. (limits lo(25),lo(28)=.false.)ecis-299/6x,11h56-60 inpa-311
     d  lml,4x,59hmaximum angular momentum (default option maximum). eciinpa-312
     es-300/21x,59hwithout long range interaction, a limit is given   ecinpa-313
     fis-301/21x,44hfor each level such that the regular coulomb,7x,8hecinpa-314
     gis-302/21x,59hfunction is larger than 1.d-30 at matching radius. einpa-315
     hcis-303/6x,11h61-65   jit,4x,59hnumber of rates of interpolation finpa-316
     ior total spin.   ecis-304/21x,18h(default value 1).,33x,8hecis-305inpa-317
     j/6x,74h66-70   nsec   time needed at the end of a search to print inpa-318
     kfinal  ecis-306)                                                  inpa-319
      write (2,1015)                                                    inpa-320
 1015 format (21x,59hresults in hundredths of second.(default value 100)inpa-321
     1ecis-307/67h  note:  if lo(94)=.true. ngr and npr are not taken ininpa-322
     2to account in,5x,8hecis-308/80h  ****  computations at equidistantinpa-323
     3 angles because such indications willecis-309/8x,72hbe read again,inpa-324
     4 but ngr is always used for plots of experimental ecis-310/8x,15hcinpa-325
     5ross-sections.,49x,8hecis-311/72x,8hecis-312/6hcard 5,34x,15hformainpa-326
     6t (7f10.5),17x,8hecis-313/6h******,66x,8hecis-314/8x,8h1-10   h,5xinpa-327
     7,44hintegration step size in fm. (default option,7x,8hecis-315/21xinpa-328
     8,45hmin(0.5/wave number, 0.5*min(diffusenesses)),,6x,8hecis-316/21inpa-329
     9x,43hwithout the diffusenesses if lo(7)=.true.).,8x,8hecis-317/7x,inpa-330
     a10h11-20   rm,4x,59hmatching radius.(if lo(7)=.true. default optioinpa-331
     bn 20.ecis-318/21x,59hif lo(7)=.false., for each non zero potentialinpa-332
     c, the ecis-319/21x,59hradius where its absolute value is (aconv*ecinpa-333
     dm/wave ecis-320/21x,59hnumber) is computed and rm is the largest oinpa-334
     ef them. ecis-321/21x,59hfor coulomb form factors, radius+10*diffusinpa-335
     feness is ecis-322/21x,5hused),46x,8hecis-323/7x,73h21-30   bjm   cinpa-336
     goefficient of the imaginary potential to be added ecis-324/21x,45hinpa-337
     hto the uncoupled equations and removed in the,6x,8hecis-325/21x,43inpa-338
     ihsecond member to accelerate convergence for,8x,8hecis-326/21x,23hinpa-339
     jschroedinger equations.,28x,8hecis-327)                           inpa-340
      write (2,1016)                                                    inpa-341
 1016 format (7x,73h31-40   eiter convergence criterion for s-matrix in inpa-342
     1the iterationecis-328/21x,23h(default option 1.e-5).,28x,8hecis-32inpa-343
     29/7x,60h41-50   aconv value below which functions and potentials ainpa-344
     3re,5x,8hecis-330/21x,47hneglected in iterations.(default option 1.inpa-345
     4e-5).,4x,8hecis-331/21x,46haconv is also used in the default valueinpa-346
     5 of rm.,5x,8hecis-332/7x,49h51-60   conj  convergence criterion foinpa-347
     6r j values.,16x,8hecis-333/21x,23h(default option 1.e-5).,28x,8hecinpa-348
     7is-334/72x,8hecis-335/33hlimitation to coulomb corrections,7x,13hfinpa-349
     8ormat (14i5),19x,8hecis-336/33h*********************************,3inpa-350
     99x,8hecis-337/64h  if lo(45) is .true., otherwise go to 'legendre inpa-351
     aexpansion data',8x,8hecis-338/8x,72h1- 5   mcm(1)  maximum angularinpa-352
     b momentum for the computation of  ecis-339/23x,45hthe corrections inpa-353
     cdue to the coulomb potential.,4x,8hecis-340/23x,19h(default optioninpa-354
     d 3).,30x,8hecis-341/8x,57h6-10   mcm(2)  same for the spin-orbit cinpa-355
     eoulomb potential.,7x,8hecis-342/23x,19h(default option 2).,30x,8heinpa-356
     fcis-343/68h note:  enter a negative value to use 0. a blank or 0 iinpa-357
     gs replaced by,4x,8hecis-344/44h *****  the default options describinpa-358
     hed above.,28x,8hecis-345/72x,8hecis-346/23hlegendre expansion datainpa-359
     i,17x,13hformat (14i5),19x,8hecis-347/23h***********************,49inpa-360
     jx,8hecis-348)                                                     inpa-361
      write (2,1017)                                                    inpa-362
 1017 format (63h  if lo(65) is .true., otherwise go to 'compound nucleuinpa-363
     1s data'.,9x,8hecis-349/8x,58h1- 5   nl(1)  power of (1-cos(theta))inpa-364
     2 for the expansion in,6x,8hecis-350/22x,58hlegendre polynomials ofinpa-365
     3 the interference between  ecis-351/22x,58hcoulomb and nuclear elainpa-366
     4stic scattering. power of  ecis-352/22x,38h(1-cos(theta)**2) if loinpa-367
     5(18) is .true..,12x,8hecis-353/22x,19h(default option 2).,31x,8hecinpa-368
     6is-354/8x,56h6-10   nl(2)  number of legendre polynomials for elasinpa-369
     7tic,8x,8hecis-355/22x,58hscattering of charged particles. (defaultinpa-370
     8 option  ecis-356/22x,58h1.5 number obtained without coulomb ampliinpa-371
     9tude).   ecis-357/1h/7x,57h11-15   nl(3)  number of legendre polyinpa-372
     anomials for elastic,8x,8hecis-358/22x,44hscattering of uncharged pinpa-373
     barticles, inelastic,6x,8hecis-359/22x,58hscattering and compound ninpa-374
     cucleus. (default option  ecis-360/22x,16hmaximum number).,34x,8hecinpa-375
     dis-361/72x,8hecis-362/21hcompound nucleus data,19x,19hformat (8i5,inpa-376
     e2f10.5),13x,8hecis-363/21h*********************,51x,8hecis-364/58hinpa-377
     f  if lo(84) or lo(85) or lo(86) is .true., otherwise go to,14x,8heinpa-378
     gcis-365/32h  'interpolation on total spin'.,40x,8hecis-366/8x,60h1inpa-379
     h- 5   nsp(1) number of uncoupled states and continua. if is,4x,8heinpa-380
     icis-367/22x,46hreplaced by min(nsp(1),nsp(2)). if it is zero,,4x,8inpa-381
     jhecis-368/22x,14hlo(84)=.false.,36x,8hecis-369)                   inpa-382
      write (2,1018)                                                    inpa-383
 1018 format (8x,53h6-10   nsp(2) number of uncoupled states with angulainpa-384
     1r,11x,8hecis-370/22x,43hdistribution. they must be the first giveninpa-385
     2.,7x,8hecis-371/7x,73h11-15   nfiss  number of fission data. if nfinpa-386
     3iss=0, lo(85)=.false.ecis-372/7x,11h16-20   nrd,4x,58hnumber of gainpa-387
     4mma transmission factors. if it is 0, ecis-373/22x,32hthese coeffiinpa-388
     5cients are computed.,18x,8hecis-374/7x,73h21-25   ncont  number ofinpa-389
     6 continua. they must be the last given,  ecis-375/22x,58hno angulainpa-390
     7r distribution can be requested for them.ecis-376/7x,59h26-30   ncinpa-391
     8oj   number of values of the spin of the residual,6x,8hecis-377/22inpa-392
     9x,46hnucleus for the continua. (default option 30).,4x,8hecis-378/inpa-393
     a7x,73h31-35   kmin   minimum number of j values for compound nucleinpa-394
     bus   ecis-379/22x,45h(default option: minimum value for s waves ininpa-395
     c,5x,8hecis-380/22x,18hentrance channel).,32x,8hecis-381/7x,73h36-4inpa-396
     d0   kmax   maximum number of j values for compound nucleus   ecis-inpa-397
     e382/22x,23h(default option njmax).,27x,8hecis-383/7x,73h41-50   acinpa-398
     fn1   ratio energy/step for the discretisation of the   ecis-384/22inpa-399
     gx,58hcontinua at large energy . (default option 8.).   ecis-385/7xinpa-400
     h,73h51-60   acn2   number of steps per mev for the discretisation inpa-401
     iof ecis-386/22x,58hthe continua at low energy. (default option 8.)inpa-402
     j.  ecis-387)                                                      inpa-403
      write (2,1019)                                                    inpa-404
 1019 format (80h  note:  the shift from the use of acn1 to acn2 occurs inpa-405
     1below the energy ecis-388/80h  ****  acn1/acn2. below this energy,inpa-406
     2 the interval is divided in equal  ecis-389/4x,76hsteps with a mininpa-407
     3imum of two steps. calculations are done with the   ecis-390/4x,33inpa-408
     4henergy of the middle of the step.,35x,8hecis-391/9x,71hwithout kminpa-409
     5in the calculation can stop before any significant   ecis-392/4x,7inpa-410
     66hresult. with interpolation on total spin below kmax, a huge storinpa-411
     7age ecis-393/4x,64harray, proportional to kmax, is needed for uncoinpa-412
     8upled states with,4x,8hecis-394/4x,21hangular distribution.,47x,8hinpa-413
     9ecis-395/9x,71hcompound nucleus calculation is stopped at the j vainpa-414
     alue larger  ecis-396/4x,76hthan kmin one for which the largest cominpa-415
     bpound nucleus contribution isecis-397/4x,76hless than conj**2. theinpa-416
     c code cannot deal with very large j values.   ecis-398/72x,8hecis-inpa-417
     d399/27hinterpolation on total spin,13x,13hformat (14i5),19x,8hecisinpa-418
     e-400/27h***************************,45x,8hecis-401/80h  if lo(43) inpa-419
     fis .true., otherwise go to  'cards read in subroutine lect'.ecis-4inpa-420
     g02/8x,25h1- 5   ls(1) first limit.,39x,8hecis-403/8x,38h6-10   ld(inpa-421
     h1) number of values skipped.,26x,8hecis-404/7x,27h11-15   ls(2) seinpa-422
     icond limit.,38x,8hecis-405/7x,39h16-20   ld(2) number of values skinpa-423
     jipped.,26x,8hecis-406)                                            inpa-424
      write (2,1020)                                                    inpa-425
 1020 format (3x,77h....................  up to ls(jit) and ld(jit)   ..inpa-426
     1.................ecis-407/7x,73hthe calculation is stopped if valuinpa-427
     2es ls decrease. the values ld  ecis-408/80h are changed to be usedinpa-428
     3 cumulatively in the programme. if lo(18)=.true.,ecis-409/80h and inpa-429
     4the spins in the ground state are both zero, the values ld read arinpa-430
     5eecis-410/17h multiplied by 2.,55x,8hecis-411/72x,8hecis-412/72x,8inpa-431
     6hecis-413/29hcards read in subroutine lecl,43x,8hecis-414/29h*****inpa-432
     7************************,43x,8hecis-415/72x,8hecis-416/1h/23hfor inpa-433
     8each nuclear state:,49x,8hecis-417/23h***********************,49x,inpa-434
     98hecis-418/6x,74hbeginning with the ground-state and including uncinpa-435
     aoupled states forecis-419/6x,54hcompound nucleus calculation whichinpa-436
     b must be at the end.,12x,8hecis-420/6x,58hthe best order is the oninpa-437
     ce of decreasing coupling strength.,8x,8hecis-421/72x,8hecis-422/34inpa-438
     dhnuclear states -spins and masses -,6x,27hformat (f5.2,2i2,a1,5f10inpa-439
     e.5),5x,8hecis-423/35h***********************************,37x,8heciinpa-440
     fs-424/7x,42h1- 5   sp(2,i)  spin of the nuclear state.,23x,8hecis-inpa-441
     g425/7x,43h6- 7   n  further description of the state.,22x,8hecis-4inpa-442
     h26/14x,66hin the rotational model, must be non-zero for the memberinpa-443
     i  ecis-427/22x,22hof a vibrational band.,28x,8hecis-428/14x,66hin inpa-444
     jthe vibrational model, can be non-zero for the ground  ecis-429)  inpa-445
      write (2,1021)                                                    inpa-446
 1021 format (22x,38hstate to avoid the input of next card.,12x,8hecis-4inpa-447
     130/14x,66hnot used if lo(3) = .true. (anharmonic vibrational  modeinpa-448
     2l ecis-431/22x,58hor asymmetric rotational model), if lo(7) = .truinpa-449
     3e.ecis-432/22x,43h(external potentials) and uncoupled states.,7x,8inpa-450
     4hecis-433/7x,73h8- 9   k optical potential. (default option, 1 forinpa-451
     5 ground-state, ecis-434/14x,36hsame as last one for excited state)inpa-452
     6.,22x,8hecis-435/9x,8h10   spi,6x,57hparity of the nuclear state: inpa-453
     7'+' or '-' but only ecis-436/14x,66h'-' is necessary ('+' for a blinpa-454
     8ank or any other character).ecis-437/6x,74h11-20   energy of the pinpa-455
     9rojectile in the laboratory system in mev  ecis-438/14x,66hfor theinpa-456
     a ground state. excitation energy for the others.   ecis-439/6x,40hinpa-457
     b21-30   sp(1,i)  spin of the projectile.,26x,8hecis-440/6x,52h31-4inpa-458
     c0   wv(1,i)  mass of the projectile in a.m.u.  .,14x,8hecis-441/14inpa-459
     dx,66hif this value is not zero for an excited state, the spin  eciinpa-460
     es-442/14x,54hof the projectile, its mass and the product of chargeinpa-461
     fs,4x,8hecis-443/14x,66hread on this card are taken into account. iinpa-462
     gf this mass is ecis-444/14x,66hzero, values of sp(i,1),sp(i,2),sp(inpa-463
     hi,3) and sp(i,6) are   ecis-445/14x,31htaken from the preceding leinpa-464
     ivel.,27x,8hecis-446/6x,48h41-50   wv(2,i)  mass of the target in ainpa-465
     j.m.u.  .,18x,8hecis-447)                                          inpa-466
      write (2,1022)                                                    inpa-467
 1022 format (6x,74h51-60   sp(3,i)  product of the charges of the targeinpa-468
     1t and of the  ecis-448/14x,18hincident particle.,40x,8hecis-449/65inpa-469
     2h  note:  only this card is read for uncoupled states and continuainpa-470
     3,7x,8hecis-450/46h  ****  used for compound nucleus calculation.,2inpa-471
     46x,8hecis-451/72x,8hecis-452/80hdescription of vibrations  (if n iinpa-472
     5s not 0 in rotational model or n is 0 ecis-453/80h****************inpa-473
     6*********  in vibrational model and lo(3)=lo(7)=.false.)ecis-454/7inpa-474
     72x,8hecis-455/17hnumber of phonons,23x,13hformat (14i5),19x,8hecisinpa-475
     8-456/17h*****************,55x,8hecis-457/7x,40h1- 5   iph(i)  descinpa-476
     9ription of the state.,25x,8hecis-458/14x,44hin the vibrational modinpa-477
     ael: 0 for ground state,14x,8hecis-459/22x,36h1 or 2 for pure 1 or inpa-478
     b2-phonons state,14x,8hecis-460/22x,42h3 for a mixture of 1 and 2-pinpa-479
     chonons states.,8x,8hecis-461/14x,48hin the rotational model: 0 forinpa-480
     d ground-state band,10x,8hecis-462/39x,22h1 for vibrational band,11inpa-481
     ex,8hecis-463/39x,23h2 for a mixture of them,10x,8hecis-464/7x,73h6inpa-482
     f-10   rotational model: number of the vibration in the order of ecinpa-483
     gis-465/14x,33hinput. (see 'cards read in lect'),25x,8hecis-466/14xinpa-484
     h,66hvibrational model: number of the phonon of the one-phonon ecisinpa-485
     i-467/14x,54hstate or of the first phonon of the two-phonons state.inpa-486
     j,4x,8hecis-468)                                                   inpa-487
      write (2,1023)                                                    inpa-488
 1023 format (6x,61h11-15   vibrational model: number of the second phoninpa-489
     1on of the,5x,8hecis-469/14x,18htwo-phonons state.,40x,8hecis-470/6inpa-490
     2x,74h16-20   vibrational model: number of the one-phonon componentinpa-491
     3 of  ecis-471/14x,14ha mixed state.,44x,8hecis-472/68h  note:  theinpa-492
     4 total number of phonons will be the largest number read,4x,8hecisinpa-493
     5-473/31h  ****  in the columns 6 to 20.,41x,8hecis-474/72x,8hecis-inpa-494
     6475/1h/24hphonons mixing parameter,16x,15hformat (7f10.5),17x,8heinpa-495
     7cis-476/24h************************,48x,8hecis-477/64h  if iph is inpa-496
     83 (vibrational model) or iph is 2 (rotational model),8x,8hecis-478inpa-497
     9/7x,21h1-10   bt in degrees.,44x,8hecis-479/6x,74hthe nuclear statinpa-498
     ae is:  cos(bt)*(1 phonon) + sin(bt)*(2 phonons).  ecis-480/14x,50hinpa-499
     bor:  cos(bt)*(vibr. band) + sin(bt)*(ground band).,8x,8hecis-481/7inpa-500
     c2x,8hecis-482/31hfor asymmetric rotational model,41x,8hecis-483/31inpa-501
     dh*******************************,41x,8hecis-484/22h if lo(1)=lo(3)inpa-502
     e=.true.,50x,8hecis-485/5x,75hthere are n=sp(*,4)/2 band mixing parinpa-503
     fameters between the n+1 bands ecis-486/80h  defined as atan(a(2*i)inpa-504
     g/a(2*i-2)) where a(i) is the amplitude of band iecis-487/5x,75hif inpa-505
     hn is not 0 and the reduced matrix elements are not read on cardsecinpa-506
     iis-488/72x,8hecis-489/17hmixing parameters,23x,15hformat (7f10.5),inpa-507
     j17x,8hecis-490/17h*****************,55x,8hecis-491)               inpa-508
      write (2,1024)                                                    inpa-509
 1024 format (7x,25h1-10   bt(1)  in degrees.,40x,8hecis-492/6x,26h11-20inpa-510
     1   bt(2)  in degrees.,40x,8hecis-493/6x,26h21-30   bt(3)  in degreinpa-511
     2es.,40x,8hecis-494/6x,26h31-40   bt(4)  in degrees.,40x,8hecis-495inpa-512
     3/6x,26h41-50   bt(5)  in degrees.,40x,8hecis-496/6x,25h51-60   ...inpa-513
     4..............,41x,8hecis-497/6x,74hthe nuclear state is:   cos(btinpa-514
     5(1))*y(ai,0) + sin(bt(1))*cos(bt(2))ecis-498/6x,74h*(y(ai,2)+s*y(ainpa-515
     6i,-2))*sqrt(0.5) + sin(bt(1))*sin(bt(2))*cos(bt(3))ecis-499/6x,74hinpa-516
     7*(y(ai,4)+s*y(ai,-4))*sqrt(0.5) + ....... where s=(-)**(ai+spi).  inpa-517
     8ecis-500/80h  note: for unnatural parity states (spi=-), bt(1) wilinpa-518
     9l be ignored in   ecis-501/51h  **** the calculation and replaced inpa-519
     aby 90. degrees.,21x,8hecis-502/8x,72hif lo(15)=.true., all the nucinpa-520
     blear parameters (quantities given  ecis-503/4x,76hin degrees) haveinpa-521
     c to be read in order to avoid a change in this part ecis-504/4x,76inpa-522
     dhof input when shifting lo(15) from .false. to .true..  they are ninpa-523
     eot ecis-505/4x,29hused and cannot be in search.,39x,8hecis-506/72xinpa-524
     f,8hecis-507/72x,8hecis-508/29hcards read in subroutine lect,43x,8hinpa-525
     gecis-509/29h*****************************,43x,8hecis-510/72x,8heciinpa-526
     hs-511/19hphonon descriptions,21x,21hformat (2i5,f10.5,i5),11x,8hecinpa-527
     iis-512/19h*******************,53x,8hecis-513/25hfor every phonon iinpa-528
     jnvolved,47x,8hecis-514)                                           inpa-529
      write (2,1025)                                                    inpa-530
 1025 format (7x,61h1- 5   nbta(9,*) = l angular momentum used also for inpa-531
     1heavy ion,4x,8hecis-515/7x,73h6-10   nbta(10,*) = k magnetic quantinpa-532
     2um number of the vibration inecis-516/21x,59hrotational model. in inpa-533
     3the vibrational model, must beecis-517/21x,59hzero to use this phoinpa-534
     4non in l=0 second order terms. ecis-518/6x,60h11-20   beta(1,*)   inpa-535
     5phonon amplitude for the real potential.,6x,8hecis-519/6x,61h21-25inpa-536
     6   ik   level of which the masses are used for heavy-ion,5x,8hecisinpa-537
     7-520/21x,35hcorrections. (default option ik=1).,16x,8hecis-521/72xinpa-538
     8,8hecis-522/55hphonon amplitudes of other potentials   format (7f1inpa-539
     90.5),17x,8hecis-523/37h*************************************,35x,8inpa-540
     ahecis-524/6x,74hif deformations are not the same for all potentialinpa-541
     bs (lo(5)=.true.)ecis-525/7x,48h1-10   beta(2,*) for volume imaginainpa-542
     cry potential.,17x,8hecis-526/6x,45h11-20   beta(3,*) for surface rinpa-543
     deal potential.,21x,8hecis-527/6x,50h21-30   beta(4,*) for surface inpa-544
     eimaginary potential.,16x,8hecis-528/6x,38h31-40   beta(5,*) for reinpa-545
     fal spin-orbit.,28x,8hecis-529/6x,43h41-50   beta(6,*) for imaginarinpa-546
     gy spin-orbit.,23x,8hecis-530/6x,40h51-60   beta(7,*) for coulomb pinpa-547
     hotential.,26x,8hecis-531/6x,51h61-70   beta(8,*) for coulomb spin-inpa-548
     iorbit potential.,15x,8hecis-532/57h  note:  if lo(5)=.false., betainpa-549
     j(i,*)=beta(1,*) for i=2,8.,15x,8hecis-533/6h  ****,66x,8hecis-534/inpa-550
     k72x,8hecis-535)                                                   inpa-551
      write (2,1026)                                                    inpa-552
 1026 format (1h/32hdeformations of rotational model,8x,21hformat (2i5,inpa-553
     1f10.5,i5),11x,8hecis-536/32h********************************,40x,8inpa-554
     2hecis-537/80h only if lo(1)=.true. and lo(7)=.false., otherwise goinpa-555
     3 to 'optical model ecis-538/13h parameters'.,59x,8hecis-539/7x,10hinpa-556
     41- 5   iqm,4x,29hlargest order of deformation.,22x,8hecis-540/7x,5inpa-557
     53h6-10   iqmax  maximum l-value of multipole expansion.,12x,8hecisinpa-558
     6-541/6x,62h11-20   aspin, the k-value of the band, used only in syinpa-559
     7mmetric,4x,8hecis-542/21x,17hrotational model.,34x,8hecis-543/6x,1inpa-560
     80h21-25   ik,5x,59hlevel of which the masses are used for heavy-ioinpa-561
     9n   ecis-544/21x,35hcorrections. (default option ik=1).,16x,8hecisinpa-562
     a-545/64h  note:  in the asymmetric rotational model iqm is limitedinpa-563
     b to 35,8x,8hecis-546/34h  ****  and iqmax is limited to 8.,38x,8heinpa-564
     ccis-547/72x,8hecis-548/55hdeformations of real volume potential   inpa-565
     dformat (7f10.5),17x,8hecis-549/37h********************************inpa-566
     e*****,35x,8hecis-550/4x,48hiq = iqm/2 values for symmetric rotatioinpa-567
     fnal model,20x,8hecis-551/4x,49hiq = iqm-1 values for asymmetric roinpa-568
     gtational model,19x,8hecis-552/7x,52h1-10   beta(1,1)  deformation inpa-569
     hof the real potential.,13x,8hecis-553/6x,53h11-20   beta(1,2)  definpa-570
     iormation of the real potential.,13x,8hecis-554/6x,53h21-30   beta(inpa-571
     j1,3)  deformation of the real potential.,13x,8hecis-555)          inpa-572
      write (2,1027)                                                    inpa-573
 1027 format (6x,53h31-40   beta(1,4)  deformation of the real potentialinpa-574
     1.,13x,8hecis-556/6x,53h41-50   beta(1,5)  deformation of the real inpa-575
     2potential.,13x,8hecis-557/31h...............................,41x,8inpa-576
     3hecis-558/6x,25heventually, on next card:,9x,15hformat (7f10.5),17inpa-577
     4x,8hecis-559/7x,52h1-10   beta(1,8)  deformation of the real poteninpa-578
     5tial.,13x,8hecis-560/6x,58h11-20   beta(1,9)  deformation of the rinpa-579
     6eal potential. ....,8x,8hecis-561/6x,33h..... and so on up to betainpa-580
     7(1,iq).,33x,8hecis-562/72x,8hecis-563/33hdeformations for other poinpa-581
     8tentials,7x,15hformat (7f10.5),17x,8hecis-564/33h*****************inpa-582
     9****************,39x,8hecis-565/6x,74hif deformations are not the inpa-583
     asame for all potentials (lo(5)=.true.)ecis-566/7x,73h1-10   beta(2inpa-584
     b,i) deformation of the volume imaginary potential.  ecis-567/6x,60inpa-585
     ch11-20   beta(3,i) deformation of the surface real potential.,6x,8inpa-586
     dhecis-568/6x,74h21-30   beta(4,i) deformation of the surface imagiinpa-587
     enary potential. ecis-569/6x,54h31-40   beta(5,i) deformation for tinpa-588
     fhe real spin-orbit.,12x,8hecis-570/6x,59h41-50   beta(6,i) deformainpa-589
     gtion for the imaginary spin-orbit.,7x,8hecis-571/6x,56h51-60   betinpa-590
     ha(7,i) deformation for the coulomb potential.,10x,8hecis-572/6x,57inpa-591
     ih61-70   beta(8,i) deformation for the coulomb spin-orbit.,9x,8hecinpa-592
     jis-573/24h there are iq such cards,48x,8hecis-574)                inpa-593
      return                                                            inpa-594
      end                                                               inpa-595
c 04/05/98                                                      ecis97  inpb-000
      subroutine inpb                                                   inpb-001
      write (2,1028)                                                    inpb-002
 1028 format (68h  note:  if lo(5)=.false., beta(i,j)=beta(1,j) for i=2,inpb-003
     16 and j=1,iq.,4x,8hecis-575/6h  ****,66x,8hecis-576/72x,8hecis-577inpb-004
     2/52hexplanation of deformations of the rotational model:,20x,8heciinpb-005
     3s-578/52h****************************************************,20x,inpb-006
     48hecis-579/47hfor symmetric rotational model  (lo(3)=.false.),25x,inpb-007
     58hecis-580/7x,53hthe order of deformation is l=2, 4, 6, ... and soinpb-008
     6 on.,12x,8hecis-581/7x,39hthe radial dependence of potentials is:,inpb-009
     726x,8hecis-582/10x,56hr = r0*(1 + beta(*,1)*y(2,0).+ beta(*,2)*y(4inpb-010
     8,0) + .....),6x,8hecis-583/10x,36hodd order deformations are not rinpb-011
     9ead.,26x,8hecis-584/72x,8hecis-585/50hfor the asymmetric rotationainpb-012
     al model (lo(3)=.true.),22x,8hecis-586/7x,73hthe order of deformatiinpb-013
     bons are (l,k)=(2,0), (2,2), (4,0), (4,2),  ecis-587/10x,56h(4,4), inpb-014
     c(6,0) .... and so on. there are limited to (8,8).,6x,8hecis-588/7xinpb-015
     d,39hthe radial dependence of potentials is:,26x,8hecis-589/10x,70hinpb-016
     er = r0*(1 + beta(*,1)*(cos(beta(*,2))*y(2,0)+sin(beta(*,2))*  ecisinpb-017
     f-590/10x,70h(y(2,2)+y(2,-2))*sqrt(0.5)) + beta(*,3)*(cos(beta(*,4)inpb-018
     g)*y(4,0)ecis-591/10x,58h+sin(beta(*,4)*(cos(beta(*,5))*(y(4,2)+y(4inpb-019
     h,-2))*sqrt(0.5)),4x,8hecis-592/10x,70h+sin(beta(*,5))*(y(4,4)+y(4,inpb-020
     i-4))*sqrt(0.5)) + ..............  ecis-593/3x,77hthe 'gamma' type inpb-021
     jbetas as beta(*,i) for i=2,4,5,7... are in degrees. ecis-594)     inpb-022
      write (2,1029)                                                    inpb-023
 1029 format (3x,77h****************************************************inpb-024
     1**************** ecis-595/1h/80hfor the constrained asymmetric roinpb-025
     2tational model, when lo(2)=.true., the ecis-596/7x,73hband mixing inpb-026
     3coefficients are calculated from 'gamma'=beta(*,2)   ecis-597/7x,6inpb-027
     41hin the davydov-filippov model. the sequence of states must be,4xinpb-028
     5,8hecis-598/7x,73hthe ground state, the first 2+, the second 2+,thinpb-029
     6e other states   ecis-599/7x,73hdescribed as in the general case (inpb-030
     7there can be only the ground   ecis-600/7x,61hstate and the first inpb-031
     82+). the mixing parameter of the first 2+,4x,8hecis-601/7x,60hstatinpb-032
     9e is used as 'gamma' value instead of beta(1,2), but the,5x,8hecisinpb-033
     a-602/7x,60hdifferences between beta(i,3) are kept. the mixing parainpb-034
     bmeter,5x,8hecis-603/7x,73hof the second 2+ state is ignored. in a inpb-035
     csearch, the index 4001   ecis-604/7x,51hshould be used instead of inpb-036
     d2002 or 3011 for 'gamma'.,14x,8hecis-605/72x,8hecis-606/44hdeformainpb-037
     etions of anharmonic vibrational model,28x,8hecis-607/44h**********inpb-038
     f**********************************,28x,8hecis-608/80h  note:  in tinpb-039
     ghis model, there is an unique ratio 1/sqrt(4*pi) for any   ecis-60inpb-040
     h9/64h  ****  order of deformation. to be consistent with the harmoinpb-041
     inic,8x,8hecis-610/8x,72hvibrational model, the deformations indicainpb-042
     jted below should be   ecis-611)                                   inpb-043
      write (2,1030)                                                    inpb-044
 1030 format (8x,57hbeta, beta**2/sqrt(4*pi) and beta**3/(4*pi) respectiinpb-045
     1vely.,7x,8hecis-612/72x,8hecis-613/12hdeformations,28x,15hformat (inpb-046
     27f10.5),17x,8hecis-614/12h************,60x,8hecis-615/65h only if inpb-047
     3lo(1)=.false. and .lo(3)=.true., lo(5) or lo(16)=.true.,,7x,8hecisinpb-048
     4-616/44h otherwise go to 'optical model parameters'.,28x,8hecis-61inpb-049
     57/7x,39h1-10   beta(1,*) for central potential.,26x,8hecis-618/6x,inpb-050
     649h11-20   beta(2,*) for volume imaginary potential.,17x,8hecis-61inpb-051
     79/6x,45h21-30   beta(3,*) for surface real potential.,21x,8hecis-6inpb-052
     820/6x,50h31-40   beta(4,*) for surface imaginary potential.,16x,8hinpb-053
     9ecis-621/6x,38h41-50   beta(5,*) for real spin-orbit.,28x,8hecis-6inpb-054
     a22/6x,43h51-60   beta(6,*) for imaginary spin-orbit.,23x,8hecis-62inpb-055
     b3/6x,40h61-70   beta(7,*) for coulomb potential.,26x,8hecis-624/72inpb-056
     cx,8hecis-625/12h  next card:,28x,15hformat (7f10.5),17x,8hecis-626inpb-057
     d/12h  **********,60x,8hecis-627/7x,50h1-10   beta(8,*) for coulombinpb-058
     e spin-orbit potential.,15x,8hecis-628/80hthere are four sets of suinpb-059
     fch cards, one for each order of deformation.   ecis-629/72x,8hecisinpb-060
     g-630/15hangular momenta,25x,13hformat (14i5),19x,8hecis-631/15h***inpb-061
     h************,57x,8hecis-632/80h only if lo(16)=.true., otherwise ginpb-062
     io to 'deformations'.(if lo(6)=.true.,ecis-633/68hheavy-ion definitinpb-063
     jion do not change non coulomb deformation lengths).,4x,8hecis-634)inpb-064
      write (2,1031)                                                    inpb-065
 1031 format (8x,46h1- 5  for zeroth order (default 2). (not used),18x,8inpb-066
     1hecis-635/8x,34h6-10  for first order (default 2).,30x,8hecis-636/inpb-067
     27x,36h11-15  for second order (default 2).,29x,8hecis-637/7x,35h16inpb-068
     3-20  for third order (default 2).,30x,8hecis-638/7x,60h21-25  ik  inpb-069
     4 level of which the masses are used for heavy-ion,5x,8hecis-639/14inpb-070
     5x,35hcorrections. (default option ik=1).,23x,8hecis-640/9x,37henteinpb-071
     6r a negative value if you want 0.,26x,8hecis-641/72x,8hecis-642/28inpb-072
     7hoptical potential parameters,44x,8hecis-643/28h******************inpb-073
     8**********,44x,8hecis-644/80hnpp loops to 'equidistant angles' if inpb-074
     9lo(7)=.false. and lo(10)=.false.   ecis-645/68h  if lo(7)=.true. ainpb-075
     and lo(10)=.true. go to 'dispersion parameters' in,4x,8hecis-646/58inpb-076
     bh  this loop, if lo(7)=.true. and lo(10)=.false. skip them.,14x,8hinpb-077
     cecis-647/72x,8hecis-648/80hthe programme searches to which nuclearinpb-078
     d level the potential belongs. if ecis-649/66h  none is found, a wainpb-079
     erning is printed and the first one is chosen.,6x,8hecis-650/72x,8hinpb-080
     fecis-651/31hvolume or scalar real potential,9x,15hformat (3f10.5),inpb-081
     g17x,8hecis-652/31h*******************************,41x,8hecis-653/7inpb-082
     hx,29h1-10   val(1)   depth in mev.,36x,8hecis-654/1h/6x,38h11-20 inpb-083
     i  val(2)   reduced radius in fm.,28x,8hecis-655/6x,35h21-30   val(inpb-084
     j3)   diffuseness in fm.,31x,8hecis-656/72x,8hecis-657)            inpb-085
      write (2,1032)                                                    inpb-086
 1032 format (36hvolume or scalar imaginary potential,4x,15hformat (3f10inpb-087
     1.5),17x,8hecis-658/36h************************************,36x,8heinpb-088
     2cis-659/7x,29h1-10   val(4)   depth in mev.,36x,8hecis-660/6x,38h1inpb-089
     31-20   val(5)   reduced radius in fm.,28x,8hecis-661/6x,35h21-30  inpb-090
     4 val(6)   diffuseness in fm.,31x,8hecis-662/72x,8hecis-663/32hsurfinpb-091
     5ace or vector real potential,8x,15hformat (3f10.5),17x,8hecis-664/inpb-092
     632h********************************,40x,8hecis-665/7x,29h1-10   vainpb-093
     7l(7)   depth in mev.,36x,8hecis-666/6x,38h11-20   val(8)   reducedinpb-094
     8 radius in fm.,28x,8hecis-667/6x,35h21-30   val(9)   diffuseness iinpb-095
     9n fm.,31x,8hecis-668/72x,8hecis-669/55hsurface or vector imaginaryinpb-096
     a potential   format (3f10.5),17x,8hecis-670/37h*******************inpb-097
     b******************,35x,8hecis-671/7x,29h1-10   val(10)  depth in minpb-098
     cev.,36x,8hecis-672/6x,38h11-20   val(11)  reduced radius in fm.,28inpb-099
     dx,8hecis-673/6x,35h21-30   val(12)  diffuseness in fm.,31x,8hecis-inpb-100
     e674/72x,8hecis-675/35hspin-orbit or tensor real potential,5x,15hfoinpb-101
     frmat (3f10.5),17x,8hecis-676/35h**********************************inpb-102
     g*,37x,8hecis-677/7x,29h1-10   val(13)  depth in mev.,36x,8hecis-67inpb-103
     h8/6x,38h11-20   val(14)  reduced radius in fm.,28x,8hecis-679/6x,3inpb-104
     i5h21-30   val(15)  diffuseness in fm.,31x,8hecis-680/72x,8hecis-68inpb-105
     j1/55hspin-orbit/tensor imaginary potential   format (3f10.5),17x,8inpb-106
     khecis-682)                                                        inpb-107
      write (2,1033)                                                    inpb-108
 1033 format (37h*************************************,35x,8hecis-683/7xinpb-109
     1,29h1-10   val(16)  depth in mev.,36x,8hecis-684/6x,38h11-20   valinpb-110
     2(17)  reduced radius in fm.,28x,8hecis-685/6x,35h21-30   val(18)  inpb-111
     3diffuseness in fm.,31x,8hecis-686/50h  note:  the spin-orbit operainpb-112
     4tor is always 2*(l.s),22x,8hecis-687/60h  ****  for spin 1/2 partiinpb-113
     5cle, the depth is the usual value.,12x,8hecis-688/8x,72hfor spin 1inpb-114
     6 particle, the depth is the half of the usual value.  ecis-689/72xinpb-115
     7,8hecis-690/17hcoulomb potential,23x,15hformat (3f10.5),17x,8hecisinpb-116
     8-691/17h*****************,55x,8hecis-692/7x,45h1-10   val(20)  redinpb-117
     9uced coulomb radius in fm.,20x,8hecis-693/6x,74h11-20   val(21)  dinpb-118
     aiffuseness of a woods-saxon charge distribution.ecis-694/6x,74h21-inpb-119
     b30   val(25)  third parameter of a fermi charge distribution.  eciinpb-120
     cs-695/72x,8hecis-696/28hspin-orbit coulomb potential,12x,15hformatinpb-121
     d (3f10.5),17x,8hecis-697/28h****************************,44x,8heciinpb-122
     es-698/7x,73h1-10   val(22)  anomalous magnetic moment (less half cinpb-123
     fharge in   ecis-699/14x,66hdirac formalism) multiplied by the charinpb-124
     gge of the target.  ecis-700/6x,38h11-20   val(23)  reduced radius inpb-125
     hin fm.,28x,8hecis-701/6x,35h21-30   val(24)  diffuseness in fm.,31inpb-126
     ix,8hecis-702/80h  note:  if val(21)=0. or val(24)=0. a homogeneousinpb-127
     j charge distribution  ecis-703)                                   inpb-128
      write (2,1034)                                                    inpb-129
 1034 format (63h  ****  is used. the product of charges is copied into inpb-130
     1val(19).,9x,8hecis-704/9x,71hwhen the diffuseness of the charge isinpb-131
     2 not zero, the woods-saxonecis-705/8x,72hform factor is multipliedinpb-132
     3 by 1+val(25)*r**2. the same parameter ecis-706/8x,55hval(25) is uinpb-133
     4sed for these two last potentials, if their,9x,8hecis-707/8x,24hdiinpb-134
     5ffuseness is not zero.,40x,8hecis-708/9x,59hif lo(9)=.true., enterinpb-135
     6 a negative radius to use a symmetric,4x,8hecis-709/8x,24hwoods-sainpb-136
     7xon form factor.,40x,8hecis-710/9x,71hif a diffuseness or the radiinpb-137
     8us of a coulomb potential without  ecis-711/8x,57hdiffuseness is ninpb-138
     9egative, its absolute value is taken into,7x,8hecis-712/8x,49haccoinpb-139
     aunt in subroutine rotp and a message printed.,15x,8hecis-713/72x,8inpb-140
     bhecis-714/1h/68h*** end of do-loop for potentials without foldinginpb-141
     c and dispersion ***,4x,8hecis-715/53h*** relations (lo(10)=.false.inpb-142
     d and lo(17)=.false.) ***,19x,8hecis-716/72x,8hecis-717/27hfolding inpb-143
     efor real potentials,13x,15hformat (3f10.5),17x,8hecis-718/27h*****inpb-144
     f**********************,45x,8hecis-719/64h only if lo(17)=.true., oinpb-145
     gtherwise go to 'dispersion parameters'.,8x,8hecis-720/7x,28h1-10  inpb-146
     h val(26) 'v' parameter,37x,8hecis-721/6x,29h11-20   val(27) 'r' painpb-147
     irameter,37x,8hecis-722/6x,29h21-30   val(28) 'a' parameter,37x,8heinpb-148
     jcis-723/72x,8hecis-724)                                           inpb-149
      write (2,1035)                                                    inpb-150
 1035 format (32hfolding for imaginary potentials,8x,15hformat (3f10.5),inpb-151
     117x,8hecis-725/32h********************************,40x,8hecis-726/inpb-152
     27x,29h1-10   val(29) 'v' parameter.,36x,8hecis-727/6x,30h11-20   vinpb-153
     3al(30) 'r' parameter.,36x,8hecis-728/6x,30h21-30   val(31) 'a' parinpb-154
     4ameter.,36x,8hecis-729/72x,8hecis-730/30hfolding for coulomb poteninpb-155
     5tials,10x,15hformat (3f10.5),17x,8hecis-731/30h*******************inpb-156
     6***********,42x,8hecis-732/7x,29h1-10   val(32) 'v' parameter.,36xinpb-157
     7,8hecis-733/6x,30h11-20   val(33) 'r' parameter.,36x,8hecis-734/6xinpb-158
     8,30h21-30   val(34) 'a' parameter.,36x,8hecis-735/72x,8hecis-736/8inpb-159
     90hexplanation of folding parameters:  the folding functions are noinpb-160
     armalisedecis-737/80h**********************************  to 1.  to inpb-161
     bfold an optical potential,ecis-738/4x,76henter the true charge, thinpb-162
     ce depth of central potential equal to the  ecis-739/4x,76hdepth ofinpb-163
     d the nucleon potential multiplied by the number of nucleons ecis-7inpb-164
     e40/4x,76hin the projectile, and the depth of of spin-orbit potentiinpb-165
     fal equal toecis-741/4x,76hthe depth of the nucleon spin-orbit poteinpb-166
     gntial divided by the number ecis-742/4x,30hof nucleons in the projinpb-167
     hectile.,38x,8hecis-743/6x,5h'v'=0,4x,11hno folding.,46x,8hecis-744inpb-168
     i/6x,5h'a'=0,4x,40hgaussian form factor with the range 'r'.,17x,8heinpb-169
     jcis-745)                                                          inpb-170
      write (2,1036)                                                    inpb-171
 1036 format (6x,5h'r'=0,4x,48hhulthen form factor (exp(-r/'v')-exp(-r/'inpb-172
     1a'))/r.,9x,8hecis-746/15x,53hreduced to yukawa form factor exp(-r/inpb-173
     2'v')/r if 'a'=0.,4x,8hecis-747/6x,51hotherwise  saxon form factor inpb-174
     31/(1+exp((r-'r')/'a').,15x,8hecis-748/6x,74hif a folding parameterinpb-175
     4 is negative, the absolute value is taken   ecis-749/4x,54hinto acinpb-176
     5count in subroutine fold and a message printed.,14x,8hecis-750/6x,inpb-177
     674hall the derivatives of potentials needed are obtained by numeriinpb-178
     7calecis-751/4x,25hderivation after folding.,43x,8hecis-752/72x,8heinpb-179
     8cis-753/21hdispersion parameters,19x,19hformat (2i5,6f10.5),13x,8hinpb-180
     9ecis-754/21h*********************,51x,8hecis-755/80h only if lo(10inpb-181
     a)=.true., otherwise go to 'end of do-loop for potentials'.ecis-756inpb-182
     b/4x,13h1- 5   ipp(2),4x,59hnv with |nv| power for volume or scalarinpb-183
     c potential. ecis-757/4x,13h6-10   ipp(3),4x,59hns with |ns| power inpb-184
     dfor surface or vector potential.ecis-758/3x,14h11-20   pip(4),4x,4inpb-185
     e5henergy in the center of mass system for which,6x,8hecis-759/21x,inpb-186
     f47hthe imaginary depths are read. (default option:,4x,8hecis-760/2inpb-187
     g1x,59henergy of the first level using this potential).   ecis-761/inpb-188
     h3x,14h21-30   pip(5),4x,47hefer   fermi energy. (default option -6inpb-189
     i.8 mev).,4x,8hecis-762/3x,14h31-40   pip(6),4x,44hbv  constant forinpb-190
     j volume or scalar potential.,7x,8hecis-763)                       inpb-191
      write (2,1037)                                                    inpb-192
 1037 format (3x,14h41-50   pip(7),4x,45hbw  constant for surface or vecinpb-193
     1tor potential.,6x,8hecis-764/3x,14h51-60   pip(8),4x,59hc   exponeinpb-194
     2ntial decrease of a surface potential.   ecis-765/21x,41hbw' seconinpb-195
     3d constant for surface or vector,10x,8hecis-766/25x,41hpotential finpb-196
     4or ns<0 (default option 2*bw).,6x,8hecis-767/3x,14h61-70   pip(9),inpb-197
     54x,33hr   non-locality range parameter.,18x,8hecis-768/21x,59hfw  inpb-198
     6fraction of the imaginary vector potential due ecis-769/25x,55hto inpb-199
     7the first term in dirac formalism if ns<0.  ecis-770/72x,8hecis-77inpb-200
     81/1h/12h  next card:,28x,15hformat (7f10.5),17x,8hecis-772/12h  *inpb-201
     9*********,60x,8hecis-773/63h only if nv<0, otherwise go to 'end ofinpb-202
     a do-loop for potentials'.,9x,8hecis-774/4x,76h1-10   pip(10)   bv'inpb-203
     b second constant for volume or scalar potential.ecis-775/3x,77h11-inpb-204
     c20   pip(11)   fv  fraction of the imaginary volume potential due inpb-205
     decis-776/25x,18hto the first term.,29x,8hecis-777/72x,8hecis-778/3inpb-206
     e7hexplanation of dispersion parameters:,35x,8hecis-779/37h********inpb-207
     f*****************************,35x,8hecis-780/80hfor positive valueinpb-208
     gs of nv: the volume imaginary potential at the energy ecis-781/80hinpb-209
     h************************** e in the center of mass system is assuminpb-210
     ied to ecis-782/4x,76hbe 'v(e)=v*(e-efer))**nv/((e-efer)**nv+bv**nvinpb-211
     j))' where 'v' is such  ecis-783)                                  inpb-212
      write (2,1038)                                                    inpb-213
 1038 format (4x,76hthat this gives the value read at the energy pip(4).inpb-214
     1 the real volumeecis-784/4x,76hpotential with the same geometry, oinpb-215
     2btained by dispersion relation   ecis-785/4x,76h(as described by cinpb-216
     3. mahaux and r. sartor in nucl. phys a458 (1986)  ecis-786/4x,39h2inpb-217
     45-50), is added to the real potential.,29x,8hecis-787/80hfor positinpb-218
     5ive values of ns: the surface imaginary potential 'w(e)' in theeciinpb-219
     6s-788/80h************************** schroedinger formalism is assuinpb-220
     7med to have theecis-789/4x,60hsame energy dependence multiplied byinpb-221
     8 'exp(-c*|e-efer|)'. the,8x,8hecis-790/4x,62hnon-locality range painpb-222
     9rameter 'r' is the inverse of eb given by,6x,8hecis-791/4x,64hequainpb-223
     ations (3.17) and (3.18) of reference given above and is used,4x,8hinpb-224
     becis-792/4x,76honly for surface potentials. there is not the defauinpb-225
     clt option r=.0125ecis-793/4x,18hto allow to use 0.,50x,8hecis-794/inpb-226
     d80hfor negative values of nv: the volume imaginary potential is asinpb-227
     esumed to ecis-795/80h************************** be the sum of two inpb-228
     fterms similar to those usedecis-796/4x,76hfor positive values, witinpb-229
     gh the power |nv| and the parameters bv and  ecis-797/4x,76hbv' resinpb-230
     hpectively. the strengths are such that the first term is fv  ecis-inpb-231
     i798/4x,42htimes the value read at the energy pip(4).,26x,8hecis-79inpb-232
     j9)                                                                inpb-233
      write (2,1039)                                                    inpb-234
 1039 format (65hfor negative values of ns: the surface imaginary potentinpb-235
     1ial is the,7x,8hecis-800/80h************************** difference inpb-236
     2of two terms similar to those usedecis-801/4x,76hfor positive valuinpb-237
     3es of nv, with the power |ns|, the parameters bw,  ecis-802/4x,38hinpb-238
     4bw' respectively and the same strengh.,30x,8hecis-803/6x,74hthe veinpb-239
     5ctor dispersive potential of the dirac formalism is treated ecis-8inpb-240
     604/4x,18has the scalar one.,50x,8hecis-805/6x,74hthe powers nv andinpb-241
     7 ns must be even. input of 0 suppresses the use  ecis-806/4x,55hofinpb-242
     8 dispersion relation for the corresponding potential.,13x,8hecis-8inpb-243
     907/72x,8hecis-808/6x,44h******  end of do-loop for potentials ****inpb-244
     a**,22x,8hecis-809/72x,8hecis-810/18hequidistant angles,22x,15hforminpb-245
     bat (7f10.5),17x,8hecis-811/18h******************,54x,8hecis-812/80inpb-246
     ch only if lo(66)=.false., otherwise go to 'spin-orbit parametrisatinpb-247
     dion'.  ecis-813/7x,28h1-10   theta1   first angle.,37x,8hecis-814/inpb-248
     e6x,42h11-20   dtheta   step. (default option 1.),24x,8hecis-815/6xinpb-249
     f,28h21-30   theta2   last angle.,38x,8hecis-816/6x,12h31-40   dtheinpb-250
     g,5x,57haveraging angle. values listed are 1/3 of the sumecis-817/2inpb-251
     h3x,36hof values at theta and theta+/-dthe.,13x,8hecis-818/72x,8hecinpb-252
     iis-819/26hspin-orbit parametrisation,14x,15hformat (7f10.5),17x,8hinpb-253
     jecis-820/26h**************************,46x,8hecis-821)            inpb-254
      write (2,1040)                                                    inpb-255
 1040 format (80h only if lo(4)=.true., otherwise go to 'hauser-feshbachinpb-256
     1 corrections'.   ecis-822/7x,11h1-10   az1.,54x,8hecis-823/6x,12h1inpb-257
     21-20   az2.,8x,33h(these parameters are in an array,13x,8hecis-824inpb-258
     3/6x,12h21-30   az3.,54x,8hecis-825/6x,12h31-40   az4.,8x,42haz(16)inpb-259
     4 from az(1) to az(6) for the search),4x,8hecis-826/6x,12h41-50   ainpb-260
     5z5.,54x,8hecis-827/6x,12h51-60   az6.,54x,8hecis-828/1h/53h  noteinpb-261
     6: the unparametrised spin-orbit deformation is:,19x,8hecis-829/40hinpb-262
     7  ****   az1=az4=0.,  az2=az3=az5=az6=1.,32x,8hecis-830/8x,46hthe inpb-263
     8spin-orbit deformation multiplied by x is:,18x,8hecis-831/10x,35hainpb-264
     9z1=az4=0., az2=1., az3=az5=az6=x .,27x,8hecis-832/8x,42hthe 'incorinpb-265
     arect' spin-orbit deformation is:,22x,8hecis-833/10x,33haz1=az2=az5inpb-266
     b=az6=0., az3=az4=0.5 .,29x,8hecis-834/8x,72hfor the most general pinpb-267
     carametrisation of deformed spin-orbit see ecis-835/7x,33hcomment cinpb-268
     dards in subroutine quan.,32x,8hecis-836/72x,8hecis-837/27hhauser-finpb-269
     eeshbach corrections,13x,15hformat (7f10.5),17x,8hecis-838/27h*****inpb-270
     f**********************,45x,8hecis-839/80h only if lo(81)=.true., oinpb-271
     gtherwise go to 'cards read in subroutine deph'.ecis-840/6x,49h1-10inpb-272
     h   bz1.   square root of elastic enhancement.,17x,8hecis-841/20x,2inpb-273
     i4h(default option 1.4142).,28x,8hecis-842/5x,75h11-20   bz2.   if inpb-274
     jlo(82)=.true., spin cut-off parameter (default   ecis-843)        inpb-275
      write (2,1041)                                                    inpb-276
 1041 format (20x,60hoption 3.5). if lo(82)=.false., particle degrees ofinpb-277
     1 ecis-844/20x,8hfreedom.,44x,8hecis-845/5x,54h21-30   bz3.   squarinpb-278
     2e root of level density parameter.,13x,8hecis-846/20x,22h(default inpb-279
     3option 100.).,30x,8hecis-847/65h  note:  the penetrabilities, whicinpb-280
     4h are probabilities of compound,7x,8hecis-848/80h  ****  nucleus finpb-281
     5ormation, are related to partial cross-sections minus  ecis-849/8xinpb-282
     6,72hthe reaction cross-section to the channels taken into account.inpb-283
     7  ecis-850/9x,59hif lo(82)=.true., denoting by ti and tf the penetinpb-284
     8rabilities,4x,8hecis-851/8x,72hdefined above for the incoming and inpb-285
     9the outgoing channels, the   ecis-852/8x,59hhauser-feshbach correcinpb-286
     ation is: ti*tf/(4*(sum on all the t)+,5x,8hecis-853/8x,72h+bz3**2*inpb-287
     b(2*j+1)*exp(-(j*j+j)/(2*bz2**2)) for inelastic channels,ecis-854/8inpb-288
     cx,41hmultiplied by bz1**2 for the elastic one.,23x,8hecis-855/8x,7inpb-289
     d2hfor the search, these quantities are in az from az(7) to az(9). inpb-290
     eecis-856/9x,71hfor lo(82)=.false.: without fluctuations (lo(87)=.tinpb-291
     frue.), bz1  ecis-857/8x,72his used and can be in search; with flucinpb-292
     gtuations (lo(87)=.false.)ecis-858/8x,57hmoldauer formula is used iinpb-293
     hf bz2=0, the given value of bz2,7x,8hecis-859/8x,44hotherwise. onlinpb-294
     iy bz1 or bz2 can be in search.,20x,8hecis-860/72x,8hecis-861/12hfiinpb-295
     jssion data,28x,15hformat (7f10.5),17x,8hecis-862/12h************,6inpb-296
     k0x,8hecis-863)                                                    inpb-297
      write (2,1042)                                                    inpb-298
 1042 format (56hif lo(82)=.true., go to 'cards read in subroutine deph'inpb-299
     1.,16x,8hecis-864/62hif lo(85)=.false., go to 'giant dipole resonaninpb-300
     2ce description'.,10x,8hecis-865/6x,42h1-10   fiss(1,*)  transmissiinpb-301
     3on coefficient,24x,8hecis-866/5x,75h11-20   fiss(2,*)  degrees of inpb-302
     4freedom. if <.5, it is replaced by 0.ecis-867/80h  there are nfissinpb-303
     5 such cards. the first coefficient is for the smallest ecis-868/80inpb-304
     6htotal j value of the system and the same parity of the ground stainpb-305
     7te. theecis-869/80hsecond one is for the opposite parity. the follinpb-306
     8owing ones are for higherecis-870/43hj values, with the same orderinpb-307
     9 for parities.,29x,8hecis-871/72x,8hecis-872/34hgiant dipole resoninpb-308
     aance description,6x,15hformat (7f10.5),17x,8hecis-873/34h*********inpb-309
     b*************************,38x,8hecis-874/80h  only if lo(86)=.trueinpb-310
     c., otherwise go to 'level density for continuum'. ecis-875/3x,52hiinpb-311
     df nrd is not 0, go to 'gamma transmission factors'.,17x,8hecis-876inpb-312
     e/7x,73hdata to compute the (neutron, gamma) cross-section when theinpb-313
     f giantecis-877/3x,77hdipole resonance model is used (see e. lynn, inpb-314
     g'the theory of neutron  ecis-878/3x,61hresonance reactions', pagesinpb-315
     h 321/326 and a. gilbert and a.g.w.,8x,8hecis-879/3x,64hcameron, cainpb-316
     in. jour. of physics 43, 1446, 1965, pages 1475/1476).,5x,8hecis-88inpb-317
     j0/6x,57h1-10   tgo   slow s-wave neutron gamma widths/spacing for,inpb-318
     k9x,8hecis-881)                                                    inpb-319
      write (2,1043)                                                    inpb-320
 1043 format (19x,46hnormalisation. if tgo=0, lo(86) is set .false.,7x,8inpb-321
     1hecis-882/5x,10h11-20   bn,4x,46hneutron separation energy.(defaulinpb-322
     2t option 8.).,7x,8hecis-883/5x,43h21-30   fnug  radiative degrees inpb-323
     3of freedom.,24x,8hecis-884/19x,43hif less than 1., it is replaced inpb-324
     4by fnug=20.,10x,8hecis-885/1h/5x,51h31-40   egd   energy of the ginpb-325
     5iant dipole resonance.,16x,8hecis-886/19x,44h(default option 163*(inpb-326
     6n*z)**2/(n+z)**(4/3).).,9x,8hecis-887/19x,47hthe strong absorptioninpb-327
     7 model id used if egd < 0.,6x,8hecis-888/19x,46h(simple behaviour inpb-328
     8as e**3 instead of resonance,7x,8hecis-889/19x,19hwith a factor e*inpb-329
     9*4),34x,8hecis-890/5x,51h41-50   ggd   resonance width. (default oinpb-330
     aption 5.).,16x,8hecis-891/4x,76hfor the search, these quantities ainpb-331
     bre in az from az(10) to az(14).   ecis-892/72x,8hecis-893/26hgammainpb-332
     c transmission factors,14x,15hformat (7f10.5),17x,8hecis-894/26h***inpb-333
     d***********************,46x,8hecis-895/40h only if lo(86)=.true. ainpb-334
     end nrd is not 0.,32x,8hecis-896/6x,22h1-10   gam(1) for l=0.,44x,8inpb-335
     fhecis-897/5x,23h11-20   gam(2) for l=1.,44x,8hecis-898/5x,23h.....inpb-336
     g..................,44x,8hecis-899/5x,23h61-70   gam(7) for l=6.,44inpb-337
     hx,8hecis-900/45h  up to gam(nrd), eventually on others cards.,27x,inpb-338
     i8hecis-901/72x,8hecis-902/33hlevel density of compound nucleus,7x,inpb-339
     j15hformat (7f10.5),17x,8hecis-903)                                inpb-340
      write (2,1044)                                                    inpb-341
 1044 format (33h*********************************,39x,8hecis-904/3x,77hinpb-342
     1if there are gamma transmission parameters computed with the giantinpb-343
     2   ecis-905/68hdipole resonance model (lo(86)=.true. and nrd=0 in inpb-344
     3'compound nucleus,4x,8hecis-906/80hdata'),  or continua (ncont notinpb-345
     4 0 in 'compound nucleus data'), otherwiseecis-907/38hgo to 'cards inpb-346
     5read in subroutine deph'.,34x,8hecis-908/3x,77hfor the total residinpb-347
     6ual nucleus needed for the gamma giant resonance, ecis-909/51hfollinpb-348
     7owed by the residual nucleus of each continuum:,21x,8hecis-910/6x,inpb-349
     851h1-10   scn(7,i) z:   charge of the compound nucleus,15x,8hecis-inpb-350
     9911/5x,75h11-20   scn(1,i) sa:  level density parameter for s-waveinpb-351
     a resonance ecis-912/27x,53hspacing. (default option (.0091*(shell inpb-352
     bcorr. ecis-913/27x,39h-.23*nd)+.143)*na where na is the total,6x,8inpb-353
     checis-914/27x,53hnumber of nucleons, nd the minimum distance  ecisinpb-354
     d-915/27x,53hto a magic number for protons or neutrons andecis-916/inpb-355
     e27x,37hshell corrections are given by cook).,8x,8hecis-917/5x,75h2inpb-356
     f1-30   scn(2,i) ux:  matching energy for the two density formula  inpb-357
     gecis-918/27x,41hshifted by pairing energy. (default value,4x,8heciinpb-358
     hs-919/27x,12h2.5+150/na).,33x,8hecis-920/5x,58h31-40   scn(3,i) tainpb-359
     iu: nuclear temperature. (default option,9x,8hecis-921/27x,26h1/tauinpb-360
     j=sqrt(sa/ux)-1.5/ux).,19x,8hecis-922)                             inpb-361
      write (2,1045)                                                    inpb-362
 1045 format (5x,61h41-50   scn(4,i) sg:  spin cut off parameter. (defauinpb-363
     1lt option,6x,8hecis-923/27x,37hformula (11) of gilbert and cameroninpb-364
     2).,8x,8hecis-924/5x,75h51-60   scn(5,i) e0:  energy shift. (defaulinpb-365
     3t option formula (28) ofecis-925/27x,21hgilbert and cameron).,24x,inpb-366
     48hecis-926/5x,61h61-70   scn(6,i) ex:  matching energy between theinpb-367
     5 two density,6x,8hecis-927/27x,41hformulae. (default option ux+paiinpb-368
     6ring with,4x,8hecis-928/27x,22hpairing given by cook),23x,8hecis-9inpb-369
     729/66h  note:  the dimensions of the array scn are 8 and ncons. scinpb-370
     8n(j,i),6x,8hecis-930/80h  ****  can be searched for j=1 to 6. if sinpb-371
     9cn(j,i) is 0., it is replaced ecis-931/8x,60hby the default optioninpb-372
     a computed with the scn(i,k) for k<j. if,4x,8hecis-932/8x,58hscn(3,inpb-373
     bi) is negative, it is replaced by the default option,6x,8hecis-933inpb-374
     c/8x,72hcomputed with default options for sa and ux. after replaceminpb-375
     dent, ecis-934/8x,57hdensity parameters used for gammas are listed inpb-376
     eat the end.,7x,8hecis-935/9x,71hfor a search, take into account thinpb-377
     fat data for the gamma giant  ecis-936/8x,57hdipole resonance are sinpb-378
     gtored after data for the continuum.,7x,8hecis-937/72x,8hecis-938/7inpb-379
     h2x,8hecis-939/1h/29hcards read in subroutine deph,43x,8hecis-940/inpb-380
     i29h*****************************,43x,8hecis-941/72x,8hecis-942/32hinpb-381
     jnumber of observables by channel,8x,13hformat (14i5),19x,8hecis-94inpb-382
     k3)                                                                inpb-383
      write (2,1046)                                                    inpb-384
 1046 format (32h********************************,40x,8hecis-944/4x,76h(inpb-385
     1non-standard observables) only if lo(94)=.true. and lo(66)=.false.inpb-386
     2,ecis-945/4x,49hotherwise go to 'restricted coulomb corrections'.,inpb-387
     319x,8hecis-946/7x,56h1- 5   number of observables for the elastic inpb-388
     4scattering.,9x,8hecis-947/7x,57h6-10   number of observables for tinpb-389
     5he first excited state.,8x,8hecis-948/6x,59h11-15   number of obseinpb-390
     6rvables for the second excited state.,7x,8hecis-949/6x,58h16-20   inpb-391
     7number of observables for the third excited state.,8x,8hecis-950/6inpb-392
     8x,19h21-25   ...........,47x,8hecis-951/14x,46hup to the last coupinpb-393
     9led channel (ncoll values).,12x,8hecis-952/72x,8hecis-953/22hfor einpb-394
     aach coupled state,50x,8hecis-954/22h**********************,50x,8heinpb-395
     bcis-955/72x,8hecis-956/26hobservable identifications,14x,13hformatinpb-396
     c (14i5),19x,8hecis-957/26h**************************,46x,8hecis-95inpb-397
     d8/7x,73h1- 5   first observable which must be the cross-section (einpb-398
     enter a ecis-959/14x,13hblank or 0) .,45x,8hecis-960/7x,25h6-10   sinpb-399
     fecond observable.,40x,8hecis-961/6x,25h11-15   third observable.,4inpb-400
     g1x,8hecis-962/6x,26h16-20   fourth observable.,40x,8hecis-963/6x,2inpb-401
     h5h21-25   fifth observable.,41x,8hecis-964/6x,19h26-30   .........inpb-402
     i..,47x,8hecis-965/14x,26hup to the last observable.,32x,8hecis-966inpb-403
     j/72x,8hecis-967/3x,40hstandard description  0   cross-section.,29xinpb-404
     k,8hecis-968)                                                      inpb-405
      write (2,1047)                                                    inpb-406
 1047 format (3x,77h********************  1   cross-section / rutherfordinpb-407
     1's cross-section.ecis-969/25x,27h2   vector analysing power.,20x,8inpb-408
     2hecis-970/6x,1h3,5x,20hvector polarisation.,40x,8hecis-971/12x,68hinpb-409
     3(note a ratio sqrt(2.) with it11 for spin 1/2 for 2 and 3). ecis-9inpb-410
     472/6x,1h4,5x,5ht20 .,55x,8hecis-973/6x,1h5,5x,5ht21 .,55x,8hecis-9inpb-411
     574/6x,1h6,5x,5ht22 .,55x,8hecis-975/6x,1h7,5x,56hspin-flip :  (a(0inpb-412
     6000,0000)+a(1100,1100)+a(1100,1-100))/2,4x,8hecis-976/6x,1h8,5x,68inpb-413
     7hreserved for a set of experimental data which are reaction  ecis-inpb-414
     8977/17x,51hcross-sections. see 'cards read in subroutine lecd',4x,inpb-415
     98hecis-978/72x,8hecis-979/4x,24hnon standard description,4x,48hentinpb-416
     aer a negative value, different for   ecis-980/4x,24h**************inpb-417
     b**********,4x,48hdifferent observables. the description  ecis-981/inpb-418
     c32x,32hwill be read in subroutine obse.,8x,8hecis-982/10x,44hcrossinpb-419
     d-sections must be before polarisations.,18x,8hecis-983/72x,8hecis-inpb-420
     e984/16hplot indications,24x,13hformat (14i5),19x,8hecis-985/16h***inpb-421
     f*************,56x,8hecis-986/7x,73h1- 5   number of decades in loginpb-422
     garithmic scales for cross-section.ecis-987/7x,40h6-10   indicationinpb-423
     h for second observable.,25x,8hecis-988/6x,40h11-15   indication foinpb-424
     ir third observable.,26x,8hecis-989/6x,27h16-20   .................inpb-425
     j..,39x,8hecis-990/14x,26hup to the last observable.,32x,8hecis-991inpb-426
     k)                                                                 inpb-427
      write (2,1048)                                                    inpb-428
 1048 format (6x,74hindications for polarisations are '1' for plot and 'inpb-429
     10' for no plotecis-992/72x,8hecis-993/6x,48h******  end of do-loopinpb-430
     2 for nuclear states ******,18x,8hecis-994/72x,8hecis-995/1h/30hreinpb-431
     3stricted coulomb corrections,10x,13hformat (14i5),19x,8hecis-996/3inpb-432
     40h******************************,42x,8hecis-997/4x,59hif lo(44) aninpb-433
     5d lo(46)=.true., otherwise go to 'cards read in,9x,8hecis-998/44h inpb-434
     6 subroutine calx'.  for each nuclear level:,28x,8hecis-999/10x,54hinpb-435
     71- 5   niv(i,j,3) between level i and level j for j=1.,8x,8hecis10inpb-436
     800/10x,54h6-10   niv(i,j,3) between level i and level j for j=2.,8inpb-437
     9x,8hecis1001/9x,33h11-15   .........................,30x,8hecis100inpb-438
     a2/17x,50henter '1' for coulomb correction and '0' for none.,5x,8heinpb-439
     bcis1003/4x,76honly values for j smaller than or equal to i are takinpb-440
     cen into account.ecis1004/9x,27hthere are ncoll such cards.,36x,8heinpb-441
     dcis1005/72x,8hecis1006/72x,8hecis1007/29hcards read in subroutine inpb-442
     ecalx,43x,8hecis1008/29h*****************************,43x,8hecis100inpb-443
     f9/80h only if lo(31)=.true., otherwise go to 'cards read in subrouinpb-444
     gtine obse'.ecis1010/72x,8hecis1011/15hchi2 conditions,25x,19hformainpb-445
     ht (4i5,2f10.5),13x,8hecis1012/15h***************,57x,8hecis1013/7xinpb-446
     i,46h1- 5   ncolr  number of angular distributions.,19x,8hecis1014/inpb-447
     j7x,45h6-10   nrec   number of parameters in search.,20x,8hecis1015inpb-448
     k)                                                                 inpb-449
      write (2,1049)                                                    inpb-450
 1049 format (6x,74h11-15   nfit   number of functions kept in the searcinpb-451
     1h beyond the  ecis1016/21x,32hminimum number which is nrec+1 .,19xinpb-452
     2,8hecis1017/6x,74h16-20   nessai maximum number of evaluations. (dinpb-453
     3efault option 100)ecis1018/21x,42hthis value is not used when lo(3inpb-454
     44)=.true..,9x,8hecis1019/6x,11h21-30   ech,4x,35hsearch scale. (deinpb-455
     5fault option 20.).,16x,8hecis1020/21x,59hin the preliminary runs, inpb-456
     6variables are changed by  ecis1021/21x,59hthe product of this numbinpb-457
     7er with their accuracy. in ecis1022/21x,46hthe others runs, the chinpb-458
     8ange of any variable is,5x,8hecis1023/21x,28hlimited by twice thisinpb-459
     9 value.,23x,8hecis1024/6x,11h31-40   rap,4x,59hratio of increase finpb-460
     aor the search scale after a run ecis1025/21x,59hfor which the chi2inpb-461
     b decreased. (default option 1.)  ecis1026/21x,59hthe value of ech inpb-462
     cis the product by rap of the last ecis1027/21x,59hmaximum change oinpb-463
     df parameter which gave a lower chi2ecis1028/21x,59hthe value 1 leainpb-464
     eds safely to the minimum. a value   ecis1029/21x,59hlarger than 1.inpb-465
     f leads quicker towards the minimum.  ecis1030/21x,38ha value less inpb-466
     gthan 1. is replaced by 1.,13x,8hecis1031/72x,8hecis1032/72x,8hecisinpb-467
     h1033/29hcards read in subroutine lecd,43x,8hecis1034/29h**********inpb-468
     i*******************,43x,8hecis1035/80h only if ncolr is not 0, othinpb-469
     jerwise go to 'cards read in subroutine obse'ecis1036/72x,8hecis103inpb-470
     k7)                                                                inpb-471
      write (2,1050)                                                    inpb-472
 1050 format (29hfor each angular distribution,43x,8hecis1038/29h*******inpb-473
     1**********************,43x,8hecis1039/72x,8hecis1040/14hidentificainpb-474
     2tion,26x,40hformat (l1,i1,i3,2i5,5x,3f10.5) ecis1041/14h**********inpb-475
     3****,58x,8hecis1042/10x,56h1   lx logical. if lx=.true. the experiinpb-476
     4mental errors are,6x,8hecis1043/14x,48hpercentages. lx is set .falinpb-477
     5se. if the observable,10x,8hecis1044/14x,29hidentification is not inpb-478
     60 or 1.,29x,8hecis1045/10x,70h2   1 if the angles are in the laborinpb-479
     7atory system, 0 otherwise.ecis1046/7x,29h3- 5   nt   number of anginpb-480
     8les.,36x,8hecis1047/7x,35h6-10   number of the nuclear state.,30x,inpb-481
     98hecis1048/6x,74h11-15   observable idntification. (see comments inpb-482
     aon 'observable   ecis1049/14x,52hidentification' in 'cards read ininpb-483
     b subroutine deph').,6x,8hecis1050/6x,62h21-30   weight of this obsinpb-484
     cervable in chi2. (default option 1.),4x,8hecis1051/6x,74h31-40   einpb-485
     dxperimental normalisation of data. (default option 1.)   ecis1052/inpb-486
     e6x,56h41-50   error on experimental normalisation. (if 0., the,10xinpb-487
     f,8hecis1053/14x,24hnormalisation is fixed).,34x,8hecis1054/1h/16xinpb-488
     g,51hif the normalisation is not fixed, the experimental,5x,8hecis1inpb-489
     h055/14x,42hvalues and their errors are divided by the,16x,8hecis10inpb-490
     i56/14x,66h'renormalisation parameter', the square of the differencinpb-491
     je ecis1057)                                                       inpb-492
      write (2,1051)                                                    inpb-493
 1051 format (14x,66hbetween the experimental normalisation and this parinpb-494
     1ameter ecis1058/14x,66hdivided by the error on normalisation is adinpb-495
     2ded to the chi2ecis1059/14x,66hfor this observable. the 'experimeninpb-496
     3tal normalisation' is  ecis1060/14x,50hthe value of the 'renormaliinpb-497
     4sation parameter' which,8x,8hecis1061/14x,54hminimises the chi2. einpb-498
     5xperimental values and errors are,4x,8hecis1062/14x,14hdivided by inpb-499
     6it.,44x,8hecis1063/16x,50hif for two successives angular distributinpb-500
     7ions, both,6x,8hecis1064/14x,47hcross-sections or polarisations, tinpb-501
     8he 'errors on,11x,8hecis1065/14x,66hexperimental normalisations' ainpb-502
     9re non-0 and the same and   ecis1066/14x,66hthe two 'experimental inpb-503
     anormalisation' are identical, the   ecis1067/14x,53hrenormalisatioinpb-504
     bn parameters are the same for these two,5x,8hecis1068/14x,66hangulinpb-505
     car distributions and one value is added to the chi2  ecis1069/14x,inpb-506
     d13hfor each one.,45x,8hecis1070/64h  note:  if nt=0, the angular dinpb-507
     eistribution described here is not,8x,8hecis1071/66h  ****  experiminpb-508
     fentally separated from the following one. it cannot,6x,8hecis1072/inpb-509
     g8x,60hhappen for the last angular distribution and the observablesinpb-510
     h,4x,8hecis1073/8x,55hmust be of the same kind (if not, the programinpb-511
     ime stops).,9x,8hecis1074/12x,68hthe programme stops also if the chinpb-512
     jannel number is too large ecis1075)                               inpb-513
      write (2,1052)                                                    inpb-514
 1052 format (8x,53hor if the observable identification is larger than 8inpb-515
     1.,11x,8hecis1076/72x,8hecis1077/24hdata card for each angle,16x,15inpb-516
     2hformat (6f10.5),17x,8hecis1078/24h************************,48x,8hinpb-517
     3ecis1079/7x,24h1-10   angle in degrees.,41x,8hecis1080/6x,27h11-20inpb-518
     4   experimental value.,39x,8hecis1081/6x,27h21-30   experimental einpb-519
     5rror.,39x,8hecis1082/6x,74h31-40   width of detector. (if non 0.,tinpb-520
     6hree calculations are done ecis1083/14x,52hat the experimental anginpb-521
     7le and at plus and minus this,6x,8hecis1084/14x,52hwidth, the calcinpb-522
     8ulated value will be the mean value).,6x,8hecis1085/6x,74h41-50   inpb-523
     9angular error. (if non 0. and the width of detector non 0.ecis1086inpb-524
     a/14x,66hthe experimental error is increased to take into account  inpb-525
     becis1087/14x,35hthe slope of the calculated curve).,23x,8hecis1088inpb-526
     c/80h  note:  if the observable identification is 8, the set of expinpb-527
     derimental ecis1089/80h  ****  values are total cross-sections of winpb-528
     ehich the channel is read in ecis1090/8x,72hfloating value instead inpb-529
     fof the angle. for channel 0., it is the  ecis1091/8x,57htotal reacinpb-530
     gtion cross-section, not taking into account the,7x,8hecis1092/8x,5inpb-531
     h2hcoulomb scattering. for channel -1., it is the total,12x,8hecis1inpb-532
     i093/8x,72hcross-section as defined for neutrons. weight and experiinpb-533
     jmental  ecis1094/8x,37hnormalisation are taken into account.,27x,8inpb-534
     khecis1095)                                                        inpb-535
      write (2,1053)                                                    inpb-536
 1053 format (72x,8hecis1096/72x,8hecis1097/29hcards read in subroutine inpb-537
     1calx,43x,8hecis1098/29h*****************************,43x,8hecis109inpb-538
     29/80h only if lo(32)=.true. and neither ncolr and nrec is 0, otherinpb-539
     3wise go to ecis1100/33h 'cards read in subroutine obse'.,39x,8heciinpb-540
     4s1101/72x,8hecis1102/17hsearch accuracies,23x,15hformat (7f10.3),1inpb-541
     57x,8hecis1103/17h*****************,55x,8hecis1104/7x,46h1-10   seainpb-542
     6rch accuracy for the first variable.,19x,8hecis1105/6x,48h11-20   inpb-543
     7search accuracy for the second variable.,18x,8hecis1106/6x,47h21-3inpb-544
     80   search accuracy for the third variable.,19x,8hecis1107/6x,28h3inpb-545
     91-40   ....................,38x,8hecis1108/14x,18hup to nrec valueinpb-546
     as.,40x,8hecis1109/6x,62hthe search accuracies cannot be 0..there iinpb-547
     bs no default option.,4x,8hecis1110/61h  they refer to values used inpb-548
     cin the programme as real radii or,11x,8hecis1111/38h  deformationsinpb-549
     d changed for heavy ions.,34x,8hecis1112/72x,8hecis1113/1h/20hindiinpb-550
     eces of variables,20x,13hformat (14i5),19x,8hecis1114/20h**********inpb-551
     f**********,52x,8hecis1115/7x,35h1- 5   index of the first variableinpb-552
     g.,30x,8hecis1116/7x,36h6-10   index of the second variable.,29x,8hinpb-553
     hecis1117/6x,36h11-15   index of the third variable.,30x,8hecis1118inpb-554
     i/6x,28h16-20   ....................,38x,8hecis1119/14x,18hup to nrinpb-555
     jec values.,40x,8hecis1120/72x,8hecis1121/4x,21hindex specificationinpb-556
     ks:,47x,8hecis1122)                                                inpb-557
      write (2,1054)                                                    inpb-558
 1054 format (4x,21h*********************,47x,8hecis1123/7x,73h1-1000   inpb-559
     1optical model and folding parameters val(i).(see, above,ecis1124/1inpb-560
     26x,51hoptical potential parameters). possible values 1 to,5x,8heciinpb-561
     3s1125/16x,64h34*npp. parameters of external form factors in the orinpb-562
     4derecis1126/16x,64hdefined when they are read. only floating valueinpb-563
     5s can be ecis1127/16x,64hin search possible values 1 to 1000. abovinpb-564
     6e, add 9000.   ecis1128/16x,64hchoosing search accuracies, note thinpb-565
     7at reduced radii are ecis1129/16x,24hnot used but only radii.,32x,inpb-566
     88hecis1130/4x,76h1001-2000   deformations for a given potential. pinpb-567
     9ossible values 1001ecis1131/16x,64hto 1008.(not the angles of asyminpb-568
     ametric rotational model) ecis1132/4x,76h2001-3000   deformations finpb-569
     bor a given multipole. possible values 2001ecis1133/16x,64hto 2000+inpb-570
     cnbet where nbet is the total number of phonons  ecis1134/16x,41haninpb-571
     dd deformations as listed in the output.,15x,8hecis1135/4x,76h3001-inpb-572
     e4000   individual deformation. (the unit of the index is the   eciinpb-573
     fs1136/16x,64hpotential, the tenth is the deformation). possible vainpb-574
     glueecis1137/16x,64h3001 to 3000 + 10*nbet with nbet defined above.inpb-575
     h values  ecis1138/16x,52has 3xx9 and 3xx0 are excluded. note that inpb-576
     ideformation,4x,8hecis1139/16x,47hlengths are used in the search ifinpb-577
     j lo(6)=.true..,9x,8hecis1140)                                     inpb-578
      write (2,1055)                                                    inpb-579
 1055 format (4x,62h4001-5000   nuclear model parameters. (in the order inpb-580
     1of input).,6x,8hecis1141/4x,76h5001-6000   reduced nuclear matrix inpb-581
     2elements. (order of input if theyecis1142/16x,64hare read on cardsinpb-582
     3, or order of computation as listed).  ecis1143/4x,76h6001-7000   inpb-583
     4spin-orbit parametrisation, hauser-feshbach corrections.ecis1144/1inpb-584
     56x,64hand compound nucleus parameters. possible values are:   ecisinpb-585
     61145/16x,41h6001-6006 for spin-orbit parametrisation,,15x,8hecis11inpb-586
     746/16x,42h6007-6009 for hauser-feshbach corrections,,14x,8hecis114inpb-587
     87/16x,48h6010-6014 for giant dipole resonance parameters,,8x,8heciinpb-588
     9s1148/16x,64h6015-6014+6*ncons for level density parameters in ordinpb-589
     aer ecis1149/16x,22hgiven by scn(ncons,6).,34x,8hecis1150/3x,77h100inpb-590
     b01-99999  to continue 1-1000 when there are more than 1000 values inpb-591
     cecis1151/16x,49hwith external form factors. use the number of the,inpb-592
     d7x,8hecis1152/16x,26hlisting increased by 9000.,30x,8hecis1153/80hinpb-593
     e  note:  any negative number -k in the card above means that k varinpb-594
     fiablesecis1154/80h  ****  will be kept proportional in the search.inpb-595
     g this value is replaced ecis1155/8x,59hby -*address where k followinpb-596
     hed by k indices of parameters is,5x,8hecis1156/8x,6hstored,58x,8heinpb-597
     icis1157/72x,8hecis1158/23hlinks between variables,17x,13hformat (1inpb-598
     j4i5),19x,8hecis1159/23h***********************,49x,8hecis1160)    inpb-599
      return                                                            inpb-600
      end                                                               inpb-601
c 04/05/98                                                      ecis97  inpc-000
      subroutine inpc                                                   inpc-001
      write (2,1056)                                                    inpc-002
 1056 format (4x,50hfor every negative value -k in the preceding card:,1inpc-003
     18x,8hecis1161/7x,35h1- 5   index of the first variable.,30x,8hecisinpc-004
     21162/7x,36h6-10   index of the second variable.,29x,8hecis1163/6x,inpc-005
     336h11-15   index of the third variable.,30x,8hecis1164/6x,26h16-20inpc-006
     4   ..................,40x,8hecis1165/14x,16hup to k indices.,42x,8inpc-007
     5hecis1166/72x,8hecis1167/72x,8hecis1168/29hcards read in subroutininpc-008
     6e obse,43x,8hecis1169/29h*****************************,43x,8hecis1inpc-009
     7170/80h only if there is any non standard observable (identified binpc-010
     8y a negative ecis1171/58h number), otherwise go to 'cards read in inpc-011
     9subroutine redm'.,14x,8hecis1172/72x,8hecis1173/1h/32hfor each noinpc-012
     an standard observable,40x,8hecis1174/32h**************************inpc-013
     b******,40x,8hecis1175/72x,8hecis1176/19hdefinition and name,21x,25inpc-014
     chformat (2l1,i1,i2,i5,5a4),7x,8hecis1177/19h*******************,53inpc-015
     dx,8hecis1178/10x,51h1   lt1  't' for an observable defined with aninpc-016
     e axis,11x,8hecis1179/19x,61hperpendicular to the reaction plane. tinpc-017
     fhe description ecis1180/19x,49his changed by a rotation r(pi/2,pi/inpc-018
     g2,pi/2) to the,4x,8hecis1181/19x,61hdefinition with respect to theinpc-019
     h direction of particle ecis1182/19x,46h(helicity). use a blank forinpc-020
     i the usual helicity,7x,8hecis1183/19x,12hdescription.,41x,8hecis11inpc-021
     j84/10x,70h2   lt2  't' if the observable is not completely definedinpc-022
     k by   ecis1185)                                                   inpc-023
      write (2,1057)                                                    inpc-024
 1057 format (19x,42htensors. see note below 'quantum numbers'.,11x,8hecinpc-025
     1is1186/10x,70h3   blank or 0 for observable in the center of mass inpc-026
     2system.   ecis1187/14x,1h1,10x,40hfor observable in the laboratoryinpc-027
     3 system.,7x,8hecis1188/14x,1h2,10x,42hfor observable defined with inpc-028
     4respect to the,5x,8hecis1189/30x,14hincident beam.,28x,8hecis1190/inpc-029
     57x,61h4- 5   kx   positive number, identification of the observablinpc-030
     6e,4x,8hecis1191/19x,14hread with -kx.,39x,8hecis1192/7x,8h6-10   kinpc-031
     7,4x,40hnumber of components of the description.,13x,8hecis1193/6x,inpc-032
     874h11-30   name of the observable which will be used in the outputinpc-033
     9.  ecis1194/72x,8hecis1195/15hquantum numbers,25x,12hformat (8i5),inpc-034
     a20x,8hecis1196/15h***************,57x,8hecis1197/7x,45h1- 5   tensinpc-035
     bor order of the incoming particle.,20x,8hecis1198/7x,39h6-10   relinpc-036
     cated magnetic quantum number.,26x,8hecis1199/6x,44h11-15   tensor inpc-037
     dorder of the initial nucleus.,22x,8hecis1200/6x,40h16-20   relatedinpc-038
     e magnetic quantum number.,26x,8hecis1201/6x,46h21-25   tensor ordeinpc-039
     fr of the outgoing particle.,20x,8hecis1202/6x,31h26-30   related qinpc-040
     guantum number.,35x,8hecis1203/6x,42h31-35   tensor order of the fiinpc-041
     hnal nucleus.,24x,8hecis1204/6x,31h36-40   related quantum number.,inpc-042
     i35x,8hecis1205/4x,23hthere are k such cards.,45x,8hecis1206/68h  ninpc-043
     jote:  if lt2=.true., some couples (tensor order, magnetic quantum,inpc-044
     k4x,8hecis1207)                                                    inpc-045
      write (2,1058)                                                    inpc-046
 1058 format (80h  ****  number) can be replaced by non tensor notation inpc-047
     1(mi, mf). in thisecis1208/8x,72hcase, use (mi-s-1) and (mf-s-1) whinpc-048
     2ere s is the spin of particle ecis1209/8x,10hor target.,54x,8hecisinpc-049
     31210/72x,8hecis1211/26hcoefficients of components,14x,15hformat (6inpc-050
     4f10.5),17x,8hecis1212/26h**************************,46x,8hecis1213inpc-051
     5/7x,42h1-10   coefficient of the first component.,23x,8hecis1214/6inpc-052
     6x,44h11-20   coefficient of the second component.,22x,8hecis1215/6inpc-053
     7x,27h21-30   ...................,39x,8hecis1216/14x,15hup to k valinpc-054
     8ues.,43x,8hecis1217/72x,8hecis1218/30himaginary part of coefficieninpc-055
     9ts,10x,15hformat (6f10.5),17x,8hecis1219/30h**********************inpc-056
     a********,42x,8hecis1220/67h only if lt1=.true. or lt2=.true., otheinpc-057
     brwise go to next observable.,5x,8hecis1221/7x,46h1-10   imaginary inpc-058
     cpart for the first component.,19x,8hecis1222/6x,48h11-20   imaginainpc-059
     dry part for the second component.,18x,8hecis1223/6x,28h21-30   ...inpc-060
     e.................,38x,8hecis1224/14x,15hup to k values.,43x,8hecisinpc-061
     f1225/64h  note:  the quantum numbers are checked and errors can stinpc-062
     gop the,8x,8hecis1226/80h  ****  programme (too large magnetic quaninpc-063
     htum numbers, negative tensor  ecis1227/8x,57horder, odd sum of maginpc-064
     inetic quantum numbers for observable,7x,8hecis1228/8x,59hdefined winpc-065
     jith the axis perpendicular to the reaction plane).,5x,8hecis1229) inpc-066
      write (2,1059)                                                    inpc-067
 1059 format (9x,41hthe observables can be read in any order.,22x,8hecisinpc-068
     11230/9x,71hpolarisation of the target is described in the system oinpc-069
     2f the   ecis1231/8x,9hparticle.,55x,8hecis1232/72x,8hecis1233/72x,inpc-070
     38hecis1234/1h/29hcards read in subroutine redm,43x,8hecis1235/30hinpc-071
     4******************************,42x,8hecis1236/6x,74hif lo(7)=.trueinpc-072
     5. or lo(15)=.true.. otherwise go to 'cards read in  ecis1237/3x,17inpc-073
     6hsubroutine eval'.,52x,8hecis1238/72x,8hecis1239/6x,55hin the subrinpc-074
     7outine redm, there is the following do loop:,11x,8hecis1240/10x,16inpc-075
     8hdo 16 i1=1,ncoll,46x,8hecis1241/10x,17hdo 15 i2=i1,ncoll,45x,8hecinpc-076
     9is1242/10x,9h.........,53x,8hecis1243/7x,11h15 continue,54x,8hecisinpc-077
     a1244/7x,11h16 continue,54x,8hecis1245/6x,26hinside which must be rinpc-078
     bead:,40x,8hecis1246/72x,8hecis1247/28hloop control and number cardinpc-079
     c,12x,12hformat (3i5),20x,8hecis1248/28h***************************inpc-080
     d*,44x,8hecis1249/7x,73h1- 5   j1 which must be equal to i1. (if noinpc-081
     et the run is stopped).ecis1250/7x,73h6-10   j2 which must be equalinpc-082
     f to i2. (if not the run is stopped).ecis1251/6x,53h11-15   k  numbinpc-083
     ger of reduced nuclear matrix elements.,13x,8hecis1252/72x,8hecis12inpc-084
     h53/31hreduced nuclear matrix elements,9x,19hformat (4i5,f20.12),13inpc-085
     ix,8hecis1254/31h*******************************,41x,8hecis1255/14hinpc-086
     jif k is not 0:,58x,8hecis1256)                                    inpc-087
      write (2,1060)                                                    inpc-088
 1060 format (7x,34h1- 5   form factor identification.,31x,8hecis1257/7xinpc-089
     1,59h6-10   multipolarity. (if triangular relation  or parity is,6xinpc-090
     2,8hecis1258/18x,47htransgressed the run is stopped). enter l for ainpc-091
     3,7x,8hecis1259/18x,38hmagnetic multipole transition bm(l-1).,16x,8inpc-092
     4hecis1260/6x,74h11-15   2*s where s is the transfer of spin. s caninpc-093
     5 be not 0 even  ecis1261/18x,62hif lo(7)=.false. (if lo(7)=.true. inpc-094
     6the run is stopped  ecis1262/18x,43hwhen triangular relation is noinpc-095
     7t fulfilled).,11x,8hecis1263/14x,54hindication for existence of mainpc-096
     8gnetic multipole coulomb,4x,8hecis1264/18x,49hform factor for the inpc-097
     9target, with s=0: enter '-1'.,5x,8hecis1265/18x,43hthis form factoinpc-098
     ar includes no central and no,11x,8hecis1266/18x,24hspin-orbit continpc-099
     bribution.,30x,8hecis1267/6x,62h16-20   2*j where j is the transferinpc-100
     c of total spin if the value,4x,8hecis1268/18x,50hgiven for 2*s is inpc-101
     dnot '0' or '-1'. in this case the,4x,8hecis1269/18x,62hcalculationinpc-102
     e is stopped if there is not a triangular   ecis1270/18x,28hrelatioinpc-103
     fn between l, s and j.,26x,8hecis1271/14x,66hindication for existeninpc-104
     gce of an associated spin-orbit form ecis1272/18x,50hfactor when 2*inpc-105
     hs is '0': enter '1' if there is one,,4x,8hecis1273/18x,32h'0' or ainpc-106
     i blank if there is none.,22x,8hecis1274/6x,61h21-40   value. the rinpc-107
     jatio between a magnetic multipole coulomb,5x,8hecis1275)          inpc-108
      write (2,1061)                                                    inpc-109
 1061 format (18x,47hexcitation bm(l-1) and an electric one be(l) is,7x,inpc-110
     18hecis1276/18x,50hsqrt(bm(l-1)/be(l)) (sqrt(.01106*bm(l-1)/be(l)) inpc-111
     2if,4x,8hecis1277/18x,50hbm(l-1) is expressed in nuclear magnetons inpc-112
     3squares.,4x,8hecis1278/8x,23hthere are k such cards.,41x,8hecis127inpc-113
     49/72x,8hecis1280/4x,26hform factor identification,42x,8hecis1281/4inpc-114
     5x,26h**************************,42x,8hecis1282/6x,58hfor anharmoniinpc-115
     6c vibrational model: the order of derivative.,8x,8hecis1283/13x,14inpc-116
     7h(from 0 to 3).,45x,8hecis1284/6x,31hfor harmonic vibrational modeinpc-117
     8l:,35x,8hecis1285/13x,67hfirst order:  k1, number of the phonon isinpc-118
     9 order of input.  ecis1286/13x,53hsecond order: k1+k2*(nbt1+1)  whinpc-119
     aere k1 and k2 are the,6x,8hecis1287/17x,63hnumber of the phonons iinpc-120
     bn the order of input, with k2   ecis1288/17x,63hlarger than k1 andinpc-121
     c nbt1 the total number of phonons.   ecis1289/72x,8hecis1290/6x,74inpc-122
     dhfor symmetric rotational model: 1+l where l is the multipolarity inpc-123
     e ecis1291/13x,49hmultiplied by 1000 plus the identification of theinpc-124
     f,10x,8hecis1292/13x,50hvibrational band as in harmonic vibrationalinpc-125
     g model.,9x,8hecis1293/13x,67ha l=0 or l=1 vibration term generate inpc-126
     ha monopole or dipole  ecis1294/13x,16hcorrection term.,43x,8hecis1inpc-127
     i295/1h/6x,74hfor asymmetric rotational model: defined as 1000* thinpc-128
     je 'order of   ecis1296)                                           inpc-129
      write (2,1062)                                                    inpc-130
 1062 format (13x,67hdeformation'. (see 'deformations of rotational modeinpc-131
     1ls').   ecis1297/72x,8hecis1298/6x,74hfor external form factor modinpc-132
     2el: if the form factor identification ecis1299/13x,67his blank or inpc-133
     3zero, an identification is defined in sequence ecis1300/13x,67ha ninpc-134
     4egative value indicates that there is a correction term ecis1301/1inpc-135
     53x,67hto be added in such a way that the integral of the sum witheinpc-136
     6cis1302/13x,67hr**(l+2) vanishes (l being the angular momentum relinpc-137
     7ated to ecis1303/13x,67hthis form factor). if the form factor ideninpc-138
     8tification is nonecis1304/13x,67hzero, its absolute value must be inpc-139
     9in sequence or refer to a ecis1305/13x,47hform factor already defiinpc-140
     aned with the same sign.,12x,8hecis1306/72x,8hecis1307/80h  note oninpc-141
     b reduced matrix elements:  the spin angular description for a  eciinpc-142
     cs1308/80h  ********************************  partial wave with totinpc-143
     dal spin jj and ecis1309/80h  with quantum numbers l1 and j1 for thinpc-144
     ee particle, i1 for the target is ecis1310/67h  ((i**l1*y(l1) , s1)inpc-145
     fj1 ,i1)jj. the interaction for the transfer of,5x,8hecis1311/66h  inpc-146
     gangular momentum l, of spin s and of total spin j, is the scalar,6inpc-147
     hx,8hecis1312/80h  product of a tensor operator q(j)nuclear for theinpc-148
     i target by the tensor ecis1313/53h  product of (i**l*y(l) , q(s)painpc-149
     jr)j for the particle.,19x,8hecis1314)                             inpc-150
      write (2,1063)                                                    inpc-151
 1063 format (4x,55h(((l2,s2)j2,i2)jj|(q(l),q(s))j.q(j)|((l1,s1)j1,i1)jjinpc-152
     1) =,13x,8hecis1315/63h  (-)**(jj+i2+j1+(l1+l2+l)/2)) * c9j(l2,l1,linpc-153
     2,s2,s1,s,j2,j1,j) *,9x,8hecis1316/66h  c6j(j2,j,j1,i1,jj,i2) * c3jinpc-154
     3(l1,l,l2,0,0,0) * sqrt((2j+1)*(2l+1)*,6x,8hecis1317/80h  (2s+1)(2linpc-155
     41+1)*(2l2+1)*(2j1+1)*(2j2+1)) /computed in subroutine quan/  ecis1inpc-156
     5318/80h  * (s2||q(s)||s1)/(2s+1) * (i2||q(j)||i1) * (4*pi)**(-1/2)inpc-157
     6 /which is   ecis1319/80h  the reduced nuclear matrix element readinpc-158
     7 here, except for the square   ecis1320/42h  root which is includeinpc-159
     8d in form factors/.,30x,8hecis1321/72x,8hecis1322/4x,76hthis matriinpc-160
     9x element is real and symmetric when the 'reduced nuclear ecis1323inpc-161
     a/62h  matrix element' is such that  (s2,i2 || q(s) q(j) ||s1,i1) =inpc-162
     b,10x,8hecis1324/80h  (-)**(i2+s2-i1-s1+s+j) * (s1,i1 || q(s) q(j) inpc-163
     c||s2,i2). in macroscopic ecis1325/80h  models, s=0 and the phase binpc-164
     decomes (-)**(i2-i1)*(product of parities). ecis1326/4x,64ha factorinpc-165
     e i**(-l) must be taken into account in the definition of,4x,8hecisinpc-166
     f1327/66h  q(j)nuclear and a phase i introduced for negative parityinpc-167
     g states.,6x,8hecis1328/4x,76hwhen s=0, (s2|| ||s1) = sqrt(2*s1+1) inpc-168
     his computed in subroutine quan ecis1329/4x,76hthe factor (2s+1) ininpc-169
     itroduced in quan to use the same reduced matrix ecis1330/49h  eleminpc-170
     jent when target and particle are exchanged.,23x,8hecis1331)       inpc-171
      write (2,1064)                                                    inpc-172
 1064 format (4x,76hfor a magnetic multipole coulomb transition bm(l-1),inpc-173
     1 the form factorecis1332/65h  is the one of an electric multipole inpc-174
     2transition be(l) divided by,7x,8hecis1333/80h  mr(m*c/hbar)**2, whinpc-175
     3ere m and mr and mp are atomic and reduced masses  ecis1334/15h  rinpc-176
     4espectively.,57x,8hecis1335/72x,8hecis1336/72x,8hecis1337/29hcardsinpc-177
     5 read in subroutine extp,43x,8hecis1338/29h***********************inpc-178
     6******,43x,8hecis1339/68h  if (lo(7)=.true., otherwise go to 'cardinpc-179
     7s read in subroutine eval'.,4x,8hecis1340/72x,8hecis1341/14hidentiinpc-180
     8fication,26x,13hformat (12i5),19x,8hecis1342/14h**************,58xinpc-181
     9,8hecis1343/7x,9h1- 5   l1,4x,8hlevel i.,44x,8hecis1344/7x,9h6-10 inpc-182
     a  l2,4x,9hlevel ip.,43x,8hecis1345/6x,10h11-15   ml,4x,60hsequenceinpc-183
     b number of the form factor in the table of  ecis1346/20x,60hreduceinpc-184
     cd nuclear matrix elements between level i and ecis1347/20x,46hleveinpc-185
     dl ip. it must be 0 for potentials. use the,6x,8hecis1348/20x,60hvainpc-186
     elue -ml to enter the correction term to the form  ecis1349/20x,20hinpc-187
     ffactor read with ml.,32x,8hecis1350/6x,49h16-20   ityp =  1 real vinpc-188
     golume or scalar potential,17x,8hecis1351/22x,38h2 imaginary volumeinpc-189
     h or scalar potential,12x,8hecis1352/22x,34h3 real surface or vectoinpc-190
     ir potential,16x,8hecis1353/22x,39h4 imaginary surface or vector poinpc-191
     jtential,11x,8hecis1354/22x,37h5 real spin-orbit or tensor potentiainpc-192
     kl,13x,8hecis1355)                                                 inpc-193
      write (2,1065)                                                    inpc-194
 1065 format (1h/22x,42h6 imaginary spin-orbit or tensor potential,8x,8inpc-195
     1hecis1356/22x,19h7 coulomb potential,31x,8hecis1357/22x,30h8 couloinpc-196
     2mb spin-orbit potential,20x,8hecis1358/6x,74h21-25   l1x   non posinpc-197
     3itive or l1 of the form factor to be copied  ecis1359/20x,17hinto inpc-198
     4the new one.,35x,8hecis1360/6x,62h26-30   l2x   l2 of the form facinpc-199
     5tor to be copied if l1x is not,4x,8hecis1361/20x,9hpositive.,43x,8inpc-200
     6hecis1362/6x,49h31-35   mlx   same for ml if l1x is not positive.,inpc-201
     717x,8hecis1363/6x,74h36-40   itypx same for ityp if l1x is not posinpc-202
     8itive, must be equal ecis1364/20x,8hto ityp.,44x,8hecis1365/20x,60inpc-203
     9hnegative number for standard form factors with non  ecis1366/20x,inpc-204
     a39hpositive value of l1x in columns 21-30:,13x,8hecis1367/24x,26h-inpc-205
     b1  woods-saxon potential.,22x,8hecis1368/24x,56h-2  first derivatiinpc-206
     cve of woods-saxon potential.  ecis1369/24x,56h-3  second derivativinpc-207
     de of woods-saxon potential. ecis1370/24x,56h-4  third derivative oinpc-208
     ef woods-saxon potential.  ecis1371/12x,68h(the n th derivative is inpc-209
     falways divided by fact(n)*sqrt(4*pi)ecis1372/17x,45hand multipliedinpc-210
     g by r**n only if lo(6)=.false.),10x,8hecis1373/24x,35h-5  deformedinpc-211
     h woods-saxon potential.,13x,8hecis1374/24x,56h-6  derivative of deinpc-212
     iformed woods-saxon potentialecis1375/24x,24h-7  laguerre polynomiainpc-213
     jl.,24x,8hecis1376/24x,43h-8  solution in real woods-saxon potentiainpc-214
     kl.,5x,8hecis1377)                                                 inpc-215
      write (2,1066)                                                    inpc-216
 1066 format (24x,21h-9  bessel expansion.,27x,8hecis1378/24x,40h-10 expinpc-217
     1ansion with laguerre polynomials.,8x,8hecis1379/20x,60h(see below inpc-218
     2'special meaning of l1x, l2x and mlx ..')ecis1380/6x,61h41-45   nsinpc-219
     3t   channel of which the step size is used (default,5x,8hecis1381/inpc-220
     420x,46hvalue: the channel which uses it for a central,6x,8hecis138inpc-221
     52/20x,60hpotential, 1 for a transition potential). if nst is ecis1inpc-222
     6383/20x,60hnegative for a standard form factor with itypx=-1 toeciinpc-223
     7s1384/20x,46hitypx=-6, use of a reduced radius, taking into,6x,8heinpc-224
     8cis1385/20x,47haccount lo(16) (heavy-ion definition) and lo(6),5x,inpc-225
     98hecis1386/20x,29h(use of deformation lengths).,23x,8hecis1387/6x,inpc-226
     a74h46-50   nfold 0 for no folding or address of folding parametersinpc-227
     b   ecis1388/20x,60hin their list read below. nfold can be differeninpc-228
     ct forecis1389/20x,60ha copied form factor and allows the folding winpc-229
     dith a  ecis1390/20x,46hdifferent multipolarity. it can be used witinpc-230
     eh a,6x,8hecis1391/20x,28hform factor given by points.,24x,8hecis13inpc-231
     f92/6x,74h51-55   nint  if not 0, the strength is the integral of tinpc-232
     ghis form ecis1393/20x,60hfactor with r**(l+2) where l is the relevinpc-233
     hant angularecis1394/20x,46hmomentum. when nint, is a positive numbinpc-234
     ier, the,6x,8hecis1395/20x,46hintegral with r**(l+1) has to be giveinpc-235
     jn; with a,6x,8hecis1396)                                          inpc-236
      write (2,1067)                                                    inpc-237
 1067 format (20x,60hnegative integer, the usual strength has to be giveinpc-238
     1necis1397/20x,45hand is replaced by this integral at its first,7x,inpc-239
     28hecis1398/20x,60hcalculation. for spin-orbit potentials, it is thinpc-240
     3e   ecis1399/20x,60hintegral of the form factor without derivationinpc-241
     4. thisecis1400/20x,48hstrength is of the same sign as the depth ofinpc-242
     5 the,4x,8hecis1401/20x,60hstandard description. for coulomb potentinpc-243
     6ials, this  ecis1402/20x,40hstrength is the last value multiplied inpc-244
     7by,12x,8hecis1403/20x,60h(2*l+1)*r**(l+1)/1.43998 . if nst is negainpc-245
     8tive for a ecis1404/20x,60hform factor copied, input of a multipliinpc-246
     9cation factorecis1405/20x,13hin next card.,39x,8hecis1406/72x,8hecinpc-247
     ais1407/80hmeaning of l1x, l2x and mlx for negative values of itypxinpc-248
     b (columns 36-40)ecis1408/80h**************************************inpc-249
     c**********************************ecis1409/6x,74h21-25   l1x   -l1inpc-250
     dx is the magnetic quantum number of the vibrationecis1410/20x,14hwinpc-251
     ehen itypx=-6.,38x,8hecis1411/20x,47h-l1x is the number of nodes whinpc-252
     fen itypx=-7 or -8,5x,8hecis1412/20x,32h(used only when mlx=0 or mlinpc-253
     gx=1).,20x,8hecis1413/20x,60h-l1x is the order of derivation of besinpc-254
     hsel functions ecis1414/20x,45hor laguerre polynomials when itypx=-inpc-255
     i9 or -10.,7x,8hecis1415/1h/6x,57h26-30   l2x   number of deformatinpc-256
     jions when itypx=-5 or -6.,9x,8hecis1416)                          inpc-257
      write (2,1068)                                                    inpc-258
 1068 format (20x,60ha division factor for the steps in computing bound inpc-259
     1 ecis1417/20x,41hfunction (default value 4) when itypx=-8.,11x,8heinpc-260
     2cis1418/20x,60hnumber of bessel functions or laguerre polynomials inpc-261
     3 ecis1419/20x,21hwhen itypx=-9 or -10.,31x,8hecis1420/6x,62h31-35 inpc-262
     4  mlx   angular momentum of the vibration when itypx=-6.,4x,8hecisinpc-263
     51421/20x,46hnumber of bound functions when itypx=-7 or -8:,6x,8hecinpc-264
     6is1422/20x,60h=0 or 1 for one function with the quantum numbers ofinpc-265
     7ecis1423/31x,15hthe transition,,26x,8hecis1424/20x,41h=2 for two finpc-266
     8unctions with the same itypx,,11x,8hecis1425/20x,60h=3 when itypx=inpc-267
     9-8 for a laguerre polynomial for the  ecis1426/31x,16hsecond functinpc-268
     aion.,25x,8hecis1427/20x,60hl-value of bessel functions or laguerreinpc-269
     b polynomials ecis1428/20x,45hwhen itypx=-9 or -10 (default option:inpc-270
     c angular,7x,8hecis1429/20x,60hmomentum of the form factor, enter ainpc-271
     d negative value ecis1430/20x,10hto use 0).,42x,8hecis1431/41h  errinpc-272
     eors in this card stop the programme.,31x,8hecis1432/72x,8hecis1433inpc-273
     f/80h  note:  if there is no spin for the particle in all the channinpc-274
     gels, the  ecis1434/68h  ****  spin-orbit potentials (ityp = 5 , 6 inpc-275
     hand 8) are not read, but,4x,8hecis1435/8x,59hthey are required as inpc-276
     isoon as there is at least a non spin-0,5x,8hecis1436/8x,59hparticlinpc-277
     je at least for one level. for the transitions with a,5x,8hecis1437inpc-278
     k)                                                                 inpc-279
      write (2,1069)                                                    inpc-280
 1069 format (8x,60htransfer of spin s which is not zero there are no spinpc-281
     1in-orbit,4x,8hecis1438/8x,58hpotentials (no tensor term in dirac finpc-282
     2ormalism). there is a,6x,8hecis1439/8x,58hcoulomb potential for ininpc-283
     3tegral spin transfer even for l=0.,6x,8hecis1440/9x,71hvolume and inpc-284
     4surface potentials are read separately except for   ecis1441/8x,72inpc-285
     5hitypx=-7 and -8. in the dirac formalism itypx=-7 and itypx=-8   einpc-286
     6cis1442/8x,58hcannot be used. for magnetic coulomb interaction, oninpc-287
     7ly the,6x,8hecis1443/8x,72hcoulomb potential is read. the form facinpc-288
     8tors with itypx=-5 to -9 ecis1444/8x,72hcan be copied only if theyinpc-289
     9 involve the same multipolarity. thereecis1445/8x,72his no limitatinpc-290
     aion for itypx=-7 and -8 if they involve two bound  ecis1446/8x,72hinpc-291
     bfunctions. the copied form factors can be folded differently.   ecinpc-292
     cis1447/72x,8hecis1448/48h allowed values of itypx for standard potinpc-293
     dentials,24x,8hecis1449/48h ***************************************inpc-294
     e********,24x,8hecis1450/18h *** ml = 0 ******,54x,8hecis1451/8h itinpc-295
     fypx =,4x,2h-1,4x,2h-2,4x,2h-3,4x,2h-4,4x,2h-5,4x,2h-6,4x,2h-7,4x,1inpc-296
     g0h-8  -9,-10,8x,8hecis1452/20h ityp = 1   yes   no,4x,2hno,4x,2hnoinpc-297
     h,4x,8hyes   no,4x,2hno,4x,8hno   yes,10x,8hecis1453/20h ityp = 2  inpc-298
     i yes   no,4x,2hno,4x,2hno,4x,8hyes   no,4x,2hno,4x,8hno   yes,10x,inpc-299
     j8hecis1454)                                                       inpc-300
      write (2,1070)                                                    inpc-301
 1070 format (20h ityp = 3   yes   no,4x,2hno,4x,2hno,4x,8hyes   no,4x,2inpc-302
     1hno,4x,8hno   yes,10x,8hecis1455/20h ityp = 4   yes   no,4x,2hno,4inpc-303
     2x,2hno,4x,8hyes   no,4x,2hno,4x,8hno   yes,10x,8hecis1456/20h itypinpc-304
     3 = 5   yes   no,4x,2hno,4x,2hno,4x,8hyes   no,4x,2hno,4x,8hno   yeinpc-305
     4s,10x,8hecis1457/20h ityp = 6   yes   no,4x,2hno,4x,2hno,4x,8hyes inpc-306
     5  no,4x,2hno,4x,8hno   yes,10x,8hecis1458/20h ityp = 7   yes   no,inpc-307
     64x,2hno,4x,2hno,4x,8hyes   no,4x,2hno,4x,8hno   yes,10x,8hecis1459inpc-308
     7/20h ityp = 8   yes   no,4x,2hno,4x,2hno,4x,8hyes   no,4x,2hno,4x,inpc-309
     88hno   yes,10x,8hecis1460/22h **** ml is not 0 ****,50x,8hecis1461inpc-310
     9/8h itypx =,4x,2h-1,4x,2h-2,4x,2h-3,4x,2h-4,4x,2h-5,4x,2h-6,4x,2h-inpc-311
     a7,4x,10h-8  -9,-10,8x,8hecis1462/62h ityp = 1   yes   yes   yes   inpc-312
     byes   yes   yes   yes   yes  yes,10x,8hecis1463/62h ityp = 2   yesinpc-313
     c   yes   yes   yes   yes   yes   yes   yes  yes,10x,8hecis1464/50hinpc-314
     d ityp = 3   yes   yes   yes   yes   yes   yes   no,4x,8hno   yes,1inpc-315
     e0x,8hecis1465/50h ityp = 4   yes   yes   yes   yes   yes   yes   ninpc-316
     fo,4x,8hno   yes,10x,8hecis1466/50h ityp = 5   yes   yes   yes   yeinpc-317
     gs   yes   yes   no,4x,8hno   yes,10x,8hecis1467/50h ityp = 6   yesinpc-318
     h   yes   yes   yes   yes   yes   no,4x,8hno   yes,10x,8hecis1468/1inpc-319
     i4h ityp = 7   no,4x,32hyes   yes   yes   yes   yes   no,4x,8hno   inpc-320
     jyes,10x,8hecis1469)                                               inpc-321
      write (2,1071)                                                    inpc-322
 1071 format (14h ityp = 8   no,4x,32hyes   yes   yes   yes   yes   no,4inpc-323
     1x,8hno   yes,10x,8hecis1470/72x,8hecis1471/1h/31h number of paraminpc-324
     2eters to store:,41x,8hecis1472/12x,2h10,4x,2h10,4x,2h10,4x,20h10  inpc-325
     311+l2x 13+l2x 11,4x,11h22   13+l2x,7x,8hecis1473/61h there is one inpc-326
     4more for coulomb potentials and itypx=-1 to -6.,11x,8hecis1474/52hinpc-327
     5 there are 5 more parameters for itypx=-7 and mlx=2.,20x,8hecis147inpc-328
     65/67h there are 16 or 6 more parameters for itypx=-8 and mlx=2 or inpc-329
     7mlx=3.,5x,8hecis1476/72x,8hecis1477/27hstrength and scaling factorinpc-330
     8,13x,15hformat (7f10.5),17x,8hecis1478/27h************************inpc-331
     9***,45x,8hecis1479/67h  if itypx is negative go to 'parameters of inpc-332
     astandard form factors'.,5x,8hecis1480/59h  then if l1x is positiveinpc-333
     b go back to 'identification' card.,13x,8hecis1481/7x,73h1-10   mulinpc-334
     ctiplicative factor for the strength (default value 1.).ecis1482/6xinpc-335
     d,74h11-20   multiplicative factor for the step size (default valueinpc-336
     e 1.)ecis1483/72x,8hecis1484/34hnumerical values of the potentials,inpc-337
     f6x,27hformat (2(f10.5,f20.10),a4),5x,8hecis1485/34h***************inpc-338
     g*******************,38x,8hecis1486/7x,20h1-10   rext  radius.,45x,inpc-339
     h8hecis1487/6x,28h11-30   fext  value at rext.,38x,8hecis1488/6x,21inpc-340
     ih31-40   rext  radius.,45x,8hecis1489/6x,28h41-60   fext  value atinpc-341
     j rext.,38x,8hecis1490)                                            inpc-342
      write (2,1072)                                                    inpc-343
 1072 format (6x,74h61-64   last  control word which must be 'last' for inpc-344
     1the last pointecis1491/7x,56hif this control word is not 'last' goinpc-345
     2 to next such card.,9x,8hecis1492/80h  note:  the given radii mustinpc-346
     3 be in increasing order and their number   ecis1493/80h  ***** eveinpc-347
     4n many points are needed for coulomb potential for which the ecis1inpc-348
     5494/8x,72hextrapolation does not work well. if its depth is given inpc-349
     6by the  ecis1495/8x,56hintegral, (nint not 0), these values descriinpc-350
     7be the charge,8x,8hecis1496/8x,13hdistribution.,51x,8hecis1497/9x,inpc-351
     857hthe sign of the potentials is the one of their depth when,6x,8hinpc-352
     9ecis1498/8x,72hwoods-saxon form factors are used for schroedinger inpc-353
     aequations andecis1499/8x,23hfor for dirac equation.,41x,8hecis1500inpc-354
     b/9x,59hthe spin-orbit 'central' have to be given as 1/r d/dr(v(r))inpc-355
     c,4x,8hecis1501/8x,72hexcept if its strength is defined by its inteinpc-356
     dgral or is folded. ecis1502/9x,71hthe spin-orbit transition potentinpc-357
     eials have to be given as v(r), ecis1503/8x,72hfrom which 1/r d/dr(inpc-358
     fv(r)) and v(r)/r**2 are internally computed.ecis1504/72x,8hecis150inpc-359
     g5/21hmultiplicative factor,19x,15hformat (7f10.5),17x,8hecis1506/2inpc-360
     h1h*********************,51x,8hecis1507/61h  if nint is not negativinpc-361
     ie for a copied form factor go back to,11x,8hecis1508/22h'identificinpc-362
     jation' card.,50x,8hecis1509)                                      inpc-363
      write (2,1073)                                                    inpc-364
 1073 format (7x,73h1-10   multiplicative factor for the strength (must inpc-365
     1not be 0.).  ecis1510/72x,8hecis1511/35hparameters of standard forinpc-366
     2m factors,37x,8hecis1512/35h***********************************,37inpc-367
     3x,8hecis1513/67h only if l1x is not positive and itypx is negativeinpc-368
     4, otherwise go to,5x,8hecis1514/28h next 'identification card'.,44inpc-369
     5x,8hecis1515/72x,8hecis1516/18hif itypx=-1 to -6:,54x,8hecis1517/1inpc-370
     68h******************,54x,8hecis1518/72x,8hecis1519/27hparameters oinpc-371
     7f the potential,13x,15hformat (7f10.5),17x,8hecis1520/27h*********inpc-372
     8******************,45x,8hecis1521/7x,26h1-10   depth of potential.inpc-373
     9,39x,8hecis1522/14x,54hproduct of depth and deformation for a traninpc-374
     asition form,4x,8hecis1523/18x,7hfactor.,47x,8hecis1524/14x,41hprodinpc-375
     buct of charges for coulomb potential.,17x,8hecis1525/14x,66hproducinpc-376
     ct of charges and deformation for coulomb transition ecis1526/18x,1inpc-377
     d2hform factor.,42x,8hecis1527/1h/6x,35h11-20   radius of volume pinpc-378
     eotential.,31x,8hecis1528/6x,40h21-30   diffuseness of volume poteninpc-379
     ftial.,26x,8hecis1529/6x,62h31-40   exponentiation factor (the forminpc-380
     g factor is at the power,4x,8hecis1530/18x,14h1+this value).,40x,8hinpc-381
     hecis1531/6x,60h41-50   third parameter of a fermi charge distributinpc-382
     iion for a,6x,8hecis1532/14x,18hcoulomb potential.,40x,8hecis1533/7inpc-383
     j2x,8hecis1534)                                                    inpc-384
      write (2,1074)                                                    inpc-385
 1074 format (31hdeformations for itypx=-5 or -6,9x,15hformat (7f10.5),1inpc-386
     17x,8hecis1535/31h*******************************,41x,8hecis1536/7xinpc-387
     2,27h1-10   deformation for l=1.,38x,8hecis1537/6x,28h11-20   deforinpc-388
     3mation for l=2.,38x,8hecis1538/6x,28h21-30   deformation for l=3.,inpc-389
     438x,8hecis1539/6x,28h31-40   deformation for l=4.,38x,8hecis1540/6inpc-390
     5x,43h41-50   .......... and so on up to l2x ....,23x,8hecis1541/61inpc-391
     6h  note:  odd and even deformations are used, starting by l=1.,11xinpc-392
     7,8hecis1542/64h  ****  the radii must be values already multipliedinpc-393
     8 by a**(1/3).,8x,8hecis1543/8x,72hno check is done on product of cinpc-394
     9harges when they are read or to ecis1544/8x,25hprevent a search oninpc-395
     a them.,39x,8hecis1545/72x,8hecis1546/18hif itypx=-7 or -8:,54x,8heinpc-396
     bcis1547/18h******************,54x,8hecis1548/72x,8hecis1549/15hquainpc-397
     cntum numbers,25x,13hformat (12i5),19x,8hecis1550/15h**************inpc-398
     d*,57x,8hecis1551/80hif mlx=0 or mlx=1, the number of nodes is l2x inpc-399
     eand the quantum numbers   ecis1552/59hare those of the transition.inpc-400
     f in this case, go to next card.,13x,8hecis1553/18hif mlx=2 or mlx=inpc-401
     g3:,54x,8hecis1554/7x,55h1- 5   np: number of nodes of the first boinpc-402
     hund function.,10x,8hecis1555/7x,56h6-10   lp: angular momentum of inpc-403
     ithe first bound function.,9x,8hecis1556/6x,54h11-15   sp: value ofinpc-404
     j 2*s for the first bound function.,12x,8hecis1557)                inpc-405
      write (2,1075)                                                    inpc-406
 1075 format (6x,54h16-20   jp: value of 2*j for the first bound functioinpc-407
     1n.,12x,8hecis1558/6x,57h21-25   nh: number of nodes of the second inpc-408
     2bound function.,9x,8hecis1559/6x,58h26-30   lh: angular momentum oinpc-409
     3f the second bound function.,8x,8hecis1560/6x,55h31-35   sh: valueinpc-410
     4 of 2*s for the second bound function.,11x,8hecis1561/6x,55h36-40 inpc-411
     5  jh: value of 2*j for the second bound function.,11x,8hecis1562/6inpc-412
     6x,61h41-45   nvc not 0 to take into account particle-hole couplinginpc-413
     7,5x,8hecis1563/18x,31h(used only with sp=1 and sh=1).,23x,8hecis15inpc-414
     864/72x,8hecis1565/13hfor itypx=-7:,27x,15hformat (7f10.5),17x,8hecinpc-415
     9is1566/13h*************,59x,8hecis1567/7x,57h1-10   oscillator parinpc-416
     aameter for the first bound function.,8x,8hecis1568/6x,59h11-20   oinpc-417
     bscillator parameter for the second bound function.,7x,8hecis1569/8inpc-418
     c0hfor mlx=0 or 1 or itypx=-8 with mlx=3, only the first parameter inpc-419
     dis read.ecis1570/66hfor mlx=2, if the second parameter is 0., the inpc-420
     efirst one is copied.,6x,8hecis1571/72x,8hecis1572/13hfor itypx=-8:inpc-421
     f,27x,15hformat (7f10.5),17x,8hecis1573/13h*************,59x,8hecisinpc-422
     g1574/7x,73h1-10   binding energy. if this value is negative, the binpc-423
     hound stateecis1575/14x,47his replaced by a scattering state normalinpc-424
     iised to,11x,8hecis1576/14x,26hsin(kr+delta) at infinity.,32x,8heciinpc-425
     js1577/6x,19h11-20   total mass.,47x,8hecis1578)                   inpc-426
      write (2,1076)                                                    inpc-427
 1076 format (6x,50h21-30   mass of bound particle (default value 1.).,1inpc-428
     16x,8hecis1579/6x,27h31-40   product of charges.,39x,8hecis1580/6x,inpc-429
     274h41-50   real potential for unbound states or starting value forinpc-430
     3   ecis1581/14x,50hthe search on bound state (default values 35 meinpc-431
     4v).,8x,8hecis1582/6x,41h51-60   reduced radius of real potential.,inpc-432
     525x,8hecis1583/6x,38h61-70   diffuseness of real potential.,28x,8hinpc-433
     6ecis1584/72x,8hecis1585/1h/13hon next card:,27x,15hformat (7f10.5inpc-434
     7),17x,8hecis1586/13h*************,59x,8hecis1587/7x,37h1-10   deptinpc-435
     8h of spin-orbit potential.,28x,8hecis1588/6x,47h11-20   reduced rainpc-436
     9dius of spin-orbit potential.,19x,8hecis1589/6x,44h21-30   diffuseinpc-437
     aness of spin-orbit potential.,22x,8hecis1590/6x,44h31-40   reducedinpc-438
     b radius of coulomb potential.,22x,8hecis1591/38hfor mlx=2, go backinpc-439
     c to 'for itypx=-8:'.,34x,8hecis1592/80hfor mlx=3, go back to 'for inpc-440
     ditypx=-7:' to read one oscillator parameter. ecis1593/45h  note:  inpc-441
     ereduced radii are used for itypx=-8.,27x,8hecis1594/80h  ****  usiinpc-442
     fng the product of two bound functions, their coupling to the ecis1inpc-443
     g595/8x,72hangular momentum of the transition is computed by the coinpc-444
     hde only ecis1596/8x,58hif their spins are both 1/2 and the nuclearinpc-445
     i matrix element,6x,8hecis1597/8x,72hshould be the strength of the inpc-446
     jinteraction. for spins not 1/2,   ecis1598)                       inpc-447
      write (2,1077)                                                    inpc-448
 1077 format (8x,72hthis coupling should be included in the nuclear matrinpc-449
     1ix element. ecis1599/72x,8hecis1600/19hif itypx=-9 or -10:,53x,8heinpc-450
     2cis1601/19h*******************,53x,8hecis1602/72x,8hecis1603/9hstrinpc-451
     3engths,31x,15hformat (7f10.5),17x,8hecis1604/9h*********,63x,8heciinpc-452
     4s1605/8x,58h1-10  strength of the integral with r**(l+2). (for couinpc-453
     5lomb,6x,8hecis1606/18x,49hpotentials and couplings, give the descrinpc-454
     6iption of,5x,8hecis1607/18x,50hcharge density or transition. the sinpc-455
     7trength must be,4x,8hecis1608/18x,62hgiven. for potentials, it is inpc-456
     8the product of charges)  ecis1609/7x,58h11-20   radial extension oinpc-457
     9f bessel function (default value,7x,8hecis1610/15x,65hmatching radinpc-458
     aius) or parameter b of laguerre polynomial   ecis1611/15x,18h(defainpc-459
     bult value 1).,39x,8hecis1612/7x,73h21-30   strength of first besseinpc-460
     cl function/laguerre polynomial.   ecis1613/7x,73h31-40   strength inpc-461
     dof second bessel function/laguerre polynomial.  ecis1614/7x,73h41-inpc-462
     e50   strength of third bessel function/laguerre polynomial.   ecisinpc-463
     f1615/7x,73h51-60   strength of fourth bessel function/laguerre polinpc-464
     gynomial.  ecis1616/7x,73h61-70   strength of fifth bessel functioninpc-465
     h/laguerre polynomial.   ecis1617/72x,8hecis1618/26h eventually, oninpc-466
     i next card:,14x,15hformat (7f10.5),17x,8hecis1619/26h ************inpc-467
     j*************,46x,8hecis1620)                                     inpc-468
      write (2,1078)                                                    inpc-469
 1078 format (8x,72h1-10   strength of sixth bessel function/laguerre poinpc-470
     1lynomial.   ecis1621/7x,73h11-20   strength of seventh bessel funcinpc-471
     2tion/laguerre polynomial. ecis1622/7x,43h21-30   .......... and soinpc-472
     3 on up to l2x ....,22x,8hecis1623/64h  note:  with bessel functioninpc-473
     4 or laguerre polynomial or laguerre,8x,8hecis1624/80h  ****  polyninpc-474
     5omials, give the spin-orbit v(r) and never 1/r d/dr v(r).  ecis162inpc-475
     65/80h  the laguerre polynomials are x**l exp(-x**2) l^(l+1/2)_n(2xinpc-476
     7**2) where ecis1626/80h  x=r/b (unnormalised polynomials as defineinpc-477
     8d in bateman or abramowitz,  ecis1627/67h  with a parameter b inveinpc-478
     9rse of the harmonic oscillator parameter).,5x,8hecis1628/5x,48htheinpc-479
     a programme stops if form factors are missing.,19x,8hecis1629/72x,8inpc-480
     bhecis1630/18hfolding parameters,22x,15hformat (7e10.5),17x,8hecis1inpc-481
     c631/18h******************,54x,8hecis1632/80h  if the maximum positinpc-482
     dive value of 'nfold' read in columns 46-50 of the ecis1633/40hideninpc-483
     etification cards is n, read n times:,32x,8hecis1634/8x,28h1-10   vinpc-484
     fal(25) 'v' parameter,36x,8hecis1635/7x,29h11-20   val(26) 'r' parainpc-485
     gmeter,36x,8hecis1636/7x,29h21-30   val(27) 'a' parameter,36x,8heciinpc-486
     hs1637/54hfor explanations, see 'cards read in subroutine lect'.,18inpc-487
     ix,8hecis1638/72x,8hecis1639/72x,8hecis1640/1h/29hcards read in suinpc-488
     jbroutine eval,43x,8hecis1641/29h*****************************,43x,inpc-489
     k8hecis1642)                                                       inpc-490
      write (2,1079)                                                    inpc-491
 1079 format (3x,77hif lo(37)=.true., otherwise go to the beginning of ainpc-492
     1nother data set. ecis1643/72x,8hecis1644/17hnumber of changes,23x,inpc-493
     223hformat (l1,i4,i5,f10.5),9x,8hecis1645/17h*****************,55x,inpc-494
     38hecis1646/10x,10h1   lo(37),5x,41h.true. for other calls to this inpc-495
     4subroutine,6x,8hecis1647/25x,26h.false. for the last call.,21x,8heinpc-496
     5cis1648/7x,10h3- 5   nin,8x,31hnumber of parameters to change.,16xinpc-497
     6,8hecis1649/7x,10h6-10   nex,8x,55hindication for the use of the vinpc-498
     7alues to be readecis1650/27x,14h>0  increments,31x,8hecis1651/27x,inpc-499
     814h=0  new values,31x,8hecis1652/27x,26h<0  percentage of increaseinpc-500
     9,19x,8hecis1653/6x,11h11-20   ech,8x,38hnew search scale. (defaultinpc-501
     a option 20.),9x,8hecis1654/72x,8hecis1655/15hidentifications,25x,1inpc-502
     b3hformat (14i5),19x,8hecis1656/15h***************,57x,8hecis1657/7inpc-503
     cx,32h1- 5   index of first parameter.,33x,8hecis1658/7x,33h6-10   inpc-504
     dindex of second parameter.,32x,8hecis1659/6x,32h11-15   ..........inpc-505
     e..............,34x,8hecis1660/10x,70hup to nin values, eventually inpc-506
     fon other cards, starting in 1-5. ecis1661/3x,44hnote:  a negative inpc-507
     gvalue is replaced by zero.,25x,8hecis1662/3x,38h****   index zero inpc-508
     his the total energy.,31x,8hecis1663/10x,70hthe other indices are tinpc-509
     ihe same as the ones used for search,   ecis1664/9x,39hwith the liminpc-510
     jitations already described.,24x,8hecis1665/72x,8hecis1666)        inpc-511
      write (2,1080)                                                    inpc-512
 1080 format (10hnew values,30x,15hformat (7f10.5),17x,8hecis1667/10h***inpc-513
     1*******,62x,8hecis1668/7x,27h1-10   first new parameter.,38x,8heciinpc-514
     2s1669/6x,29h11-20   second new parameter.,37x,8hecis1670/6x,28h21-inpc-515
     330   ....................,38x,8hecis1671/63h  if lo(37)=.true. go inpc-516
     4again to 'cards read in subroutine eval'.,9x,8hecis1672/57h  if loinpc-517
     5(37)=.false. go to the beginning of next data set.,15x,8hecis1673/inpc-518
     654h  note:  there are different uses of this possibility:,18x,8hecinpc-519
     7is1674/67h  *****  1) as a search stops usually before the minimuminpc-520
     8, it can be,5x,8hecis1675/8x,72hrefined by using nex positive and inpc-521
     9introducing an increment '0.' ecis1676/8x,46hfor any parameter, ininpc-522
     a search or not in search.,18x,8hecis1677/9x,71h2) when searching tinpc-523
     bhe minimum of the chi2 as a function of someecis1678/8x,72hfixed pinpc-524
     carameter. the next search starts with the values of the  ecis1679/inpc-525
     d8x,49hparameters in search obtained in the last search.,15x,8hecisinpc-526
     e1680/9x,71h3) when some result must be obtained for different valuinpc-527
     fes of   ecis1681/8x,15hthe parameters.,49x,8hecis1682/72x,8hecis16inpc-528
     g83/72x,8hecis1684/44hrestart input: cards read in subroutine rest,inpc-529
     h28x,8hecis1685/44h********************************************,28xinpc-530
     i,8hecis1686/72x,8hecis1687/18hrestart conditions,22x,24hformat (l1inpc-531
     j,i4,i5,2f10.5),8x,8hecis1688/18h******************,54x,8hecis1689)inpc-532
      write (2,1081)                                                    inpc-533
 1081 format (10x,58h1   lo(35)  the only control which can be changed, inpc-534
     1all the,4x,8hecis1690/14x,31hothers being those of last run.,27x,8inpc-535
     2hecis1691/7x,41h2- 5   new maximum number of evaluations.,24x,8hecinpc-536
     3is1692/7x,55h6-10   new value of nsec. (default value: the old oneinpc-537
     4).,10x,8hecis1693/6x,25h11-20   new value of ech.,41x,8hecis1694/6inpc-538
     5x,25h11-20   new value of rap.,41x,8hecis1695/14x,53hif they are linpc-539
     6ess than 1., ech or rap are not changed.,5x,8hecis1696/72x,8hecis1inpc-540
     7697/72x,8hecis1698/80h********************************************inpc-541
     8****************************ecis1699/1h/72x,8hecis1700/30x,19h***inpc-542
     9****************,23x,8hecis1701/30x,19h*  next data set  *,23x,8heinpc-543
     acis1702/30x,19h*******************,23x,8hecis1703/72x,8hecis1704/6inpc-544
     bx,56h'fin' in columns 1-3 to stop the job without diagnostic.,10x,inpc-545
     c8hecis1705/72x,8hecis1706/7x,50hfor any trouble, write (and even sinpc-546
     dend listings) to,15x,8hecis1707/5x,56hjacques raynal/service de phinpc-547
     eysique theorique/c.e.-saclay,11x,8hecis1708/15x,33h91191 gif-sur-yinpc-548
     fvette cedex/france,24x,8hecis1709/72x,8hecis1710/5x,24hfax: (33)(1inpc-549
     g) 69.08-81-20,43x,8hecis1711/5x,33he-mail: raynal@spht.saclay.cea.inpc-550
     hfr,34x,8hecis1712/72x,8hecis1713)                                 inpc-551
      return                                                            inpc-552
      end                                                               inpc-553
c 03/04/98  ibm version                                         ecis97  lecl-000
      subroutine lecl(ncolx,ncoll,npp,sp,ipi,ipp,wv,iph,npar,nva,ncont,nlecl-001
     1scn,aimax,nbet,bt,lo)                                             lecl-002
c input of level descriptions.                                          lecl-003
c input variables:   ncolx:  total number of nuclear states             lecl-004
c                    ncoll:  number of coupled nuclear states           lecl-005
c                    npp:    number of optical potentials               lecl-006
c                    ncont:  number of continuum for compound nucleus   lecl-007
c                    nscn:   address of iph in the working space        lecl-008
c                    lo:     logical controls                           lecl-009
c output variables:  sp,ipi,ipp,wv:  see calx                           lecl-010
c                    iph(i) for i=1,ncoll number of phonons             lecl-011
c                    for vibrational model if iph(i) is 3, the state is lecl-012
c                    mixture of 1 and 2-phonons states.                 lecl-013
c                    for rotational model, iph(i) is 1 for a vibrationallecl-014
c                    band and 2 for a mixture with the ground state bandlecl-015
c                    iph(i) for i=ncoll+1,2*ncoll contains the addresseslecl-016
c                    of the description of the phonons and mixed states.lecl-017
c                    npar:   first address of nuclear parameters        lecl-018
c                    nva:    number of nuclear parameters               lecl-019
c                    nscn:   first free address of the working space    lecl-020
c                    aimax:  maximum sum of spins of target and particlelecl-021
c                    nbet:   number of different phonons                lecl-022
c working space:     bt:     temporary storage of nuclear parameters    lecl-023
c***********************************************************************lecl-024
      double precision wv,e,chi2,chi2m,cm,ck,chb,cmb,ccz,xe,xm,xn,xz    lecl-025
      logical lo(250)                                                   lecl-026
      dimension sp(3,1),ipi(10,1),ipp(11,1),iph(1),bt(1),wv(15,1)       lecl-027
      common /dblpr/ chi2,chi2m,cm,ck,chb,cmb,ccz,xe,xm,xn,xz           lecl-028
      data sigm /1h-/                                                   lecl-029
c output of nuclear model                                               lecl-030
      if (lo(7)) go to 3                                                lecl-031
      if (lo(1)) go to 2                                                lecl-032
      if (lo(3)) go to 1                                                lecl-033
      if (lo(102)) write (2,1000)                                       lecl-034
      if (lo(2)) write (2,1001)                                         lecl-035
      go to 4                                                           lecl-036
    1 write (2,1002)                                                    lecl-037
      if (lo(115)) go to 25                                             lecl-038
      go to 4                                                           lecl-039
    2 if (lo(103)) write (2,1003)                                       lecl-040
      if (lo(3)) write (2,1004)                                         lecl-041
      go to 4                                                           lecl-042
    3 write (2,1005)                                                    lecl-043
c input of channel description                                          lecl-044
    4 i=2*ncoll+1                                                       lecl-045
      nva=0                                                             lecl-046
      nbet=0                                                            lecl-047
      aimax=0.0                                                         lecl-048
      do 5 iv=1,npp                                                     lecl-049
    5 ipp(1,iv)=-1                                                      lecl-050
      do 22 iv=1,ncolx                                                  lecl-051
      read (1,1006) sp(2,iv),n,k,spi,e,sp(1,iv),wv(1,iv),wv(2,iv),sp(3,ilecl-052
     1v)                                                                lecl-053
      if (iv.ne.1) go to 8                                              lecl-054
      write(3,545) '<tljlabel>',wv(1,iv),e,wv(2,iv),sp(3,iv),           eb000000
     +     ' <\tljlabel>'                                               eb000000
      write(7,545) '<tljlabel>',wv(1,iv),e,wv(2,iv),sp(3,iv),           eb000000
     +     ' <\tljlabel>'                                               eb000000
 545  format(a10,f7.2,f10.5,f7.2,f7.2,a12)                              eb000000
      if (k.eq.0) k=1                                                   lecl-055
      if (lo(18).and.((sp(1,1).ne.sp(2,1)).or.(spi.eq.sigm).or.lo(100)))lecl-056
     1 go to 29                                                         lecl-057
      lo(223)=lo(18).and.sp(1,1)*sp(2,1).eq.0.                          lecl-058
      lo(231)=lo(18).and.sp(1,1)*sp(2,1).ne.0.                          lecl-059
      amred=wv(1,1)*wv(2,1)/(wv(1,1)+wv(2,1))                           lecl-060
      if (lo(8)) go to 6                                                lecl-061
      wv(3,1)=e*wv(2,1)/(wv(1,1)+wv(2,1))                               lecl-062
      go to 7                                                           lecl-063
c relativistic c.-m. energy ecm=sqrt((m1+m2)**2+2*m2*elab))-m1-m2       lecl-064
    6 wv(3,1)=cm*(dsqrt((wv(1,1)+wv(2,1))**2+2.d0*wv(2,1)*e/cm)-wv(1,1)-lecl-065
     1wv(2,1))                                                          lecl-066
    7 am3=wv(2,1)**.33333333333333d0                                    lecl-067
      bm3=wv(1,1)**.33333333333333d0                                    lecl-068
      write (2,1007) wv(2,1),sp(3,1),am3,wv(1,1),amred,sp(1,1),bm3      lecl-069
      write (2,1008) e,wv(3,1)                                          lecl-070
      e=0.d0                                                            lecl-071
      go to 11                                                          lecl-072
    8 if (wv(1,iv).eq.0.d0) go to 9                                     lecl-073
      amred=wv(1,iv)*wv(2,iv)/(wv(1,iv)+wv(2,iv))                       lecl-074
      am3=wv(2,iv)**.33333333333333d0                                   lecl-075
      bm3=wv(1,iv)**.33333333333333d0                                   lecl-076
      write (2,1007) wv(2,iv),sp(3,iv),am3,wv(1,iv),amred,sp(1,iv),bm3  lecl-077
      go to 10                                                          lecl-078
    9 wv(1,iv)=wv(1,iv-1)                                               lecl-079
      wv(2,iv)=wv(2,iv-1)                                               lecl-080
      sp(1,iv)=sp(1,iv-1)                                               lecl-081
      sp(3,iv)=sp(3,iv-1)                                               lecl-082
   10 wv(3,iv)=wv(3,1)-e                                                lecl-083
      if((ncont+iv.le.ncolx).and.lo(8)) wv(2,iv)=wv(1,1)+wv(2,1)-wv(1,ivlecl-084
     1)+e/cm                                                            lecl-085
      if (k.eq.0) k=ipi(4,iv-1)                                         lecl-086
   11 ipi(2,iv)=2.*sp(1,iv)+1.1                                         lecl-087
      ipi(3,iv)=2.*sp(2,iv)+1.1                                         lecl-088
      if (lo(209).and.ipi(2,iv).ne.2) go to 26                          lecl-089
      if (k.gt.npp.or.k.le.0) go to 27                                  lecl-090
      ipi(4,iv)=k                                                       lecl-091
      ipi(10,iv)=k                                                      lecl-092
      if (ipp(1,k).eq.-1) ipp(1,k)=iv                                   lecl-093
      aimax=amax1(aimax,sp(2,iv)+sp(1,iv))                              lecl-094
      ipi(1,iv)=0                                                       lecl-095
      if (spi.eq.sigm) ipi(1,iv)=1                                      lecl-096
      if (iv.le.ncoll) go to 13                                         lecl-097
c uncoupled states for compound nucleus                                 lecl-098
      if (ncont+iv.gt.ncolx) go to 12                                   lecl-099
      write (2,1009) iv,sp(2,iv),spi,e,k                                lecl-100
      go to 22                                                          lecl-101
c continuum for compound nucleus                                        lecl-102
   12 write (2,1010) iv,sp(2,iv),spi,e,k                                lecl-103
      go to 22                                                          lecl-104
   13 m=0                                                               lecl-105
      if (lo(7)) m=2                                                    lecl-106
      if (lo(3)) m=1                                                    lecl-107
      if (m.ne.0) go to 17                                              lecl-108
      if ((lo(1).and.n.eq.0).or.lo(101).and.n.ne.0) go to 14            lecl-109
c input of phonons in harmonic vibrational or symmetric rotational modellecl-110
      read (1,1011) iph(iv),iph(i),iph(i+1),iph(i+2)                    lecl-111
      nbet=max0(nbet,iph(i),iph(i+1),iph(i+2))                          lecl-112
      iph(iv+ncoll)=i                                                   lecl-113
      m=iph(iv)+1                                                       lecl-114
      go to ( 15 , 16 , 17 , 17 ) , m                                   lecl-115
c ground state                                                          lecl-116
   14 iph(iv)=0                                                         lecl-117
   15 write (2,1012) iv,sp(2,iv),spi,e,k                                lecl-118
      go to 22                                                          lecl-119
c 1 phonon state                                                        lecl-120
   16 if (lo(101)) write (2,1013) iv,sp(2,iv),spi,e,k,iph(i)            lecl-121
      if (lo(1)) write (2,1014) iv,sp(2,iv),spi,e,k,iph(i)              lecl-122
      i=i+1                                                             lecl-123
      go to 22                                                          lecl-124
   17 write (2,1015) iv,sp(2,iv),spi,e,k                                lecl-125
      go to ( 21 , 22 , 18 , 19 ) , m                                   lecl-126
   18 if (lo(1)) go to 19                                               lecl-127
c 2 phonon state                                                        lecl-128
      write (2,1016) iph(i),iph(i+1)                                    lecl-129
      i=i+2                                                             lecl-130
      go to 22                                                          lecl-131
c mixture of 1 phonon and 2 phonon state - input of mixing parameter    lecl-132
   19 nva=nva+1                                                         lecl-133
      read (1,1017) bt(nva)                                             lecl-134
      b1=1.74532925d-02*bt(nva)                                         lecl-135
      c1=cos(b1)                                                        lecl-136
      c3=sin(b1)                                                        lecl-137
      if (lo(1)) go to 20                                               lecl-138
      write (2,1018) bt(nva),c3,iph(i),iph(i+1),c1,iph(i+2)             lecl-139
      i=i+3                                                             lecl-140
      go to 22                                                          lecl-141
   20 write (2,1019) bt(nva),c3,iph(i),c1                               lecl-142
      i=i+1                                                             lecl-143
      go to 22                                                          lecl-144
c asymmetric rotational model - input of mixing parameters              lecl-145
   21 if (lo(101)) go to 22                                             lecl-146
      k=0.5*sp(2,iv)+.1                                                 lecl-147
      iph(iv)=k                                                         lecl-148
      iph(iv+ncoll)=nva                                                 lecl-149
      if (k.eq.0) go to 22                                              lecl-150
      read (1,1017) (bt(nva+j),j=1,k)                                   lecl-151
      write (2,1020) (bt(nva+j),j=1,k)                                  lecl-152
      nva=nva+k                                                         lecl-153
   22 continue                                                          lecl-154
      nscn=nscn+i                                                       lecl-155
      npar=nscn                                                         lecl-156
      if (lo(15)) nva=0                                                 lecl-157
      if (nva.eq.0) go to 24                                            lecl-158
c the nuclear parameters which were stored in bt are copied in the wor- lecl-159
c king space from npar to nscn-1                                        lecl-160
      do 23 i=1,nva                                                     lecl-161
   23 sp(npar+i-1,1)=bt(i)                                              lecl-162
      nscn=npar+nva                                                     lecl-163
   24 if (lo(1).and.lo(3)) nscn=nscn+nva+ncoll                          lecl-164
      return                                                            lecl-165
   25 write (2,1021)                                                    lecl-166
      go to 30                                                          lecl-167
   26 write (2,1022) sp(1,iv)                                           lecl-168
      go to 28                                                          lecl-169
   27 write (2,1023) k,npp                                              lecl-170
   28 write (2,1015) iv,sp(2,iv),spi,e,k                                lecl-171
      go to 30                                                          lecl-172
   29 write (2,1024)                                                    lecl-173
   30 write (2,1025)                                                    lecl-174
      stop                                                              lecl-175
 1000 format (/30h first order vibrational model/)                      lecl-176
 1001 format (/31h second order vibrational model/)                     lecl-177
 1002 format (/29h anharmonic vibrational model/)                       lecl-178
 1003 format (/27h symmetric rotational model/)                         lecl-179
 1004 format (/28h asymmetric rotational model/)                        lecl-180
 1005 format (/27h external form factor model/)                         lecl-181
 1006 format (f5.2,2i2,a1,5f10.5)                                       lecl-182
 1007 format (/7h target,14x,6hmass =,f10.5,11x,20hproduct of charges =,lecl-183
     1f6.0,11x,9hat**1/3 =,e15.6/18h incident particle,3x,6hmass =,f10.5lecl-184
     2,3x,14hreduced mass =,e15.6,3x,6hspin =,f4.1,3x,9hap**1/3 =,e15.6)lecl-185
 1008 format (10x,13henergy(lab) =,e15.6,4h mev,10x,15henergy(c. m.) =,elecl-186
     115.6,4h mev/)                                                     lecl-187
 1009 format (4h n =,i3,11h -   spin =,f4.1,a1,20h excitation energy =,flecl-188
     18.4,4h mev,10x,9hpotential,i5,6x,27h***** uncoupled state *****)  lecl-189
 1010 format (4h n =,i3,11h -   spin =,f4.1,a1,20h excitation energy =,flecl-190
     18.4,4h mev,10x,9hpotential,i5,6x,32h***** start of a continuum ***lecl-191
     2**)                                                               lecl-192
 1011 format (14i5)                                                     lecl-193
 1012 format (4h n =,i3,11h -   spin =,f4.1,a1,20h excitation energy =,flecl-194
     18.4,4h mev,10x,9hpotential,i5,6x,17hground state band)            lecl-195
 1013 format (4h n =,i3,11h -   spin =,f4.1,a1,20h excitation energy =,flecl-196
     18.4,4h mev,10x,9hpotential,i5,6x,i2,13h phonon state)             lecl-197
 1014 format (4h n =,i3,11h -   spin =,f4.1,a1,20h excitation energy =,flecl-198
     18.4,4h mev,10x,9hpotential,i5,6x,26hvibrational band of phonon,i2)lecl-199
 1015 format (4h n =,i3,11h -   spin =,f4.1,a1,20h excitation energy =,flecl-200
     18.4,4h mev,10x,9hpotential,i5)                                    lecl-201
 1016 format (23x,29h2 phonons state, with phonons,i2,4h and,i2)        lecl-202
 1017 format (7f10.5)                                                   lecl-203
 1018 format (23x,36hmixing of 1 and 2 phonon states with,f9.3,8h degreelecl-204
     1s/23x,f10.5,29h2 phonons state, with phonons,i2,4h and,i2,4h  + ,flecl-205
     210.5,26h1 phonon state with phonon,i2)                            lecl-206
 1019 format (23x,43hmixing of vibrational and ground bands with,f9.3,8hlecl-207
     1 degrees/23x,f10.5,26hvibrational band of phonon,i2,4h and,f10.5,1lecl-208
     27hground state band)                                              lecl-209
 1020 format (23x,18hband mixing coeff.,5f10.5)                         lecl-210
 1021 format (63h the nuclear reduced matrix elements must be read in thlecl-211
     1is model)                                                         lecl-212
 1022 format (14h particle spin,f5.1,31h not allowed for dirac equation)lecl-213
 1023 format (10h potential,i3,34h will not be read.total number is:,i3)lecl-214
 1024 format (113h projectile-target antisymmetrisation valid only for slecl-215
     1pin of particle equal to spin of target and positive parity/49x,26lecl-216
     2hand schroedinger formalism)                                      lecl-217
 1025 format (/22h in lecl  ... stop ...)                               lecl-218
      end                                                               lecl-219
c 30/04/98  ibm version                                         ecis97  lect-000
      subroutine lect(nbet,sp,ipp,pip,wv,nbta,beta,val,fiss,gam,npp,nfm lect-001
     1,rm,aconv,idmt,idt,h,aspin,ism,iqm,iqmax,scn,lo)                  lect-002
c lect reads all input except the 5 first data cards,the levels, the    lect-003
c experimental data,the search conditions,the nuclear reduced matrix    lect-004
c elements and the form factors.                                        lect-005
c input variables:   nbet:    number of phonons                         lect-006
c                    sp,ipp,pip,wv:  see calx                           lect-007
c                    npp:     number of optical potentials              lect-008
c                    nfm:     address of beta in the working space      lect-009
c                    rm:      matching radius                           lect-010
c                    aconv:   convergence parameter for potentials.     lect-011
c                    idmt:    size of working space                     lect-012
c                    idt:     length free for beta                      lect-013
c                    h:       integration step                          lect-014
c                    lo:      logical controls                          lect-015
c input variable by common                                              lect-016
c /ncomp/nrd,nfiss:  number of gamma and fission transmission coeff.    lect-017
c        ncont,ncons:number of level densities                          lect-018
c output variables:  ipp(2,3,*),pip(4...11,*)  dispersion parameters.   lect-019
c                    nbet:    number of different deformations          lect-020
c                    nbta(j,i) quantum numbers of deform. for j=9,10    lect-021
c                    beta(j,i) nuclear deformation for potential j=1,8  lect-022
c                    val(i,n)  (25 optical +9 folding parameters)* npp  lect-023
c                    fiss:    fission data for compound nucleus         lect-024
c                    gam:     gamma data for compound nucleus           lect-025
c                    nfm:     first free address of the working space   lect-026
c                    rm:      matching radius                           lect-027
c                    h:       integration step                          lect-028
c                    aspin:   k-value of the rotational band            lect-029
c                    ism:     number of integration steps               lect-030
c                    iqm:     maximum l-value of def. in rotat. model   lect-031
c                    iqmax:   maximum l-expansion in rotational model   lect-032
c                    scn:     descriptions of level densities           lect-033
c output variable by common                                             lect-034
c /titr/ theta1,theta2,dtheta,dthe: indications for equidistant angles  lect-035
c /ncomp/az(6):  deformed spin-orbit parameters.                        lect-036
c        bz(3):  hauser-feshbach parameters.                            lect-037
c        tg0,bn,fnug,egd,ggd:  moldauer's data for giant resonance      lect-038
c***********************************************************************lect-039
      double precision wv,chi2,chi2m,cm,ck,chb,cmb,ccz,xe,xm,xn,xz,x2   lect-040
      dimension sp(3,1),val(34,1),ipp(11,1),pip(11,1),beta(10,1),aleg(6)lect-041
     1,bleg(2),cleg(6),ro(6),gam(1),fiss(2,1),nbta(10,1),scn(8,1),wv(15,lect-042
     21)                                                                lect-043
      logical lo(250),lt(6)                                             lect-044
      common /dblpr/ chi2,chi2m,cm,ck,chb,cmb,ccz,xe,xm,xn,xz           lect-045
      common /titr/ title(18),theta1,theta2,dtheta,dthe,ncj,jmm(2),nl(3)lect-046
      common /ncomp/ nsp(3),nfiss,nrd,ncont,ncoj,acn1,acn2,ncons,nie,ncolect-047
     1lx,ndp,ndq,az(6),bz(3),tg0,bn,fnug,egd,ggd,tg1,sgsq               lect-048
      data bleg,cleg /4hnot ,4h    ,4h vol,4hume ,4h sca,4hlar ,4h vec,4lect-049
     1htor /                                                            lect-050
      if (lo(8)) go to 1                                                lect-051
      x2=dsqrt(ck*wv(3,1)*wv(1,1)*wv(2,1)/(wv(1,1)+wv(2,1)))            lect-052
      go to 2                                                           lect-053
    1 x2=dsqrt(0.125d0*ck*wv(3,1)*(wv(3,1)/cm+2.d0*wv(1,1)+2.d0*wv(2,1))lect-054
     1*(wv(3,1)/cm+2.d0*wv(1,1))*(wv(3,1)/cm+2.d0*wv(2,1)))/(wv(3,1)/cm+lect-055
     2wv(1,1)+wv(2,1))                                                  lect-056
    2 iqm=0                                                             lect-057
      if (nbet.eq.0) go to 6                                            lect-058
c input of phonon deformations in vibrational and rotational models     lect-059
      do 5 i=1,nbet                                                     lect-060
      read (1,1000) nbta(9,i),nbta(10,i),beta(1,i),k                    lect-061
      do 3 j=2,8                                                        lect-062
    3 beta(j,i)=beta(1,i)                                               lect-063
      if (lo(5)) read (1,1001) (beta(j,i),j=2,8)                        lect-064
      write (2,1002) i,nbta(9,i),nbta(10,i),(beta(j,i),j=1,8)           lect-065
      if (lo(116)) go to 5                                              lect-066
      if (k.eq.0) k=1                                                   lect-067
      k=min0(k,ncolx)                                                   lect-068
      am3=wv(2,k)**.33333333333333d0                                    lect-069
      bm3=wv(1,k)**.33333333333333d0                                    lect-070
      cm3=am3/(am3+bm3)                                                 lect-071
      dm3=1.                                                            lect-072
      if (lo(6)) dm3=cm3                                                lect-073
      do 4 j=1,6                                                        lect-074
    4 beta(j,i)=beta(j,i)*cm3/dm3                                       lect-075
      beta(7,i)=beta(7,i)*cm3**nbta(9,i)/dm3                            lect-076
      beta(8,i)=beta(8,i)*cm3**nbta(9,i)/dm3                            lect-077
      write (2,1003) k,(beta(j,i),j=1,8)                                lect-078
    5 continue                                                          lect-079
    6 if (lo(7)) go to 20                                               lect-080
      if (lo(101)) go to 15                                             lect-081
c input of deformations for the rotational model                        lect-082
      read (1,1000) iqm,iqmax,aspin,k                                   lect-083
      iq=nbet+1                                                         lect-084
      jq=nbet+iqm/2                                                     lect-085
      if (lo(103)) go to 7                                              lect-086
      jq=nbet+iqm                                                       lect-087
      if ((iqm.gt.35).or.(iqmax.gt.8)) go to 41                         lect-088
    7 if (10*jq.gt.idt) call memo(idmt,10*jq-idt,idt,3,lo)              lect-089
      if (lo(216)) go to 42                                             lect-090
      read (1,1001) (beta(1,i),i=iq,jq)                                 lect-091
      m=0                                                               lect-092
      l=0                                                               lect-093
      do 11 i=iq,jq                                                     lect-094
      if (lo(3)) go to 8                                                lect-095
      l=2*(i-nbet)                                                      lect-096
      go to 9                                                           lect-097
    8 m=m+2                                                             lect-098
      if (m.le.l) go to 9                                               lect-099
      l=l+2                                                             lect-100
      m=0                                                               lect-101
    9 nbta(9,i)=l                                                       lect-102
      nbta(10,i)=m                                                      lect-103
      do 10 j=2,8                                                       lect-104
   10 beta(j,i)=beta(1,i)                                               lect-105
   11 continue                                                          lect-106
      if (lo(5)) read (1,1001) ((beta(j,i),j=2,8),i=iq,jq)              lect-107
      write (2,1004) iqmax,aspin                                        lect-108
      write (2,1005) (i,nbta(9,i),nbta(10,i),(beta(j,i),j=1,8),i=iq,jq) lect-109
      if (lo(116)) go to 14                                             lect-110
      if (k.eq.0) k=1                                                   lect-111
      k=min0(k,ncolx)                                                   lect-112
      am3=wv(2,k)**.33333333333333d0                                    lect-113
      bm3=wv(1,k)**.33333333333333d0                                    lect-114
      cm3=am3/(am3+bm3)                                                 lect-115
      dm3=1.                                                            lect-116
      if (lo(6)) dm3=cm3                                                lect-117
      do 13 i=iq,jq                                                     lect-118
      if (nbta(10,i).ne.0) go to 13                                     lect-119
      do 12 k=1,6                                                       lect-120
   12 beta(k,i)=beta(k,i)*cm3/dm3                                       lect-121
      beta(7,i)=beta(7,i)*cm3**nbta(9,i)/dm3                            lect-122
      beta(8,i)=beta(8,i)*cm3**nbta(9,i)/dm3                            lect-123
   13 continue                                                          lect-124
      write (2,1006) k                                                  lect-125
      write (2,1005) (i,nbta(9,i),nbta(10,i),(beta(j,i),j=1,8),i=iq,jq) lect-126
   14 nbet=jq                                                           lect-127
      go to 20                                                          lect-128
c anharmonic vibrational model with different deformations              lect-129
   15 if (lo(103)) go to 20                                             lect-130
      write (2,1007)                                                    lect-131
      do 17 i=1,4                                                       lect-132
      do 16 j=1,8                                                       lect-133
   16 beta(j,i)=1.                                                      lect-134
      nbta(9,i)=0                                                       lect-135
      nbta(10,i)=0                                                      lect-136
      if (lo(5)) read (1,1001) (beta(j,i),j=1,8)                        lect-137
   17 write (2,1008) i,nbta(9,i),(beta(j,i),j=1,8)                      lect-138
      nbet=4                                                            lect-139
      if (lo(116)) go to 20                                             lect-140
      read (1,1009) (nbta(9,j),j=1,4),k                                 lect-141
      if (k.eq.0) k=1                                                   lect-142
      k=min0(k,ncolx)                                                   lect-143
      am3=wv(2,k)**.33333333333333d0                                    lect-144
      bm3=wv(1,k)**.33333333333333d0                                    lect-145
      cm3=am3/(am3+bm3)                                                 lect-146
      dm3=1.                                                            lect-147
      if (lo(6)) dm3=cm3                                                lect-148
      write (2,1006) k                                                  lect-149
      do 19 i=2,4                                                       lect-150
      if (nbta(9,i).eq.0) nbta(9,i)=2                                   lect-151
      if (nbta(9,i).lt.0) nbta(9,i)=0                                   lect-152
      do 18 j=1,6                                                       lect-153
   18 beta(j,i)=beta(j,i)*(cm3/dm3)**(i-1)                              lect-154
      beta(7,i)=beta(7,i)*(cm3**nbta(9,i)/dm3)**(i-1)                   lect-155
      beta(8,i)=beta(8,i)*(cm3**nbta(9,i)/dm3)**(i-1)                   lect-156
   19 write (2,1010) i,nbta(9,i),(beta(j,i),j=1,8)                      lect-157
c input of optical model parameters                                     lect-158
   20 w2=10.e20                                                         lect-159
      lo(201)=.true.                                                    lect-160
      lo(202)=.true.                                                    lect-161
      lo(203)=.true.                                                    lect-162
      lo(208)=.false.                                                   lect-163
      lt(4)=.true.                                                      lect-164
      lt(6)=.true.                                                      lect-165
      w1=0.0                                                            lect-166
      w3=x2/(aconv*wv(3,1))                                             lect-167
      do 28 ip=1,npp                                                    lect-168
      ij=ipp(1,ip)                                                      lect-169
      if (ij.ne.-1) go to 21                                            lect-170
      ipp(1,ip)=1                                                       lect-171
      write (2,1011) ip                                                 lect-172
      ij=1                                                              lect-173
   21 if (lo(7)) go to 23                                               lect-174
      am3=wv(2,ij)**.33333333333333d0                                   lect-175
      if (lo(16)) am3=am3+wv(1,ij)**.33333333333333d0                   lect-176
      write (2,1012) ip,am3                                             lect-177
      do 22 i=1,6                                                       lect-178
      aleg(i)=bleg(2)                                                   lect-179
      read (1,1013) val(3*i-2,ip),ro(i),val(3*i,ip)                     lect-180
      val(3*i-1,ip)=am3*ro(i)                                           lect-181
      if (val(3*i-2,ip).eq.0.) go to 22                                 lect-182
      w1=amax1(w1,val(3*i-1,ip)+alog(w3*abs(val(3*i-2,ip)))*val(3*i,ip))lect-183
      w2=amin1(w2,val(3*i,ip))                                          lect-184
   22 continue                                                          lect-185
      lt(1)=sp(1,ij).eq.0.or.val(13,ip).eq.0.                           lect-186
      lt(2)=sp(1,ij).eq.0.or.val(16,ip).eq.0.                           lect-187
      lo(201)=lo(201).and.lt(1)                                         lect-188
      lo(202)=lo(202).and.lt(2)                                         lect-189
c output of optical parameters                                          lect-190
      if (lo(112)) aleg(2)=bleg(1)                                      lect-191
      if (lt(1).or.lo(113)) aleg(5)=bleg(1)                             lect-192
      if (lt(2).or.lo(114)) aleg(6)=bleg(1)                             lect-193
      aleg(4)=aleg(2)                                                   lect-194
      write (2,1014) (aleg(i),val(3*i-2,ip),val(3*i-1,ip),ro(i),val(3*i,lect-195
     1ip),i=1,6)                                                        lect-196
      read (1,1013) ro(1),val(21,ip),val(25,ip)                         lect-197
      read (1,1013) val(22,ip),ro(2),val(24,ip)                         lect-198
      if (lo(99)) val(21,ip)=0.                                         lect-199
      if (lo(99)) val(24,ip)=0.                                         lect-200
      val(19,ip)=sp(3,ij)                                               lect-201
      val(20,ip)=am3*ro(1)                                              lect-202
      lt(3)=val(19,ip).eq.0.                                            lect-203
      lt(4)=lt(3).and.lt(4)                                             lect-204
      aleg(1)=bleg(2)                                                   lect-205
      if (lt(3).or.lo(111)) aleg(1)=bleg(1)                             lect-206
      val(23,ip)=am3*ro(2)                                              lect-207
      lt(5)=val(22,ip).eq.0.or.sp(1,ij).eq.0.                           lect-208
      lo(203)=lo(203).and.lt(5)                                         lect-209
      lt(6)=lt(5).and.lt(6)                                             lect-210
      aleg(2)=bleg(2)                                                   lect-211
      if (lt(5).or.lo(119)) aleg(2)=bleg(1)                             lect-212
      write (2,1015) (aleg(i),val(3*i+16,ip),val(3*i+17,ip),ro(i),val(3*lect-213
     1i+18,ip),i=1,2),val(25,ip)                                        lect-214
      lo(208)=lo(208).or.val(22,ip).ne.0..or.(lo(209).and.val(19,ip).ne.lect-215
     10.)                                                               lect-216
      w1=amax1(w1,val(20,ip)+10.*val(21,ip),val(23,ip)+10.*val(24,ip))  lect-217
      if (val(21,ip).ne.0) w2=amin1(w2,val(21,ip))                      lect-218
      if (val(24,ip).ne.0) w2=amin1(w2,val(24,ip))                      lect-219
      if (lo(117)) go to 23                                             lect-220
c input of folding parameters                                           lect-221
      read (1,1013) (val(i,ip),i=26,34)                                 lect-222
      write (2,1016) (val(i,ip),i=26,34)                                lect-223
   23 if (lo(110)) go to 28                                             lect-224
c input of dispersion parameters                                        lect-225
      read (1,1017) ipp(2,ip),ipp(3,ip),(pip(j,ip),j=4,6),(pip(j,ip),j=9lect-226
     1,11)                                                              lect-227
      if (ipp(2,ip).lt.0) read (1,1001) pip(7,ip),pip(8,ip)             lect-228
      if (pip(4,ip).eq.0.) pip(4,ip)=wv(3,ij)                           lect-229
      if (pip(5,ip).eq.0) pip(5,ip)=-6.8                                lect-230
      write (2,1018) pip(4,ip),pip(5,ip)                                lect-231
      i1=1                                                              lect-232
      if (lo(209)) i1=3                                                 lect-233
      if (ipp(2,ip).lt.0) go to 24                                      lect-234
      write (2,1019) cleg(i1),cleg(i1+1),ipp(2,ip),pip(6,ip)            lect-235
      go to 25                                                          lect-236
   24 write (2,1020) cleg(i1),cleg(i1+1),ipp(2,ip),pip(6,ip),pip(7,ip),plect-237
     1ip(8,ip)                                                          lect-238
   25 if (lo(209)) go to 27                                             lect-239
      if (ipp(3,ip).lt.0) go to 26                                      lect-240
      write (2,1021) ipp(3,ip),pip(9,ip),pip(10,ip),pip(11,ip)          lect-241
      go to 28                                                          lect-242
   26 if (pip(10,ip).eq.0.) pip(10,ip)=2.*pip(9,ip)                     lect-243
      write (2,1022) ipp(3,ip),pip(9,ip),pip(10,ip)                     lect-244
      go to 28                                                          lect-245
   27 if (ipp(3,ip).ge.0) write (2,1019) cleg(5),cleg(6),ipp(3,ip),pip(9lect-246
     1,ip)                                                              lect-247
      if (ipp(3,ip).lt.0) write (2,1020) cleg(5),cleg(6),ipp(3,ip),pip(9lect-248
     1,ip),pip(10,ip),pip(11,ip)                                        lect-249
   28 continue                                                          lect-250
      if (lo(99)) lo(202)=.false.                                       lect-251
      if (lo(107)) go to 30                                             lect-252
      do 29 ij=1,ncolx                                                  lect-253
      lt(4)=lt(4).and.sp(3,ij).eq.0.                                    lect-254
      lt(6)=lt(6).and.sp(1,ij).eq.0.                                    lect-255
   29 lo(202)=lo(202).and.sp(1,ij).eq.0.                                lect-256
      w1=20.                                                            lect-257
      lo(201)=lo(202)                                                   lect-258
      lo(203)=lo(202).or.lt(6)                                          lect-259
      lo(208)=lo(209).or.(.not.lo(203))                                 lect-260
   30 lo(201)=lo(201).and.lo(202)                                       lect-261
      lo(229)=(.not.lo(201)).or.lo(209)                                 lect-262
      lo(230)=(.not.lo(202)).or.lo(209)                                 lect-263
      lo(13)=.not.(lo(113).or.lo(201))                                  lect-264
      lo(14)=.not.(lo(114).or.lo(202))                                  lect-265
      lo(11)=.not.(lo(111).or.lt(4))                                    lect-266
      lo(19)=.not.(lo(119).or.lt(6))                                    lect-267
      if (lo(19)) lo(11)=.true.                                         lect-268
      lo(208)=lo(208).or.lo(44)                                         lect-269
      if (lo(144).and.lo(46)) lo(208)=.false.                           lect-270
c default value of matching radius: max(r*a**1/3+10*a)                  lect-271
c default value for integration step: min(min(a)/2,1/(2*k))             lect-272
      if (rm.le.0.) rm=w1                                               lect-273
      if (h.le.0.) h=dmin1(w2/2.d0,0.5d0/x2)                            lect-274
      ism=rm/h+0.5                                                      lect-275
      h=ism                                                             lect-276
      h=rm/h                                                            lect-277
      rm=h*ism                                                          lect-278
      write (2,1023) h,rm                                               lect-279
      if (lo(66)) go to 31                                              lect-280
c input of limits for calculation at equidistant angles                 lect-281
      read (1,1001) theta1,dtheta,theta2,dthe                           lect-282
      if (dtheta.eq.0.) dtheta=1.                                       lect-283
      if ((theta2-theta1)*dtheta.lt.0.) dtheta=-dtheta                  lect-284
      write (2,1024) theta1,dtheta,theta2,dthe                          lect-285
c input of deformed spin-orbit parameters                               lect-286
   31 az(1)=0.                                                          lect-287
      az(2)=1.                                                          lect-288
      az(3)=1.                                                          lect-289
      az(4)=0.                                                          lect-290
      az(5)=1.                                                          lect-291
      az(6)=1.                                                          lect-292
      if (lo(104)) go to 32                                             lect-293
      read (1,1001) az                                                  lect-294
      write (2,1025) az                                                 lect-295
   32 if (lo(181)) go to 39                                             lect-296
      read (1,1001) bz                                                  lect-297
      if (bz(1).eq.0.) bz(1)=1.4142                                     lect-298
      if (lo(182)) go to 33                                             lect-299
      if (bz(2).eq.0.) bz(2)=3.5                                        lect-300
      if (bz(3).eq.0.) bz(3)=100.                                       lect-301
      write (2,1026) bz                                                 lect-302
      go to 39                                                          lect-303
   33 write (2,1027) bz(1),bz(2)                                        lect-304
      if (lo(185)) go to 35                                             lect-305
      write (2,1028) nfiss                                              lect-306
      do 34 i=1,nfiss                                                   lect-307
      read (1,1001) fiss(1,i),fiss(2,i)                                 lect-308
      if (fiss(2,i).lt.0.5) fiss(2,i)=0.                                lect-309
   34 write (2,1029) fiss(1,i),fiss(2,i)                                lect-310
   35 if (lo(186)) go to 37                                             lect-311
      write (2,1030)                                                    lect-312
      if (nrd.gt.0) go to 36                                            lect-313
      read (1,1001) tg0,bn,fnug,egd,ggd                                 lect-314
      read (1,1001) scn(7,ncons),(scn(i,ncons),i=1,6)                   lect-315
      if (bn.eq.0.) bn=8.                                               lect-316
      if (fnug.lt.1.) fnug=20.                                          lect-317
      if (tg0.eq.0.) lo(86)=.false.                                     lect-318
      lo(186)=.not.lo(86)                                               lect-319
      write (2,1031) tg0,bn,fnug,egd,ggd                                lect-320
      write (2,1032) (scn(i,ncons),i=1,7)                               lect-321
      na=wv(2,1)+wv(1,1)+.5d0                                           lect-322
      call lden(na,scn(1,ncons))                                        lect-323
      go to 37                                                          lect-324
   36 read (1,1001) (gam(i),i=1,nrd)                                    lect-325
      write (2,1033) (gam(i),i=1,nrd)                                   lect-326
   37 if (ncont.eq.0) go to 39                                          lect-327
      write (2,1034)                                                    lect-328
      do 38 j=1,ncont                                                   lect-329
      read (1,1001) scn(7,j),(scn(i,j),i=1,6)                           lect-330
      write (2,1035) j,(scn(i,j),i=1,7)                                 lect-331
      na=wv(2,ncolx+j-ncont)+.5d0                                       lect-332
   38 call lden(na,scn(1,j))                                            lect-333
   39 nfm=nfm+10*nbet                                                   lect-334
      do 40 i=1,100                                                     lect-335
   40 lo(i+100)=.not.lo(i)                                              lect-336
      return                                                            lect-337
   41 write (2,1036) iqm,iqmax                                          lect-338
   42 write (2,1037)                                                    lect-339
      stop                                                              lect-340
 1000 format (2i5,f10.5,i5)                                             lect-341
 1001 format (7f10.5)                                                   lect-342
 1002 format (10x,6hphonon,i3,5x,3hl =,i3,5x,3hk =,i3,5x,6hbeta =,8f8.5)lect-343
 1003 format (12x,30hafter heavy ion correction i =,i2,8h  beta =,8f8.5)lect-344
 1004 format (/10x,33hmultipole expansion up to iqmax =,i3,20x,3hk =,f7.lect-345
     12,5h band)                                                        lect-346
 1005 format (/22h beta(i,j) for  l   k ,8x,1hv,9x,1hw,8x,2hvs,8x,2hws,7lect-347
     1x,3hvso,7x,3hwso,6x,14hcoul s.o. coul/(5x,i5,5x,i2,2x,i2,2x,8f10.5lect-348
     2))                                                                lect-349
 1006 format (/10x,30hafter heavy ion correction i =,i3/)               lect-350
 1007 format (/10x,33hratios of anharmonic deformations/25x,1hv,9x,1hw,8lect-351
     1x,2hvs,8x,2hws,7x,3hvso,7x,3hwso,6x,14hcoul s.o. coul)            lect-352
 1008 format (6h order,i3,6x,i3,2x,8f10.5)                              lect-353
 1009 format (14i5)                                                     lect-354
 1010 format (6h order,i3,6h  iq =,i3,2x,8f10.5)                        lect-355
 1011 format (/33h ***** no state for the potential,i3,28h *** we use thlect-356
     1e ground state/)                                                  lect-357
 1012 format (//23h optical potentials  **,i3,38h **     reduced radius lect-358
     1multiplied by  ,e15.6/)                                           lect-359
 1013 format (3f10.5)                                                   lect-360
 1014 format (2x,a4,38hdeformed  volume/scalar real potential/14x,5hdeptlect-361
     1h,f12.6,13h mev   radius,f10.6,21h fermi (reduced value,f9.6,16h) lect-362
     2   diffuseness,f9.6,6h fermi//2x,a4,43hdeformed  volume/scalar imalect-363
     3ginary potential/14x,5hdepth,f12.6,13h mev   radius,f10.6,21h fermlect-364
     4i (reduced value,f9.6,16h)    diffuseness,f9.6,6h fermi//2x,a4,39hlect-365
     5deformed  surface/vector real potential/14x,5hdepth,f12.6,13h mev lect-366
     6  radius,f10.6,21h fermi (reduced value,f9.6,16h)    diffuseness,flect-367
     79.6,6h fermi//2x,a4,44hdeformed  surface/vector imaginary potentialect-368
     8l/14x,5hdepth,f12.6,13h mev   radius,f10.6,21h fermi (reduced valulect-369
     9e,f9.6,16h)    diffuseness,f9.6,6h fermi//2x,a4,42hdeformed  real lect-370
     aspin-orbit/tensor potential/14x,5hdepth,f12.6,13h mev   radius,f10lect-371
     b.6,21h fermi (reduced value,f9.6,16h)    diffuseness,f9.6,6h fermilect-372
     c//2x,a4,47hdeformed  imaginary spin-orbit/tensor potential/14x,5hdlect-373
     depth,f12.6,13h mev   radius,f10.6,21h fermi (reduced value,f9.6,16lect-374
     eh)    diffuseness,f9.6,6h fermi)                                  lect-375
 1015 format (/2x,a4,27hdeformed  coulomb potential/19h product of charglect-376
     1es,f9.0,10x,6hradius,f10.6,21h fermi (reduced value,f9.6,16h)    dlect-377
     2iffuseness,f9.6,6h fermi//2x,a4,38hdeformed  spin-orbit coulomb polect-378
     3tential/14x,5hdepth,f12.6,13h mev   radius,f10.6,21h fermi (reducelect-379
     4d value,f9.6,16h)    diffuseness,f9.6,6h fermi/14x,22hthird chargelect-380
     5 parameter,f9.6)                                                  lect-381
 1016 format (/22h *** folding model ***/19h real part      v =,f10.4,6xlect-382
     1,3hr =,f10.4,6x,3ha =,f10.4/19h imaginary part v =,f10.4,6x,3hr =,lect-383
     2f10.4,6x,3ha =,f10.4/19h coulomb part   v =,f10.4,6x,3hr =,f10.4,6lect-384
     3x,3ha =,f10.4/)                                                   lect-385
 1017 format (2i5,6f10.5)                                               lect-386
 1018 format (26h imaginary depths read for,f12.6,38h mev (centre of maslect-387
     1s)    fermi energy:,f12.6)                                        lect-388
 1019 format (2a4,11h:   power =,i3,5x,3hb =,f10.4)                     lect-389
 1020 format (2a4,11h:   power =,i3,5x,11hsum of b1 =,f10.4,5x,8hand b2 lect-390
     1=,f10.4,5x,20hcontribution of b1 =,f10.5)                         lect-391
 1021 format (19h surface:   power =,i3,5x,3hb =,f10.4,5x,18h decreasinglect-392
     3 rate =,f10.6,5x,25h non locality parameter =,f10.4)              lect-393
 1022 format (19h surface:   power =,i3,5x,18hdifference of b1 =,f10.4,5lect-394
     1x,8hand b2 =,f10.4)                                               lect-395
 1023 format (/24h integration step size =,f8.5,10x,17hmatching radius =lect-396
     1,f8.3,6h fermi)                                                   lect-397
 1024 format (/23h scattering angles from,f7.3,12h in steps of,f7.3,6h ulect-398
     1p to,f8.3,28h degrees   averaged with +/-,f8.3,8h degrees/)       lect-399
 1025 format (10x,16h****** az ******,e15.8)                            lect-400
 1026 format (/42h square root of elastic enhancement factor,8x,e15.8/23lect-401
     1h spin cut-off parameter,27x,e15.8/39h square root of level densitlect-402
     2y parameter,11x,e15.8)                                            lect-403
 1027 format (/63h square root of elastic enhancement factor without flulect-404
     1ctuations,7x,e15.8/45h particle width fluctuation degree of freedolect-405
     2m,25x,e15.8/)                                                     lect-406
 1028 format (/i5,13h fission data)                                     lect-407
 1029 format (10x,2e15.8)                                               lect-408
 1030 format (/11h gamma data)                                          lect-409
 1031 format (5x,4htg0:,e13.6,6x,3hbn:,e13.6,4x,5hfnug:,e13.6,5x,4hegd:,lect-410
     1e13.6,5x,4hggd:,e13.6)                                            lect-411
 1032 format (27h density of states given by/6x,3hsa:,e13.6,6x,3hux:,e13lect-412
     1.6,5x,4htau:,e13.6,6x,3hsg:,e13.6/28x,3he0:,e13.6,6x,3hex:,e13.6,7lect-413
     2x,2hz:,f5.0)                                                      lect-414
 1033 format (8e15.8)                                                   lect-415
 1034 format (41h density of states for continuum given by)             lect-416
 1035 format (12h read values/(1x,i3,5h  sa:,e13.6,6x,3hux:,e13.6,5x,4htlect-417
     1au:,e13.6,6x,3hsg:,e13.6/28x,3he0:,e13.6,6x,3hex:,e13.6,7x,2hz:,f5lect-418
     2.0))                                                              lect-419
 1036 format (6h iqm =,i3,11h or iqmax =,i3,78h are larger than the maxilect-420
     1mum values 35 or 8 of the asymmetric rotational model)            lect-421
 1037 format (//22h in lect  ... stop ...)                              lect-422
      end                                                               lect-423
c 05/10/96  ibm version   cdc with 'c' to double precision      ecis96  deph-000
      subroutine deph(ncoll,ncols,sp,wv,ipi,mf,fm,ms1,ms2,nct,kcc,kba,kadeph-001
     1b,kbc,ktgr,ngr,npr,jtx,idmt,niv,njc,njx,njy,nmax,lo)              deph-002
c helicity quantum numbers and choice of observables for the output     deph-003
c input variables: ncoll:  number of coupled nuclear levels             deph-004
c                  ncols:  number of levels with angular distribution   deph-005
c                  sp,wv,ipi:     see calx                              deph-006
c                  ngr:    indication for plots of cross-section: numberdeph-007
c                          of powers of 10 by 100 points                deph-008
c                  npr:    indications for plots of polarisations:      deph-009
c                          1 first one,2 second,3 first and second ..etcdeph-010
c          on a binary basis. the first value of ngr and npr is for the deph-011
c          ground state and the second one for the excited states       deph-012
c                  idmt:   size of working field                        deph-013
c                  nmax:   maximum number of amplitudes                 deph-014
c                  lo:     logical controls                             deph-015
c output variables:mf,fm:  in equivalence by call  -  table of quantum  deph-016
c                          numbers and observables                      deph-017
c                  ipi(j=5 to 8,i): beginning and end for each level in deph-018
c                       the two parts of the table mf-fm                deph-019
c                  ms1,ms2:   largest particle and target multiplicitiesdeph-020
c                  nct:   number of equations for each parity in 1 and 2deph-021
c                         number of solutions for each parity in 3 and 4deph-022
c                         number of comp. nucl. coeff. in 5 and 6       calx-106
c                  kcc:   number of independent compound nucleus coeff. deph-023
c                  kba:   number of independent coupled amplitudes      deph-024
c                  kab:   maximum number of coupled equations           deph-025
c                  kbc:   maximum number of solutions needed            deph-026
c                  ktgr:  length of the table mf-fm                     deph-027
c                  jtx:   maximum number of kinds of polarisation       deph-028
c                  niv(*,*,3): address of coulomb integrals             deph-029
c                  njc:    1+maximum number of observ. at equid. angles deph-030
c                  njx:    number of sets of coulomb funct. and integraldeph-031
c                  njy:    maximum label of non standard observable     deph-032
c                                                                       deph-033
c   **** table mf-fm **** first part                                    deph-034
c for each independent amplitude (with respect to parity only)          deph-035
c  mf(1,*)  helicity of the outgoing particle                           deph-036
c  mf(2,*)  helicity of the residual target                             deph-037
c  mf(3,*)  helicity of the incoming particle                           deph-038
c  mf(4,*)  helicity of the target                                      deph-039
c    these helicities are numbered from the lowest value                deph-040
c  fm(5,*)  parity related amplitudes:0 none,1 or -1 one with this sign deph-041
c  fm(6,*)  magnetic quantum number of the rotation matrix elements     deph-042
c    related to the initial state                                       deph-043
c  fm(7,*)  magnetic quantum number of the rotation matrix elements for deph-044
c    the final state; however, with absolute value .25, it indicates    deph-045
c    that the last computed matrix elements can be used with the        deph-046
c    sign of fm(7,*).  a re-ordering of the helicities has been done    deph-047
c  m(8,*)  direct address of the amplitude in an one-row matrix         deph-048
c  m(9,*)  direct address of the parity related amplitude               deph-049
c***********************************************************************deph-050
      logical lo(250)                                                   deph-051
      double precision wv                                               deph-052
      dimension sp(3,1),ipi(10,1),mf(9,1),fm(9,1),ngr(2),npr(2),niv(ncoldeph-053
     1l,ncoll,3),wv(15,1),nct(6)                                        deph-054
      njc=2                                                             deph-055
      njy=0                                                             deph-056
      jtx=0                                                             deph-057
      nct(5)=0                                                          deph-059
      nct(6)=0                                                          deph-058
      kcc=0                                                             deph-060
      ms1=0                                                             deph-061
      ms2=0                                                             deph-062
      ni=ipi(2,1)                                                       deph-063
      mi=ipi(3,1)                                                       deph-064
c loop on the nuclear levels                                            deph-065
      do 15 i=1,ncols                                                   deph-066
      ip=mod(ipi(1,i)+ipi(1,1),2)                                       deph-067
      ki=kcc+1                                                          deph-068
      ipi(5,i)=ki                                                       deph-069
      nj=ipi(2,i)                                                       deph-070
      mj=ipi(3,i)                                                       deph-071
      ms1=max0(ms1,nj)                                                  deph-072
      ms2=max0(ms2,mj)                                                  deph-073
      do 12 i1=1,nj                                                     deph-074
      j1=nj+1-i1                                                        deph-075
      do 11 i2=1,mj                                                     deph-076
      j2=mj+1-i2                                                        deph-077
      do 10 i3=1,ni                                                     deph-078
      j3=ni+1-i3                                                        deph-079
      do 9 i4=1,mi                                                      deph-080
      j4=mi+1-i4                                                        deph-081
      if (kcc.lt.ki) go to 3                                            deph-082
c search for parity conjugate among the amplitudes already obtained     deph-083
      do 1 j=ki,kcc                                                     deph-084
      if ((mf(1,j).eq.j1).and.(mf(2,j).eq.j2).and.(mf(3,j).eq.j3).and.(mdeph-085
     1f(4,j).eq.j4)) go to 2                                            deph-086
    1 continue                                                          deph-087
      go to 3                                                           deph-088
    2 fm(5,j)=1-2*mod(ip+j1+i2+j3+i4,2)                                 deph-089
      mf(9,j)=i1+nj*(i2-1+mj*(i4-1+mi*(i3-1)))                          deph-090
      go to 9                                                           deph-091
c new amplitude                                                         deph-092
    3 kcc=kcc+1                                                         deph-093
      if (9*kcc.ge.nmax) call memo(idmt,idmt+9,nmax,3,lo)               deph-094
      if (lo(216)) go to 37                                             deph-095
      mf(1,kcc)=i1                                                      deph-096
      mf(2,kcc)=i2                                                      deph-097
      mf(3,kcc)=i3                                                      deph-098
      mf(4,kcc)=i4                                                      deph-099
      fm(5,kcc)=0.                                                      deph-100
      fm(6,kcc)=mf(3,kcc)-mf(4,kcc)-sp(1,1)+sp(2,1)                     deph-101
      fm(7,kcc)=mf(1,kcc)-mf(2,kcc)-sp(1,i)+sp(2,i)                     deph-102
      mf(8,kcc)=i1+nj*(i2-1+mj*(i4-1+mi*(i3-1)))                        deph-103
      if (kcc.le.ki) go to 9                                            deph-104
c search for related rotation matrix elements                           deph-105
      kk=kcc-1                                                          deph-106
      m1=abs(fm(6,kcc)+fm(7,kcc))+.1                                    deph-107
      m2=abs(fm(6,kcc)-fm(7,kcc))+.1                                    deph-108
      do 8 j=ki,kk                                                      deph-109
      if (abs(fm(7,j)).eq..25) go to 8                                  deph-110
      m3=abs(fm(6,j)+fm(7,j))+.1                                        deph-111
      m4=abs(fm(6,j)-fm(7,j))+.1                                        deph-112
      if (m1.ne.m3.or.m2.ne.m4) go to 8                                 deph-113
      m3=abs(fm(6,j)-fm(6,kcc)+fm(7,kcc)-fm(7,j))+.1                    deph-114
      fm(7,kcc)=1-mod(m3,4)                                             deph-115
      fm(7,kcc)=.25*fm(7,kcc)                                           deph-116
      ja=j+1                                                            deph-117
      if (ja.eq.kcc) go to 9                                            deph-118
c permutation of amplitudes                                             deph-119
      do 7 m1=1,9                                                       deph-120
      if ((m1.gt.4).and.(m1.lt.8)) go to 5                              deph-121
      m2=mf(m1,kcc)                                                     deph-122
      do 4 m3=ja,kcc                                                    deph-123
      m4=kcc+ja-m3                                                      deph-124
    4 mf(m1,m4)=mf(m1,m4-1)                                             deph-125
      mf(m1,ja)=m2                                                      deph-126
      go to 7                                                           deph-127
    5 f2=fm(m1,kcc)                                                     deph-128
      do 6 m3=ja,kcc                                                    deph-129
      m4=kcc+ja-m3                                                      deph-130
    6 fm(m1,m4)=fm(m1,m4-1)                                             deph-131
      fm(m1,ja)=f2                                                      deph-132
    7 continue                                                          deph-133
      go to 9                                                           deph-134
    8 continue                                                          deph-135
    9 continue                                                          deph-136
   10 continue                                                          deph-137
   11 continue                                                          deph-138
   12 continue                                                          deph-139
      ipi(6,i)=kcc                                                      deph-140
c computation of the number of coupled equations                        deph-141
      l=nj*mj                                                           deph-142
      kk1=l/2                                                           deph-143
      kk2=l-kk1                                                         deph-144
      if (kk1.eq.kk2) go to 13                                          deph-145
      n=mj/2+nj/2+ipi(1,i)                                              deph-146
      if (2*(n/2).eq.n) go to 13                                        deph-147
      kk1=kk1+1                                                         deph-148
      kk2=kk1-1                                                         deph-149
   13 nct(5)=nct(5)+kk2                                                 deph-151
      nct(6)=nct(6)+kk1                                                 deph-150
      if (i.ne.1) go to 14                                              deph-152
      nct(3)=nct(5)                                                     deph-154
      nct(4)=nct(6)                                                     deph-153
   14 if (i.ne.ncoll) go to 15                                          deph-155
      nct(1)=nct(5)                                                     deph-154
      nct(2)=nct(6)                                                     deph-153
      kab=max0(nct(1),nct(2))                                           deph-156
      kbc=max0(nct(3),nct(4))                                           deph-157
      if (nct(4).eq.0) kab=nct(1)                                       deph-158
      if (nct(3).eq.0) kab=nct(2)                                       deph-159
      kba=kcc                                                           deph-160
   15 continue                                                          deph-161
      if (kba.ne.kcc) go to 16                                          deph-162
      write (2,1000) kbc,kab,kba                                        deph-163
      go to 17                                                          deph-164
   16 write (2,1001) kbc,kab,kba,kcc                                    deph-165
   17 ktgr=kcc                                                          deph-166
      ipi(8,ncols)=ipi(6,ncols)                                         deph-167
      if (lo(66)) go to 29                                              deph-168
c***********************************************************************deph-169
c   **** table mf-fm **** second part                                   deph-170
c  this part of the table is prolongated in lecd and will be updated    deph-171
c  by obse      - for each observable                                   deph-172
c  mf(1,*)  kind of observable                                          deph-173
c  mf(2,*)  level                                                       deph-174
c  mf(5,*)  indication for graphs                                       deph-175
c  ****standard options****                                             deph-176
c for all states : cross section                                        deph-177
c for ground state with charged particles: cross section divided by     deph-178
c       rutherford's cross-section                                      deph-179
c for spin 1/2 - ground state  polarisation                             deph-180
c for spin 1/2 excited states  vect. ana. power,polar. and spin-flip    deph-181
c for spin larger than 1/2  ground state it11,t20,t21 and t22           deph-182
c for excited states,it11,vect. polar.,t20,t21,t22                      deph-183
c  *** non-standard options ***                                         deph-184
c  the first one must be the cross-section                              deph-185
c any observable not described below is identified by a negative number deph-186
c  of which the positive value must be found by obse                    deph-187
c  followed by the description of the observable                        deph-188
c **** standard descriptions ****                                       deph-189
c 0  cross section                                                      deph-190
c 1  cross section divided by rutherford's cross section                deph-191
c 2  vector analysing power                                             deph-192
c 3  vector polarisation                                                deph-193
c 4  t20     5  t21     6  t22                                          deph-194
c 7  spin-flip defined as (a(0000 0000)+a(1100 1100)+a(1100 1-100))/2   deph-195
c***********************************************************************deph-196
      kx=kcc                                                            deph-197
      iy=1                                                              deph-198
      if (lo(194)) go to 18                                             deph-199
      read (1,1002) (ipi(8,i),i=1,ncoll)                                deph-200
      write (2,1003) (i,ipi(8,i),i=1,ncoll)                             deph-201
   18 do 28 i=1,ncoll                                                   deph-202
      if (lo(94)) go to 23                                              deph-203
c there must be at least place to store six observables                 deph-204
      if (9*kx+54.ge.nmax) call memo(idmt,idmt+9*kx+54-nmax,nmax,3,lo)  deph-205
      if (lo(216)) go to 37                                             deph-206
      kx=kx+1                                                           deph-207
      ipi(8,i)=1                                                        deph-208
      mf(1,kx)=0                                                        deph-209
      if ((i.ne.1).or.(sp(3,1).eq.0.)) go to 19                         deph-210
      ipi(8,1)=2                                                        deph-211
      kx=kx+1                                                           deph-212
      mf(1,kx)=1                                                        deph-213
   19 mf(5,kx)=ngr(iy)                                                  deph-214
      if (ni.eq.1) go to 23                                             deph-215
      ipi(8,i)=ipi(8,i)+1                                               deph-216
      kx=kx+1                                                           deph-217
      mf(1,kx)=2                                                        deph-218
      ix=npr(iy)/2                                                      deph-219
      mf(5,kx)=npr(1)-2*ix                                              deph-220
      if (ni.gt.2) go to 21                                             deph-221
      if (i.eq.1) go to 23                                              deph-222
      if (ipi(2,i).gt.3) go to 20                                       deph-223
      if (ipi(2,i).eq.1) go to 23                                       deph-224
      ipi(8,i)=ipi(8,i)+1                                               deph-225
      kx=kx+1                                                           deph-226
      mf(1,kx)=3                                                        deph-227
      mf(5,kx)=mod(ix,2)                                                deph-228
      ix=ix/2                                                           deph-229
   20 kx=kx+1                                                           deph-230
      mf(1,kx)=7                                                        deph-231
      mf(5,kx)=mod(ix,2)                                                deph-232
      ipi(8,i)=ipi(8,i)+1                                               deph-233
      go to 23                                                          deph-234
   21 ipi(8,i)=ipi(8,i)+3                                               deph-235
      do 22 l=4,6                                                       deph-236
      kx=kx+1                                                           deph-237
      mf(1,kx)=l                                                        deph-238
      mf(5,kx)=mod(ix,2)                                                deph-239
   22 ix=ix/2                                                           deph-240
   23 k1=ktgr+1                                                         deph-241
      ipi(7,i)=k1                                                       deph-242
      ktgr=ktgr+ipi(8,i)                                                deph-243
      ipi(8,i)=ktgr                                                     deph-244
      if (9*ktgr.ge.nmax) call memo(idmt,idmt+9*ktgr-nmax,nmax,3,lo)    deph-245
      if (lo(216)) go to 37                                             deph-246
      do 24 j=k1,ktgr                                                   deph-247
   24 mf(2,j)=i                                                         deph-248
      if (lo(194)) go to 26                                             deph-249
      read (1,1002) (mf(1,j),j=k1,ktgr)                                 deph-250
      if (mf(1,k1).ne.0) write (2,1004)                                 deph-251
      read (1,1002) (mf(5,j),j=k1,ktgr)                                 deph-252
      mf(1,k1)=0                                                        deph-253
      write (2,1005) i,(mf(1,j),j=k1,ktgr)                              deph-254
      write (2,1006) (mf(5,j),j=k1,ktgr)                                deph-255
      do 25 j=k1,ktgr                                                   deph-256
      if (mf(1,j).gt.7) go to 36                                        deph-257
   25 continue                                                          deph-258
   26 jt=0                                                              deph-259
      do 27 j=k1,ktgr                                                   deph-260
      njy=max0(njy,-mf(1,j))                                            deph-261
      if (mf(1,j).eq.0.or.mf(1,j).eq.1) go to 27                        deph-262
      jt=jt+1                                                           deph-263
   27 continue                                                          deph-264
      jtx=max0(jtx,jt)                                                  deph-265
      njc=max0(njc,ktgr-k1+2)                                           deph-266
   28 iy=2                                                              deph-267
      if (lo(81)) njc=max0(njc+2,6)                                     deph-268
   29 iy=0                                                              deph-269
      if (lo(44)) iy=1                                                  deph-270
      if (lo(46).and.lo(44)) write (2,1007)                             deph-271
      do 32 i=1,ncoll                                                   deph-272
      if (lo(46).and.lo(44)) go to 31                                   deph-273
      do 30 j=1,ncoll                                                   deph-274
   30 niv(i,j,3)=iy                                                     deph-275
      if (lo(208)) niv(i,i,3)=1                                         deph-276
      go to 32                                                          deph-277
   31 read (1,1002) (niv(i,j,3),j=1,ncoll)                              deph-278
      write (2,1008) i,(j,niv(i,j,3),j=1,ncoll)                         deph-279
   32 continue                                                          deph-280
      nj=njx                                                            deph-281
      do 34 i=1,ncoll                                                   deph-282
      do 33 j=1,i                                                       deph-283
      l=niv(i,j,3)                                                      deph-284
      niv(i,j,3)=0                                                      deph-285
c no coul. corr. with diff. particle mass, charges or a closed channel  deph-286
      if (l.eq.0.or.sp(3,i).ne.sp(3,j).or.wv(1,i).ne.wv(1,j).or.wv(3,i).deph-287
     1lt.0..or.wv(3,j).lt.0.) go to 33                                  deph-288
      njx=njx+1                                                         deph-289
      niv(i,j,3)=njx                                                    deph-290
   33 niv(j,i,3)=niv(i,j,3)                                             deph-291
   34 continue                                                          deph-292
      if (nj.eq.njx) return                                             deph-293
      write (2,1009)                                                    deph-294
      do 35 i=1,ncoll                                                   deph-295
   35 write (2,1010) i,(niv(i,j,3),j,j=1,ncoll)                         deph-296
      return                                                            deph-297
   36 write (2,1011)                                                    deph-298
   37 write (2,1012)                                                    deph-299
      stop                                                              deph-300
 1000 format (/5x,i3,10h solutions,i10,18h coupled equations,i10,23h inddeph-301
     1ependent amplitudes/)                                             deph-302
 1001 format (/5x,i3,10h solutions,i10,18h coupled equations,i10,23h inddeph-303
     1ependent amplitudes,i10,24h sets of compound coeff./)             deph-304
 1002 format (14i5)                                                     deph-305
 1003 format (/26h equidistant angles output//(10x,7hchannel,i3,5x,i3,12deph-306
     1h observables))                                                   deph-307
 1004 format (56h the first observable must be the cross section: label deph-308
     10)                                                                deph-309
 1005 format (24h observables for channel,i3,4h  : ,18i5/(24x,18i5))    deph-310
 1006 format (12x,19hgraph information: ,18i5/(24x,18i5))               deph-311
 1007 format (/35h coulomb corrections ( 1=yes, 0=no))                  deph-312
 1008 format (4h i =,i2,4x,10(4h j =,i2,1h:,i1,2x)/(10x,10(4h j =,i2,1h:deph-313
     1,i1,2x)))                                                         deph-314
 1009 format (/31h storage of coulomb corrections)                      deph-315
 1010 format (4h i =,i2,2x,6(i6,8h for j =,i2)/(10x,6(i6,8h for j =,i2))deph-316
     1)                                                                 deph-317
 1011 format (//75h the standard observables are only 7  for any other gdeph-318
     1ive a negative integer)                                           deph-319
 1012 format (//22h in deph  ... stop ...)                              deph-320
      end                                                               deph-321
c 23/03/88  ibm and cdc version                                 ecis88  lecd-000
      subroutine lecd(ncoll,ncolr,ktg,mf,fm,donn,np,ntot,jtx,njz,idmt,nmlecd-001
     1ax,lo)                                                            lecd-002
c input of experimental data                                            lecd-003
c input variables: ncoll: number of nuclear levels                      lecd-004
c                  ncolr: number of angular distributions               lecd-005
c                  ktg:   starting address in table mf(9,1)=fm(9,1) for lecd-006
c          experimental angular distributions   (see deph)              lecd-007
c          from ktg to ktg+ncolr-1  description of observables          lecd-008
c          from ktg+ncolr  channel, beginning and end of data, indica-  lecd-009
c          tion c.m./lab as 0/1, weight, norm and its error; then place lecd-010
c          for calculated normalisation and chi2                        lecd-011
c                  np:    indications for plots of cross-section        lecd-012
c                  jtx:   maximum number of angles for a graph          lecd-013
c                  njz:   maximum index of non standard observable      lecd-014
c                  idmt:  length of working space                       lecd-015
c                  nmax:  maximum number of data for the working space  lecd-016
c                  lo:    logical controls. if lo(72)=.true. no output olecd-017
c                         experimental data                             lecd-018
c output variables:jtx:   maximum number of angles for a graph          lecd-019
c                  njz:   maximum index of non standard observable      lecd-020
c                  mf,fm: see above comments on ktg                     lecd-021
c                  donn:  experimental data: angle, value, error,       lecd-022
c                         angular width and place for corrected error   lecd-023
c                  ntot:  number of experimental data                   lecd-024
c      if the number of data for an observable is 0,it is summed        lecd-025
c      with the next observable which must be of the same kind          lecd-026
c***********************************************************************lecd-027
      logical lo(250),lt,lx                                             lecd-028
      dimension donn(6,1),fm(9,1),mf(9,1),np(2)                         lecd-029
      lt=.true.                                                         lecd-030
      ntot=0                                                            lecd-031
      do 4 ix=1,ncolr                                                   lecd-032
      iy=ix+ktg                                                         lecd-033
      iv=iy+ncolr                                                       lecd-034
c input of the definition of the angular distribution                   lecd-035
      lx=.false.                                                        lecd-036
      read (1,1000) lx,mf(4,iv),nt,mf(1,iv),mf(1,iy),(fm(j,iv),j=5,7)   lecd-037
      if (fm(5,iv).eq.0.) fm(5,iv)=1.                                   lecd-038
      if (fm(6,iv).eq.0.) fm(6,iv)=1.                                   lecd-039
      mf(2,iy)=mf(1,iv)                                                 lecd-040
      jtx=max0(jtx,nt)                                                  lecd-041
      njz=max0(njz,-mf(1,iy))                                           lecd-042
      mf(5,iy)=1                                                        lecd-043
      mf2=min0(2,mf(1,iv))                                              lecd-044
      if (mf(1,iy).eq.0.or.mf(1,iy).eq.1) mf(5,iy)=np(mf2)              lecd-045
      if (lo(172).and.nt.eq.0) write (2,1001) ix,nt,mf(1,iv),mf(1,iy)   lecd-046
      if (.not.lt.and.(mf(1,iy).ne.mf(1,iy-1))) go to 5                 lecd-047
      lt=nt.ne.0                                                        lecd-048
      ns=ntot+1                                                         lecd-049
      ntot=ntot+nt                                                      lecd-050
      mf(2,iv)=ns                                                       lecd-051
      mf(3,iv)=ntot                                                     lecd-052
      if (.not.lt) go to 4                                              lecd-053
      if (lo(172)) write (2,1002) ix,nt,mf(1,iv),mf(1,iy),(fm(i,iv),i=5,lecd-054
     17)                                                                lecd-055
      if (lo(172).and.(mf(1,iy).eq.8)) write (2,1003)                   lecd-056
      lx=lx.and.(mf(1,iy).eq.0.or.mf(1,iy).eq.1)                        lecd-057
      if (lo(172).and.lx) write (2,1004)                                lecd-058
      if (lo(172).and.mf(4,iv).eq.1) write (2,1005)                     lecd-059
      if (6*ntot+6.ge.nmax) call memo(idmt,idmt+6*ntot+6-nmax,nmax,3,lo)lecd-060
      if (lo(216)) go to 9                                              lecd-061
c input of the angular distribution data                                lecd-062
      do 1 i=ns,ntot                                                    lecd-063
      read (1,1006) (donn(j,i),j=1,5)                                   lecd-064
      if (lx) donn(3,i)=donn(2,i)*donn(3,i)*.01                         lecd-065
      donn(6,i)=donn(3,i)                                               lecd-066
      if (lo(172)) write (2,1007) i,(donn(j,i),j=1,5)                   lecd-067
    1 continue                                                          lecd-068
      if (mf(1,iv).gt.ncoll) go to 6                                    lecd-069
      if (mf(1,iy).gt.8) go to 7                                        lecd-070
      if (mf(1,iy).lt.8) go to 3                                        lecd-071
c check of total cross-section data                                     lecd-072
      do 2 i=ns,ntot                                                    lecd-073
      j=donn(1,i)+.1                                                    lecd-074
      if (j.lt.0.or.j.gt.ncoll) go to 8                                 lecd-075
    2 continue                                                          lecd-076
    3 if (fm(7,iv).eq.0.) go to 4                                       lecd-077
      ntot=ntot+1                                                       lecd-078
c normalisation as a data for the search                                lecd-079
      donn(2,ntot)=fm(6,iv)                                             lecd-080
      donn(3,ntot)=fm(7,iv)                                             lecd-081
      if (lo(172)) write (2,1008) ntot,donn(2,ntot),donn(3,ntot)        lecd-082
    4 continue                                                          lecd-083
      if (lt) return                                                    lecd-084
      write (2,1009)                                                    lecd-085
      go to 9                                                           lecd-086
    5 write (2,1010) mf(1,iy),mf(1,iy-1)                                lecd-087
      go to 9                                                           lecd-088
    6 write (2,1011)                                                    lecd-089
      go to 9                                                           lecd-090
    7 write (2,1012)                                                    lecd-091
      go to 9                                                           lecd-092
    8 write (2,1013) donn(1,i),i                                        lecd-093
    9 write (2,1014)                                                    lecd-094
      stop                                                              lecd-095
 1000 format (l1,i1,i3,2i5,5x,3f10.5)                                   lecd-096
 1001 format (/13h  ang. distr.,i3,i9,15h data   level =,i3,5x,6hkind =,lecd-097
     1i3,34h unresolved with the following one/)                        lecd-098
 1002 format (/13h  ang. distr.,i3,i9,15h data   level =,i3,5x,6hkind =,lecd-099
     1i3//5x,6hweight,e12.4,5x,4hnorm,e12.4,12h  with error,e12.4//23x,5lecd-100
     2hangle,14x,5hvalue,15x,5herror,12x,10hang. width,10x,10hang. errorlecd-101
     3/)                                                                lecd-102
 1003 format (36h these data are total cross-sections)                  lecd-103
 1004 format (27h input of percentage errors)                           lecd-104
 1005 format (32h angles in the laboratory system)                      lecd-105
 1006 format (6f10.5)                                                   lecd-106
 1007 format (5x,i5,5e20.6)                                             lecd-107
 1008 format (5x,i5,30h data which is a normalisation,e20.6,11h with errlecd-108
     1or,e20.6)                                                         lecd-109
 1009 format (//47h  the last angular distribution include no data)     lecd-110
 1010 format (//11h the kind =,i3,49h of this observable is not the samelecd-111
     1 as the kind =,i3,36h of the previous one which was empty)        lecd-112
 1011 format (//23h level number too large)                             lecd-113
 1012 format (//48h there are only 8 kind of programmed observables//75hlecd-114
     1  for other kinds, introduce a negative number  and,later,their delecd-115
     2scription)                                                        lecd-116
 1013 format (13h angular data,f10.5,4h for,i4,41h data not allowed for lecd-117
     1total cross-section)                                              lecd-118
 1014 format (//22h in lecd  ... stop ...)                              lecd-119
      end                                                               lecd-120
c 03/04/98  ibm version                                         ecis97  obse-000
      subroutine obse(mf,nt,ncolr,ipi,am,itx,bm,nx,jcal,jtn,idmt,lo)    obse-001
c computes for each observable all the indications for do loops and the obse-002
c geometrical coefficients needed in scat                               obse-003
c input variables: mf:     informations coming from deph and lecd       obse-004
c                  nt:     number of rows of mf                         obse-005
c                  ncolr:  number of experimental angular distributions obse-006
c                  ipi(j=2,3,i): multiplicity of particle and target    obse-007
c                  jtn:    length available in am                       obse-008
c                  idmt:   total length of working field                obse-009
c                  lo:     logical controls                             obse-010
c      the subroutine returns lo(226)=.true. if there is an observable  obse-011
c  not in the center of mass system.                                    obse-012
c output variables:am:     see description below                        obse-013
c                  jcal:   length of am                                 obse-014
c working fields:  bm(9,*) and nx(18,*) in equivalence by call          obse-015
c                  the results are stored after the working field       obse-016
c                  and copied in am before return.                      obse-017
c                  itx(7,*) to store legends, in equivalence with am    obse-018
c as input,mf(1,i)=0 to 8 for a standard observable or a negative       obse-019
c     number for non standard observable of which the description       obse-020
c     has to be read with the control number -mf(1,i)                   obse-021
c     however, mf(1,i)=8 for a set of experimental data which are cross-obse-022
c     sections. it keeps this value.                                    obse-023
c     mf(5,i)= indication for plots                                     obse-024
c as output mf(1,i)=0 for cross-section,1 for c.-s./ruth.,-2 and -3     obse-025
c     for vector analysing power and polarisation for spins not greater obse-026
c     than 1                                                            obse-027
c     mf(2,i)             indication for plots                          obse-028
c     mf(3,i) and mf(4,i) beginning and end of the description in am    obse-029
c     mf(5,i) to mf(9,i)  contains the legend                           obse-030
c***********************************************************************obse-031
c  the first part of the am table is sets of 10 d. p. indications,each  obse-032
c     of them related to a single 'a' - the 8 first are indications for obse-033
c     the 4 do loops, 9 is a set of 6 logical in a binary code and indi-obse-034
c     cation for change of frame for the particle and the target under  obse-035
c     the form n1+1000*n2, 10 is the amplitude.                         obse-036
c  the second part are tensor operator matrix elements.                 obse-037
c       indications for a do loop are 4 integer                         obse-038
c        im: lower bound                                                obse-039
c        ip: upper bound                                                obse-040
c        nm: difference of magnetic quantum numbers                     obse-041
c        il: when added to the index of the do loop,address of the      obse-042
c             matrix element from the top of table am                   obse-043
c       the 4 first logicals  are .true. if there is a tensor operator  obse-044
c        for the related do loop,.false. for identity operator.         obse-045
c        the fifth is .true. for no tensor operator at all              obse-046
c        the sixth is .true. for pure imaginary coefficient             obse-047
c       indication for change of frame are                              obse-048
c            1 for laboratory system                                    obse-049
c            2 for axis along the incident direction                    obse-050
c***********************************************************************obse-051
      logical lt1,lt2,lz(6),lo(250)                                     obse-052
      dimension iy(7,9),itx(7,1),mt(4),ipi(10,1),mf(9,1),nx(18,1),mx(8,9obse-053
     1),nz(2)                                                           obse-054
      double precision am(1),bm(9,1),fs,cx(9),e1,e2,e3,f1,f2,f3,d1,d2,c1obse-055
     1,c2,fj                                                            obse-056
      data iy /2*1,4h  cr,4hoss-,4hsect,4hion ,4h    ,2*1,4h   c,4h. s.,obse-057
     14h/rut,4hher.,4h    ,2*2,4h    ,4hasym,4h. or,4h it1,4h1   ,2*3,4hobse-058
     2    ,4h vec,4ht. p,4holar,4h.   ,2*4,3*4h    ,4ht20 ,4h    ,2*5,3*obse-059
     34h    ,4ht21 ,4h    ,2*6,3*4h    ,4ht22 ,4h    ,7,9,4h    ,4h    ,obse-060
     44hspin,4h-fli,4hp   ,2*1,4htota,4hl cr,4hoss-,4hsect,4h.   /      obse-061
      data cx,jts /6*1.d0,3*0.5d0,0/                                    obse-062
      data mx /8*0,2*1,10*0,2*1,2*0,2,7*0,2,1,6*0,2*2,14*0,2*1,2*0,2*1,2obse-063
     1*0,2*1,2*0,1,-1,2*0/                                              obse-064
      if (jtn.lt.162) call memo(idmt,idmt+jtn-162,jtn,3,lo)             obse-065
      if (lo(216)) go to 91                                             obse-066
c transfer of standard descriptions                                     obse-067
      do 3 i=1,9                                                        obse-068
      do 1 j=1,8                                                        obse-069
    1 nx(j+6,i)=mx(j,i)                                                 obse-070
      do 2 j=1,7                                                        obse-071
    2 itx(j,i)=iy(j,i)                                                  obse-072
    3 bm(3,i)=cx(i)                                                     obse-073
      lo(226)=.false.                                                   obse-074
      kit=9                                                             obse-075
      knx=9                                                             obse-076
      jcal=0                                                            obse-077
      mt(1)=ipi(2,1)                                                    obse-078
      mt(2)=ipi(3,1)                                                    obse-079
c verification of indications already in mf(1,i)                        obse-080
      do 4 i=1,nt                                                       obse-081
      if (mf(1,i).le.7) go to 4                                         obse-082
      if (mf(1,i).eq.8.and.nt-i.ge.ncolr) go to 82                      obse-083
      if (mf(1,i).gt.8) go to 83                                        obse-084
    4 mf(6,i)=0                                                         obse-085
      if (lo(194).and.lo(131)) go to 55                                 obse-086
c search for non standard observables                                   obse-087
    5 do 6 l=1,nt                                                       obse-088
      if (mf(1,l).lt.0) go to 7                                         obse-089
    6 continue                                                          obse-090
      go to 55                                                          obse-091
    7 kz=kit                                                            obse-092
      kit=kit+1                                                         obse-093
c input of the description of non standard observables                  obse-094
      lt1=.false.                                                       obse-095
      lt2=.false.                                                       obse-096
      read (1,1000) lt1,lt2,lt3,kx,k,(itx(j,kit),j=3,7)                 obse-097
      k1=knx+1                                                          obse-098
      knx=knx+k                                                         obse-099
      if (18*knx.gt.jtn) call memo(idmt,idmt+18*knx-jtn,jtn,3,lo)       obse-100
      if (lo(216)) go to 91                                             obse-101
      read (1,1001) ((nx(j,i),j=7,14),i=k1,knx)                         obse-102
      read (1,1002) (bm(3,i),i=k1,knx)                                  obse-103
      if (lt1.or.lt2) read (1,1002) (bm(1,i),i=k1,knx)                  obse-104
    8 k2=k1                                                             obse-105
      write (2,1003) kx,(itx(j,kit),j=3,7),k                            obse-106
      if (lt1) write (2,1004)                                           obse-107
      if (lt3.eq.1) write (2,1005)                                      obse-108
      if (lt3.eq.2) write (2,1006)                                      obse-109
      if (.not.lt2) go to 21                                            obse-110
c output of the description not completely in tensor notation           obse-111
c if lt2=.true. , observables can be defined as matrix elements         obse-112
c (mi,mf). in this case,the values read are (mi-s-1,mf-s-1) instead of  obse-113
c the quantum numbers of tensor operator.                               obse-114
      write (2,1007)                                                    obse-115
    9 k3=min0(k2+5,knx)                                                 obse-116
      write (2,1008) ((nx(i,j),i=11,14),j=k2,k3)                        obse-117
      write (2,1009) (bm(3,i),i=k2,k3)                                  obse-118
      write (2,1010) ((nx(i,j),i=7,10),j=k2,k3)                         obse-119
      write (2,1011) (bm(1,i),i=k2,k3)                                  obse-120
      k2=k3+1                                                           obse-121
      if (k2.le.knx) go to 9                                            obse-122
      iv=mf(2,l)                                                        obse-123
      mt(3)=ipi(2,iv)                                                   obse-124
      mt(4)=ipi(3,iv)                                                   obse-125
      klt=1                                                             obse-126
c search for non tensor description - pseudo-loop for ij                obse-127
      ij=1                                                              obse-128
   10 k2=k1                                                             obse-129
      k6=knx                                                            obse-130
   11 if (k2.gt.k6) go to 13                                            obse-131
      do 12 k=k2,k6                                                     obse-132
      if (nx(2*ij+5,k).lt.0) go to 14                                   obse-133
   12 continue                                                          obse-134
   13 if (k6.ne.knx) go to 26                                           obse-135
      go to 19                                                          obse-136
c recurrence computation of (-)**(s-mf)*<s s mi -mf|l m>/sqrt(2*s+1)    obse-137
c starting with the minimum value of l                                  obse-138
   14 m1=mt(ij)+nx(2*ij+5,k)                                            obse-139
      m2=mt(ij)+nx(2*ij+6,k)                                            obse-140
      if (m1.lt.0.or.m2.lt.0) go to 84                                  obse-141
      m4=m1-m2                                                          obse-142
      m3=iabs(m4)+1                                                     obse-143
      m5=mt(ij)                                                         obse-144
      e2=0.d0                                                           obse-145
      e3=1.d0                                                           obse-146
      c1=m1+m2-mt(ij)+1                                                 obse-147
      d2=0.d0                                                           obse-148
      c2=0.d0                                                           obse-149
      do 17 m=m3,m5                                                     obse-150
      if (m.eq.m3) go to 15                                             obse-151
      e1=e2                                                             obse-152
      e2=e3                                                             obse-153
      d1=d2                                                             obse-154
      f1=((m-1)**2-m4**2)*(mt(ij)**2-(m-1)**2)                          obse-155
      f2=(2*m-1)*(2*m-3)                                                obse-156
      d2=dsqrt(f1/f2)                                                   obse-157
      e3=(c1*e2-d1*e1)/d2                                               obse-158
   15 knx=knx+1                                                         obse-159
      do 16 ji=7,14                                                     obse-160
   16 nx(ji,knx)=nx(ji,k)                                               obse-161
      nx(2*ij+5,knx)=m-1                                                obse-162
      nx(2*ij+6,knx)=m4                                                 obse-163
      c2=c2+e3*e3                                                       obse-164
   17 bm(1,knx)=e3                                                      obse-165
c normalisation and sign given by coefficient for maximum value of l    obse-166
      c2=c2*mt(ij)                                                      obse-167
      c2=1.d0/dsqrt(c2)                                                 obse-168
      if (e3.lt.0.d0) c2=-c2                                            obse-169
      if (mod(nx(2*ij+6,k),2).eq.0) c2=-c2                              obse-170
      do 18 m=m3,m5                                                     obse-171
      ji=knx+m-m5                                                       obse-172
      bm(3,ji)=bm(3,k)*bm(1,ji)*c2                                      obse-173
   18 bm(1,ji)=bm(1,k)*bm(1,ji)*c2                                      obse-174
      bm(3,k)=0.d0                                                      obse-175
      bm(1,k)=0.d0                                                      obse-176
      k2=k+1                                                            obse-177
      go to 11                                                          obse-178
   19 ij=ij+1                                                           obse-179
      if (ij.le.4) go to 10                                             obse-180
      k2=k1                                                             obse-181
      lt2=.false.                                                       obse-182
      if (lt1) go to 21                                                 obse-183
c if axis of quantification not in vertical plane, take imaginary       obse-184
c amplitude for pure imaginary tensors                                  obse-185
      do 20 k=k1,knx                                                    obse-186
      m1=nx(7,k)+nx(9,k)+nx(11,k)+nx(13,k)                              obse-187
      if (mod(m1,2).ne.0) bm(3,k)=bm(1,k)                               obse-188
   20 continue                                                          obse-189
   21 if (lt1) go to 34                                                 obse-190
c the first non zero magnetic quantum number must be positive           obse-191
      do 25 k4=k1,knx                                                   obse-192
      bm(1,k4)=0.d0                                                     obse-193
      do 22 j=8,14,2                                                    obse-194
      if (nx(j,k4)) 23 , 22 , 25                                        obse-195
   22 continue                                                          obse-196
      go to 25                                                          obse-197
   23 ik=0                                                              obse-198
      do 24 j=8,14,2                                                    obse-199
      ik=ik+nx(j-1,k4)+nx(j,k4)                                         obse-200
   24 nx(j,k4)=-nx(j,k4)                                                obse-201
      if (2*(ik/2).ne.ik) bm(3,k4)=-bm(3,k4)                            obse-202
   25 continue                                                          obse-203
      klt=2                                                             obse-204
c reduction of the description                                          obse-205
c for change into tensors if klt=1, for here if klt=2                   obse-206
c for change to axis in the reaction plane if klt=3                     obse-207
   26 if (k1.gt.knx) go to 85                                           obse-208
      do 29 k4=k1,knx                                                   obse-209
      if (dabs(bm(3,k4))+dabs(bm(1,k4)).lt..1d-6) go to 31              obse-210
      k5=k4-1                                                           obse-211
      if (k1.gt.k5) go to 29                                            obse-212
      do 28 j=k1,k5                                                     obse-213
      do 27 i=7,14                                                      obse-214
      if (nx(i,j).ne.nx(i,k4)) go to 28                                 obse-215
   27 continue                                                          obse-216
      go to 30                                                          obse-217
   28 continue                                                          obse-218
   29 continue                                                          obse-219
      go to ( 19 , 34 , 49 ),klt                                        obse-220
   30 bm(3,j)=bm(3,j)+bm(3,k4)                                          obse-221
      bm(1,j)=bm(1,j)+bm(1,k4)                                          obse-222
   31 knx=knx-1                                                         obse-223
      if (knx.lt.k4) go to 26                                           obse-224
      do 33 k=k4,knx                                                    obse-225
      do 32 j=7,14                                                      obse-226
   32 nx(j,k)=nx(j,k+1)                                                 obse-227
      bm(1,k)=bm(1,k+1)                                                 obse-228
   33 bm(3,k)=bm(3,k+1)                                                 obse-229
      go to 26                                                          obse-230
c output of the description                                             obse-231
   34 k3=min0(k2+5,knx)                                                 obse-232
      write (2,1008) ((nx(i,j),i=11,14),j=k2,k3)                        obse-233
      write (2,1012) (bm(3,i),i=k2,k3)                                  obse-234
      write (2,1010) ((nx(i,j),i=7,10),j=k2,k3)                         obse-235
      if (lt1) write (2,1011) (bm(1,i),i=k2,k3)                         obse-236
      k2=k3+1                                                           obse-237
      if (k2.le.knx) go to 34                                           obse-238
      do 36 k=k1,knx                                                    obse-239
      do 35 i=8,14,2                                                    obse-240
      if (iabs(nx(i,k)).gt.nx(i-1,k).or.nx(i-1,k).lt.0) go to 86        obse-241
   35 continue                                                          obse-242
   36 continue                                                          obse-243
      if (.not.lt1) go to 53                                            obse-244
c change from vertical axis of quantification to helicity description   obse-245
c by the rotation r(pi/2,pi/2,pi/2)                                     obse-246
      do 38 i=k1,knx                                                    obse-247
      m1=iabs(nx(8,i))+iabs(nx(10,i))+iabs(nx(12,i))+iabs(nx(14,i))     obse-248
      m2=m1/2                                                           obse-249
      if (2*m2.ne.m1) go to 87                                          obse-250
      if (2*(m2/2).eq.m2) go to 37                                      obse-251
      bm(3,i)=-bm(3,i)                                                  obse-252
      bm(1,i)=-bm(1,i)                                                  obse-253
   37 if (m1.eq.0) bm(1,i)=0.d0                                         obse-254
   38 continue                                                          obse-255
      klt=3                                                             obse-256
c pseudo-loop on ij to 49                                               obse-257
      ij=7                                                              obse-258
   39 j1=knx                                                            obse-259
      do 46 k3=k1,knx                                                   obse-260
      k=nx(ij,k3)                                                       obse-261
      n1=k+nx(ij+1,k3)+1                                                obse-262
      n=2*k+1                                                           obse-263
      e3=1.d0                                                           obse-264
      if (k.eq.0) go to 41                                              obse-265
c rotation matrix elements for pi/2                                     obse-266
      do 40 i=1,k                                                       obse-267
   40 e3=e3*.5d0                                                        obse-268
   41 c1=0.d0                                                           obse-269
      e2=0.d0                                                           obse-270
      fj=k                                                              obse-271
      fs=-fj                                                            obse-272
      do 42 i=1,n1                                                      obse-273
      if (i.eq.1) go to 42                                              obse-274
      c2=c1                                                             obse-275
      c1=(i-1)*(1+n-i)                                                  obse-276
      c1=dsqrt(c1)                                                      obse-277
      e1=e2                                                             obse-278
      e2=e3                                                             obse-279
      e3=(2.d0*fj*e2-e1*c2)/c1                                          obse-280
      fs=fs+1.d0                                                        obse-281
   42 f2=0.d0                                                           obse-282
      f3=e3                                                             obse-283
      d1=0.d0                                                           obse-284
      do 45 j=1,n                                                       obse-285
      if (j.eq.1) go to 43                                              obse-286
      d2=d1                                                             obse-287
      d1=(j-1)*(1+n-j)                                                  obse-288
      d1=dsqrt(d1)                                                      obse-289
      f1=f2                                                             obse-290
      f2=f3                                                             obse-291
      f3=(2.d0*fs*f2-f1*d2)/d1                                          obse-292
   43 j1=j1+1                                                           obse-293
      if (18*j1.gt.jtn) call memo(idmt,idmt+18*j1-jtn,jtn,3,lo)         obse-294
      if (lo(216)) go to 91                                             obse-295
      do 44 l=7,14                                                      obse-296
   44 nx(l,j1)=nx(l,k3)                                                 obse-297
      bm(3,j1)=f3*bm(3,k3)                                              obse-298
      bm(1,j1)=f3*bm(1,k3)                                              obse-299
   45 nx(ij+1,j1)=j-1-k                                                 obse-300
   46 continue                                                          obse-301
c reduction of the description                                          obse-302
      j2=k1-1                                                           obse-303
      j3=knx+1                                                          obse-304
      do 48 j4=j3,j1                                                    obse-305
      j2=j2+1                                                           obse-306
      do 47 l=7,14                                                      obse-307
   47 nx(l,j2)=nx(l,j4)                                                 obse-308
      bm(3,j2)=bm(3,j4)                                                 obse-309
   48 bm(1,j2)=bm(1,j4)                                                 obse-310
      knx=j2                                                            obse-311
      go to 26                                                          obse-312
   49 ij=ij+2                                                           obse-313
      if (ij.le.13) go to 39                                            obse-314
      do 52 j1=k1,knx                                                   obse-315
      m1=nx(7,j1)+nx(9,j1)+nx(11,j1)+nx(13,j1)                          obse-316
      m2=nx(8,j1)+nx(10,j1)+nx(12,j1)+nx(14,j1)+4*m1                    obse-317
      m3=m2/2                                                           obse-318
      if (2*(m1/2).eq.m1) go to 50                                      obse-319
      if (2*m3.ne.m2) go to 51                                          obse-320
      bm(3,j1)=bm(1,j1)                                                 obse-321
      go to 51                                                          obse-322
   50 if (2*m3.eq.m2) go to 51                                          obse-323
      bm(3,j1)=-bm(1,j1)                                                obse-324
   51 if (2*(m3/2).ne.m3) bm(3,j1)=-bm(3,j1)                            obse-325
   52 continue                                                          obse-326
      lt1=.false.                                                       obse-327
      write (2,1013)                                                    obse-328
      k=knx+1-k1                                                        obse-329
      go to 8                                                           obse-330
c storage of the description                                            obse-331
   53 l1=0                                                              obse-332
      itx(1,kit)=k1                                                     obse-333
      itx(2,kit)=knx                                                    obse-334
      do 54 i=1,nt                                                      obse-335
      if (mf(1,i).ne.-kx) go to 54                                      obse-336
      mf(1,i)=kz                                                        obse-337
      mf(6,i)=lt3                                                       obse-338
      l1=l1+1                                                           obse-339
   54 continue                                                          obse-340
      if (l1.eq.0) write (2,1014) kx                                    obse-341
      go to 5                                                           obse-342
c computation of all the indications needed for the observables         obse-343
c (beginning and end of do loops,geometrical coefficients ...)          obse-344
   55 do  56 i=1,nt                                                     obse-345
      i1=mf(1,i)+1                                                      obse-346
      mf(3,i)=itx(1,i1)                                                 obse-347
   56 mf(4,i)=itx(2,i1)                                                 obse-348
      lt1=.false.                                                       obse-349
   57 lt1=.not.lt1                                                      obse-350
c lt1=.true.  first passage: number of informations needed for do loops obse-351
c lt1=.false. second one: computation of geometrical coefficients which obse-352
c are stored after the indications for do loops                         obse-353
      ical=0                                                            obse-354
      ncal=0                                                            obse-355
      do 77 i=1,nt                                                      obse-356
      iv=mf(2,i)                                                        obse-357
      mt(3)=ipi(2,iv)                                                   obse-358
      mt(4)=ipi(3,iv)                                                   obse-359
      if (mf(1,i).le.0.or.mf(1,i).eq.8) go to 77                        obse-360
      if (mf(1,i).ne.1) go to 58                                        obse-361
      if (iv.ne.1) go to 88                                             obse-362
      go to 77                                                          obse-363
   58 if ((mf(1,i).eq.2.and.mt(1).le.3).or.(mf(1,i).eq.3.and.mt(3).le.3)obse-364
     1) go to 61                                                        obse-365
      if (i.eq.1) go to 62                                              obse-366
      i1=i-1                                                            obse-367
      do 59 j=1,i1                                                      obse-368
      if (mf(1,i).eq.mf(1,j).and.mf(2,i).eq.mf(2,j)) go to 60           obse-369
   59 continue                                                          obse-370
      go to 62                                                          obse-371
   60 mf(3,i)=mf(3,j)                                                   obse-372
      mf(4,i)=mf(4,j)                                                   obse-373
      go to 77                                                          obse-374
   61 mf(1,i)=-mf(1,i)                                                  obse-375
      if ((mf(1,i).eq.-2.and.mt(1).eq.0).or.(mf(1,i).eq.-3.and.mt(3).eq.obse-376
     10)) go to 89                                                      obse-377
      go to 77                                                          obse-378
   62 i1=mf(3,i)                                                        obse-379
      i2=mf(4,i)                                                        obse-380
      do 76 ki=i1,i2                                                    obse-381
      kt=0                                                              obse-382
      do 72 l=1,4                                                       obse-383
      k=nx(2*l+5,ki)                                                    obse-384
      nm=nx(2*l+6,ki)                                                   obse-385
      kt=kt+k                                                           obse-386
      if (k.gt.mt(l)) go to 90                                          obse-387
      if (ical.eq.0) go to 64                                           obse-388
      do 63 n=1,ical                                                    obse-389
      if (mt(l).eq.nx(15,n).and.k.eq.nx(16,n).and.nm.eq.nx(17,n)) go to obse-390
     1 70                                                               obse-391
   63 continue                                                          obse-392
   64 ical=ical+1                                                       obse-393
      if (18*ical.gt.jtn) call memo(idmt,idmt+18*ical-jtn,jtn,3,lo)     obse-394
      if (lo(216)) go to 91                                             obse-395
      nx(15,ical)=mt(l)                                                 obse-396
      nx(16,ical)=k                                                     obse-397
      nx(17,ical)=nm                                                    obse-398
      nx(18,ical)=jcal                                                  obse-399
      if (lt1) go to 72                                                 obse-400
      in=mt(l)                                                          obse-401
      nx(1,ical)=max0(1,1+nm)                                           obse-402
      nx(2,ical)=min0(in,in+nm)                                         obse-403
      nx(3,ical)=nm                                                     obse-404
      nx(4,ical)=jcal-nx(1,ical)+1                                      obse-405
      if (nx(16,ical).eq.0) go to 69                                    obse-406
c recurrence computation of geometrical coefficients                    obse-407
      f3=2*k+1                                                          obse-408
      f3=dsqrt(f3)                                                      obse-409
      do 65 j=1,k                                                       obse-410
      f1=in-j                                                           obse-411
      f2=in+j                                                           obse-412
   65 f3=-f3*dsqrt(f1/f2)                                               obse-413
      jnm=nm                                                            obse-414
      inm=iabs(jnm)                                                     obse-415
      if (jnm.eq.0) go to 67                                            obse-416
      if (inm.ne.jnm.and.2*(inm/2).ne.inm) f3=-f3                       obse-417
      do 66 j=1,inm                                                     obse-418
      f1=(k+j)*(k-j+1)                                                  obse-419
      f2=j*(in-j)                                                       obse-420
   66 f3=f3*dsqrt(f1/f2)                                                obse-421
   67 jcal=jcal+1                                                       obse-422
      is=nx(2,ical)-nx(1,ical)                                          obse-423
      if (2*(jcal+is).gt.jts) call memo(idmt,idmt+2*(jcal+is)-jts,jts,3,obse-424
     1lo)                                                               obse-425
      if (lo(216)) go to 91                                             obse-426
      bm(jcal,kx)=f3                                                    obse-427
      if (is.lt.1) go to 69                                             obse-428
      f2=0.d0                                                           obse-429
      d1=k*(k+1)-(in+1)*(inm-1)                                         obse-430
      c2=0.d0                                                           obse-431
      do 68 j=1,is                                                      obse-432
      c1=c2                                                             obse-433
      c2=j*(in-j)*(j+inm)*(in-j-inm)                                    obse-434
      c2=dsqrt(c2)                                                      obse-435
      d1=d1+2*(2*j-2-in+inm)                                            obse-436
      f1=f2                                                             obse-437
      f2=f3                                                             obse-438
      f3=-(d1*f2+c1*f1)/c2                                              obse-439
      jcal=jcal+1                                                       obse-440
      bm(jcal,kx)=f3                                                    obse-441
   68 continue                                                          obse-442
   69 n=ical                                                            obse-443
   70 if (lt1) go to 72                                                 obse-444
      do 71 ma=1,4                                                      obse-445
      mc=20*ncal+4*l+ma-4                                               obse-446
   71 nx(mc,kx)=nx(ma,n)                                                obse-447
      lz(l)=nx(16,n).ne.0                                               obse-448
   72 continue                                                          obse-449
      if (lt1) go to 75                                                 obse-450
      lz(5)=kt.eq.0                                                     obse-451
      lz(6)=2*(kt/2).ne.kt                                              obse-452
      nz(1)=0                                                           obse-453
      nz(2)=0                                                           obse-454
      if (lz(4)) nz(2)=mf(6,i)                                          obse-455
      if (lz(3).or.lz(4)) nz(1)=mf(6,i)                                 obse-456
      lo(226)=lo(226).or.nz(1).ne.0                                     obse-457
      ia1=0                                                             obse-458
      ia2=1                                                             obse-459
      do 73 li=1,6                                                      obse-460
      if (lz(li)) ia1=ia1+ia2                                           obse-461
   73 ia2=2*ia2                                                         obse-462
      nx(20*ncal+17,kx)=ia1                                             obse-463
      nx(20*ncal+18,kx)=nz(1)+1000*nz(2)                                obse-464
      bm(10*ncal+10,kx)=bm(3,ki)                                        obse-465
      do 74 li=2,4,2                                                    obse-466
      if (.not.lz(li)) go to 74                                         obse-467
      im=nx(20*ncal+4*li-3,kx)                                          obse-468
      nx(20*ncal+4*li-3,kx)=mt(li)-nx(20*ncal+4*li-2,kx)+1              obse-469
      nx(20*ncal+4*li-2,kx)=mt(li)-im+1                                 obse-470
      nx(20*ncal+4*li-1,kx)=-nx(20*ncal+4*li-1,kx)                      obse-471
      nx(20*ncal+4*li,kx)=nx(20*ncal+4*li,kx)+im+nx(20*ncal+4*li-2,kx)  obse-472
   74 continue                                                          obse-473
   75 ncal=ncal+1                                                       obse-474
   76 continue                                                          obse-475
      if (lt1) go to 77                                                 obse-476
      mf(4,i)=ncal                                                      obse-477
      mf(3,i)=ncal+i1-i2                                                obse-478
   77 continue                                                          obse-479
      if (.not.lt1) go to 78                                            obse-480
      kx=max0(knx,ical)+1                                               obse-481
      jcal=10*ncal                                                      obse-482
      jts=jtn-18*(kx-1)                                                 obse-483
      if (2*jcal.gt.jts) call memo(idmt,idmt+2*jcal-jts,jts,3,lo)       obse-484
      if (lo(216)) go to 91                                             obse-485
      go to 57                                                          obse-486
c storage of legends and copy of results                                obse-487
   78 do 80 i=1,nt                                                      obse-488
      i5=iabs(mf(1,i))+1                                                obse-489
      mf(2,i)=mf(5,i)                                                   obse-490
      do 79 j=3,7                                                       obse-491
   79 mf(j+2,i)=itx(j,i5)                                               obse-492
   80 continue                                                          obse-493
      do 81 i=1,jcal                                                    obse-494
   81 am(i)=bm(i,kx)                                                    obse-495
      return                                                            obse-496
   82 write (2,1015) i,mf(1,i)                                          obse-497
      go to 91                                                          obse-498
   83 write (2,1016) i,mf(1,i)                                          obse-499
      go to 91                                                          obse-500
   84 write (2,1017) nx(2*ij+5,k),nx(2*ij+6,k),mt(ij)                   obse-501
      go to 91                                                          obse-502
   85 write (2,1018)                                                    obse-503
      go to 91                                                          obse-504
   86 write (2,1019) nx(2*i-1,k1),nx(2*i,k1)                            obse-505
      go to 91                                                          obse-506
   87 write (2,1020)                                                    obse-507
      go to 91                                                          obse-508
   88 write (2,1021) mf(2,i)                                            obse-509
      go to 91                                                          obse-510
   89 write (2,1022) mf(2,i)                                            obse-511
      go to 91                                                          obse-512
   90 write (2,1023) mt(l),mf(2,i),l,k                                  obse-513
   91 write (2,1024)                                                    obse-514
      stop                                                              obse-515
 1000 format (2l1,i1,i2,i5,5a4)                                         obse-516
 1001 format (8i5)                                                      obse-517
 1002 format (6f10.5)                                                   obse-518
 1003 format (/11h observable,i3,9h labelled,5x,5a4,10x,i3,11h componentobse-519
     1s)                                                                obse-520
 1004 format (57h defined with an axis perpendicular to the reaction plaobse-521
     1ne)                                                               obse-522
 1005 format (33h defined in the laboratory system)                     obse-523
 1006 format (42h defined with respect to the incident beam)            obse-524
 1007 format (34h not completely defined by tensors)                    obse-525
 1008 format (/6(11x,4i2,2x))                                           obse-526
 1009 format (6(2h +,f8.4,2h*m,9x))                                     obse-527
 1010 format (6(11x,4i2,2x))                                            obse-528
 1011 format (16h imaginary parts/6(1x,f8.5,12x))                       obse-529
 1012 format (6(2h +,f8.4,2h*a,9x))                                     obse-530
 1013 format (//21h after transformation/)                              obse-531
 1014 format (32h the observable read with number,i4,12h is not used)   obse-532
 1015 format (4h the,i4,22h th observable,of kind,i2,30h must be for expobse-533
     1erimental data)                                                   obse-534
 1016 format (4h the,i4,22h th observable,of kind,i2,15h is not defined)obse-535
 1017 format (23h non tensor indications,i4,4h and,i4,24h incorrect for obse-536
     1(2*s+1) =,i3)                                                     obse-537
 1018 format (16h zero observable)                                      obse-538
 1019 format (/60h too large magnetic quantum number or negative multipoobse-539
     1larity,2i6)                                                       obse-540
 1020 format (61h the sum of magnetic quantum numbers is odd for one comobse-541
     1ponent)                                                           obse-542
 1021 format (67h no cross section divided by rutherford's for the inelaobse-543
     1stic channel,i3)                                                  obse-544
 1022 format (47h no polarisation for a zero spin in the channel,i3)    obse-545
 1023 format (5x,i5,31h is a too small spin in channel,i4,13h and particobse-546
     1le,i4,35h for a polarisation of tensor order,i4)                  obse-547
 1024 format (//22h in obse  ... stop ...)                              obse-548
      end                                                               obse-549
c 04/04/98  ibm version                                         ecis97  colf-000
      subroutine colf(ncolt,ncoll,sp,ipi,wv,fg,xg,ism,lmax1,lmax2,scn,h,colf-001
     1iexp,z,lm,lmax3,niv,kxt,ipp,pip,npx,idmt,lo)                      colf-002
c coulomb functions at the matching point rm=ism*h                      colf-003
c input variables: ncolt:   number of nuclear states (coupled or not)   colf-004
c                           and continua for compound nucleus           colf-005
c                  ncoll:   number of coupled states                    colf-006
c                  sp(j,*): product of charges for j=3                  colf-007
c                  wv(j,*): mass of particle and target for j=1,2       colf-008
c                           center of mass energy in mev for j=3        colf-009
c                  ism:     number of points for integration            colf-010
c                  lmax1:   maximum number of coulomb functions         colf-011
c                  lmax2:   maximum number of coulomb phase shifts      colf-012
c                  scn:     descriptions of level densities             colf-013
c                  h:       integration step size in fm                 colf-014
c                  lm:      length of working space as single precision colf-015
c                  niv(*,*,3): addresses of coulomb integrals           colf-016
c                  ipp,pip: equivalent by call  (see calx)              colf-017
c                  idmt:    length of the total working fields          colf-018
c                  lo:      logical controls                            colf-019
c for common /ncomp/ see calx, lect and colf                            colf-020
c in common /ncomp/nrd,nfiss: number of gamma and fission transmission  colf-021
c                             coefficients read in lect                 colf-022
c                  tg0,bn,fnug,egd,ggd:  neutron binding energy         colf-023
c                           giant dipole resonance energy and width ....colf-024
c output variables:wv(4,*): wave number in 1/fm                         colf-025
c                  wv(5,*): coulomb parameter                           colf-026
c                  wv(6,*): square root of ratios of wave numbers       colf-027
c                           (modified by step sizes)                    colf-028
c                  wv(7,*): relativistic energy                         colf-029
c                  wv(8,*): step size times ratio of wave number to     colf-030
c                                square root of non relativistic energy colf-031
c                  wv(9,*): wave number multiplies by ratio of steps    colf-032
c                  wv(10,*):square of the product of wave number by the colf-033
c                                step size                              colf-034
c                  wv(11,*):step size for the level                     colf-035
c to take into account recoil when the masses are not the same in all   colf-036
c the channels, the wv(8,*) and wv(9,*) are multiplied by a scale factorcolf-037
c x=(initial target mass)/(target mass) and wv(10,*) is multiplied by   colf-038
c its square. always wv(10,*)=(h*wv(9,*))**2.                           colf-039
c                  fg(m,i=1 to 4,iv): f,fp,g,gp for l=m-1 and iv=1,ncollcolf-040
c                   and integrals of f*f,f*g,g*f and g*g/r**2 from rm tocolf-041
c                   infinity if lo(44)=.true. for iv greater than ncoll colf-042
c                  xg(m,iv): sigma(m-1)-sigma(0) for iv=1,ncoll         colf-043
c                   and integrals of f*f/r**2 from zero to infinity     colf-044
c                   if lo(44)=.true. for iv greater than ncoll          colf-045
c                  kxt:    total number of penetrabilities              colf-046
c                  npx:    number of different potentials               colf-047
c                  lmax3:  effective maximum number of coulomb functionscolf-048
c                  ipi(j,i): for i=ncoll+1 to ncolt, maximum l+1 and    colf-049
c                   starting address of penetrabilities in 7 and 9      colf-050
c in common /ncomp/egd,ggd: energy and width of giant dipole resonance  colf-051
c                  tg1,sgsq  .........                                  colf-052
c in scn:  1-sa  2-ux   3-tau  4-sg   5-e0   6-ex   7-nz  8-b           colf-053
c working field in fcou: iexp(i), i=1,lmax1  powers of 10 for large     colf-054
c                    values of functions (multiples of 10**30)          colf-055
c working field in cori:  z  see in cori                                colf-056
c***********************************************************************colf-057
      implicit real*8 (a-h,o-z)                                         colf-058
      logical lo(250)                                                   colf-059
      real*4 sp,scn,h,acn1,acn2,az,bz,tg0,bn,fnug,egd,ggd,tg1,sgsq,pip  colf-060
      dimension wv(15,1),fg(lmax1,4,1),xg(lmax2,1),z(1),iexp(1),niv(ncolcolf-061
     1l,ncoll,3),ipi(10,1),sp(3,1),scn(8,1),ipp(11,1),pip(11,1)         colf-062
      common /ncomp/ nsp(3),nfiss,nrd,ncont,ncoj,acn1,acn2,ncons,nie,ncocolf-063
     1lx,ndp,ndq,az(6),bz(3),tg0,bn,fnug,egd,ggd,tg1,sgsq               colf-064
      common /dblpr/ chi2,chi2m,cm,ck,chb,cmb,ccz,xe,xm,xn,xz           colf-065
      kxt=0                                                             colf-066
      xm=cm*wv(1,1)*wv(2,1)/(wv(1,1)+wv(2,1))                           colf-067
      if (lo(98)) xm=cm*wv(1,1)                                         colf-068
      if (.not.lo(209)) write (2,1000)                                  colf-069
      if (lo(209)) write (2,1001) xm                                    colf-070
      xn=chb**2/(2.d0*xm)                                               colf-071
c check of the length of working field for iexp                         colf-072
      if (lm.lt.lmax1) call memo(idmt,idmt+ncoll*lmax1-lm,lm,3,lo)      colf-073
      if (lo(216)) go to 23                                             colf-074
      amrd=xm/cm                                                        colf-075
      amr=wv(3,1)/cm+wv(1,1)+wv(2,1)                                    colf-076
      lmax3=lmax1                                                       colf-077
c wave number,coulomb parameter and call to coulomb subroutines         colf-078
      do 11 i=1,ncolt                                                   colf-079
      rec=1.d0                                                          colf-080
      if (lo(193).and.wv(1,1).ne.wv(1,i)) rec=wv(2,1)/wv(2,i)           colf-081
      hrec=dble(h)*rec                                                  colf-082
      rm=ism*dble(h)                                                    colf-083
      wv(11,i)=hrec                                                     colf-084
      if (lo(8)) go to 1                                                colf-085
      amrd=wv(1,i)*wv(2,i)/(wv(1,i)+wv(2,i))                            colf-086
      wsk2=ck*wv(3,i)*amrd                                              colf-087
      go to 3                                                           colf-088
    1 amt=wv(2,i)                                                       colf-089
      if (lo(209)) go to 2                                              colf-090
c reduced mass replaced by reduced energy (h.v. geramb's suggestion)    colf-091
c for relativistic conventional schroedinger equation                   colf-092
      if (lo(44)) amt=wv(2,1)                                           colf-093
      amrd=(amr**4-(wv(1,i)**2-amt**2)**2)/(4.d0*amr**3)                colf-094
    2 wsk2=0.125d0*ck*wv(3,i)*(wv(3,i)/cm+2.d0*wv(1,i)+2.d0*amt)*(wv(3,icolf-095
     1)/cm+2.d0*wv(1,i))*(wv(3,i)/cm+2.d0*amt)/amr**2                   colf-096
    3 wv(4,i)=dsqrt(dabs(wsk2))                                         colf-097
      wv(9,i)=wv(4,i)*rec                                               colf-098
      wv(6,i)=dsqrt(wv(9,i)/wv(9,1))                                    colf-099
      wv(8,i)=hrec*dsqrt(ck*amrd)                                       colf-100
      wv(10,i)=hrec*hrec*wsk2                                           colf-101
      if (lo(209)) go to 4                                              colf-102
      wv(5,i)=0.5d0*ck*ccz*amrd*sp(3,i)/wv(4,i)                         colf-103
      g=amrd*(wv(1,i)+wv(2,i))/(wv(1,i)*wv(2,i))                        colf-104
      if (i.le.ncoll) write (2,1002) i,(wv(j,i),j=4,6),g,amrd,hrec      colf-105
      go to 5                                                           colf-106
    4 hpc=chb*wv(4,i)                                                   colf-107
      wv(7,i)=dsqrt(hpc**2+xm**2)                                       colf-108
      wv(5,i)=ccz*sp(3,i)/wv(4,i)*wv(7,i)/chb**2                        colf-109
      if (i.le.ncoll) write (2,1002) i,(wv(j,i),j=4,7),hrec             colf-110
    5 if (dabs(wv(5,i)).gt.400.d0) wv(5,i)=400.d0*wv(5,i)/dabs(wv(5,i)) colf-111
      if (i.gt.ncoll) go to 7                                           colf-112
      rau=rm*wv(9,i)                                                    colf-113
      eta=wv(5,i)                                                       colf-114
      if (wv(3,i).gt.0.) go to 6                                        colf-115
      call cocl(fg(1,1,i),fg(1,2,i),fg(1,3,i),fg(1,4,i),xg(1,i),eta,rau,colf-116
     1lmax1-1)                                                          colf-117
      go to 8                                                           colf-118
    6 lx=lmax1                                                          colf-119
      call fcou(lx-1,eta,rau,fg(1,1,i),fg(1,2,i),fg(1,3,i),fg(1,4,i),iexcolf-120
     1p,xg(1,i))                                                        colf-121
      go to 8                                                           colf-122
    7 ly=0                                                              colf-123
      if (wv(3,i).gt.0.) ly=dmin1(4.d0+3.3d0*dsqrt(wv(3,i)),lmax1+.1d0) colf-124
      ipi(9,i)=ly-1                                                     colf-125
      ipi(7,i)=kxt                                                      colf-126
      kxt=kxt+ly*ipi(2,i)                                               colf-127
      go to 11                                                          colf-128
    8 ipi(9,i)=ipi(9,1)                                                 colf-129
      if (wsk2.lt.0.d0) go to 11                                        colf-130
c computation of coulomb phase-shifts                                   colf-131
      lmx1=lmax3                                                        colf-132
c correction of large value and search for maximum effective number     colf-133
c of coulomb functions                                                  colf-134
      do 9 j=1,lmx1                                                     colf-135
      if (iexp(j).eq.0) go to 9                                         colf-136
      if (lo(208).or.iexp(j).gt.15) lmax3=min0(lmax3,j)                 colf-137
      fg(j,1,i)=fg(j,1,i)*1.d-15                                        colf-138
      fg(j,2,i)=fg(j,2,i)*1.d-15                                        colf-139
      fg(j,3,i)=fg(j,3,i)*1.d15                                         colf-140
      fg(j,4,i)=fg(j,4,i)*1.d15                                         colf-141
    9 continue                                                          colf-142
      if (lmx1.ne.lmax3) write (2,1003) lmx1,lmax3                      colf-143
      if (.not.lo(208)) ipi(9,i)=min0(lmax3-1,ipi(9,1))                 colf-144
c computation of coulomb integrals                                      colf-145
      xi=xg(1,i)                                                        colf-146
      si=wv(9,i)                                                        colf-147
      do 10 j=1,i                                                       colf-148
      k=niv(i,j,3)                                                      colf-149
      if (k.eq.0) go to 10                                              colf-150
      xj=xg(1,j)                                                        colf-151
      ej=wv(5,j)                                                        colf-152
      sj=wv(9,j)                                                        colf-153
      call cori(eta,ej,si,sj,rm,xg(1,k),xi,xj,fg(1,1,i),fg(1,1,j),z,lmaxcolf-154
     11,lmax2,lm,lmax3,fg(1,1,k),idmt,lo)                               colf-155
   10 continue                                                          colf-156
   11 continue                                                          colf-157
      xz=10.d0/dfloat(ipi(2,1)*ipi(3,1))/wv(4,1)**2                     colf-158
      do 13 i=1,ncoll                                                   colf-159
      xg(1,i)=0.d0                                                      colf-160
      do 12 j=2,lmax2                                                   colf-161
      aj=j-1                                                            colf-162
   12 xg(j,i)=xg(j-1,i)+datan2(wv(5,i),aj)                              colf-163
   13 continue                                                          colf-164
      xe=wv(7,1)                                                        colf-165
      call disp(0,ipi,wv,ipp,pip,ncoll,ncolt-ncont,npx,lo)              colf-166
      if (lo(181)) return                                               colf-167
      bz(2)=abs(bz(2))                                                  colf-168
      bz(3)=bz(1)*bz(1)-1.                                              colf-169
      if (.not.(lo(214).or.lo(222))) return                             colf-170
c  gamma ray input                                                      colf-171
      if (lo(186).or.(nrd.ne.0)) return                                 colf-172
      xfr=0.5d0                                                         colf-173
      na=wv(2,1)+wv(1,1)+.5d0                                           colf-174
      aa=na                                                             colf-175
      nz=scn(7,ncons)+.1d0                                              colf-176
      nn=na-nz                                                          colf-177
      zz=nz*nn                                                          colf-178
      kgd=0                                                             colf-179
      if (egd.eq.0.) egd=163.0*sqrt(zz)/(aa**1.3333)                    colf-180
      if (egd.lt.0.) go to 14                                           colf-181
      kgd=1                                                             colf-182
      if (ggd.le.0.0) ggd=5.0                                           colf-183
   14 if (.not.lo(215)) write (2,1004) na,nz,nn,bn,fnug,scn(4,ncons)    colf-184
      atg0=abs(tg0)                                                     colf-185
      if (.not.lo(215)) write (2,1005) atg0                             colf-186
      if (kgd.eq.0.and..not.lo(215)) write (2,1006)                     colf-187
      if (kgd.eq.1.and..not.lo(215)) write (2,1007) egd,ggd,xfr         colf-188
      sgsq=2.*scn(4,ncons)**2                                           colf-189
      roj=0.d0                                                          colf-190
      ecm=0.d0                                                          colf-191
   15 tg=0.d0                                                           colf-192
      elim=bn+ecm                                                       colf-193
      elo=0.d0                                                          colf-194
   16 ehi=elo+0.05d0                                                    colf-195
      if (ehi.ge.elim) ehi=elim                                         colf-196
      eps=(ehi+elo)/2.d0                                                colf-197
      esq=eps*eps                                                       colf-198
      tint=(ehi-elo)*eps*esq                                            colf-199
      eee=-egd*egd+esq                                                  colf-200
      if (kgd.eq.1) tint=tint*eps/(esq*ggd*ggd+eee*eee)                 colf-201
      exc=bn+ecm-eps                                                    colf-202
      if (exc.gt.scn(6,ncons)) go to 17                                 colf-203
      ebyt=(exc-scn(5,ncons))/scn(3,ncons)                              colf-204
      tint=tint*exp(ebyt)/scn(3,ncons)                                  colf-205
      go to 18                                                          colf-206
   17 exd=exc+scn(2,ncons)-scn(6,ncons)                                 colf-207
      ebyt=sqrt(scn(1,ncons)*exd)                                       colf-208
      tint=tint*exp(2.d0*ebyt)/(ebyt*exd*scn(8,ncons))                  colf-209
   18 tg=tg+tint                                                        colf-210
      if (ehi.eq.elim) go to 19                                         colf-211
      elo=ehi                                                           colf-212
      go to 16                                                          colf-213
   19 if (ecm.ne.0.0) go to 22                                          colf-214
      temp=tg                                                           colf-215
      id=ipi(3,1)-1                                                     colf-216
      n1=iabs(id-1)                                                     colf-217
      n2=id+1                                                           colf-218
      do 21 i=n1,n2,2                                                   colf-219
      n3=iabs(i-2)                                                      colf-220
      n4=i+2                                                            colf-221
      do 20 j=n3,n4,2                                                   colf-222
      dex=-dfloat((j+1)*(j+1))/(sgsq*4.d0)                              colf-223
   20 roj=roj+dexp(dex)*dfloat(j+1)/sgsq                                colf-224
   21 continue                                                          colf-225
      ctg=atg0/(temp*roj)                                               colf-226
      ecm=wv(3,1)                                                       colf-227
      go to 15                                                          colf-228
   22 tg1=tg*ctg                                                        colf-229
      return                                                            colf-230
   23 write (2,1008)                                                    colf-231
      stop                                                              colf-232
 1000 format (/111h level       wave number  coulomb parameter   sqrt(k colf-233
     1out/k in)   rel. enhanc.      reduced mass       step size)       colf-234
 1001 format (/104h level       wave number  coulomb parameter   sqrt(k colf-235
     1out/k in)   rel. energy        step size  ** mass =,f15.8,3h **)  colf-236
 1002 format (1x,i5,6f18.10)                                            colf-237
 1003 format (48h number of finite coulomb integrals reduced from,i6,3h colf-238
     1to,i6)                                                            colf-239
 1004 format (/34h    gamma ray channel parameters ://5h   a=,i3,4h  z=,colf-240
     1i3,4h  n=,i3,5x,f9.3,21h mev  neutron binding,5x,f6.2,19h radiativcolf-241
     2e d. of f.,5x,6hsigma=,f6.3)                                      colf-242
 1005 format (60h   normalised to slow s-wave neutron gamma widths/spacicolf-243
     1ngs =,e12.4)                                                      colf-244
 1006 format (27h   e1 strong coupling model)                           colf-245
 1007 format (25h   e1 giant resonance at ,f7.2,13h mev   width=,f7.2,4hcolf-246
     1 mev,5x,18hexchange fraction=,f4.2)                               colf-247
 1008 format (22h in colf  ... stop ...)                                colf-248
      end                                                               colf-249
c 11/04/98  ibm version                                         ecis88  cocl-000
      subroutine cocl(g,gd,f,fd,sigma,eta,rho,l)                        cocl-001
c closed channel decreasing coulomb functions                           cocl-002
c input variables: eta: coulomb parameter; eta >= 0                     cocl-003
c                  rho: |k|*r value                                     cocl-004
c                  l:    maximum l value                                cocl-005
c output variables: sigma(i)=0 for i = 1 to l+1                         cocl-006
c       f(i):  decreasing solution at (eta,rho) for i = 1 to l+1        cocl-007
c       fd(i): derivative of f(i) for i = 1 to l+1                      cocl-008
c       g(i):  increasing solution for i = 1 to l+1                     cocl-009
c       gd(i): derivative of f(i) for i = 1 to l+1                      cocl-010
c the functions are renormalised to 1 and such that  f*gd - g*fd = 1    cocl-011
c***********************************************************************cocl-012
      implicit real*8 (a-h,o-z)                                         cocl-013
      logical ifeqal                                                    cocl-014
      dimension f(1),fd(1),g(1),gd(1),sigma(1),s(7),t(3)                cocl-015
      data s /7*0.d0/                                                   cocl-016
      if (eta.lt.0.d0.or.rho.le.0.d0) go to 11                          cocl-017
      lp1=l+1                                                           cocl-018
      if (eta.lt.1.d-6) go to 6                                         cocl-019
      is=7                                                              cocl-020
      m=10.d0*rho+3.d0                                                  cocl-021
      h=m                                                               cocl-022
      h=rho/h                                                           cocl-023
      rhoa=10.d0*(eta+1.d0)                                             cocl-024
      ifeqal=rhoa.lt.rho                                                cocl-025
      m=rhoa/h+0.5d0                                                    cocl-026
      rhoa=h*m                                                          cocl-027
      if (ifeqal.or.rhoa.lt.rho+1.5d0*h) rhoa=rho+2.d0*h                cocl-028
c expansion in powers of 1/rhoa                                         cocl-029
    1 c=1.d0/rhoa                                                       cocl-030
      a=1.d0                                                            cocl-031
      b=1.d0-c*eta                                                      cocl-032
      f(1)=a                                                            cocl-033
      fd(1)=b                                                           cocl-034
      do 2 m=1,26                                                       cocl-035
      am=m                                                              cocl-036
      d=0.5d0*(eta+am-1.d0)*(eta+am)*c/am                               cocl-037
      a=-a*d                                                            cocl-038
      b=-b*d-a*c                                                        cocl-039
      f(1)=f(1)+a                                                       cocl-040
    2 fd(1)=fd(1)+b                                                     cocl-041
      if (ifeqal) go to 7                                               cocl-042
      s(is)=f(1)                                                        cocl-043
      if (is.ne.7) go to 3                                              cocl-044
      is=6                                                              cocl-045
      rhoa=rhoa+h                                                       cocl-046
      s(7)=s(7)*dexp(h-eta*dlog(1.d0-h/rhoa))                           cocl-047
      go to 1                                                           cocl-048
c backward integration                                                  cocl-049
    3 a=2.d0+1.d0/1.2d0*h*h                                             cocl-050
      b=1.d0/6.d0*h*eta                                                 cocl-051
      c=1.d0-1.d0/12.d0*h*h                                             cocl-052
      m1=rhoa/h-0.5d0                                                   cocl-053
      m2=rho/h-1.5d0                                                    cocl-054
      am=m1                                                             cocl-055
      t(2)=b/(am+1.d0)                                                  cocl-056
      t(3)=b/am                                                         cocl-057
      js=m1                                                             cocl-058
      do 5 is=m2,m1                                                     cocl-059
      do 4 i=1,6                                                        cocl-060
    4 s(i)=s(i+1)/s(7)                                                  cocl-061
      t(1)=t(2)                                                         cocl-062
      t(2)=t(3)                                                         cocl-063
      am=js-1                                                           cocl-064
      t(3)=b/am                                                         cocl-065
      s(7)=((a+10.d0*t(2))*s(6)-(c-t(1))*s(5))/(c-t(3))                 cocl-066
    5 js=js-1                                                           cocl-067
      f(1)=1.d0                                                         cocl-068
      fd(1)=(1.d0/60.d0*(s(1)-s(7))+0.15d0*(s(6)-s(2))+0.75d0*(s(3)-s(5)cocl-069
     1))/(h*s(4))                                                       cocl-070
      go to 7                                                           cocl-071
    6 f(1)=1.d0                                                         cocl-072
      fd(1)=-1.d0                                                       cocl-073
c recurrence for l > 0                                                  cocl-074
    7 c=1.d0/rho                                                        cocl-075
      if (l.le.0) go to 9                                               cocl-076
      do 8 m=1,l                                                        cocl-077
      am=m                                                              cocl-078
      a=eta/am                                                          cocl-079
      b=a+c*am                                                          cocl-080
      f(m+1)=1.d0                                                       cocl-081
    8 fd(m+1)=(a*a-1.d0)/(b-fd(m))-b                                    cocl-082
    9 do 10 m=1,lp1                                                     cocl-083
      g(m)=1.d0                                                         cocl-084
      gd(m)=1.d0+fd(m)                                                  cocl-085
   10 sigma(m)=0.d0                                                     cocl-086
      return                                                            cocl-087
   11 write (2,1000) eta,rho                                            cocl-088
      stop                                                              cocl-089
 1000 format (17h cocl  ***  eta =,1p,d13.5,8h,  rho =,d13.5,25h   argumcocl-090
     1ent out off range)                                                cocl-091
      end                                                               cocl-092
c 29/05/86  ibm version                                         ecis88  fcou-000
      subroutine fcou(l,eta,ro,f,fp,g,gp,iexp,sigma)                    fcou-001
coulomb functions for rho > 0 and -500 < eta < 500   ex - dfcoul        fcou-002
c  for the mathematical description see chr. bardin et. al. cea-n-906   fcou-003
c  or bardin et al. comp. physics comm. vol 3 (1972) pages 73-87        fcou-004
c  numerical accuracy: at least 8 significant digits, an exception is   fcou-005
c  the region -8 < eta < -6 and ro < 125/6                              fcou-006
c the calculation of phase-shifts has been suppressed except for l=0    fcou-007
      implicit real*8 (a-h,o-z)                                         fcou-008
      dimension f(1),fp(1),g(1),gp(1),iexp(1),sigma(1)                  fcou-009
      if (ro.gt.0.d0.and.dabs(eta).le.500.d0) go to 1                   fcou-010
      write (2,1000) eta,ro                                             fcou-011
      stop                                                              fcou-012
    1 call fcz0(eta,ro,f1,fp1,g1,gp1,iexp1,sigma1)                      fcou-013
      f(1)=f1                                                           fcou-014
      fp(1)=fp1                                                         fcou-015
      g(1)=g1                                                           fcou-016
      gp(1)=gp1                                                         fcou-017
      iexp(1)=iexp1                                                     fcou-018
      sigma(1)=sigma1                                                   fcou-019
      if (l.le.0) return                                                fcou-020
      linf=0                                                            fcou-021
      lin=1                                                             fcou-022
      ind=0                                                             fcou-023
      l1=l+1                                                            fcou-024
      etac=eta*eta                                                      fcou-025
      if ((eta.gt.0.d0.and.ro.lt.eta+eta.or.ro.lt.eta+dsqrt(etac+1.d0)))fcou-026
     1 go to 7                                                          fcou-027
      if (ro.ge.eta+dsqrt(etac+l*(l+1))) go to 5                        fcou-028
    2 roinf=eta+dsqrt(etac+linf*(linf+1))                               fcou-029
      if (ro.lt.roinf) go to 3                                          fcou-030
      if (linf.ge.l) go to 4                                            fcou-031
      linf=linf+1                                                       fcou-032
      go to 2                                                           fcou-033
    3 ind=1                                                             fcou-034
    4 lin=linf+1                                                        fcou-035
    5 xm=1.d0                                                           fcou-036
      if (ind.eq.0) lin=l1                                              fcou-037
      do 6 j=2,lin                                                      fcou-038
      zig=(dsqrt(etac+xm*xm))/xm                                        fcou-039
      zag=eta/xm+xm/ro                                                  fcou-040
      f(j)=(zag*f(j-1)-fp(j-1))/zig                                     fcou-041
      fp(j)=zig*f(j-1)-zag*f(j)                                         fcou-042
      g(j)=(zag*g(j-1)-gp(j-1))/zig                                     fcou-043
      gp(j)=zig*g(j-1)-zag*g(j)                                         fcou-044
      iexp(j)=iexp(1)                                                   fcou-045
    6 xm=xm+1.d0                                                        fcou-046
      if (ind.eq.0) return                                              fcou-047
    7 ftest=f(lin)                                                      fcou-048
      fptest=fp(lin)                                                    fcou-049
      lmax=linf+25+idint(5.d0*dabs(eta))                                fcou-050
      if (lmax.lt.l) lmax=l                                             fcou-051
      fi=1.d0                                                           fcou-052
      fpi=1.d0                                                          fcou-053
    8 xm=lmax+1                                                         fcou-054
      zig=(dsqrt(etac+xm*xm))/xm                                        fcou-055
      zag=eta/xm+xm/ro                                                  fcou-056
      fl=(zag*fi+fpi)/zig                                               fcou-057
      fpl=zag*fl-zig*fi                                                 fcou-058
      if (dabs(fl).lt.1.d15.and.dabs(fpl).lt.1.d15) go to 9             fcou-059
      fl=fl*1.d-15                                                      fcou-060
      fpl=fpl*1.d-15                                                    fcou-061
    9 fi=fl                                                             fcou-062
      fpi=fpl                                                           fcou-063
      if (lmax.le.l) go to 11                                           fcou-064
   10 lmax=lmax-1                                                       fcou-065
      go to 8                                                           fcou-066
   11 f(lmax+1)=fl                                                      fcou-067
      fp(lmax+1)=fpl                                                    fcou-068
      if (lmax.gt.linf) go to 10                                        fcou-069
      fact=ftest/f(lin)                                                 fcou-070
      factp=fptest/fp(lin)                                              fcou-071
      indice=iexp(1)/15                                                 fcou-072
      xm=linf                                                           fcou-073
      do 13 j=lin,l1                                                    fcou-074
      f(j)=f(j)*fact                                                    fcou-075
      fp(j)=fp(j)*factp                                                 fcou-076
      if (j.eq.1) go to 13                                              fcou-077
      zig=(dsqrt(etac+xm*xm))/xm                                        fcou-078
      zag=eta/xm+xm/ro                                                  fcou-079
      g(j)=(zag*g(j-1)-gp(j-1))/zig                                     fcou-080
      gp(j)=zig*g(j-1)-zag*g(j)                                         fcou-081
      if (dabs(g(j)).lt.1.d15.and.dabs(gp(j)).lt.1.d15) go to 12        fcou-082
      g(j)=g(j)/1.d15                                                   fcou-083
      gp(j)=gp(j)/1.d15                                                 fcou-084
      indice=indice+1                                                   fcou-085
   12 iexp(j)=indice*15                                                 fcou-086
      a=dlog10(dabs(fp(j)))+dlog10(dabs(g(j)))                          fcou-087
      b=0.d0                                                            fcou-088
      if (a.ge.0.d0) b=1.d0                                             fcou-089
      i1=b+a                                                            fcou-090
      i2=b+dlog10(dabs(gp(j)))+dlog10(dabs(f(j)))                       fcou-091
      f(j)=f(j)*1.d1**(-i2)                                             fcou-092
      fp(j)=fp(j)*1.d1**(-i1)                                           fcou-093
   13 xm=xm+1.d0                                                        fcou-094
      return                                                            fcou-095
 1000 format (19h  fcou   ***  eta =,1p,d13.5,8h,  rho =,d13.5,25h   argfcou-096
     1ument out off range)                                              fcou-097
      end                                                               fcou-098
c 29/10/85  ibm version                                         ecis88  fcz0-000
      subroutine fcz0(eta,ro,f0,fp0,g0,gp0,iexp,sigma)                  fcz0-001
c the lower limit of riccati method for positive eta has been changed   fcz0-002
c from 30. to 28. to avoid an overflow in the normalisation             fcz0-003
      implicit real*8 (a-h,o-z)                                         fcz0-004
      sigma=sigm(eta)                                                   fcz0-005
      iexp=0                                                            fcz0-006
      if (eta.le.28.d0.and.eta.ge.-8.d0) go to 1                        fcz0-007
      call yfri(eta,ro,f0,fp0,g0,gp0,iexp,sigma)                        fcz0-008
      return                                                            fcz0-009
    1 if (eta.ne.0.d0) go to 2                                          fcz0-010
      f0=dsin(ro)                                                       fcz0-011
      g0=dcos(ro)                                                       fcz0-012
      fp0=g0                                                            fcz0-013
      gp0=-f0                                                           fcz0-014
      return                                                            fcz0-015
    2 borne=1.666666666666667d0*dabs(eta)+7.5d0                         fcz0-016
      if (ro.lt.borne) go to 3                                          fcz0-017
      call yfas(eta,ro,f0,fp0,g0,gp0,sigma)                             fcz0-018
      return                                                            fcz0-019
    3 if (eta.ge.10.d0) go to 4                                         fcz0-020
      if (eta.le.0.d0) go to 5                                          fcz0-021
      if (ro-2.d0) 15 , 5 , 5                                           fcz0-022
    4 if (eta.gt.(5.d0*ro+6.d1)/7.d0) go to 15                          fcz0-023
c rs=-1 for normalisation at the origin,rs=1 a ro=end                   fcz0-024
    5 if (eta.lt.2.5) go to 6                                           fcz0-025
      rs=1.d0                                                           fcz0-026
      call yfas(eta,borne,f0,fp0,g0,gp0,sigma)                          fcz0-027
      go to 8                                                           fcz0-028
    6 rs=-1.d0                                                          fcz0-029
c          clenshaw at the origin                                       fcz0-030
      if (eta) 7,8,8                                                    fcz0-031
    7 n=-0.5d0*eta+5.d0                                                 fcz0-032
      go to 9                                                           fcz0-033
    8 n=eta/5.d0+5.d0                                                   fcz0-034
    9 n=10*(n/2+1)                                                      fcz0-035
      tm1=1.d0                                                          fcz0-036
      t=2.d0*ro/borne-1.d0                                              fcz0-037
      x=t+t                                                             fcz0-038
      do 10 i=1,n                                                       fcz0-039
      tp1=x*t-tm1                                                       fcz0-040
      tm1=t                                                             fcz0-041
   10 t=tp1                                                             fcz0-042
      t=tm1                                                             fcz0-043
      a1=1.d-30                                                         fcz0-044
      a2=0.d0                                                           fcz0-045
      b1=0.d0                                                           fcz0-046
      b2=a1                                                             fcz0-047
      s=1.d0                                                            fcz0-048
      sa=0.d0                                                           fcz0-049
      sb=0.d0                                                           fcz0-050
      z1=0.d0                                                           fcz0-051
      z1p=0.d0                                                          fcz0-052
      ap12=0.d0                                                         fcz0-053
      ap11=0.d0                                                         fcz0-054
      bp11=0.d0                                                         fcz0-055
      z2=0.d0                                                           fcz0-056
      z2p=0.d0                                                          fcz0-057
      ap22=0.d0                                                         fcz0-058
      ap21=0.d0                                                         fcz0-059
      bp21=0.d0                                                         fcz0-060
      a0=8.d0*eta/borne-1.d0                                            fcz0-061
      bd=4.d0/(borne*borne)                                             fcz0-062
      b0=bd*(n+2)                                                       fcz0-063
      b4=bd*(n-1)                                                       fcz0-064
      r4=4.d0*n                                                         fcz0-065
c          backwards recurrence                                         fcz0-066
   11 am11=a0*(a1-ap11)+ap12-b0*b1-b4*bp11                              fcz0-067
      am21=a0*(a2-ap21)+ap22-b0*b2-b4*bp21                              fcz0-068
      sa=sa+s*a1                                                        fcz0-069
      sb=sb+s*a2                                                        fcz0-070
      z1=z1+a1*t                                                        fcz0-071
      z1p=z1p+b1*t                                                      fcz0-072
      z2=z2+a2*t                                                        fcz0-073
      z2p=z2p+b2*t                                                      fcz0-074
      if (r4.eq.0.d0) go to 12                                          fcz0-075
      bm11=r4*a1+bp11                                                   fcz0-076
      ap12=ap11                                                         fcz0-077
      ap11=a1                                                           fcz0-078
      a1=am11                                                           fcz0-079
      bp11=b1                                                           fcz0-080
      b1=bm11                                                           fcz0-081
      bm21=r4*a2+bp21                                                   fcz0-082
      ap22=ap21                                                         fcz0-083
      ap21=a2                                                           fcz0-084
      a2=am21                                                           fcz0-085
      bp21=b2                                                           fcz0-086
      b2=bm21                                                           fcz0-087
      b4=b4-bd                                                          fcz0-088
      b0=b0-bd                                                          fcz0-089
      r4=r4-4.d0                                                        fcz0-090
      s=s*rs                                                            fcz0-091
      tm1=x*t-tp1                                                       fcz0-092
      tp1=t                                                             fcz0-093
      t=tm1                                                             fcz0-094
      go to 11                                                          fcz0-095
   12 a=ap21-am21                                                       fcz0-096
      b=am11-ap11                                                       fcz0-097
      sa=a*sa+b*sb                                                      fcz0-098
      a1=a*a1+b*a2                                                      fcz0-099
      b1=a*b1+b*b2                                                      fcz0-100
      z1=a*z1+b*z2                                                      fcz0-101
      z1p=a*z1p+b*z2p                                                   fcz0-102
      sa=(sa-0.5d0*a1)/t                                                fcz0-103
      z1=z1-0.5d0*a1                                                    fcz0-104
      z1p=z1p-0.5d0*b1                                                  fcz0-105
      if (rs.lt.0.d0) go to 13                                          fcz0-106
      s=f0/(borne*sa)                                                   fcz0-107
      go to 14                                                          fcz0-108
   13 pieta=3.141592653589793d0*eta                                     fcz0-109
      s=dexp(pieta)                                                     fcz0-110
      s=dexp(-pieta/2.d0)*dsqrt(2.d0*pieta/(s-1.d0/s))/sa               fcz0-111
   14 f0=s*ro*z1                                                        fcz0-112
      fp0=s*(z1+ro*z1p/borne)                                           fcz0-113
      go to 18                                                          fcz0-114
c   regular series at the origin                                        fcz0-115
   15 pi=3.141592653589793d0                                            fcz0-116
      ro2=ro*ro                                                         fcz0-117
      etap=eta+eta                                                      fcz0-118
      pieta=pi*eta                                                      fcz0-119
      b=dexp(pieta)                                                     fcz0-120
      b=dexp(0.5d0*pieta)*dsqrt((b-1.d0/b)/(2.d0*pieta))                fcz0-121
      u0=0.d0                                                           fcz0-122
      u1=ro                                                             fcz0-123
      u=u0+u1                                                           fcz0-124
      up=1.d0                                                           fcz0-125
      xn=2.d0                                                           fcz0-126
      do 16 n=2,10000                                                   fcz0-127
      xn1=xn*(xn-1.d0)                                                  fcz0-128
      u2=(etap*ro*u1-ro2*u0)/xn1                                        fcz0-129
      u=u+u2                                                            fcz0-130
      up=up+xn*u2/ro                                                    fcz0-131
      if (dabs(u1)+dabs(u2).lt.1.d-10*dabs(u)) go to 17                 fcz0-132
      u0=u1                                                             fcz0-133
      u1=u2                                                             fcz0-134
   16 xn=xn+1.d0                                                        fcz0-135
   17 f0=u/b                                                            fcz0-136
      fp0=up/b                                                          fcz0-137
   18 call yfir(eta,ro,g0,gp0,sigma)                                    fcz0-138
      return                                                            fcz0-139
      end                                                               fcz0-140
c 27/11/98  ibm version                                         ecis97  yfri-000
      subroutine yfri(eta,rau,fo,fpo,go,gpo,idiv,sigma)                 yfri-001
      implicit real*8 (a-h,o-z)                                         yfri-002
      dimension q(5),qp(5)                                              yfri-003
c        coefficients riccati                                           yfri-004
      data g61,g62,g63,g64,g65,g66,g67,g68,g69,g610,g611/ 1.159057617187yfri-005
     15d-2,3.863525390625d-2,4.6600341796875d-2,4.8583984375d-2,1.156514yfri-006
     248567708d0,5.6874755859375d0,1.323888288225445d1,1.713083224826384yfri-007
     3d1,1.269003295898436d1,5.05523681640625d0,8.42539464010415d-1/    yfri-008
      data g81,g82,g83,g84,g85,g86,g87,g88,g89,g810,g811,g812,g813,g814,yfri-009
     1g815/ 1.851092066083633d-2,8.63842964172363d-2,1.564757823944092d-yfri-010
     21,1.430139541625977d-1,1.924622058868408d-1,8.500803152720129d0,7.yfri-011
     3265429720878595d1,3.057942376817972d2,7.699689544836672d2,1.254157yfri-012
     4054424285d3,1.361719536066055d3,9.831831171035763d2,4.547869927883yfri-013
     5148d2,1.222640538215636d2,1.455524450256709d1/                    yfri-014
      data gp61,gp62,gp63,gp64,gp65,gp66/ 0.289764404296875d-1,0.2318115yfri-015
     1234375d0,0.8056640625d0,1.6015625d0,0.3046875d0,5.625d0/          yfri-016
      data gp81,gp82,gp83,gp84,gp85,gp86,gp87,gp88/ 0.647882223129272d-1yfri-017
     1,0.6910743713378906d0,0.3322952270507811d1,0.94830322265625d1,17.6yfri-018
     296533203125d0,34.787109375d0,50.203125d0,78.75d0/                 yfri-019
      data q/ 0.4959570165d-1,0.8888888889d-2,0.2455199181d-2,0.91089580yfri-020
     161d-3,0.2534684115d-3/                                            yfri-021
      data qp,ho,hpo/ 0.1728260369d0,0.3174603174d-3,0.3581214850d-2,0.3yfri-022
     1117824680d-3,0.9073966427d-3,2*0.d0/                              yfri-023
      etac=eta*eta                                                      yfri-024
      eta2=eta+eta                                                      yfri-025
      etaro=eta*rau                                                     yfri-026
      ind=0                                                             yfri-027
      jnd=0                                                             yfri-028
      ig=0                                                              yfri-029
      idiv=0                                                            yfri-030
      if (eta.gt.0.d0) go to 1                                          yfri-031
      if (-etaro-14.0625d0) 3 , 15 , 15                                 yfri-032
    1 if (dabs(rau-eta2).le.1.d-9) go to 14                             yfri-033
      if (rau-eta2) 6 , 14 , 2                                          yfri-034
    2 if (rau-eta2-2.d1*(eta**0.25d0)) 4 , 15 , 15                      yfri-035
    3 nn=1                                                              yfri-036
      go to 5                                                           yfri-037
    4 nn=0                                                              yfri-038
    5 call yfcl(eta,rau,fo,fpo,go,gpo,sigma,idiv,nn)                    yfri-039
      return                                                            yfri-040
    6 if (etaro.le.12.d0) go to 3                                       yfri-041
      tra=eta2-6.75d0*(eta**0.4d0)                                      yfri-042
      if (rau.le.tra) go to 7                                           yfri-043
      ind=1                                                             yfri-044
      jnd=1                                                             yfri-045
      ro=rau                                                            yfri-046
      rau=tra                                                           yfri-047
      rau0=tra                                                          yfri-048
c             riccati   1                                               yfri-049
    7 x=rau/eta2                                                        yfri-050
      u=(1.d0-x)/x                                                      yfri-051
      x2=x*x                                                            yfri-052
      ru=dsqrt(u)                                                       yfri-053
      rx=dsqrt(x)                                                       yfri-054
      tre=1.d0/(u*ru*eta2)                                              yfri-055
      trb=tre*tre                                                       yfri-056
      fi=(dsqrt((1.d0-x)*x)+datan2(rx,dsqrt(1.d0-rx*rx))-1.5707963267948yfri-057
     197d0)*eta2                                                        yfri-058
      tr1=-0.25d0*dlog(u)                                               yfri-059
      tr2=-((9.d0*u+6.d0)*u+5.d0)/48.d0                                 yfri-060
      tr3=((((-3.d0*u-4.d0)*u+6.d0)*u+12.d0)*u+5.d0)/64.d0              yfri-061
      tr4=-((((((u+2.d0)*945.d0*u+1395.d0)*u+12300.d0)*u+25191.d0)*u+198yfri-062
     190.d0)*u+5525.d0)/46080.d0                                        yfri-063
      tr5=((((((((-27.d0*u-72.d0)*u-68.d0)*u+360.d0)*u+2190.d0)*u+4808.dyfri-064
     10)*u+5148.d0)*u+2712.d0)*u+565.d0)/2048.d0                        yfri-065
      tr6=-((((((((((g61*u+g62)*u+g63)*u+g64)*u+g65)*u+g66)*u+g67)*u+g68yfri-066
     1)*u+g69)*u+g610)*u+g611)                                          yfri-067
      tr7=((((((((((((-81.d0*u-324.d0)*u-486.d0)*u-404.d0)*u+4509.d0)*u+yfri-068
     152344.d0)*u+233436.d0)*u+567864.d0)*u+838521.d0)*u+775884.d0)*u+44yfri-069
     21450.d0)*u+141660.d0)*u+19675.d0)/6144.d0                         yfri-070
      tr8=(((((((((((((g81*u+g82)*u+g83)*u+g84)*u+g85)*u+g86)*u+g87)*u+gyfri-071
     188)*u+g89)*u+g810)*u+g811)*u+g812)*u+g813)*u+g814)*u+g815         yfri-072
      fi=fi+tre*(tr2+trb*(tr4+trb*(tr6+trb*tr8)))                       yfri-073
      psi=-fi                                                           yfri-074
      tra=tr1+trb*(tr3+trb*(tr5+trb*tr7))                               yfri-075
      fi=fi+tra                                                         yfri-076
      psi=psi+tra                                                       yfri-077
      fip=ru*eta2                                                       yfri-078
      tra=1.d0/(x2*u)                                                   yfri-079
      tr1=0.25d0                                                        yfri-080
      tre=tre/(x2*x2*u)                                                 yfri-081
      trb=trb/(x2*x2)                                                   yfri-082
      tr2=-(8.d0*x-3.d0)/32.d0                                          yfri-083
      tr3=((24.d0*x-12.d0)*x+3.d0)/64.d0                                yfri-084
      tr4=(((-1536.d0*x+704.d0)*x-336.d0)*x+63.d0)/2048.d0              yfri-085
      tr5=((((1920.d0*x-576.d0)*x+504.d0)*x-180.d0)*x+27.d0)/1024.d0    yfri-086
      tr6=((((-gp66*x+gp65)*x-gp64)*x+gp63)*x-gp62)*x+gp61              yfri-087
      tr7=-((((((-40320.d0*x-10560.d0)*x-13248.d0)*x+7560.d0)*x-3132.d0)yfri-088
     1*x+756.d0)*x-81.d0)/2048.d0                                       yfri-089
      tr8=-(((((((gp88*x+gp87)*x+gp86)*x-gp85)*x+gp84)*x-gp83)*x+gp82)*xyfri-090
     1-gp81)                                                            yfri-091
      fip=fip+tre*(tr2+trb*(tr4+trb*(tr6+trb*tr8)))                     yfri-092
      psip=-fip                                                         yfri-093
      tra=tra*(tr1+trb*(tr3+trb*(tr5+trb*tr7)))                         yfri-094
      fip=fip+tra                                                       yfri-095
      psip=psip+tra                                                     yfri-096
      xxx=34.588776394910686d0                                          yfri-097
      indg=idint(psi/xxx)                                               yfri-098
      idiv=15*indg                                                      yfri-099
      if (indg.eq.0) go to 8                                            yfri-100
      psi=psi-xxx*indg                                                  yfri-101
      fi=fi+xxx*indg                                                    yfri-102
    8 fo=0.5d0*dexp(fi)                                                 yfri-103
      go=dexp(psi)                                                      yfri-104
      fpo=fo*fip/eta2                                                   yfri-105
      gpo=go*psip/eta2                                                  yfri-106
      if (jnd.eq.0) return                                              yfri-107
      rau=ro                                                            yfri-108
      go=fo                                                             yfri-109
      gpo=fpo                                                           yfri-110
    9 x=rau0-ro                                                         yfri-111
      x2=x*x                                                            yfri-112
      x3=x*x2                                                           yfri-113
      unr=1.d0/rau0                                                     yfri-114
      etr0=1.d0-2.d0*eta*unr                                            yfri-115
      u0=go                                                             yfri-116
      u1=-x*gpo                                                         yfri-117
      u2=-0.5d0*etr0*x2*u0                                              yfri-118
      s=u0+u1+u2                                                        yfri-119
      v1=u1/x                                                           yfri-120
      v2=2.d0*u2/x                                                      yfri-121
      t=v1+v2                                                           yfri-122
      xn=3.d0                                                           yfri-123
      do 11 n=3,10000                                                   yfri-124
      xn1=xn-1.d0                                                       yfri-125
      xn1=xn*xn1                                                        yfri-126
      u3=x*u2*unr*(1.d0-2.d0/xn)-etr0*u1*x2/xn1+x3*u0*unr/xn1           yfri-127
      s=s+u3                                                            yfri-128
      v3=xn*u3/x                                                        yfri-129
      t=t+v3                                                            yfri-130
      if (dabs(u3).gt.1.d-10*dabs(s)) go to 10                          yfri-131
      if (dabs(v3).le.1.d-10*dabs(t)) go to 12                          yfri-132
   10 u0=u1                                                             yfri-133
      u1=u2                                                             yfri-134
      u2=u3                                                             yfri-135
   11 xn=xn+1.d0                                                        yfri-136
   12 if (ig.eq.0) go to 13                                             yfri-137
      go=s                                                              yfri-138
      gpo=-t                                                            yfri-139
      fo=ho                                                             yfri-140
      fpo=hpo                                                           yfri-141
      return                                                            yfri-142
   13 ho=s                                                              yfri-143
      hpo=-t                                                            yfri-144
   14 et0=eta**(0.1666666666666667d0)                                   yfri-145
      etad=etac*etac                                                    yfri-146
      et=eta**(0.6666666666666667d0)                                    yfri-147
      et1=et*et                                                         yfri-148
      et2=et1*et1                                                       yfri-149
      et3=et2*et                                                        yfri-150
      et4=etad*et                                                       yfri-151
      et5=et4*et                                                        yfri-152
      fo=1.d0-q(1)/et1-q(2)/etac-q(3)/et3-q(4)/etad-q(5)/et5            yfri-153
      go=1.d0+q(1)/et1-q(2)/etac+q(3)/et3-q(4)/etad+q(5)/et5            yfri-154
      fpo=1.d0+qp(1)/et+qp(2)/etac+qp(3)/et2+qp(4)/etad+qp(5)/et4       yfri-155
      gpo=1.d0-qp(1)/et+qp(2)/etac-qp(3)/et2+qp(4)/etad-qp(5)/et4       yfri-156
      fo=0.7063326373d0*et0*fo                                          yfri-157
      go=1.223404016d0*et0*go                                           yfri-158
      fpo=0.4086957323d0*fpo/et0                                        yfri-159
      gpo=-0.7078817734d0*gpo/et0                                       yfri-160
      idiv=0                                                            yfri-161
      if (ind.eq.0) return                                              yfri-162
      ig=1                                                              yfri-163
      rau0=eta2                                                         yfri-164
      go to 9                                                           yfri-165
c        riccati 2 et 3                                                 yfri-166
   15 x=eta2/rau                                                        yfri-167
      x2=x*x                                                            yfri-168
      u=1.d0-x                                                          yfri-169
      ru=dsqrt(u)                                                       yfri-170
      u3=u*u*u                                                          yfri-171
      trd=1.d0/(u3*eta2*eta2)                                           yfri-172
      trc=x2*trd                                                        yfri-173
      tre=1.d0/(u*ru*eta2)                                              yfri-174
      fi=-0.25d0*dlog(u)                                                yfri-175
      trb=trd/64.d0                                                     yfri-176
      tr3=(((3.d0*u-4.d0)*u-6.d0)*u+12.d0)*u-5.d0                       yfri-177
      tr5=((((((((-27.d0*u+72.d0)*u-68.d0)*u-360.d0)*u+2190.d0)*u-4808.dyfri-178
     10)*u+5148.d0)*u-2712.d0)*u+565.d0)/32.d0                          yfri-179
      tr7=((((((((((((81.d0*u-324.d0)*u+486.d0)*u-404.d0)*u-4509.d0)*u+5yfri-180
     12344.d0)*u-233436.d0)*u+567864.d0)*u-838521.d0)*u+775884.d0)*u-441yfri-181
     2450.d0)*u+141660.d0)*u-19675.d0)/96.d0                            yfri-182
      fi=fi+trb*(tr3+trd*(tr5+trd*tr7))                                 yfri-183
      fip=0.25d0/u                                                      yfri-184
      trb=3.d0*trc/(64.d0*u)                                            yfri-185
      tr3=(4.d0-x)*x-8.d0                                               yfri-186
      tr5=((((9.d0*x-60.d0)*x+168.d0)*x-192.d0)*x+640.d0)/16.d0         yfri-187
      tr7=((((((-27.d0*x+252.d0)*x-1044.d0)*x+2520.d0)*x-4416.d0)*x-3520yfri-188
     1.d0)*x-13440.d0)/32.d0                                            yfri-189
      fip=fip+trb*(tr3+trc*(tr5+trc*tr7))                               yfri-190
      tra=dabs((ru-1.d0)/(ru+1.d0))                                     yfri-191
      psi=(0.5d0*dlog(tra)+ru/x)*eta2+0.785398163397448d0               yfri-192
      tr2=-((9.d0*u-6.d0)*u+5.d0)/48.d0                                 yfri-193
      tr4=((((((u-2.d0)*945.d0*u+1395.d0)*u-12300.d0)*u+25191.d0)*u-1989yfri-194
     10.d0)*u+5525.d0)/46080.d0                                         yfri-195
      tr6=(((((((((-g61*u+g62)*u-g63)*u+g64)*u-g65)*u+g66)*u-g67)*u+g68)yfri-196
     1*u-g69)*u+g610)*u-g611                                            yfri-197
      tr8=(((((((((((((g81*u-g82)*u+g83)*u-g84)*u+g85)*u-g86)*u+g87)*u-gyfri-198
     188)*u+g89)*u-g810)*u+g811)*u-g812)*u+g813)*u-g814)*u+g815         yfri-199
      psi=psi+tre*(tr2+trd*(tr4+trd*(tr6+trd*tr8)))                     yfri-200
      psip=-ru*eta2/x2                                                  yfri-201
      trb=tre*x/u                                                       yfri-202
      tr2=(3.d0*x-8.d0)/32.d0                                           yfri-203
      tr4=-(((63.d0*x-336.d0)*x+704.d0)*x-1536.d0)/2048.d0              yfri-204
      tr6=((((gp61*x-gp62)*x+gp63)*x-gp64)*x+gp65)*x-gp66               yfri-205
      tr8=((((((-gp81*x+gp82)*x-gp83)*x+gp84)*x-gp85)*x+gp86)*x+gp87)*x+yfri-206
     1gp88                                                              yfri-207
      psip=psip+trb*(tr2+trc*(tr4+trc*(tr6+trc*tr8)))                   yfri-208
      tra=dexp(fi)                                                      yfri-209
      fo=tra*dsin(psi)                                                  yfri-210
      go=tra*dcos(psi)                                                  yfri-211
      if (eta.gt.0.d0) go to 16                                         yfri-212
      tra=fo                                                            yfri-213
      fo=-go                                                            yfri-214
      go=tra                                                            yfri-215
   16 tra=-eta2/(rau*rau)                                               yfri-216
      fpo=(fip*fo+psip*go)*tra                                          yfri-217
      gpo=(fip*go-psip*fo)*tra                                          yfri-218
      return                                                            yfri-219
      end                                                               yfri-220
c 29/10/85  ibm version                                         ecis88  yfcl-000
      subroutine yfcl(eta,ro,u,up,v,vp,sigma,idiv,nn)                   yfcl-001
      implicit real*8 (a-h,o-z)                                         yfcl-002
      idiv=0                                                            yfcl-003
      etap=eta+eta                                                      yfcl-004
      ro2=ro*ro                                                         yfcl-005
      if (nn.eq.1) go to 4                                              yfcl-006
c          clenshaw asymptotic                                          yfcl-007
      e2=eta*eta                                                        yfcl-008
      m=40.d0+eta/4.d0                                                  yfcl-009
      m=2*(m/2)                                                         yfcl-010
      i=1                                                               yfcl-011
      r=m                                                               yfcl-012
      d4=4.d0*r                                                         yfcl-013
      tm1=1.d0                                                          yfcl-014
      t=4.d0*eta/ro-1.d0                                                yfcl-015
      z=t+t                                                             yfcl-016
      do 1 j=1,m                                                        yfcl-017
      tp1=z*t-tm1                                                       yfcl-018
      tm1=t                                                             yfcl-019
    1 t=tp1                                                             yfcl-020
      t=tm1                                                             yfcl-021
      gr=0.d0                                                           yfcl-022
      gpr=0.d0                                                          yfcl-023
      scr=0.d0                                                          yfcl-024
      ep1r=0.d0                                                         yfcl-025
      er=0.d0                                                           yfcl-026
      dp1r=0.d0                                                         yfcl-027
      dr=1.d-25                                                         yfcl-028
      c1r=r+1.d0                                                        yfcl-029
      c0r=e2-r*(r+1.d0)                                                 yfcl-030
      gi=0.d0                                                           yfcl-031
      gpi=0.d0                                                          yfcl-032
      sci=0.d0                                                          yfcl-033
      ep1i=0.d0                                                         yfcl-034
      ei=0.d0                                                           yfcl-035
      dp1i=0.d0                                                         yfcl-036
      di=0.d0                                                           yfcl-037
      c1i=-3.d0*eta                                                     yfcl-038
      c0i=-(r+r+1.d0)*eta                                               yfcl-039
c          backwards recurrence                                         yfcl-040
    2 scz=c0r*c0r+c0i*c0i                                               yfcl-041
      c2r=c1r*dr-c1i*di+0.5d0*(dp1r+er+ep1r)-eta*dp1i                   yfcl-042
      c2i=c1r*di+c1i*dr+0.5d0*(dp1i+ei+ep1i)+eta*dp1r                   yfcl-043
      cr=(c2r*c0r+c2i*c0i)/scz                                          yfcl-044
      ci=(c0r*c2i-c0i*c2r)/scz                                          yfcl-045
      gr=gr+cr*t                                                        yfcl-046
      gpr=gpr+dr*t                                                      yfcl-047
      scr=scr+i*cr                                                      yfcl-048
      gi=gi+ci*t                                                        yfcl-049
      gpi=gpi+di*t                                                      yfcl-050
      sci=sci+i*ci                                                      yfcl-051
      if (r.eq.0.d0) go to 3                                            yfcl-052
      em1r=d4*dr+ep1r                                                   yfcl-053
      dm1r=d4*cr+dp1r                                                   yfcl-054
      ep1r=er                                                           yfcl-055
      er=em1r                                                           yfcl-056
      dp1r=dr                                                           yfcl-057
      dr=dm1r                                                           yfcl-058
      em1i=d4*di+ep1i                                                   yfcl-059
      dm1i=d4*ci+dp1i                                                   yfcl-060
      ep1i=ei                                                           yfcl-061
      ei=em1i                                                           yfcl-062
      dp1i=di                                                           yfcl-063
      di=dm1i                                                           yfcl-064
      tm1=z*t-tp1                                                       yfcl-065
      tp1=t                                                             yfcl-066
      t=tm1                                                             yfcl-067
      c0r=c0r+r+r                                                       yfcl-068
      c0i=c0i+etap                                                      yfcl-069
      c1r=c1r-1.d0                                                      yfcl-070
      i=-i                                                              yfcl-071
      d4=d4-4.d0                                                        yfcl-072
      r=r-1.d0                                                          yfcl-073
      go to 2                                                           yfcl-074
    3 scr=scr-0.5d0*cr                                                  yfcl-075
      gr=gr-0.5d0*cr                                                    yfcl-076
      gpr=gpr-0.5d0*dr                                                  yfcl-077
      sci=sci-0.5d0*ci                                                  yfcl-078
      gi=gi-0.5d0*ci                                                    yfcl-079
      gpi=gpi-0.5d0*di                                                  yfcl-080
      z=sigma+ro-eta*dlog(ro+ro)                                        yfcl-081
      scz=scr*scr+sci*sci                                               yfcl-082
      cr=dcos(z)                                                        yfcl-083
      ci=dsin(z)                                                        yfcl-084
      dr=(cr*scr+ci*sci)/scz                                            yfcl-085
      di=(ci*scr-cr*sci)/scz                                            yfcl-086
      sci=1.d0-eta/ro                                                   yfcl-087
      scr=etap/ro2                                                      yfcl-088
      cr=-gi*sci-gpr*scr                                                yfcl-089
      ci=gr*sci-gpi*scr                                                 yfcl-090
      vp=dr*cr-di*ci                                                    yfcl-091
      up=dr*ci+di*cr                                                    yfcl-092
      v=dr*gr-di*gi                                                     yfcl-093
      u=dr*gi+di*gr                                                     yfcl-094
      return                                                            yfcl-095
c          series at the origin                                         yfcl-096
    4 pi=3.141592653589793d0                                            yfcl-097
      pieta=pi*eta                                                      yfcl-098
      if (dabs(pieta).gt.36.d0) go to 5                                 yfcl-099
      p=dsqrt((dexp(2.d0*pieta)-1.d0)/(2.d0*pieta))                     yfcl-100
      go to 7                                                           yfcl-101
    5 if (pieta.gt.0.d0) go to 6                                        yfcl-102
      p=1.d0/dsqrt(-pieta-pieta)                                        yfcl-103
      go to 7                                                           yfcl-104
    6 z=34.588776394910686d0                                            yfcl-105
      idiv=pieta/z                                                      yfcl-106
      p=dexp(pieta-idiv*z)/dsqrt(pieta+pieta)                           yfcl-107
      idiv=15*idiv                                                      yfcl-108
    7 z1=etap*(psi(eta)+.6931471805599453d0)                            yfcl-109
      u0=0.d0                                                           yfcl-110
      u1=ro                                                             yfcl-111
      v0=1.d0                                                           yfcl-112
      v1=z1*ro                                                          yfcl-113
      u=u0+u1                                                           yfcl-114
      v=v0+v1                                                           yfcl-115
      up=1.d0                                                           yfcl-116
      vp=z1                                                             yfcl-117
      xn=2.d0                                                           yfcl-118
      do 9 n=2,10000                                                    yfcl-119
      xn1=xn*(xn-1.d0)                                                  yfcl-120
      u2=(etap*ro*u1-ro2*u0)/xn1                                        yfcl-121
      u=u+u2                                                            yfcl-122
      v2=(etap*ro*v1-ro2*v0-etap*(xn+xn-1.d0)*u2)/xn1                   yfcl-123
      v=v+v2                                                            yfcl-124
      up=up+xn*u2/ro                                                    yfcl-125
      vp=vp+xn*v2/ro                                                    yfcl-126
      if (dabs(u2).gt.1.d-14*dabs(u)) go to 8                           yfcl-127
      if (dabs(v2).le.1.d-14*dabs(v)) go to 10                          yfcl-128
    8 u0=u1                                                             yfcl-129
      u1=u2                                                             yfcl-130
      v0=v1                                                             yfcl-131
      v1=v2                                                             yfcl-132
    9 xn=xn+1.d0                                                        yfcl-133
   10 pp=v+etap*u*dlog(ro)                                              yfcl-134
      w=u/p                                                             yfcl-135
      wp=up/p                                                           yfcl-136
      v=p*pp                                                            yfcl-137
      vp=p*(vp+etap*(up*dlog(ro)+u/ro))                                 yfcl-138
      u=w                                                               yfcl-139
      up=wp                                                             yfcl-140
      return                                                            yfcl-141
      end                                                               yfcl-142
c 29/10/85  ibm version                                         ecis88  yfas-000
      subroutine yfas(eta,rau,fo,fpo,go,gpo,sigo)                       yfas-001
      implicit real*8 (a-h,o-z)                                         yfas-002
c          asymptotic expansions                                        yfas-003
      trb=0.d0                                                          yfas-004
      rau2=rau+rau                                                      yfas-005
      etac=eta*eta                                                      yfas-006
      n=0                                                               yfas-007
      ps=1.d0                                                           yfas-008
      gs=0.d0                                                           yfas-009
      pt=0.d0                                                           yfas-010
      gt=1.d0-eta/rau                                                   yfas-011
      sf=ps                                                             yfas-012
      sg=gs                                                             yfas-013
      spf=pt                                                            yfas-014
      spg=gt                                                            yfas-015
    1 denom=(n+1)*rau2                                                  yfas-016
      an=(n+n+1)*eta/denom                                              yfas-017
      bn=(etac-n*(n+1))/denom                                           yfas-018
      ps1=an*ps-bn*pt                                                   yfas-019
      gs1=an*gs-bn*gt-ps1/rau                                           yfas-020
      pt1=an*pt+bn*ps                                                   yfas-021
      gt1=an*gt+bn*gs-pt1/rau                                           yfas-022
      sf=sf+ps1                                                         yfas-023
      sg=sg+gs1                                                         yfas-024
      spf=spf+pt1                                                       yfas-025
      spg=spg+gt1                                                       yfas-026
      n=n+1                                                             yfas-027
      if (dabs(ps1).gt.trb) trb=dabs(ps1)                               yfas-028
      if (dabs(ps1).lt.1.d-10*trb.or.bn.lt.-1.d0) go to 2               yfas-029
      ps=ps1                                                            yfas-030
      gs=gs1                                                            yfas-031
      pt=pt1                                                            yfas-032
      gt=gt1                                                            yfas-033
      go to 1                                                           yfas-034
    2 tetao=rau-eta*dlog(rau2)+sigo                                     yfas-035
      tra=dsin(tetao)                                                   yfas-036
      trb=dcos(tetao)                                                   yfas-037
      go=sf*trb-spf*tra                                                 yfas-038
      gpo=sg*trb-spg*tra                                                yfas-039
      fo=spf*trb+sf*tra                                                 yfas-040
      fpo=spg*trb+sg*tra                                                yfas-041
      return                                                            yfas-042
      end                                                               yfas-043
c 04/04/98  ibm version                                         ecis97  yfir-000
      subroutine yfir(eta,ro,g0,gp0,sigma)                              yfir-001
c  irregular coulomb function                                           yfir-002
      implicit real*8(a-h,o-z)                                          yfir-003
      if (eta.le.0.d0) go to 9                                          yfir-004
      if ((ro.le.(54.d0-eta)/80.d0).or.(eta.le.22.d0.and.ro.le.(30.d0-etyfir-005
     1a)/20.d0).or.(eta.le.18.d0.and.ro.le.0.075d0*(26.d0-eta)).or.(eta.yfir-006
     2le.10.d0.and.ro.le..15d0*(18.d0-eta)).or.(eta.le.3.d0.and.ro.le.2.yfir-007
     325d0+7.35d0*(3.d0-eta))) go to 5                                  yfir-008
c   taylor series starting from rau0                                    yfir-009
    1 rau0=1.666666666666667d0*dabs(eta)+7.5d0                          yfir-010
      call yfas(eta,rau0,f0,fp0,g0,gp0,sigma)                           yfir-011
      x=rau0-ro                                                         yfir-012
      x2=x*x                                                            yfir-013
      x3=x*x2                                                           yfir-014
      unr=1.d0/rau0                                                     yfir-015
      etr0=1.d0-2.d0*eta*unr                                            yfir-016
      u0=g0                                                             yfir-017
      u1=-x*gp0                                                         yfir-018
      u2=-0.5d0*etr0*x2*u0                                              yfir-019
      s=u0+u1+u2                                                        yfir-020
      v1=u1/x                                                           yfir-021
      v2=2.d0*u2/x                                                      yfir-022
      t=v1+v2                                                           yfir-023
      xn=3.d0                                                           yfir-024
      do 3 n=3,10000                                                    yfir-025
      xn1=xn-1.d0                                                       yfir-026
      xn1=xn*xn1                                                        yfir-027
      u3=x*u2*unr*(1.d0-2.d0/xn)-etr0*u1*x2/xn1+x3*u0*unr/xn1           yfir-028
      s=s+u3                                                            yfir-029
      v3=xn*u3/x                                                        yfir-030
      t=t+v3                                                            yfir-031
      if (dabs(u3).gt.1.d-11*dabs(s)) go to 2                           yfir-032
      if (dabs(v3).le.1.d-11*dabs(t)) go to 4                           yfir-033
    2 u0=u1                                                             yfir-034
      u1=u2                                                             yfir-035
      u2=u3                                                             yfir-036
    3 xn=xn+1.d0                                                        yfir-037
    4 g0=s                                                              yfir-038
      gp0=-t                                                            yfir-039
      return                                                            yfir-040
c   series at the origin                                                yfir-041
    5 pi=3.141592653589793d0                                            yfir-042
      ro2=ro*ro                                                         yfir-043
      etap=eta+eta                                                      yfir-044
      pieta=pi*eta                                                      yfir-045
      pieta2=0.5d0*pieta                                                yfir-046
      b=dexp(pieta)                                                     yfir-047
      b=dexp(pieta2)*dsqrt((b-1.d0/b)/(2.d0*pieta))                     yfir-048
      c1=etap*(psi(eta)+.6931471805599453d0)                            yfir-049
      u0=0.d0                                                           yfir-050
      u1=ro                                                             yfir-051
      v0=1.d0                                                           yfir-052
      v1=c1*ro                                                          yfir-053
      u=u0+u1                                                           yfir-054
      v=v0+v1                                                           yfir-055
      up=1.d0                                                           yfir-056
      vp=c1                                                             yfir-057
      xn=2.d0                                                           yfir-058
      do 7 n=2,10000                                                    yfir-059
      xn1=xn*(xn-1.d0)                                                  yfir-060
      u2=(etap*ro*u1-ro2*u0)/xn1                                        yfir-061
      u=u+u2                                                            yfir-062
      v2=(etap*ro*v1-ro2*v0-etap*(xn+xn-1.d0)*u2)/xn1                   yfir-063
      v=v+v2                                                            yfir-064
      up=up+xn*u2/ro                                                    yfir-065
      vp=vp+xn*v2/ro                                                    yfir-066
      if (dabs(u2).gt.1.d-14*dabs(u)) go to 6                           yfir-067
      if (dabs(v2).le.1.d-14*dabs(v)) go to 8                           yfir-068
    6 u0=u1                                                             yfir-069
      u1=u2                                                             yfir-070
      v0=v1                                                             yfir-071
      v1=v2                                                             yfir-072
    7 xn=xn+1.d0                                                        yfir-073
    8 gp=v+etap*u*dlog(ro)                                              yfir-074
      g0=b*gp                                                           yfir-075
      gp0=b*(vp+etap*(up*dlog(ro)+u/ro))                                yfir-076
      return                                                            yfir-077
    9 if (ro.le.0.5d0*eta+9.d0) go to 5                                 yfir-078
      go to 1                                                           yfir-079
      end                                                               yfir-080
c 29/10/85  ibm version                                         ecis88  sigm-000
      function sigm(eta)                                                sigm-001
c  coulomb phase shift sigma0                                           sigm-002
      implicit real*8 (a-h,o-z)                                         sigm-003
      dimension c(2,13)                                                 sigm-004
      data c1,c2,c3,c4,c5,c6,c7,c /8.333333333333333d-2,-2.7777777777777sigm-005
     178d-3,7.936507936507937d-4,-5.952380952380952d-4,8.417508417508417sigm-006
     2d-4,-1.917526917526918d-3,6.41025641025641d-3,1.d-16,1.4d-15,-5.4dsigm-007
     3-15,-2.07d-14,5.1d-13,-3.6968d-12,7.7823d-12,1.043427d-10,-1.18127sigm-008
     446d-9,5.0020075d-9,6.116095d-9,-2.056338417d-7,1.133027232d-6,-1.2sigm-009
     5504934821d-6,-2.01348547807d-5,1.280502823882d-4,-2.152416741149d-sigm-010
     64,-1.1651675918591d-3,7.218943246663d-3,-9.621971527877d-3,-4.2197sigm-011
     77345555443d-2,.1665386113822915d0,-4.20026350340952d-2,-.655878071sigm-012
     85202538d0,.5772156649015329d0,1.d0/                               sigm-013
      if (dabs(eta).gt.1.d-16) go to 1                                  sigm-014
      sigm=-c(1,13)*eta                                                 sigm-015
      go to 5                                                           sigm-016
    1 e=eta*eta                                                         sigm-017
      if (e.gt.1.d0) go to 3                                            sigm-018
      x=c(1,1)                                                          sigm-019
      y=c(2,1)                                                          sigm-020
      do 2 i=2,13                                                       sigm-021
      x=c(1,i)-e*x                                                      sigm-022
    2 y=c(2,i)-e*y                                                      sigm-023
      sigm=-datan2(eta*x,y)                                             sigm-024
      go to 5                                                           sigm-025
    3 l=1                                                               sigm-026
      if (e.lt.64.d0) l=2.d0+dsqrt(64.d0-e)                             sigm-027
      z=l                                                               sigm-028
      x=dsqrt(z*z+e)                                                    sigm-029
      y=datan2(eta,z)                                                   sigm-030
      e=1.d0/(z*z+e)                                                    sigm-031
      sigm=eta*(dlog(x)-1.d0)+(z-.5d0)*y-(c1*dsin(y)+e*(c2*dsin(3.d0*y)+sigm-032
     1e*(c3*dsin(5.d0*y)+e*(c4*dsin(7.d0*y)+e*(c5*dsin(9.d0*y)+e*(c6*dsisigm-033
     2n(11.d0*y)+e*c7*dsin(13.d0*y)))))))/x                             sigm-034
      if (l.eq.1) go to 5                                               sigm-035
      j=l-1                                                             sigm-036
      do 4 i=1,j                                                        sigm-037
      z=z-1.d0                                                          sigm-038
    4 sigm=sigm-datan2(eta,z)                                           sigm-039
    5 return                                                            sigm-040
      end                                                               sigm-041
c 29/10/85  ibm version                                         ecis88  psi -000
      function psi(eta)                                                 psi -001
c  real part of psi(1-i*eta)-psi(1)-psi(i)                              psi -002
c  with psi(z) = logarithmic derivative of the gamma function           psi -003
      double precision psi,e,eta,x,y,c,c1,c2,c3,c4,c5,c6,b(13)          psi -004
      data c/.5772156649015329d0/,c1/8.333333333333333d-2/,c2/-8.3333333psi -005
     133333333d-3/,c3/3.968253968253968d-3/,c4/-4.166666666666667d-3/,c5psi -006
     2/7.575757575757576d-3/,c6/-2.109279609279609d-2/,b/7.4507117898354psi -007
     328d-9,2.980350351465228d-8,1.192199259653110d-7,4.769329867878064dpsi -008
     4-7,1.908212716553938d-6,7.637197637899762d-6,3.058823630702049d-5,psi -009
     51.227133475784893d-4,4.941886041194665d-4,2.008392826082234d-3,8.3psi -010
     649277381922945d-3,3.692775514337036d-2,2.020569031595948d-1/      psi -011
      if (dabs(eta).gt.1.d-8) go to 1                                   psi -012
      psi=c-1.d0                                                        psi -013
      go to 5                                                           psi -014
    1 e=eta*eta                                                         psi -015
      if (e.gt..25d0) go to 3                                           psi -016
      x=b(1)                                                            psi -017
      do 2 i=2,13                                                       psi -018
    2 x=b(i)-e*x                                                        psi -019
      psi=c-1.d0/(1.d0+e)+e*x                                           psi -020
      go to 5                                                           psi -021
    3 l=1                                                               psi -022
      if (e.lt.64.d0) l=2.d0+dsqrt(64.d0-e)                             psi -023
      x=dsqrt(l*l+e)                                                    psi -024
      y=datan(eta/l)                                                    psi -025
      e=1.d0/(l*l+e)                                                    psi -026
      psi=dlog(x)-.5d0*l*e-e*(c1*dcos(2*y)+e*(c2*dcos(4*y)+e*(c3*dcos(6*psi -027
     1y)+e*(c4*dcos(8*y)+e*(c5*dcos(10*y)+e*(c6*dcos(12*y)+e*c1*dcos(14*psi -028
     2y)))))))+c+c-1.d0                                                 psi -029
      if (l.eq.1) go to 5                                               psi -030
      j=l-1                                                             psi -031
      e=eta*eta                                                         psi -032
      do 4 i=1,j                                                        psi -033
    4 psi=psi-1.d0/(i+e/i)                                              psi -034
    5 return                                                            psi -035
      end                                                               psi -036
c 04/04/98  ibm version                                         ecis97  cori-000
      subroutine cori(ei,ef,s1,s2,rr,t,ssi,ssf,fgi,fgf,z,lm1,lm2,lm3,lm,cori-001
     1w,idmt,lo)                                                        cori-002
c    computation of the integrals from rs to infinity of products of    cori-003
c regular or irregular coulomb functions of same l-value divided by r**2cori-004
c for l=0 to l=lm-1 and of regular functions of same l divided by r**2  cori-005
c l=0 to l=lm2-1.calls corz if there is no charge.                      cori-006
c input variables:  ei,ef:  coulomb parameters.                         cori-007
c                   s1,s2:  wave numbers.                               cori-008
c                   rr:     matching radius.                            cori-009
c                   ssi,ssf:coulomb phase-shifts for l=0.               cori-010
c                   fgi,fgf:regular and irregular coulomb functions.    cori-011
c                   lm1:    maximum number of integrals from rs to inf. cori-012
c                   lm2:    number of integrals from 0 to infinity      cori-013
c                   lm3:    dimension of working space(single precision)cori-014
c                   lm:     actual number of integrals from rs to inf.  cori-015
c                   idmt:   dimension of total working space.           cori-016
c                   lo:     logical controls.                           cori-017
c output:variables: t:      integrals from 0 to infinity for products ofcori-018
c                           regular functions.                          cori-019
c                   w:      integrals from rs to infinity.              cori-020
c working space:    z:      for the computation of hypergeometric f3.   cori-021
c***********************************************************************cori-022
      implicit real*8 (a-h,o-z)                                         cori-023
      logical lo(250),ll(4)                                             cori-024
      dimension w(lm1,4),x1(4),x2(4),x3(4),x4(4),fgi(lm1,2),fgf(lm1,2),zcori-025
     1(4,2),t(4),y(4,4),az(2),cc(4,4)                                   cori-026
      data pi /3.141592653589793d0/                                     cori-027
      si=s1*rr                                                          cori-028
      sf=s2*rr                                                          cori-029
      if (ei.eq.0.) go to 36                                            cori-030
c computation of some constants                                         cori-031
      if (si.gt.2.2d0*sf) go to 38                                      cori-032
      rs=dsqrt(si*sf)                                                   cori-033
      fs=dsqrt(sf/si)                                                   cori-034
      fi=ei**2                                                          cori-035
      ff=ef**2                                                          cori-036
      eif=ei*ef                                                         cori-037
      ex=ef-ei                                                          cori-038
      sif=si/sf+sf/si                                                   cori-039
      cx=fi*si**2+ff*sf**2                                              cori-040
      dx=fi*si**2-ff*sf**2                                              cori-041
      if (dabs(dx).gt.1.d-10) go to 1                                   cori-042
      dt=1.d0                                                           cori-043
      dx=0.d0                                                           cori-044
      dy=eif                                                            cori-045
      go to 2                                                           cori-046
    1 dt=si**2-sf**2                                                    cori-047
      dy=(fi*si**4-ff*sf**4)/(si*sf)                                    cori-048
      if (dabs(dt).lt.1.d-10) go to 2                                   cori-049
      dx=dx/dt                                                          cori-050
      dy=dy/dt                                                          cori-051
      dt=1.d0                                                           cori-052
    2 rm=dmax1((5.d0*dabs(ei)+22.5d0)*fs,(5.d0*dabs(ef)+22.5d0)/fs,.18d0cori-053
     1*eif)/3.d0                                                        cori-054
      if (rm.lt.rs) rm=rs                                               cori-055
c computation of integrals from rs to infinity for l=0 and l=1          cori-056
      call cor0(ei,ef,ssi,ssf,zr,zi,z,lm3,idmt,rm,rs,fs,fi,ff,ex,cc,lo) cori-057
c computation of integrals from 0 to infinity for l=0 and l=1           cori-058
      a1=dsqrt(1.d0+fi)                                                 cori-059
      b1=dsqrt(1.d0+ff)                                                 cori-060
      if (ei.ne.ef.or.si.ne.sf) go to 4                                 cori-061
c when ei=ef=e   i(l,l,2)=(pi-pi*coth(pi*e)-1/e+sum on n from 0 to l of cori-062
c                2*e/(n**2+e**2))/2/(2*l+1)                             cori-063
      a2=pi*.5d0                                                        cori-064
      b2=dexp(-2.d0*pi*ei)                                              cori-065
      if (ei.ne.0.d0) a2=a2-.5d0*pi*(b2+1.d0)/(1.d0-b2)+.5d0/ei         cori-066
      b3=0.d0                                                           cori-067
      do 3 i=1,lm2                                                      cori-068
      b2=b3                                                             cori-069
      b3=b3+1.d0                                                        cori-070
      t(i)=a2/(b2+b3)                                                   cori-071
    3 a2=a2+ei/(b3**2+fi)                                               cori-072
      ll(1)=.true.                                                      cori-073
      ll(2)=.true.                                                      cori-074
      go to 11                                                          cori-075
c computation of i(0,0,1) and i(1,1,1)                                  cori-076
c  i(l,l,1) = 2*(si*sf)**(1/2)/(si+sf)**2 * exp( pi*sign(sf-si)*ex/2) * cori-077
c real part of (|sf-si|/(sf+si))**(i*ex)*gamma(-i*ex)*exp(i*(xef-xei))* cori-078
c   2f1(l+1-i*ei,l+1+i*ef;1+i*ef-i*ei;((sf-si)/(sf+si))**2)             cori-079
c  where ex=ef-ei.                                                      cori-080
    4 a2=ex**2                                                          cori-081
      b2=((si-sf)/(si+sf))**2                                           cori-082
      a3=2.d0*dexp(zr-pi*.5d0*ex)/(si+sf)**2*rs                         cori-083
      if (sf.gt.si) a3=a3*dexp(pi*ex)                                   cori-084
      a4=zi+ssf-ssi+.5d0*dlog(b2)*ex                                    cori-085
      a5=a3*dcos(a4)                                                    cori-086
      a6=a3*dsin(a4)                                                    cori-087
      a3=a5                                                             cori-088
      a4=a6                                                             cori-089
      a7=0.d0                                                           cori-090
      do 7 l=1,2                                                        cori-091
      az(l)=a3                                                          cori-092
      a8=0.d0                                                           cori-093
      do 5 n=1,500                                                      cori-094
      a8=a8+1.d0                                                        cori-095
      b3=(a7+a8)**2+eif                                                 cori-096
      b4=(a7+a8)*ex                                                     cori-097
      b7=b2/(a8*(a8**2+a2))                                             cori-098
      b5=(b3*a8+b4*ex)*b7                                               cori-099
      b6=(a8*b4-ex*b3)*b7                                               cori-100
      a9=a3*b5-a4*b6                                                    cori-101
      a4=a3*b6+a4*b5                                                    cori-102
      a3=a9                                                             cori-103
      az(l)=az(l)+a3                                                    cori-104
      if (dabs(a3)+dabs(a4).lt.dabs(az(l))*1.d-16) go to 6              cori-105
    5 continue                                                          cori-106
      li=l-1                                                            cori-107
      write (2,1000) li,li,ei,ef,az(l),a3,a4                            cori-108
    6 b3=1.d0+eif                                                       cori-109
      b5=(1.d0-b2)/dsqrt(b3*b3+ex*ex)                                   cori-110
      a7=1.d0                                                           cori-111
      a3=b5*(a5*b3-a6*ex)                                               cori-112
    7 a4=b5*(a6*b3+a5*ex)                                               cori-113
c computation of i(0,0,2) and i(1,1,2) . only the first is needed       cori-114
c   for backward recurrence                                             cori-115
c i(l,l,2) = pi/(2*sh(pi*ex)*( (y/si-1/(y*sf))/(2*l+1)+((si-sf)/(sf*si))cori-116
c  *exp(-pi*ex/2) * real part of exp(i*(xei-xef))*((si-sf)/2)**(-i*ex)  cori-117
c  *sf**(i*ef)*si**(-i*ei)*f3(-l+i*ei,-l-i*ef,l+1+i*ei,l+1-i*ef,2-i*ex; cori-118
c  (si-sf)/(2*si),(sf-si)/(2*sf))                                       cori-119
c    where  y=exp(pi*ex/2)*(si/sf)**l*|gamma(l+1+i*ef)/gamma(l+1+i*ei)| cori-120
      a2=ex/(2.d0*ef)                                                   cori-121
      a3=-a2*(si-sf)/(2.d0*sf)                                          cori-122
      a4=a2*(si-sf)/(2.d0*si)                                           cori-123
      ll(1)=lm2*dabs(ex).gt.3.d0*dabs(ei+ef)                            cori-124
      ll(2)=.not.ll(1)                                                  cori-125
      b3=dexp(-zr)/ex/dsqrt(1.d0+ex**2)                                 cori-126
      b4=ssi-ssf-zi+datan(ex)-.5d0*pi+ef*dlog(sf)-ei*dlog(si)-ex*dlog(.5cori-127
     1d0*dabs(si-sf))                                                   cori-128
      if (sf.gt.si) b3=b3*dexp(ex*pi)                                   cori-129
      a5=b3*dcos(b4)                                                    cori-130
      a6=b3*dsin(b4)                                                    cori-131
      b5=a5                                                             cori-132
      b6=a6                                                             cori-133
      b2=dsqrt(ef/ei*(dexp(-2.d0*pi*ei)-1.d0)/(dexp(-2.d0*pi*ef)-1.d0)) cori-134
      a7=dexp(-.5d0*pi*ex)                                              cori-135
      a8=pi*a7**2/(1.d0-a7**4)*rs                                       cori-136
      a7=a7*(sf-si)/(sf*si)                                             cori-137
      a9=0.d0                                                           cori-138
      z(1,1)=1.d0                                                       cori-139
      z(2,1)=0.d0                                                       cori-140
      z(3,1)=1.d0                                                       cori-141
      z(4,1)=0.d0                                                       cori-142
      do 10 l=1,2                                                       cori-143
      li=l-1                                                            cori-144
      t(l)=b5                                                           cori-145
      c1=0.d0                                                           cori-146
      n=0                                                               cori-147
    8 n=n+1                                                             cori-148
      if (8*n.gt.lm3) call memo(idmt,idmt+8*n-lm3,lm3,3,lo)             cori-149
      if (lo(216)) go to 37                                             cori-150
      c1=c1+1.d0                                                        cori-151
      b3=c1+1.d0                                                        cori-152
      b4=b3**2+ex**2                                                    cori-153
      b9=(b5*b3-ex*b6)/(b4*a2)                                          cori-154
      b6=(b5*ex+b6*b3)/(b4*a2)                                          cori-155
      b5=b9                                                             cori-156
      b3=(a9+c1)*(c1-a9-1.d0)-fi                                        cori-157
      b4=ei*(2.d0*c1-1.d0)                                              cori-158
      z(1,n+1)=(z(1,n)*b3-z(2,n)*b4)*a4/c1                              cori-159
      z(2,n+1)=(z(1,n)*b4+z(2,n)*b3)*a4/c1                              cori-160
      b3=(a9+c1)*(c1-a9-1.d0)-ff                                        cori-161
      b4=-ef*(2.d0*c1-1.d0)                                             cori-162
      z(3,n+1)=(z(3,n)*b3-z(4,n)*b4)*a3/c1                              cori-163
      z(4,n+1)=(z(3,n)*b4+z(4,n)*b3)*a3/c1                              cori-164
      b7=z(1,n+1)                                                       cori-165
      b8=z(2,n+1)                                                       cori-166
      do 9 j=1,n                                                        cori-167
      m=n+2-j                                                           cori-168
      b7=b7+z(1,j)*z(3,m)-z(2,j)*z(4,m)                                 cori-169
    9 b8=b8+z(2,j)*z(3,m)+z(1,j)*z(4,m)                                 cori-170
      if (dabs(b7)+dabs(b8).gt.1.d30) go to 39                          cori-171
      b7=b7*b5-b8*b6                                                    cori-172
      t(l)=t(l)+b7                                                      cori-173
      if (dabs(b7).gt.dabs(t(l))*1.d-16) go to 8                        cori-174
      t(l)=a8*(a7*t(l)+(b2/si-1.d0/(b2*sf))/(2.d0*a9+1.d0))             cori-175
      if (ll(1)) go to 11                                               cori-176
      a9=1.d0                                                           cori-177
      b2=b2*sf/si*b1/a1                                                 cori-178
      b4=b1*a1                                                          cori-179
      b3=(1.d0+eif)/b4                                                  cori-180
      b4=-ex/b4                                                         cori-181
      b5=b3*a5-b4*a6                                                    cori-182
   10 b6=b3*a6+b4*a5                                                    cori-183
c comp. of the integrals from 0 to infinity                             cori-184
c upwards recurrences for the other integrals:  starting values         cori-185
   11 do 12 j=1,4                                                       cori-186
      w(1,j)=cc(j,3)                                                    cori-187
      w(2,j)=cc(j,4)                                                    cori-188
      x2(j)=cc(j,1)/rs                                                  cori-189
   12 x3(j)=cc(j,2)/rs                                                  cori-190
      rm=rs**2                                                          cori-191
      in=1                                                              cori-192
      lx=lm                                                             cori-193
      if (.not.ll(1)) lx=max0(lx,lm2)                                   cori-194
      ll(3)=ll(1)                                                       cori-195
      i=2                                                               cori-196
      if (ll(1)) go to 13                                               cori-197
      c4=az(1)                                                          cori-198
      c5=az(2)                                                          cori-199
   13 i=i+1                                                             cori-200
      a2=a1                                                             cori-201
      b2=b1                                                             cori-202
      a=i-1                                                             cori-203
      a1=dsqrt(a**2+fi)                                                 cori-204
      b1=dsqrt(a**2+ff)                                                 cori-205
      ll(4)=i.gt.lm                                                     cori-206
   14 a9=(a-1.d0)**2*dt+dx                                              cori-207
      a3=(2.d0*a-3.d0)*(a**2*dt+dx)*a2*b2                               cori-208
      a4=-(2.d0*a-1.d0)*(dx*cx/rm+dy*((a-1.d0)**2+a**2)+dt*(a*a-a)**2*sicori-209
     1f)                                                                cori-210
      a5=(2.d0*a+1.d0)*a9*a1*b1                                         cori-211
      c1=dt*(2.d0*a-1.d0)*(ei*si+ef*sf)*a2*b2/(a-1.d0)                  cori-212
      c2=dt*(a-.5d0)*(b2**2*((a-1.d0)*ef*sf-(a+1.d0)*ei*si)*sf/si+a2**2*cori-213
     1((a-1.d0)*ei*si-(a+1.d0)*ef*sf)*si/sf)/(a-1.d0)                   cori-214
      a6=a*a2*b2                                                        cori-215
      a7=-(2.d0*a-1.d0)*(eif+(a-1.d0)*a*sif*.5d0)                       cori-216
      a8=(a-1.d0)*a1*b1                                                 cori-217
      if (ll(4)) go to 15                                               cori-218
      b6=(a-.5d0)/(rm*rs*(a-1.d0)**2)                                   cori-219
      b3=-2.d0*rm*dx*b6*a2*b2                                           cori-220
      b4=b6*a9*sf*(2.d0*(a*a-a)*a+(a+1.d0)*ei*si-(a-1.d0)*ef*sf)*b2     cori-221
      b5=b6*a9*si*(2.d0*(a*a-a)*a+(a+1.d0)*ef*sf-(a-1.d0)*ei*si)*a2     cori-222
      b6=-b6*(a9*(2.d0*(a*a-a)**2*(2.d0*a-1.d0)+(ei*si+ef*sf)*(a-1.d0)*(cori-223
     1a+1.d0)*(2.d0*a-1.d0)+2.d0*eif*rm*a)-(a-1.d0)*(cx*dx+(a-1.d0)*((a+cori-224
     21.d0)*cx*dt-2.d0*rm*dy)))                                         cori-225
      b9=(a-.5d0)*a/rs                                                  cori-226
      b7=b9*b2/si                                                       cori-227
      b8=b9*a2/sf                                                       cori-228
      b9=b9*(-(2.d0*a-1.d0)*(a-1.d0)-(ei*si+ef*sf))/rm                  cori-229
   15 if (in.ne.1) go to 24                                             cori-230
      if (ll(3)) go to 16                                               cori-231
      t(i)=-(a3*t(i-2)+a4*t(i-1)+c1*c4+c2*c5)/a5                        cori-232
      c3=c4                                                             cori-233
      c4=c5                                                             cori-234
      c5=-(a6*c3+a7*c4)/a8                                              cori-235
   16 if (ll(4)) go to 21                                               cori-236
      do 18 j=1,4                                                       cori-237
      j1=mod(j+1,2)+i-2                                                 cori-238
      j2=(j+1)/2+i-3                                                    cori-239
      do 17 k=1,4                                                       cori-240
      k1=mod(k+1,2)*2+1                                                 cori-241
      k2=2*((k+1)/2)-1                                                  cori-242
   17 y(k,j)=fgi(j1,k1)*fgf(j2,k2)                                      cori-243
   18 continue                                                          cori-244
c recurrence for (0,2;l)                                                cori-245
      do 19 j=1,4                                                       cori-246
      x1(j)=x2(j)                                                       cori-247
      x2(j)=x3(j)                                                       cori-248
   19 w(i,j)=-(b3*y(j,1)+b4*y(j,2)+b5*y(j,3)+b6*y(j,4)+a3*w(i-2,j)+a4*w(cori-249
     1i-1,j)+c1*x1(j)+c2*x2(j))/a5                                      cori-250
      do 20 j=1,4                                                       cori-251
   20 x3(j)=-(b7*y(j,2)+b8*y(j,3)+b9*y(j,4)+a6*x1(j)+a7*x2(j))/a8       cori-252
   21 if (i.lt.lx) go to 13                                             cori-253
      ln=max0(lm,idint(rs))+50                                          cori-254
      lx=ln                                                             cori-255
      if (.not.ll(2)) lx=max0(lx,lm2+6*min0(idint((si+sf)/dabs(si-sf)),5cori-256
     100))                                                              cori-257
      ll(3)=ll(2)                                                       cori-258
      in=2                                                              cori-259
      x4(1)=1.d0                                                        cori-260
      x4(2)=0.d0                                                        cori-261
      x4(3)=0.d0                                                        cori-262
      x4(4)=0.d0                                                        cori-263
      a1=lx-1                                                           cori-264
      a2=dsqrt(a1**2+fi)                                                cori-265
      b2=dsqrt(a1**2+ff)                                                cori-266
      do 22 j=1,4                                                       cori-267
      x2(j)=0.d0                                                        cori-268
   22 x3(j)=0.d0                                                        cori-269
      x3(1)=1.d-20                                                      cori-270
      x3(2)=1.d-20                                                      cori-271
   23 lx=lx-1                                                           cori-272
      a=lx                                                              cori-273
      a1=a2                                                             cori-274
      b1=b2                                                             cori-275
      a3=lx-1                                                           cori-276
      ll(4)=lx.gt.ln                                                    cori-277
      a2=dsqrt(a3**2+fi)                                                cori-278
      b2=dsqrt(a3**2+ff)                                                cori-279
      go to 14                                                          cori-280
   24 if (ll(3)) go to 25                                               cori-281
      x4(1)=-a6/(a7+a8*x4(1))                                           cori-282
      x4(3)=x4(1)*x4(2)                                                 cori-283
      x4(2)=-(a4*x4(3)+a5*x4(4)*x4(1)+c1+c2*x4(1))/a3                   cori-284
      x4(4)=x4(3)                                                       cori-285
      if (lx.le.lm2) t(lx)=x4(3)/x4(2)                                  cori-286
   25 if (ll(4)) go to 31                                               cori-287
c downward recurrence for f(ei) and f(ef)                               cori-288
      do 26 j=1,4                                                       cori-289
      x1(j)=x2(j)                                                       cori-290
   26 x2(j)=x3(j)                                                       cori-291
      x3(1)=((2.d0*a-1.d0)*(ei+(a-1.d0)*a/si)*x2(1)-(a-1.d0)*a1*x1(1))/(cori-292
     1a*a2)                                                             cori-293
      x3(2)=((2.d0*a-1.d0)*(ef+(a-1.d0)*a/sf)*x2(2)-(a-1.d0)*b1*x1(2))/(cori-294
     1a*b2)                                                             cori-295
c downwards recurrence for (1,2;l)                                      cori-296
      x3(4)=-(a7*x2(4)+a8*x1(4)+b7*x2(1)*x3(2)+b8*x3(1)*x2(2)+b9*x2(1)*xcori-297
     12(2))/a6                                                          cori-298
c downward recurrence for (0,2;l)                                       cori-299
      x3(3)=-(a4*x2(3)+a5*x1(3)+c1*x3(4)+c2*x2(4)+b3*x3(1)*x3(2)+b4*x2(1cori-300
     1)*x3(2)+b5*x3(1)*x2(2)+b6*x2(1)*x2(2))/a3                         cori-301
      i=lx-1                                                            cori-302
      if (i.le.lm) w(i,1)=x3(3)                                         cori-303
      if (dabs(x3(1)).lt.1.d10) go to 27                                cori-304
      x3(1)=x3(1)*1.d-20                                                cori-305
      x2(1)=x2(1)*1.d-20                                                cori-306
      go to 28                                                          cori-307
   27 if (dabs(x3(2)).lt.1.d10) go to 31                                cori-308
      x2(2)=x2(2)*1.d-20                                                cori-309
      x3(2)=x3(2)*1.d-20                                                cori-310
   28 do 29 j=3,4                                                       cori-311
      x3(j)=x3(j)*1.d-20                                                cori-312
   29 x2(j)=x2(j)*1.d-20                                                cori-313
      if (i.gt.lm) go to 31                                             cori-314
      do 30 j=i,lm                                                      cori-315
   30 w(j,1)=w(j,1)*1.d-20                                              cori-316
   31 if (lx.gt.2) go to 23                                             cori-317
      if (ll(2)) go to 34                                               cori-318
c computation of the mixture of the decreasing solution of homogeneous  cori-319
c equation  (s2/s1)**l * |gamma(l+1+i*e2)/gamma(l+1+i*e1)|/(2*l+1)      cori-320
c where s2 is the smaller of the two values si and sf.                  cori-321
      a1=x4(2)*az(1)                                                    cori-322
      a2=t(1)-a1                                                        cori-323
      a3=0.d0                                                           cori-324
      do 33 i=2,lm2                                                     cori-325
      a3=a3+1.d0                                                        cori-326
      a1=t(i)*a1                                                        cori-327
      a4=sf*dsqrt((a3**2+ff)/(a3**2+fi))/si                             cori-328
      if (si.gt.sf) go to 32                                            cori-329
      a2=a2/a4                                                          cori-330
      go to 33                                                          cori-331
   32 a2=a2*a4                                                          cori-332
   33 t(i)=a1+a2/(2.d0*a3+1.d0)                                         cori-333
c the values obtained are unnormalised integrals from rs to 0.          cori-334
c normalisation and transformation to integral from rs to infinity      cori-335
   34 a1=fgi(1,1)*fgf(1,1)/(x3(1)*x3(2))                                cori-336
      do 35 j=1,lm                                                      cori-337
   35 w(j,1)=a1*w(j,1)+t(j)                                             cori-338
      if (s1.ne.s2) write (2,1001) cc(1,3),w(1,1),cc(1,4),w(2,1)        cori-339
c upwards recurrences for the other integrals:  starting values         cori-340
      return                                                            cori-341
   36 call corz(si,sf,t,fgi,fgf,lm1,lm2,lm,w)                           cori-342
      return                                                            cori-343
   37 write (2,1002)                                                    cori-344
      return                                                            cori-345
   38 write (2,1003) ef,ei                                              cori-346
      return                                                            cori-347
   39 write (2,1004) n,li,li,ei,ef,t(l),b5,b6                           cori-348
      return                                                            cori-349
 1000 format (37h no convergence with 500 terms for i(,i1,1h,,13h,1) witcori-350
     1h ei =,f15.6,31x,8hand ef =,f15.6,5x,7hin corh/5x,7hvalue =,d15.8,cori-351
     25x,11hlast term =,2d16.8/17h ... continue ...)                    cori-352
 1001 format (80h integrals with regular functions: (l+1)       direct  cori-353
     1     backwards recurrence/37x,1h1,2d20.10/37x,1h2,2d20.10)        cori-354
 1002 format (8h in cori)                                               cori-355
 1003 format (24h too large ratio ef/ei =,f15.6,1h/,f15.6,5x,7hin cori) cori-356
 1004 format (4h the,i4,43h term is too large in the computation of i(,icori-357
     11,1h,,i1,16h,2)    with ei =,f15.6,5x,8hand ef =,f15.6,5x,7hin corcori-358
     2h/5x,7hvalue =,d15.8,5x,11hlast term =,2d16.8)                    cori-359
      end                                                               cori-360
c 04/04/98  ibm version                                         ecis97  cor0-000
      subroutine cor0(ei,ef,ssi,ssf,zr,zi,z,lm3,idmt,rm,rs,fs,fi,ff,ex,ccor0-001
     1c,lo)                                                             cor0-002
c    computation of the integrals from rs to infinity of products of    cor0-003
c regular or irregular coulomb functions of l=0 and l=1 divided by r**2 cor0-004
c input variables: ei,ef:  coulomb parameters.                          cor0-005
c                  ssi,ssf:coulomb phase-shifts for l=0.                cor0-006
c                  lm3:    dimension of working space(single precision) cor0-007
c                  lm:     actual number of integrals from rs to inf.   cor0-008
c                  idmt:   dimension of total working space.            cor0-009
c                  rm:     actual matching radius for integrals.        cor0-010
c                  rs:     needed matching radius for integrals.        cor0-011
c                  fs:     square root of ratio of wave numbers.        cor0-012
c                  fi,ff:  squares of coulomb parameters.               cor0-013
c                  ex:     difference of coulomb parameters.            cor0-014
c                  lo:     logical controls.                            cor0-015
c output variables:cc:     integrals from rs to infinity.               cor0-016
c                  zr,zi:  real, imaginary part of log(gamma(0.,ei-ef)) cor0-017
c working space:   z:      for the computation of f and g.              cor0-018
c***********************************************************************cor0-019
      implicit real*8 (a-h,o-z)                                         cor0-020
      logical lo(250)                                                   cor0-021
      dimension x1(4),x2(4),x3(4),x4(4),x5(4),z(4,2),c(2,2,2),y(4,4),ie(cor0-022
     12),absc(20),p(20),b(7),cc(4,4)                                    cor0-023
      data pi /3.141592653589793d0/                                     cor0-024
      data b /.8333333333333333d-01,-.2777777777777778d-2,.7936507936507cor0-025
     19365d-3,-.5952380952380952d-3,.84175084175d-3,-.19175269d-2,.641d-cor0-026
     202/                                                               cor0-027
      data absc( 1),p( 1) / 0.88114514472040d-03, 0.22606385492666d-02/ cor0-028
      data absc( 2),p( 2) / 0.46368806502715d-02, 0.52491422655764d-02/ cor0-029
      data absc( 3),p( 3) / 0.11370025008113d-01, 0.82105291909539d-02/ cor0-030
      data absc( 4),p( 4) / 0.21041590393104d-01, 0.11122924597084d-01/ cor0-031
      data absc( 5),p( 5) / 0.33593595860662d-01, 0.13968503490012d-01/ cor0-032
      data absc( 6),p( 6) / 0.48950596515563d-01, 0.16730097641274d-01/ cor0-033
      data absc( 7),p( 7) / 0.67020248393870d-01, 0.19391083987236d-01/ cor0-034
      data absc( 8),p( 8) / 0.87693884583344d-01, 0.21935454092836d-01/ cor0-035
      data absc( 9),p( 9) / 0.11084717428674d+00, 0.24347903817536d-01/ cor0-036
      data absc(10),p(10) / 0.13634087240504d+00, 0.26613923491968d-01/ cor0-037
      data absc(11),p(11) / 0.16402165769291d+00, 0.28719884549696d-01/ cor0-038
      data absc(12),p(12) / 0.19372305516601d+00, 0.30653121246465d-01/ cor0-039
      data absc(13),p(13) / 0.22526643745244d+00, 0.32402006728300d-01/ cor0-040
      data absc(14),p(14) / 0.25846209915691d+00, 0.33956022907617d-01/ cor0-041
      data absc(15),p(15) / 0.29311039781420d+00, 0.35305823695643d-01/ cor0-042
      data absc(16),p(16) / 0.32900295458712d+00, 0.36443291197902d-01/ cor0-043
      data absc(17),p(17) / 0.36592390749637d+00, 0.37361584528984d-01/ cor0-044
      data absc(18),p(18) / 0.40365120964931d+00, 0.38055180950313d-01/ cor0-045
      data absc(19),p(19) / 0.44195796466237d+00, 0.38519909082124d-01/ cor0-046
      data absc(20),p(20) / 0.48061379124697d+00, 0.38752973989212d-01/ cor0-047
c computation of the integrals from rm to infinity for l=0,1 by         cor0-048
c rawitscher's method. (comp. physics comm., vol.11,183,1976)           cor0-049
c expansions of coulomb wave functions are z(n,2*m-1)+i*z(n,2*m)=g+i*f  cor0-050
c   n=1: l=0,e=ei     n=2: l=0,e=ef     n=3: l=1,e=ei     n=4: l=1,e=ef cor0-051
      a1=rm/fs                                                          cor0-052
      b1=rm*fs                                                          cor0-053
      x1(1)=a1-ei*dlog(2.d0*a1)+ssi                                     cor0-054
      x1(3)=b1-ef*dlog(2.d0*b1)+ssf                                     cor0-055
      x1(2)=x1(1)+datan(ei)-.5d0*pi                                     cor0-056
      x1(4)=x1(3)+datan(ef)-.5d0*pi                                     cor0-057
c first term of asymptotic expansion of h(+/-) for l=0,1                cor0-058
      do 1 i=1,4                                                        cor0-059
      x5(i)=0.d0                                                        cor0-060
      z(i,1)=dcos(x1(i))                                                cor0-061
    1 z(i,2)=dsin(x1(i))                                                cor0-062
      x1(1)=-a1-b1                                                      cor0-063
      x2(1)=ei+ef                                                       cor0-064
      x1(2)=b1-a1                                                       cor0-065
      x2(2)=-ex                                                         cor0-066
      if (dabs(x1(2)).lt.1.d-8) x1(2)=0.d0                              cor0-067
      if (x1(2).eq.0.d0) go to 4                                        cor0-068
c computation of log(gamma(0.,ei-ef))                                   cor0-069
      b2=-datan(ex/11.d0)                                               cor0-070
      b3=121.d0+ex**2                                                   cor0-071
      a2=.5d0*dlog(b3)                                                  cor0-072
      zr=.91893853320467274d0+10.5d0*a2+ex*b2-11.d0-dlog(dabs(ex))      cor0-073
      zi=10.5d0*b2+ex-ex*a2+0.5d0*pi                                    cor0-074
      if (ex.lt.0.d0) zi=zi-pi                                          cor0-075
      a2=11.d0/b3                                                       cor0-076
      b2=ex/b3                                                          cor0-077
      a3=a2**2-b2**2                                                    cor0-078
      b3=2.d0*a2*b2                                                     cor0-079
      do 2 i=1,7                                                        cor0-080
      zr=zr+b(i)*a2                                                     cor0-081
      zi=zi+b(i)*b2                                                     cor0-082
      c1=a2*a3-b2*b3                                                    cor0-083
      b2=a2*b3+b2*a3                                                    cor0-084
    2 a2=c1                                                             cor0-085
      do 3 i=1,10                                                       cor0-086
      a2=i                                                              cor0-087
      zr=zr-.5d0*dlog(a2**2+ex**2)                                      cor0-088
    3 zi=zi+datan(ex/a2)                                                cor0-089
    4 if (dabs(x1(2)).gt.2.d0) go to 9                                  cor0-090
c computation of the first confluent hypergeometric function            cor0-091
      if (x1(2).eq.0.d0) go to 8                                        cor0-092
      if (dabs(x2(2)).lt.1.d-3) go to 5                                 cor0-093
      a2=dexp(-dsign(0.5d0*pi,x1(2))*x2(2)+zr)                          cor0-094
      b2=dsign(zi,x2(2))+x2(2)*dlog(dabs(x1(2)))                        cor0-095
      x5(2)=a2*dcos(b2)                                                 cor0-096
      x5(4)=a2*dsin(b2)-1.d0/x2(2)                                      cor0-097
      go to 6                                                           cor0-098
c expansion for small ex                                                cor0-099
    5 a2=dlog(dabs(x1(2)))                                              cor0-100
      b2=pi*.5d0                                                        cor0-101
      if (x1(2).lt.0.d0) b2=-b2                                         cor0-102
      a3=a2*(1.d0+ex*(b2-ex*((a2**2-3.d0*b2**2)/6.d0+ex*b2*(a2**2-b2**2)cor0-103
     1/6.d0)))                                                          cor0-104
      b3=b2-ex*((a2**2-b2**2)/2.d0+ex*(b2*(3.d0*a2**2-b2**2)/6.d0-ex*(a2cor0-105
     1**4-6.d0*a2**2*b2**2+b2**4)/24.d0))                               cor0-106
      a2=.5772156649015329d0-.400685634386331d0*ex**2                   cor0-107
      b2=-ex*(.822467033424113d0-0.270580808427784d0*ex**2)             cor0-108
      a4=a2*(1.d0+ex*(b2-ex*((a2**2-3.d0*b2**2)/6.d0+ex*b2*(a2**2-b2**2)cor0-109
     1/6.d0)))                                                          cor0-110
      b4=b2-ex*((a2**2-b2**2)/2.d0+ex*(b2*(3.d0*a2**2-b2**2)/6.d0-ex*(a2cor0-111
     1**4-6.d0*a2**2*b2**2+b2**4)/24.d0))                               cor0-112
      x5(2)=-a3-a4-ex*(a3*b4+b3*a4)                                     cor0-113
      x5(4)=-b3-b4+ex*(a3*a4-b3*b4)                                     cor0-114
    6 a2=x5(2)                                                          cor0-115
      b2=x5(4)                                                          cor0-116
      a3=1.d0                                                           cor0-117
      b3=0.d0                                                           cor0-118
      do 7 j=1,1000                                                     cor0-119
      b4=j                                                              cor0-120
      c1=-x1(2)*(b4*b3-ex*a3)/(b4**2+ex**2)                             cor0-121
      b3=x1(2)*(b4*a3+ex*b3)/(b4**2+ex**2)                              cor0-122
      a3=c1                                                             cor0-123
      c2=(-x1(2)*b2+a3)/b4                                              cor0-124
      b2=(x1(2)*a2+b3)/b4                                               cor0-125
      a2=c2                                                             cor0-126
      x5(2)=x5(2)+a2                                                    cor0-127
      x5(4)=x5(4)+b2                                                    cor0-128
      if (dabs(a2)+dabs(b2).lt.1.d-12*(dabs(x5(2))+dabs(x5(4)))) go to 9cor0-129
    7 continue                                                          cor0-130
      go to 9                                                           cor0-131
    8 x5(4)=-.5d0*pi                                                    cor0-132
      x5(2)=0.d0                                                        cor0-133
    9 do 10 j=1,16                                                      cor0-134
   10 y(j,1)=0.d0                                                       cor0-135
      n=dmin1(a1+dsqrt(a1**2-fi),b1+dsqrt(b1**2-ff))+2.d0               cor0-136
      a3=0.d0                                                           cor0-137
      b3=0.d0                                                           cor0-138
c loop of the asymptotic expansion                                      cor0-139
      do 24 i=1,n                                                       cor0-140
      if (16*i.gt.lm3) call memo(idmt,idmt+16*i-lm3,lm3,3,lo)           cor0-141
      if (lo(216)) go to 33                                             cor0-142
      a4=i-2                                                            cor0-143
      if (i.eq.1) go to 16                                              cor0-144
      if (i.eq.2) go to 12                                              cor0-145
      b4=1.d0-.5d0/a4                                                   cor0-146
      x3(1)=ei*b4/a1                                                    cor0-147
      x3(2)=x3(1)                                                       cor0-148
      x3(3)=ef*b4/b1                                                    cor0-149
      x3(4)=x3(3)                                                       cor0-150
      x4(1)=(fi-a4*(a4-1.d0))/(2.d0*a4*a1)                              cor0-151
      x4(2)=(fi-(a4+1.d0)*(a4-2.d0))/(2.d0*a4*a1)                       cor0-152
      x4(3)=(ff-a4*(a4-1.d0))/(2.d0*a4*b1)                              cor0-153
      x4(4)=(ff-(a4+1.d0)*(a4-2.d0))/(2.d0*a4*b1)                       cor0-154
c new term of asymptotic expansion                                      cor0-155
      do 11 j=1,4                                                       cor0-156
      z(j,2*i-3)=z(j,2*i-5)*x3(j)-z(j,2*i-4)*x4(j)                      cor0-157
   11 z(j,2*i-2)=z(j,2*i-5)*x4(j)+z(j,2*i-4)*x3(j)                      cor0-158
   12 do 13 j=1,8                                                       cor0-159
   13 c(j,1,1)=0.d0                                                     cor0-160
c product of the asymptotic expansions in c(1,n,m)+i*c(2,n,m)           cor0-161
c  n=1: h0(+)(ei)*h0(+)(ef)     n=2: h1(+)(ei)*h1(+)(ef)                cor0-162
c  m=1: hl(+)(ei)*hl(+)(ef)     m=2: hl(+)(ei)*hl(+)(ef)*               cor0-163
      i1=i-1                                                            cor0-164
      do 15 j=1,i1                                                      cor0-165
      m=i-j                                                             cor0-166
      do 14 l=1,2                                                       cor0-167
      c(1,l,1)=c(1,l,1)+z(l,2*j-1)*z(l+2,2*m-1)-z(l,2*j)*z(l+2,2*m)     cor0-168
      c(2,l,1)=c(2,l,1)+z(l,2*j-1)*z(l+2,2*m)+z(l,2*j)*z(l+2,2*m-1)     cor0-169
      c(1,l,2)=c(1,l,2)+z(l,2*j-1)*z(l+2,2*m-1)+z(l,2*j)*z(l+2,2*m)     cor0-170
   14 c(2,l,2)=c(2,l,2)-z(l,2*j-1)*z(l+2,2*m)+z(l,2*j)*z(l+2,2*m-1)     cor0-171
   15 continue                                                          cor0-172
   16 b4=a4+2.d0                                                        cor0-173
      a5=0.d0                                                           cor0-174
      b5=0.d0                                                           cor0-175
c integration from rs to infinity                                       cor0-176
      do 23 m=1,2                                                       cor0-177
c transfer of previous integrals                                        cor0-178
      x4(m)=x5(m)*rm                                                    cor0-179
      x4(m+2)=x5(m+2)*rm                                                cor0-180
      if (dabs(x1(m)).le.2.d0.and.m.eq.2) go to 20                      cor0-181
c pade method for omega function                                        cor0-182
c instead of formula (44), we compute i*k*r*omega in terms of i*k*r     cor0-183
      a9=b4**2+(x2(m)+x1(m))**2                                         cor0-184
      a6=b4/a9                                                          cor0-185
      b6=-(x2(m)+x1(m))/a9                                              cor0-186
      a7=-b6*x1(m)                                                      cor0-187
      b7=a6*x1(m)                                                       cor0-188
      a8=a6                                                             cor0-189
      b8=b6+1.d0/x1(m)                                                  cor0-190
      b9=1.d0                                                           cor0-191
c steed's algorithm                                                     cor0-192
      do 17 j=1,1000                                                    cor0-193
      c2=b7+x1(m)/b9                                                    cor0-194
      a9=(a7**2+c2**2)*b9                                               cor0-195
      c1=a7/a9                                                          cor0-196
      c2=-c2/a9                                                         cor0-197
      c3=-(c2*x1(m)+1.d0)*a8-c1*x1(m)*b8                                cor0-198
      c4=c1*x1(m)*a8-b8*(c2*x1(m)+1.d0)                                 cor0-199
      a7=1.d0+c1*(b4+b9)-c2*x2(m)                                       cor0-200
      b7=c1*x2(m)+(b4+b9)*c2                                            cor0-201
      a9=a7**2+b7**2                                                    cor0-202
      a7=a7/a9                                                          cor0-203
      b7=-b7/a9                                                         cor0-204
      a8=(a7-1.d0)*c3-b7*c4                                             cor0-205
      b8=(a7-1.d0)*c4+b7*c3                                             cor0-206
      b9=b9+1.d0                                                        cor0-207
      if (dabs(c3)+dabs(c4)+dabs(a8)+dabs(b8).lt.1.d-12*(dabs(b6)+dabs(acor0-208
     16))) go to 18                                                     cor0-209
      a6=a6+a8+c3                                                       cor0-210
   17 b6=b6+b8+c4                                                       cor0-211
   18 x5(m)=0.d0                                                        cor0-212
      x5(m+2)=0.d0                                                      cor0-213
      j=j+1                                                             cor0-214
c direct computation of pade approximant for more precision             cor0-215
      do 19 k=1,j                                                       cor0-216
      c1=1.d0+b9*x5(m)                                                  cor0-217
      c2=b9*x5(m+2)                                                     cor0-218
      a9=c1**2+c2**2                                                    cor0-219
      b9=b9-1.d0                                                        cor0-220
      a7=((b4+b9)*c1+x2(m)*c2)/a9                                       cor0-221
      b7=x1(m)+(c1*x2(m)-c2*(b4+b9))/a9                                 cor0-222
      a9=a7**2+b7**2                                                    cor0-223
      x5(m)=a7/a9                                                       cor0-224
   19 x5(m+2)=-b7/a9                                                    cor0-225
      go to 21                                                          cor0-226
c taylor expansion of confluent hypergeometric function                 cor0-227
   20 if (i.eq.1) go to 23                                              cor0-228
      a7=1.d0+x1(m)*x5(m+2)                                             cor0-229
      b7=-x1(m)*x5(m)                                                   cor0-230
      a9=((b4-1)**2+x2(m)**2)                                           cor0-231
      x5(m)=(a7*(b4-1)+x2(m)*b7)/a9                                     cor0-232
      x5(m+2)=(b7*(b4-1)-x2(m)*a7)/a9                                   cor0-233
   21 if (i.eq.1) go to 23                                              cor0-234
c storage of integrals to a factor r in y(j,m)                          cor0-235
c  j=1 and j=2  real and imaginary parts of integral of h0(ei)*h0(ef)   cor0-236
c  j=3 and j=4  real and imaginary parts of integral of h1(ei)*h1(ef)   cor0-237
c  m=1 and m=2 for h*h   m=3 and m=4 for h*h*                           cor0-238
c  m=1 and m=3 for 1/r   m=2 and m=4 for 1/r**2                         cor0-239
      do 22 j=1,2                                                       cor0-240
      a6=c(1,j,m)*x4(m)-c(2,j,m)*x4(m+2)                                cor0-241
      b6=c(1,j,m)*x4(m+2)+c(2,j,m)*x4(m)                                cor0-242
      a5=dmax1(a5,a6**2+b6**2)                                          cor0-243
      y(2*j-1,2*m-1)=y(2*j-1,2*m-1)+a6                                  cor0-244
      y(2*j,2*m-1)=y(2*j,2*m-1)+b6                                      cor0-245
      a3=dmax1(a3,y(2*j-1,2*m-1)**2+y(2*j,2*m-1)**2)                    cor0-246
      a6=c(1,j,m)*x5(m)-c(2,j,m)*x5(m+2)                                cor0-247
      b6=c(1,j,m)*x5(m+2)+c(2,j,m)*x5(m)                                cor0-248
      b5=dmax1(b5,a6**2+b6**2)                                          cor0-249
      y(2*j-1,2*m)=y(2*j-1,2*m)+a6                                      cor0-250
      y(2*j,2*m)=y(2*j,2*m)+b6                                          cor0-251
   22 b3=dmax1(b3,y(2*j-1,2*m)**2+y(2*j,2*m)**2)                        cor0-252
   23 continue                                                          cor0-253
      if (i.ne.1.and.a5.lt.a3*1.d-30.and.b5.lt.b3*1.d-30) go to 25      cor0-254
   24 continue                                                          cor0-255
   25 a1=2.d0*rm                                                        cor0-256
c transformation from h(+/-) to f and g                                 cor0-257
      do 26 i=1,4                                                       cor0-258
      cc(1,i)=(y(2*i-1,3)-y(2*i-1,1))/a1                                cor0-259
      cc(4,i)=(y(2*i-1,3)+y(2*i-1,1))/a1                                cor0-260
      cc(3,i)=(y(2*i,1)+y(2*i,3))/a1                                    cor0-261
   26 cc(2,i)=(y(2*i,1)-y(2*i,3))/a1                                    cor0-262
      if (rm.eq.rs) go to 32                                            cor0-263
c if rm is not rs, 40 points gauss integration from rs to rm            cor0-264
c each gauss integration is for variation of r less than 20.            cor0-265
      in=1.d0+dabs(rm-rs)*.05d0                                         cor0-266
      a1=in                                                             cor0-267
      a1=(rm-rs)/a1                                                     cor0-268
      a2=rm                                                             cor0-269
      do 31 it=1,in                                                     cor0-270
      a3=a2-a1                                                          cor0-271
      do 30 ii=1,40                                                     cor0-272
      i=min0(ii,41-ii)                                                  cor0-273
      a4=absc(i)                                                        cor0-274
      if (i.ne.ii) a4=1.d0-a4                                           cor0-275
      a5=a3+a1*a4                                                       cor0-276
      call fcou(1,ei,a5/fs,y,y(1,3),y(3,1),y(3,3),ie,x1)                cor0-277
      call fcou(1,ef,a5*fs,y(1,2),y(1,4),y(3,2),y(3,4),ie,x1)           cor0-278
      do 29 m=1,2                                                       cor0-279
      do 28 j=1,2                                                       cor0-280
      do 27 l=1,2                                                       cor0-281
      a6=p(i)*y(2*j+m-2,1)*y(2*l+m-2,2)/a5*a1                           cor0-282
      cc(2*l+j-2,m)=cc(2*l+j-2,m)+a6                                    cor0-283
   27 cc(2*l+j-2,m+2)=cc(2*l+j-2,m+2)+a6/a5                             cor0-284
   28 continue                                                          cor0-285
   29 continue                                                          cor0-286
   30 continue                                                          cor0-287
   31 a2=a3                                                             cor0-288
   32 return                                                            cor0-289
   33 write (2,1000)                                                    cor0-290
      stop                                                              cor0-291
 1000 format (8h in cor0)                                               cor0-292
      end                                                               cor0-293
c 04/04/98  ibm version                                         ecis97  corz-000
      subroutine corz(xi,xf,t,fgi,fgf,lm1,lm2,lm,w)                     corz-001
c    computation of the integrals from 1 to infinity of products of     corz-002
c regular or irregular bessel functions of same l-value and argument    corz-003
c xi*r and xf*r respectively, divided by r**3 for l=1 to lm, and of     corz-004
c integrals from 0 to infinity of regular functions of these arguments  corz-005
c divided by r**3.                                                      corz-006
c    the limit of stability of the upwards recurrence has               corz-007
c     been found to be   lm2*(1-xi/xf) < 3 .                            corz-008
c input variables:                                                      corz-009
c     xi,xf   wave numbers multiplied by the matching radius            corz-010
c     fgi,fgf regular and irregular bessel functions.                   corz-011
c     lm1     maximum number of integrals from 1 to infinity.           corz-012
c     lm2     number of integrals from 0 to infinity.                   corz-013
c     lm      actual number of integrals from 1 to infinity.            corz-014
c output variables:                                                     corz-015
c     w       integrals from 1 to infinity.                             corz-016
c     t       integrals from 0 to infinity.                             corz-017
c***********************************************************************corz-018
      implicit real*8 (a-h,o-z)                                         corz-019
      dimension w(lm1,4),fgi(lm1,3),fgf(lm1,3),t(3),b(4),c(2),d(2)      corz-020
c integrals from 0 to infinity.                                         corz-021
c the recurrence relation starts from l=0 with l*(0,3;l)=1/3 for l=0    corz-022
      t(1)=1.d0/3.d0                                                    corz-023
      if (xi.ne.xf) go to 2                                             corz-024
c when ki=kf   (0,3;l)=1/(2*l*(l+1))                                    corz-025
      a1=0.d0                                                           corz-026
      do 1 i=2,lm2                                                      corz-027
      a1=a1+1.d0                                                        corz-028
    1 t(i)=.5d0/(a1*(a1+1.d0))                                          corz-029
      go to 11                                                          corz-030
    2 x=xi/xf                                                           corz-031
      if (x.gt.1.d0) x=1.d0/x                                           corz-032
c (0,3;l) = x**l gt(1/2) gt(l+1)/2/gt(l+3/2) 2f1(l,-1/2;l+3/2;x**2)     corz-033
      if (x.ge..9d0) go to 4                                            corz-034
c direct expansion of the 2f1 function                                  corz-035
      a1=x**2                                                           corz-036
      t(2)=x/3.d0                                                       corz-037
      a2=t(2)                                                           corz-038
      a3=0.d0                                                           corz-039
      do 3 j=1,2000                                                     corz-040
      a3=a3+1.d0                                                        corz-041
      a2=a2*a1*(a3-1.5d0)/(a3+1.5d0)                                    corz-042
      t(2)=t(2)+a2                                                      corz-043
      if (dabs(a2).lt.1.d-15*dabs(t(2))) go to 6                        corz-044
    3 continue                                                          corz-045
      go to 6                                                           corz-046
c analytic continuation of the 2f1 function - erdelyi,.... 15.3.11      corz-047
    4 a1=1-x**2                                                         corz-048
      a2=x*a1**2/16.d0                                                  corz-049
      a3=dlog(a1/4.d0)+2.d0                                             corz-050
      t(2)=x*(2.d0+a1)/8.d0+a2*a3                                       corz-051
      a4=0.d0                                                           corz-052
      do 5 j=1,2000                                                     corz-053
      a4=a4+1.d0                                                        corz-054
      a3=a3-.5d0/((a4+.5d0)*a4)                                         corz-055
      a2=a2*a1*(a4+.5d0)/a4                                             corz-056
      a5=a2*a3                                                          corz-057
      t(2)=t(2)+a5                                                      corz-058
      if (dabs(a5).lt.1.d-15*dabs(t(2))) go to 6                        corz-059
    5 continue                                                          corz-060
c recurrence relation for  (0,3;l) :                                    corz-061
c  2*(l-1)*(0,3;l-1)-(2*l+1)*(x+1/x)*(0,3;l)+2*(l+2)*(0,3;l+1)=0        corz-062
c upwards recurrence                                                    corz-063
    6 a1=x+1.d0/x                                                       corz-064
      xx=lm2*(1-x)                                                      corz-065
      if (xx.gt.3.d0) go to 8                                           corz-066
      t(3)=.5d0*(a1*t(2)-t(1))                                          corz-067
      a2=0.d0                                                           corz-068
      do 7 i=4,lm2                                                      corz-069
      a2=a2+1.d0                                                        corz-070
    7 t(i)=((a2+1.5d0)*a1*t(i-1)-a2*t(i-2))/(a2+3.d0)                   corz-071
      go to 11                                                          corz-072
c downwards recurrence                                                  corz-073
    8 lk=4*lm2                                                          corz-074
      a2=lk-1                                                           corz-075
      a3=a2/(a2+2.d0)                                                   corz-076
      do 9 i=3,lk                                                       corz-077
      j=lk-i+3                                                          corz-078
      a2=a2-1.d0                                                        corz-079
      a3=a2/((a2+1.5d0)*a1-(a2+3.d0)*a3)                                corz-080
      if (j.le.lm2) t(j)=a3                                             corz-081
    9 continue                                                          corz-082
      do 10 i=3,lm2                                                     corz-083
   10 t(i)=t(i)*t(i-1)                                                  corz-084
   11 b(1)=xi+xf                                                        corz-085
      b(2)=xi-xf                                                        corz-086
c computation of the integrals from 1 to infinity of exp(i*b*r)/r**3 dr corz-087
      do 17 i=1,2                                                       corz-088
      if (b(i).lt.5.d0) go to 13                                        corz-089
c use of pade approximant                                               corz-090
      a1=0.d0                                                           corz-091
      a2=0.d0                                                           corz-092
      a3=21.d0                                                          corz-093
      do 12 j=1,20                                                      corz-094
      a3=a3-1.d0                                                        corz-095
      a2=a2-b(i)                                                        corz-096
      b1=a1**2+a2**2                                                    corz-097
      b2=a1*a3/b1+1.d0                                                  corz-098
      b3=-a2*a3/b1                                                      corz-099
      b1=b2**2+b3**2                                                    corz-100
      a1=b2*(a3+2.d0)/b1                                                corz-101
   12 a2=-b3*(a3+2.d0)/b1                                               corz-102
      a2=a2-b(i)                                                        corz-103
      b1=a1**2+a2**2                                                    corz-104
      c(i)=(dcos(b(i))*a1+dsin(b(i))*a2)/b1                             corz-105
      d(i)=(dsin(b(i))*a1-dcos(b(i))*a2)/b1                             corz-106
      go to 17                                                          corz-107
   13 if (b(i).eq.0.d0) go to 16                                        corz-108
c use of the taylor expansion                                           corz-109
      a1=dabs(b(i))                                                     corz-110
      c(i)=.5d0*(1.d0-a1**2*(.922784335098467d0-dlog(a1)))              corz-111
      d(i)=a1*(1.d0-.78539816339744831d0*a1)                            corz-112
      a2=a1**2/2.d0                                                     corz-113
      a3=0.d0                                                           corz-114
      do 14 j=2,20                                                      corz-115
      a3=a3+1.d0                                                        corz-116
      a2=a2*a1/(2.d0*a3+1.d0)                                           corz-117
      d(i)=d(i)+a2/(2.d0*a3-1.d0)                                       corz-118
      a2=-a2*a1/(2.d0*a3+2.d0)                                          corz-119
      c(i)=c(i)+a2/(2.d0*a3)                                            corz-120
      if (dabs(a2).lt.1.d-16) go to 15                                  corz-121
   14 continue                                                          corz-122
   15 if (a1.ne.b(i)) d(i)=-d(i)                                        corz-123
      go to 17                                                          corz-124
   16 c(i)=.5d0                                                         corz-125
      d(i)=0.d0                                                         corz-126
   17 continue                                                          corz-127
c storage of the two first integrals                                    corz-128
      a1=2.d0*xi*xf                                                     corz-129
      do 18 i=1,2                                                       corz-130
      w(i,1)=(c(2)-c(1))/a1                                             corz-131
      w(i,2)=(d(1)-d(2))/a1                                             corz-132
      w(i,3)=(d(1)+d(2))/a1                                             corz-133
      w(i,4)=(c(2)+c(1))/a1                                             corz-134
      if (i.eq.2) go to 18                                              corz-135
      c(1)=c(1)*b(2)**2+dcos(b(1))+b(1)*dsin(b(1))                      corz-136
      d(1)=d(1)*b(2)**2+dsin(b(1))-b(1)*dcos(b(1))                      corz-137
      c(2)=c(2)*b(1)**2+dcos(b(2))+b(2)*dsin(b(2))                      corz-138
      d(2)=d(2)*b(1)**2+dsin(b(2))-b(2)*dcos(b(2))                      corz-139
      a1=2.d0*a1**2                                                     corz-140
   18 continue                                                          corz-141
c upwards recurrence                                                    corz-142
      a1=xi/xf+xf/xi                                                    corz-143
      a2=2.d0*xi*xf                                                     corz-144
      a3=2.d0                                                           corz-145
      do 20 j=3,lm                                                      corz-146
      a3=a3+1.d0                                                        corz-147
      b(2)=(fgi(j-2,3)*fgf(j-2,1)-fgi(j,3)*fgf(j,1))/a2                 corz-148
      b(3)=(fgi(j-2,1)*fgf(j-2,3)-fgi(j,1)*fgf(j,3))/a2                 corz-149
      b(4)=(fgi(j-2,3)*fgf(j-2,3)-fgi(j,3)*fgf(j,3))/a2                 corz-150
      do 19 i=2,4                                                       corz-151
   19 w(j,i)=((a3-1.5d0)*a1*w(j-1,i)-(a3-3.d0)*w(j-2,i)-b(i))/a3        corz-152
   20 continue                                                          corz-153
      ln=max0(lm,idint(dmax1(xi,xf)))+50                                corz-154
      b2=0.d0                                                           corz-155
      b3=0.d0                                                           corz-156
      c2=0.d0                                                           corz-157
      c3=1.d-15                                                         corz-158
      d2=0.d0                                                           corz-159
      d3=1.d-15                                                         corz-160
      a3=ln                                                             corz-161
      do 24 i=2,ln                                                      corz-162
      j=ln-i+2                                                          corz-163
      a3=a3-1.d0                                                        corz-164
      b1=b2                                                             corz-165
      b2=b3                                                             corz-166
      c1=c2                                                             corz-167
      c2=c3                                                             corz-168
      d1=d2                                                             corz-169
      d2=d3                                                             corz-170
      c3=(2.d0*a3+3.d0)*c2/xi-c1                                        corz-171
      d3=(2.d0*a3+3.d0)*d2/xf-d1                                        corz-172
      b3=((a3+1.5d0)*a1*b2-(a3+3.d0)*b1-(c3*d3-c1*d1)/a2)/a3            corz-173
      if (j.le.lm) w(j,1)=b3                                            corz-174
      if (d3.lt.1.d15) go to 21                                         corz-175
      d2=d2*1.d-30                                                      corz-176
      d3=d3*1.d-30                                                      corz-177
      go to 22                                                          corz-178
   21 if (c3.lt.1.d15) go to 24                                         corz-179
      c2=c2*1.d-30                                                      corz-180
      c3=c3*1.d-30                                                      corz-181
   22 b2=b2*1.d-30                                                      corz-182
      b3=b3*1.d-30                                                      corz-183
      if (j.gt.lm) go to 24                                             corz-184
      do 23 k=j,lm                                                      corz-185
   23 w(k,1)=w(k,1)*1.d-30                                              corz-186
   24 continue                                                          corz-187
      a1=fgi(2,1)*fgf(2,1)/(c3*d3)                                      corz-188
      do 25 i=2,lm                                                      corz-189
   25 w(i,1)=w(i,1)*a1+t(i)                                             corz-190
      return                                                            corz-191
      end                                                               corz-192
c 04/04/98  ibm version                                         ecis97  disp-000
      subroutine disp(ix,ipi,wv,ipp,pip,ncoll,ncolt,npx,lo)             disp-001
c computation of the depths of real surface and volume contributions    disp-002
c obtained by dispersion relations from the imaginary volume and        disp-003
c surface potentials. computation of the corrections to the imaginary   disp-004
c potentials due to differences of energy.                              disp-005
c input variables: ix:        0 for discrete levels, 1 for continua     disp-006
c                  ipi(4,iv): potential for the level iv                disp-007
c                  wv(3,iv):  center of mass energy of the level iv     disp-008
c                  ipp,pip:   equivalent by call  (see calx)            disp-009
c                  ncoll:     number of coupled levels                  disp-010
c                  ncolt:     total number of levels                    disp-011
c                  lo(209):   use of dirac potentials                   disp-012
c output variables:wv(12,iv): corr. to volume/scalar imaginary potentialdisp-013
c                  wv(13,iv): corr. to volume/scalar real potential     disp-014
c                  wv(14,iv): corr. to surface/vector imaginary potentiadisp-015
c                  wv(15,iv): corr. to surface/vector real potential    disp-016
c                  npx:       number of different potentials            disp-017
c***********************************************************************disp-018
      implicit real*8 (a-h,o-z)                                         disp-019
      logical lo(250)                                                   disp-020
      real*4 pip(11,1)                                                  disp-021
      dimension ipi(10,1),ipp(11,1),wv(15,1),ar(2),ai(2),ww(4)          disp-022
      data pi /3.141592653589793d0/                                     disp-023
      if (lo(10)) write (2,1000)                                        disp-024
      do 22 iv=1,ncolt                                                  disp-025
      do 1 i=1,4                                                        disp-026
    1 ww(i)=0.d0                                                        disp-027
      if (lo(110)) go to 20                                             disp-028
      ip=ipi(4,iv)                                                      disp-029
      if (abs(pip(4,ip)-pip(5,ip)).lt.1.e-3) go to 27                   disp-030
      yy=pip(4,ip)-pip(5,ip)                                            disp-031
      y=wv(3,iv)-pip(5,ip)                                              disp-032
c volume form-factor                                                    disp-033
      do 6 i=1,2                                                        disp-034
      nv=iabs(ipp(i+1,ip))                                              disp-035
      if (nv.eq.0) go to 5                                              disp-036
      if (mod(nv,2).ne.0) go to 28                                      disp-037
      mv=nv/2                                                           disp-038
      ik=3                                                              disp-039
    2 bv=pip(3*i+ik,ip)                                                 disp-040
      av=(yy**nv+bv**nv)/yy**nv                                         disp-041
      au=0.d0                                                           disp-042
c loop on poles in the upper plane                                      disp-043
      do 3 j=1,mv                                                       disp-044
      bt=pi*dfloat(2*j-1)/dfloat(nv)                                    disp-045
    3 au=au+dsin(bt)/(y**2+2*y*dcos(bt)*bv+bv**2)                       disp-046
      ww(2*i)=av*au*y*bv/dfloat(mv)                                     disp-047
      ww(2*i-1)=av*y**nv/(y**nv+bv**nv)-1.d0                            disp-048
      if (nv.eq.ipp(i+1,ip)) go to 5                                    disp-049
c sum or difference of two volume terms                                 disp-050
      if (ik.eq.4) go to 4                                              disp-051
      ap=ww(2*i)                                                        disp-052
      aq=ww(2*i-1)                                                      disp-053
      aw=av                                                             disp-054
      ik=4                                                              disp-055
      go to 2                                                           disp-056
    4 at=pip(3*i+5,ip)                                                  disp-057
      if (.not.lo(209).and.i.eq.2) at=av/(av-aw)                        disp-058
      ww(2*i)=at*(ap-ww(2*i))+ww(2*i)                                   disp-059
      ww(2*i-1)=at*(aq-ww(2*i-1))+ww(2*i-1)                             disp-060
    5 if (.not.lo(209).and.ipp(3,ip).ge.0) go to 7                      disp-061
    6 continue                                                          disp-062
      go to 20                                                          disp-063
c surface form-factor                                                   disp-064
    7 ns=iabs(ipp(3,ip))                                                disp-065
      if (ns.eq.0) go to 20                                             disp-066
      if (mod(ns,2).ne.0) go to 29                                      disp-067
      bs=pip(9,ip)                                                      disp-068
      cs=pip(10,ip)                                                     disp-069
      cxw=pip(11,ip)                                                    disp-070
      as=(yy**ns+bs**ns)/yy**ns*dexp(cs*yy)                             disp-071
      aa=y**ns/(y**ns+bs**ns)                                           disp-072
      ww(3)=as*aa*dexp(-cs*y)-1.d0                                      disp-073
      uu=0.d0                                                           disp-074
      if (dabs(cs*y).lt.1.d-12) go to 15                                disp-075
c pole on the real axis                                                 disp-076
      ar(1)=(cxw+cs)*y                                                  disp-077
      ar(2)=(cxw-cs)*y                                                  disp-078
      ai(2)=0.d0                                                        disp-079
      do 14 j=1,2                                                       disp-080
      if (ar(j).gt.10.or.ar(j).lt.-30.) go to 10                        disp-081
c series expansion of real exponential integral function                disp-082
      br=-.57721566490153d0-dlog(dabs(ar(j)))                           disp-083
      cr=1.d0                                                           disp-084
      do 8 i=1,200                                                      disp-085
      aj=i                                                              disp-086
      cr=-cr*ar(j)/aj                                                   disp-087
      if (dabs(cr).lt.1.d-15*dabs(br)) go to 9                          disp-088
    8 br=br-cr/aj                                                       disp-089
      go to 10                                                          disp-090
    9 br=br*dexp(ar(j))                                                 disp-091
      go to 14                                                          disp-092
c pade approximant of real exponential integral function                disp-093
   10 do 12 m=5,200,5                                                   disp-094
      br=0.d0                                                           disp-095
      do 11 i=1,m                                                       disp-096
      aj=m+1-i                                                          disp-097
      br=aj/(ar(j)+br)                                                  disp-098
   11 br=aj/(1.d0+br)                                                   disp-099
      ai(1)=ai(2)                                                       disp-100
      ai(2)=br                                                          disp-101
      if (dabs(ai(1)-ai(2)).lt.1.d-10*dabs(ai(1)+ai(2))) go to 13       disp-102
   12 continue                                                          disp-103
   13 cr=.5d0*(ai(1)+ai(2))+ar(j)                                       disp-104
      br=1.d0/cr                                                        disp-105
   14 uu=aa*br-uu                                                       disp-106
   15 ms=ns/2                                                           disp-107
c loop on poles in the complex upper plane                              disp-108
      do 19 i=1,ms                                                      disp-109
      a3=pi*dfloat(2*i-1)/dfloat(ns)                                    disp-110
      ay=bs*dcos(a3)                                                    disp-111
      az=bs*dsin(a3)                                                    disp-112
      ar(1)=(cxw+cs)*ay                                                 disp-113
      ai(1)=(cxw+cs)*az                                                 disp-114
      ar(2)=(cxw-cs)*ay                                                 disp-115
      ai(2)=(cxw-cs)*az                                                 disp-116
      wr=0.d0                                                           disp-117
      wi=0.d0                                                           disp-118
      do 18 j=1,2                                                       disp-119
c series expansion of complex exponential integral function             disp-120
      at=ar(j)**2+ai(j)**2                                              disp-121
      ag=datan2(ai(j),ar(j))                                            disp-122
      aq=.5d0*dlog(at)                                                  disp-123
      br=-.57721566490153d0-aq                                          disp-124
      bi=-ag                                                            disp-125
      yr=1.d0                                                           disp-126
      yi=0.d0                                                           disp-127
      do 16 k=1,200                                                     disp-128
      aj=k                                                              disp-129
      yz=yr                                                             disp-130
      yr=-(yr*ar(j)-yi*ai(j))/aj                                        disp-131
      yi=-(yz*ai(j)+yi*ar(j))/aj                                        disp-132
      if (yr**2+yi**2.lt.1.d-30*(br**2+bi**2)) go to 17                 disp-133
      br=br-yr/aj                                                       disp-134
   16 bi=bi-yi/aj                                                       disp-135
   17 continue                                                          disp-136
      cc=dexp(ar(j))                                                    disp-137
      cr=br*cc                                                          disp-138
      ci=bi*cc                                                          disp-139
      br=cr*dcos(ai(j))-ci*dsin(ai(j))                                  disp-140
      bi=ci*dcos(ai(j))+cr*dsin(ai(j))                                  disp-141
      wr=cr*dcos(ai(j))-ci*dsin(ai(j))-wr                               disp-142
   18 wi=ci*dcos(ai(j))+cr*dsin(ai(j))-wi                               disp-143
      br=ay-y                                                           disp-144
      aa=(br**2+az**2)*ns                                               disp-145
      ci=-az/aa                                                         disp-146
      cr=br/aa                                                          disp-147
      aw=ay*cr-az*ci-1.d0/dfloat(ns)                                    disp-148
      ax=ay*ci+az*cr                                                    disp-149
   19 uu=uu+2.d0*(wr*aw-wi*ax)                                          disp-150
      ww(4)=as*uu/pi*dexp(-cxw*y)                                       disp-151
   20 do 21 i=1,4                                                       disp-152
   21 wv(i+11,iv)=ww(i)                                                 disp-153
      if (lo(10)) write (2,1001) iv,ip,pip(4,ip),wv(3,iv),ww            disp-154
   22 continue                                                          disp-155
      do 23 i=1,ncolt                                                   disp-156
   23 ipi(10,i)=1                                                       disp-157
      if (ix.eq.1) return                                               disp-158
      if (lo(209)) return                                               disp-159
      npx=1                                                             disp-160
      if (ncoll.eq.1) return                                            disp-161
      do 26 i=2,ncoll                                                   disp-162
      do 25 j=2,i                                                       disp-163
      if (ipi(4,i).ne.ipi(4,j-1)) go to 25                              disp-164
      do 24 k=12,15                                                     disp-165
      if (wv(k,i).ne.wv(k,j-1)) go to 25                                disp-166
   24 continue                                                          disp-167
      ipi(10,i)=ipi(10,j-1)                                             disp-168
      go to 26                                                          disp-169
   25 continue                                                          disp-170
      if (lo(10).or.ipi(4,i).ne.1) npx=npx+1                            disp-171
      ipi(10,i)=npx                                                     disp-172
   26 continue                                                          disp-173
      return                                                            disp-174
   27 write (2,1002) iv,ip,pip(4,ip),pip(5,ip)                          disp-175
      go to 30                                                          disp-176
   28 write (2,1003) iv,ip,i,nv                                         disp-177
      go to 30                                                          disp-178
   29 write (2,1004) iv,ip,ns                                           disp-179
   30 write (2,1005)                                                    disp-180
      stop                                                              disp-181
 1000 format (102h level   potential   ref. energy     energy     volumedisp-182
     1/scalar correction     surface/vector correction/51x,9himaginary,9disp-183
     2x,4hreal,8x,9himaginary,7x,4hreal)                                disp-184
 1001 format (2i9,2f14.4,4f15.6)                                        disp-185
 1002 format (10h for level,i3,15h  and potential,i3,49h  too small diffdisp-186
     1erence between reference energy =,f14.4,19h and fermi energy =,f14disp-187
     2.4)                                                               disp-188
 1003 format (10h for level,i3,15h  and potential,i3,22h  for volume potdisp-189
     1ential,i2,16h  the power nv =,i3,8h  is odd)                      disp-190
 1004 format (10h for level,i3,15h  and potential,i3,38h  for surface podisp-191
     1tential the power ns =,i3,8h  is odd)                             disp-192
 1005 format (22h  ... stop in disp ...)                                disp-193
      end                                                               disp-194
c 04/04/98  ibm version                                         ecis97  lden-000
      subroutine lden(na,scn)                                           lden-001
c compound nucleus preparatory computations added by moldauer with prsl lden-002
c input variables: na:      total mass of the compound nucleus          lden-003
c                  scn:     descriptions of level densities             lden-004
c output variables:                                                     lden-005
c in scn:  1-sa  2-ux   3-tau  4-sg   5-e0   6-ex   7-nz  8-b           lden-006
c data pz, pn, sz and sn are the one used by the code gnash             lden-007
c***********************************************************************lden-008
      dimension pz(100),pn(150),sz(100),sn(150),scn(8)                  lden-009
      common /ncomp/ nsp(3),nfiss,nrd,ncont,ncoj,acn1,acn2,ncons,nie,ncolden-010
     1x,ndp,ndq,az(6),bz(3),tg0,bn,fnug,egd,ggd,tg1,sgsq                lden-011
      data pz /0.,5.05,0.,4.50,0.,3.95,0.,3.40,0.,2.90,0.,2.46,0.,2.09,0lden-012
     1.,1.62,0.,1.62,0.,1.83,0.,1.73,0.,1.35,0.,1.54,0.,1.28,0.26,0.88,0lden-013
     2.19,1.35,-.05,1.52,-.09,1.17,.04,1.24,0.29,1.09,.26,1.17,.23,1.15,lden-014
     3-.08,1.35,0.34,1.05,.28,1.27,0.,1.05,0.,1.,.09,1.2,.2,1.4,.93,1.,-lden-015
     4.2,1.19,.09,.97,0.,.92,.11,.68,.05,.68,-.22,.79,.09,.69,.01,.72,0.lden-016
     5,.4,.16,.73,0.,.46,.17,.89,0.,.79,0.,.89,0.,.81,-.06,.69,-.2,.71,-lden-017
     6.12,.72,0.,.77,2*0./                                              lden-018
      data pn /0.,5.25,0.,4.70,0.,4.15,0.,3.58,0.,3.05,0.,2.67,0.,1.8,0.lden-019
     1,1.67,0.,1.86,0.,2.04,0.,1.64,0.,1.44,0.,1.54,0.,1.3,0.,1.27,0.,1.lden-020
     229,.08,1.41,-.08,1.5,-.05,2.24,-.47,1.43,-.15,1.44,.06,1.56,.25,1.lden-021
     357,-.16,1.46,0.,.93,.01,.62,-.5,1.42,.13,1.52,-.65,.8,-.08,1.29,-.lden-022
     447,1.25,-.44,.97,.08,1.65,-.11,1.26,-.46,1.06,0.22,1.55,-.07,1.37,lden-023
     50.1,1.2,-.27,.92,-.35,1.19,0.,1.05,-.25,1.61,-.21,.9,-.21,.74,-.38lden-024
     6,.72,-.34,.92,-.26,.94,.01,.65,-.36,.83,.11,.67,.05,1.,.51,1.04,.3lden-025
     73,.68,-.27,.81,.09,.75,.17,.86,.14,1.1,-.22,.84,-.47,.48,.02,.88,.lden-026
     824,.52,.27,.41,-.05,.38,.15,.67,0.,.61,0.,.78,0.,.67,0.,.67,0.,.79lden-027
     9,0.,.6,.04,.64,-.06,.45,.05,.26,-.22,.39,0.,.39/                  lden-028
      data sz /.19,.38,.57,.75,.94,1.13,1.32,1.51,1.70,2.10,2.91,4.17,5.lden-029
     172,7.8,8.97,9.7,10.1,10.7,11.38,12.07,12.55,13.24,13.93,14.71,15.5lden-030
     23,16.37,17.36,18.6,18.7,18.01,17.87,17.08,16.6,16.75,16.5,16.35,16lden-031
     3.22,16.41,16.89,16.43,16.68,16.73,17.45,17.29,17.44,17.82,18.62,18lden-032
     4.27,19.39,19.91,19.14,18.26,17.4,16.42,15.77,14.37,13.91,13.1,13.1lden-033
     51,11.43,10.89,10.75,10.62,10.41,10.21,9.85,9.47,9.03,8.61,8.13,7.4lden-034
     66,7.48,7.2,7.13,7.06,6.78,6.64,6.64,7.68,7.89,8.41,8.49,7.88,6.3,5lden-035
     7.47,4.78,4.37,4.17,4.13,4.32,4.55,5.04,5.28,6.06,6.28,6.87,7.20,7.lden-036
     874,2*0./                                                          lden-037
      data sn /0.62,1.24,1.85,2.47,3.09,3.71,4.33,4.95,5.56,6.18,6.8,7.5lden-038
     13,7.55,7.21,7.44,8.07,8.94,9.81,10.6,11.39,12.54,13.68,14.34,14.19lden-039
     2,13.83,13.5,13.,12.13,12.6,13.26,14.13,14.92,15.52,16.38,17.16,17.lden-040
     355,18.03,17.59,19.03,18.71,18.8,18.99,18.46,18.25,17.76,17.38,16.7lden-041
     42,15.62,14.38,12.88,13.23,13.81,14.9,14.86,15.76,16.2,17.62,17.73,lden-042
     518.16,18.67,19.69,19.51,20.17,19.48,19.98,19.83,20.2,19.72,19.87,1lden-043
     69.24,18.44,17.61,17.1,16.16,15.9,15.33,14.76,13.54,12.63,10.65,10.lden-044
     71,8.89,10.25,9.79,11.39,11.72,12.43,12.96,13.43,13.37,12.96,12.11,lden-045
     811.92,11.,10.8,10.42,10.39,9.69,9.27,8.93,8.57,8.02,7.59,7.33,7.23lden-046
     9,7.05,7.42,6.75,6.6,6.38,6.36,6.49,6.25,5.85,5.48,4.53,4.3,3.39,2.lden-047
     a35,1.66,.81,0.46,-.96,-1.69,-2.53,-3.16,-1.87,-.41,.71,1.66,2.62,3lden-048
     b.22,3.76,4.1,4.46,4.83,5.09,5.18,5.17,5.1,5.01,4.97,5.09,5.03,4.93lden-049
     c,5.28,5.49,5.50,5.37,5.30/                                        lden-050
      nz=scn(7)+.1                                                      lden-051
      if (nz.le.0) nz=na/2                                              lden-052
      nn=na-nz                                                          lden-053
      aa=na                                                             lden-054
      sc=0.0                                                            lden-055
      pr=0.0                                                            lden-056
c sa given by p. j. brancazio and a. g. w. cameron, canadian journal of lden-057
c physics 47 (1969) 1029.                                               lden-058
      if (nz.gt.100.or.nn.gt.150) go to 1                               lden-059
      sc=sn(nn)-sz(nz)                                                  lden-060
      pr=pn(nn)+pz(nz)                                                  lden-061
      nd=min0(iabs(nz-2),iabs(nz-8),iabs(nz-20),iabs(nz-28),iabs(nz-50),lden-062
     1iabs(nz-82),iabs(nz-126),iabs(nn-2),iabs(nn-8),iabs(nn-20),iabs(nnlden-063
     2-28),iabs(nn-50),iabs(nn-82),iabs(nn-126),iabs(nn-184))           lden-064
    1 sa=abs((.0091*(sc-.23*nd)+.143)*aa)                               lden-065
      if (scn(1).eq.0.) scn(1)=sa                                       lden-066
      ux=2.5+150./aa                                                    lden-067
      if (scn(2).eq.0.) scn(2)=ux                                       lden-068
      tau=1.0/(sqrt(scn(1)/scn(2))-3./(2.*scn(2)))                      lden-069
      if (tau.gt.0.) go to 2                                            lden-070
      scn(3)=1.0/(sqrt(sa/ux)-3./(2.*ux))                               lden-071
      write (2,1000) tau,scn(3)                                         lden-072
    2 if (scn(3).eq.0.) scn(3)=tau                                      lden-073
      sg=sqrt(0.0888*sqrt(scn(1)*scn(2))*aa**0.666666667d0)             lden-074
      if (scn(4).eq.0.) scn(4)=sg                                       lden-075
      ex=abs(scn(2)+pr)                                                 lden-076
      e0=ex-scn(3)*(2.*sqrt(scn(1)*scn(2))+alog(scn(3)/(16.9705627e0*scnlden-077
     1(1)**.25*scn(2)**1.25*scn(4))))                                   lden-078
      if (scn(5).eq.0.) scn(5)=e0                                       lden-079
      if (scn(6).eq.0.) scn(6)=ex                                       lden-080
      scn(8)=exp(2.*sqrt(scn(1)*scn(2))-(scn(6)-scn(5))/scn(3))*scn(3)/(lden-081
     1scn(1)**.5*scn(2)**1.5)                                           lden-082
      write (2,1001) (scn(j),j=1,7)                                     lden-083
      return                                                            lden-084
 1000 format (5x,11htemperature,f10.5,12h replaced by,f10.5)            lden-085
 1001 format (12h used values/(4x,5h  sa:,e13.6,6x,3hux:,e13.6,5x,4htau:lden-086
     1,e13.6,6x,3hsg:,e13.6/28x,3he0:,e13.6,6x,3hex:,e13.6,7x,2hz:,f5.0)lden-087
     2)                                                                 lden-088
      end                                                               lden-089
c 04/04/98  ibm version                                         ecis97  redm-000
      subroutine redm(niv,iq,t,ipi,ncoll,it,nbta,beta,nbt1,iph,var,nva,iredm-001
     1qmax,aspin,fac,nfa,npp,im,idmt,idt,lo)                            redm-002
c reduced nuclear matrix elements                                       redm-003
c input variables: ipi(i,j):parity of nuclear states for j=1            redm-004
c                          multiplicity of the part. and target for j=2,redm-005
c                  ncoll:  number of coupled states                     redm-006
c                  nbta,beta:   deformations, equivalent by call        redm-007
c                  nbt1:   number of phonons                            redm-008
c                  iph:    used for vibrational model    see vibm       redm-009
c                  var:    parameters for some models                   redm-010
c                  nva:    number of these parameters                   redm-011
c                  iqmax,aspin: see rotm                                redm-012
c                  fac,nfa: table of log of factorials and their number redm-013
c                  npp:    number of optical potentials                 redm-014
c                  idmt:   total length of working field                redm-015
c                  idt:    length available in this subroutine          redm-016
c                  lo:     logical controls                             redm-017
c output variables:im:     number of nuclear multipoles                 redm-018
c                  niv(i1,i2,k): first i of t(4,i) for the pair of      redm-019
c             nuclear states i1,i2 for k=1 and last one for k=2         redm-020
c                  iq(4,i),t(4,i) are equivalent by call                redm-021
c             - the first 4*'it' data (for a given i) are               redm-022
c               1) reference to table of form factors                   redm-023
c               2) reference to table of angular momenta                redm-024
c               3) address of the associated spin-orbit form factor or 0redm-025
c               4) the reduced nuclear matrix element multiplied by     redm-026
c                (-)**(l/2) where l is the transferred angular momentum redm-027
c             - the next 3*'im' data are table of angular momenta       redm-028
c               1) l  transferred angular momentum                      redm-029
c               2) 2*s where s is the transfer of spin                  redm-030
c               3) 2*j where j is the transfer of total spin or 0 if s=0redm-031
c             - the following 7*'intc' are the table ivy of form factor redm-032
c                     independent of dispersion relations.              redm-033
c               1) form factor control number                           redm-034
c               2) reference to the table of multipoles                 redm-035
c               3) 0 or address of the first spin-orbit form factor     redm-036
c               4) 0 or address of temporary coulomb form factor        redm-037
c               5) 0 or address of temporary coulomb spin-orbit         redm-038
c               6) 0 or address of correction term (positive for        redm-039
c                       corrected term, negative for correction term)   redm-040
c               7) angular momentum                                     redm-041
c             - the following 4*'intv' are the table ivz of form factor redm-042
c                     dependent of dispersion relations.                redm-043
c               1) address of computation (without dispersion relations)redm-044
c               2) form factor control number with respect to dispersionredm-045
c               3) 0 or address of the first spin-orbit form factor     redm-046
c               4) angular momentum                                     redm-047
c in common /pote1/ related to computation of potentials and table ivy  redm-048
c                  itx(16):starting address of different form factors.  redm-049
c                      for schroed. equation, itx(i)+1 is the starting  redm-050
c                      address of the potential read in extp with ityp=iredm-051
c                      for dirac equations, itx(1)=0                    redm-052
c                      itx(2)+1=address off first transition form factorredm-053
c                      itx(7)=address of last transition form factor    redm-054
c                      itx(3)=address of last temporary central poten.  redm-055
c                      itx(4)=itx(7)-24,itx(5)=itx(3)-11,itx(6)=itx(2)-4redm-056
c       all are used for schroedinger, the first 8 for dirac            redm-057
c                  imax:   maximum angular momentum                     redm-058
c                  intc:   number of form factors without deformed      redm-059
c                             spin-orbit including correction terms     redm-060
c                  inls:   number of spin-orbit form factors not taking redm-061
c                             into account multiplication by 2.         redm-062
c                  invc:   number of coulomb transition form factors    redm-063
c                  invd:   idem for coulomb spin-orbit                  redm-064
c                  itxm:   total number of form factors                 redm-065
c in common /pote2/ related to use of potentials and table ivz          redm-066
c                  ity(8):starting address of real and imaginary,       redm-067
c                      central and spin-orbit, potential and transition redm-068
c                      form factors for schroedinger equations.         redm-069
c       all are used for schroedinger, ity(2) and ity(5) only for dirac redm-070
c                  invt:   number of form factors without deformed      redm-071
c                             spin-orbit and correction terms           redm-072
c                  intv:   same as invt, taking into account dispersion redm-073
c                  insl:   same as inls, without correction terms       redm-074
c                  npx:    same as npp, taking into account dispersion  redm-075
c if lo(15)=.true. the reduced matrix elements are read at the first    redm-076
c call and the parameters 'var' are not used - in any case where 'var'  redm-077
c are not used,the subroutine is skipped.                               redm-078
c if lo(61)=.true. the matrix elements are punched at the first call    redm-079
c in this subroutine.                                                   redm-080
c***********************************************************************redm-081
      logical lo(250),lt                                                redm-082
      double precision fac                                              redm-083
      dimension iph(1),iq(4,1),t(4,1),ipi(10,1),var(1),beta(10,1),niv(ncredm-084
     1oll,ncoll,2),fac(1),nbta(10,1)                                    redm-085
      common /pote1/ itx(16),imax,intc,inls,invc,invd,itxm              redm-086
      common /pote2/ ity(8),invt,intv,insl,npx                          redm-087
      if (lo(220)) go to 42                                             redm-088
      if (lo(7).or.lo(15)) go to 3                                      redm-089
c standard computation of the reduced matrix elements in at(4,i)        redm-090
c with form factor identification in iq(1,i), multipole in iq(2,i)      redm-091
c and 0 or 1 in iq(3,i) if spin-orbit is not or is deformed.            redm-092
c they are called at the first run or if 'var' has been changed         redm-093
      if (lo(1)) go to 1                                                redm-094
      call vibm(niv,iq,t,ipi,ncoll,it,iph,var,nva,nbta,nbt1,fac,nfa,idmtredm-095
     1,idt,lo)                                                          redm-096
      go to 17                                                          redm-097
    1 if (lo(3)) go to 2                                                redm-098
      call rotm(niv,iq,t,ipi,ncoll,iph,nbta,var,nva,it,iqmax,aspin,fac,nredm-099
     1fa,idmt,idt,lo)                                                   redm-100
      go to 17                                                          redm-101
    2 call roam(niv,iq,t,ipi,ncoll,it,beta,iph,var,var(nva+1),iqmax,fac,redm-102
     1nfa,idmt,idt,lo)                                                  redm-103
      go to 17                                                          redm-104
c input of nuclear matrix elements from cards                           redm-105
    3 if (lo(217)) go to 42                                             redm-106
      it=0                                                              redm-107
      i=0                                                               redm-108
      nps=1                                                             redm-109
      if ((lo(201).and.lo(203)).or.lo(113)) nps=0                       redm-110
      do 16 i1=1,ncoll                                                  redm-111
      do 15 i2=i1,ncoll                                                 redm-112
      niv(i1,i2,1)=it+1                                                 redm-113
      read (1,1000) j1,j2,k                                             redm-114
      write (2,1001) j1,j2,k                                            redm-115
      if ((j1.ne.i1).or.(j2.ne.i2)) go to 46                            redm-116
      if (k.eq.0) go to 15                                              redm-117
      ijl=iabs(ipi(3,i1)-ipi(3,i2))                                     redm-118
      jil=(ipi(3,i1)+ipi(3,i2))                                         redm-119
      ijs=iabs(ipi(2,i1)-ipi(2,i2))                                     redm-120
      jis=ipi(2,i1)+ipi(2,i2)                                           redm-121
      if (4*(it+k).gt.idt) call memo(idmt,idmt+4*(it+k)-idt,idt,3,lo)   redm-122
      if (lo(216)) go to 54                                             redm-123
      do 14 k1=1,k                                                      redm-124
      it=it+1                                                           redm-125
      read (1,1002) j,iq(2,it),nn,m,t(4,it)                             redm-126
      if (nn.eq.-1.and.lo(111)) go to 47                                redm-127
      n=nn                                                              redm-128
      if (nn.eq.-1) n=0                                                 redm-129
      if (mod(iq(2,it)+ipi(1,i1)+ipi(1,i2),2).ne.0) go to 48            redm-130
      if ((n.gt.jis).or.(n.lt.ijs).or.(mod(jis+n,2).ne.0)) go to 49     redm-131
      if (lo(7)) go to 7                                                redm-132
      if (lo(1)) go to 5                                                redm-133
      if (lo(3)) go to 4                                                redm-134
      iqp=j/(nbt1+1)                                                    redm-135
      ipq=mod(j,nbt1+1)                                                 redm-136
      if ((ipq.le.0).or.(max0(ipq,iqp).gt.nbt1).or.(iqp.lt.0)) go to 50 redm-137
      go to 11                                                          redm-138
    4 if (j.lt.0.or.j.gt.3) go to 51                                    redm-139
      go to 11                                                          redm-140
    5 iqp=j/1000                                                        redm-141
      if (lo(3)) go to 6                                                redm-142
      if (iqp.ne.1+iq(2,it)) go to 52                                   redm-143
      go to 11                                                          redm-144
    6 iqy=iq(2,it)/2+1                                                  redm-145
      iqz=(iqy*(iqy-1))/2                                               redm-146
      if (iqp.le.iqz.or.iqp.gt.iqz+iqy) go to 53                        redm-147
      go to 11                                                          redm-148
    7 if (j.eq.0) go to 10                                              redm-149
      if (iabs(j)-i-1) 8 , 10 , 54                                      redm-150
    8 if (it.eq.1) go to 11                                             redm-151
      do 9 ii=2,it                                                      redm-152
      if (j.eq.iq(1,ii-1)) go to 11                                     redm-153
    9 continue                                                          redm-154
      go to 55                                                          redm-155
   10 i=i+1                                                             redm-156
      if (j.eq.0) j=i                                                   redm-157
   11 iq(1,it)=j                                                        redm-158
      if (n.eq.0) go to 12                                              redm-159
      if (2*iq(2,it).lt.iabs(n-m).or.2*iq(2,it).gt.n+m.or.mod(n+m,2).ne.redm-160
     10) go to 56                                                       redm-161
      nm=m                                                              redm-162
      iq(3,it)=10*m+10000*n                                             redm-163
      go to 13                                                          redm-164
   12 if ((m.lt.0).or.(m.gt.nps)) go to 57                              redm-165
      iq(3,it)=10*m                                                     redm-166
      nm=2*iq(2,it)                                                     redm-167
   13 if (nm.lt.ijl.or.nm.gt.jil) go to 58                              redm-168
      if (nn.eq.-1) iq(3,it)=iq(3,it)+1                                 redm-169
   14 write (2,1003) iq(1,it),iq(2,it),nn,m,t(4,it)                     redm-170
   15 niv(i1,i2,2)=it                                                   redm-171
   16 continue                                                          redm-172
   17 k=niv(ncoll,ncoll,2)                                              redm-173
      do 19 i1=1,ncoll                                                  redm-174
      do 18 i2=i1,ncoll                                                 redm-175
      niv(i2,i1,1)=niv(i1,i2,1)                                         redm-176
      niv(i2,i1,2)=niv(i1,i2,2)                                         redm-177
   18 continue                                                          redm-178
   19 continue                                                          redm-179
c check that there is enough place                                      redm-180
      if (14*it.gt.idt) call memo(idmt,idmt+14*it-idt,idt,3,lo)         redm-181
      if (lo(216)) go to 54                                             redm-182
      im=0                                                              redm-183
      invt=0                                                            redm-184
      intv=0                                                            redm-185
      inls=0                                                            redm-186
      insl=0                                                            redm-187
      invc=0                                                            redm-188
      invd=0                                                            redm-189
      intc=0                                                            redm-190
      imax=0                                                            redm-191
c table of multipoles                                                   redm-192
      if (it.eq.0) go to 40                                             redm-193
      itn=4*it                                                          redm-194
      do 23 j=1,it                                                      redm-195
      is=iq(3,j)/10000                                                  redm-196
      ij=mod(iq(3,j),1000)/10                                           redm-197
      il=mod(iq(3,j),10)                                                redm-198
      if (is.eq.0) ij=2*iq(2,j)                                         redm-199
      if (ij.eq.0) is=2*iq(2,j)                                         redm-200
      if (il.eq.1) is=-2                                                redm-201
      if (is.ne.0) iq(3,j)=0                                            redm-202
      if (im.eq.0) go to 21                                             redm-203
      do 20 k=1,im,3                                                    redm-204
      if ((iq(itn+k,1).eq.iq(2,j)).and.(iq(itn+k+1,1).eq.is).and.(iq(itnredm-205
     1+k+2,1).eq.ij)) go to 22                                          redm-206
   20 continue                                                          redm-207
   21 iq(itn+im+1,1)=iq(2,j)                                            redm-208
      iq(itn+im+2,1)=is                                                 redm-209
      iq(itn+im+3,1)=ij                                                 redm-210
      imax=max0(imax,iq(2,j))                                           redm-211
      im=im+3                                                           redm-212
      iq(2,j)=im/3                                                      redm-213
      go to 23                                                          redm-214
   22 iq(2,j)=1+k/3                                                     redm-215
   23 continue                                                          redm-216
      itm=itn+im                                                        redm-217
c table of form factors                                                 redm-218
c lt is true if the multipole order matters for form factors            redm-219
      lt=(lo(1).or.lo(11).or.lo(17).or.lo(19)).and.lo(107)              redm-220
      do 26 j=1,it                                                      redm-221
      if (invt.eq.0) go to 25                                           redm-222
      do 24 l=1,invt,7                                                  redm-223
      if (iq(itm+l,1).ne.iq(1,j)) go to 24                              redm-224
      if (lt.and.(iq(itm+l+1,1).ne.iq(2,j))) go to 24                   redm-225
      iq(1,j)=1+l/7                                                     redm-226
      iq(itm+l+2,1)=max0(iq(3,j),iq(itm+l+2,1))                         redm-227
      go to 26                                                          redm-228
   24 continue                                                          redm-229
   25 k=iq(2,j)                                                         redm-230
      k1=iq(itn+3*k-2,1)                                                redm-231
      iq(itm+invt+1,1)=iq(1,j)                                          redm-232
      iq(itm+invt+2,1)=k                                                redm-233
      iq(itm+invt+3,1)=iq(3,j)                                          redm-234
      iq(itm+invt+4,1)=0                                                redm-235
      iq(itm+invt+5,1)=0                                                redm-236
      iq(itm+invt+6,1)=0                                                redm-237
      iq(itm+invt+7,1)=k1                                               redm-238
      if ((iq(1,j).lt.0).or.((iq(1,j).gt.1000).and.(k1.le.1).and.(mod(iqredm-239
     1(1,j),1000).ne.0))) iq(itm+invt+6,1)=1                            redm-240
      if (lo(11).and.(mod(iq(itn+3*k-1,1),2).eq.0)) iq(itm+invt+4,1)=1  redm-241
      if (lo(19)) iq(itm+invt+5,1)=iq(itm+invt+3,1)                     redm-242
      invt=invt+7                                                       redm-243
      iq(1,j)=invt/7                                                    redm-244
   26 continue                                                          redm-245
c search on correction terms                                            redm-246
      intc=invt                                                         redm-247
      do 28 j=1,invt,7                                                  redm-248
      if (iq(itm+j+5,1).eq.0) go to 28                                  redm-249
      k1=itm+j-1                                                        redm-250
      do 27 l=1,7                                                       redm-251
   27 iq(itm+intc+l,1)=iq(k1+l,1)                                       redm-252
      iq(itm+intc+6,1)=-(1+j/7)                                         redm-253
      intc=intc+7                                                       redm-254
      iq(k1+6,1)=intc/7                                                 redm-255
   28 continue                                                          redm-256
      do 30 j=1,intc,7                                                  redm-257
      if (iq(itm+j+3,1).eq.0) go to 29                                  redm-258
      invc=invc+1                                                       redm-259
      iq(itm+j+3,1)=invc                                                redm-260
   29 if ((iq(itm+j+2,1).eq.0).and.(iq(itm+j+4,1).eq.0)) go to 30       redm-261
      inls=inls+1                                                       redm-262
      iq(itm+j+2,1)=inls                                                redm-263
      if (iq(itm+j+4,1).eq.0) go to 30                                  redm-264
      invd=invd+1                                                       redm-265
      iq(itm+j+4,1)=invd                                                redm-266
   30 continue                                                          redm-267
      itp=itm+intc                                                      redm-268
      ntc=invt/7                                                        redm-269
      do 31 j=1,ntc                                                     redm-270
      iq(itp+4*j-3,1)=j                                                 redm-271
      iq(itp+4*j-2,1)=0                                                 redm-272
      iq(itp+4*j-1,1)=iq(itm+7*j-4,1)                                   redm-273
      iq(itp+4*j,1)=iq(itm+7*j,1)                                       redm-274
   31 continue                                                          redm-275
      intv=4*ntc                                                        redm-276
      if (lo(120)) go to 37                                             redm-277
      do 36 i1=1,ncoll                                                  redm-278
      do 35 i2=i1,ncoll                                                 redm-279
      k1=niv(i1,i2,1)                                                   redm-280
      k2=niv(i1,i2,2)                                                   redm-281
      if (k1.gt.k2) go to 35                                            redm-282
      kk=i1*(ncoll+1)+i2                                                redm-283
      do 34 k=k1,k2                                                     redm-284
      j=iq(1,k)                                                         redm-285
      if (iq(itp+4*j-2,1).ne.0) go to 32                                redm-286
      iq(itp+4*j-2,1)=kk                                                redm-287
      go to 34                                                          redm-288
   32 do 33 l=1,4                                                       redm-289
   33 iq(itp+intv+l,1)=iq(itp+4*j+l-4,1)                                redm-290
      iq(itp+intv+2,1)=kk                                               redm-291
      intv=intv+4                                                       redm-292
      iq(1,k)=intv/4                                                    redm-293
   34 continue                                                          redm-294
   35 continue                                                          redm-295
   36 continue                                                          redm-296
   37 im=im/3                                                           redm-297
      intv=intv/4                                                       redm-298
      invt=invt/7                                                       redm-299
      intc=intc/7                                                       redm-300
      insl=0                                                            redm-301
      do 39 j=1,intv                                                    redm-302
      l=iq(itp+4*j-1,1)                                                 redm-303
      insl=max0(insl,l)                                                 redm-304
      do 38 k=1,it                                                      redm-305
      if (iq(1,k).eq.j) iq(3,k)=l                                       redm-306
   38 continue                                                          redm-307
   39 continue                                                          redm-308
c number of real and imaginary form factors                             redm-309
   40 nv=intc                                                           redm-310
      if (lo(13).or.lo(19)) nv=nv+2*inls                                redm-311
      ity(1)=0                                                          redm-312
      lo(221)=im.eq.0                                                   redm-313
      if (lo(100)) go to 41                                             redm-314
      ity(3)=npx                                                        redm-315
      ity(5)=ity(3)+npx                                                 redm-316
      if (lo(201).and.lo(203)) ity(5)=ity(3)                            redm-317
      ity(7)=ity(5)+intv                                                redm-318
      ity(2)=ity(7)+2*insl                                              redm-319
      ity(4)=ity(2)+npx                                                 redm-320
      ity(6)=ity(4)+npx                                                 redm-321
      if (lo(201).and.lo(203)) ity(6)=ity(4)                            redm-322
      ity(8)=ity(6)+intv                                                redm-323
      if (lo(112)) ity(8)=ity(6)                                        redm-324
      itx(1)=ity(8)+2*insl                                              redm-325
      if (lo(114)) itx(1)=ity(8)                                        redm-326
      if (lo(112)) itx(1)=ity(6)                                        redm-327
      itx(5)=itx(1)+npp                                                 redm-328
      itx(9)=itx(5)+npp                                                 redm-329
      if (lo(201).and.lo(203)) itx(9)=itx(5)                            redm-330
      itx(13)=itx(9)+intc                                               redm-331
      itx(2)=itx(13)+2*inls                                             redm-332
      itx(6)=itx(2)+npp                                                 redm-333
      itx(10)=itx(6)+npp                                                redm-334
      if (lo(201).and.lo(203)) itx(10)=itx(6)                           redm-335
      itx(14)=itx(10)+intc                                              redm-336
      itx(7)=itx(14)+2*inls                                             redm-337
      if (lo(114)) itx(7)=itx(14)                                       redm-338
      if (lo(112)) itx(7)=itx(10)                                       redm-339
      itx(8)=itx(7)+npp                                                 redm-340
      itx(3)=itx(8)+npp                                                 redm-341
      itx(4)=itx(3)+npp                                                 redm-342
      itx(11)=itx(4)+npp                                                redm-343
      itx(12)=itx(11)+intc                                              redm-344
      itx(15)=itx(12)+intc                                              redm-345
      if (lo(112)) itx(15)=itx(12)                                      redm-346
      itx(16)=itx(15)+invc                                              redm-347
      itxm=itx(16)+2*invd+1                                             redm-348
      go to 42                                                          redm-349
   41 ity(5)=0                                                          redm-350
      itx(1)=0                                                          redm-351
      itx(2)=14*ncoll                                                   redm-352
      ity(2)=itx(2)                                                     redm-353
      itx(7)=itx(2)+4*(intv+insl)                                       redm-354
      itx(3)=itx(7)+24*npp                                              redm-355
      itx(4)=itx(7)-24                                                  redm-356
      itx(5)=itx(3)-11                                                  redm-357
      itx(6)=itx(2)-4                                                   redm-358
      itxm=itx(3)+11*intc                                               redm-359
   42 if (lo(152).and.lo(161)) return                                   redm-360
c reduced matrix elements punched on cards on request                   redm-361
c output of reduced matrix elements on request                          redm-362
      it=niv(ncoll,ncoll,2)                                             redm-363
      itm=4*it-3                                                        redm-364
      itn=itm+3*im-4                                                    redm-365
      itp=itn+7*intc+3                                                  redm-366
      if (lo(52)) write (2,1006)                                        redm-367
      do 45 i1=1,ncoll                                                  redm-368
      do 44 i2=i1,ncoll                                                 redm-369
      k1=niv(i1,i2,1)                                                   redm-370
      k2=niv(i1,i2,2)                                                   redm-371
      if (lo(52)) write (2,1007) i1,i2,k1,k2                            redm-372
      k=k2-k1+1                                                         redm-373
      if (lo(61)) write (7,1004) i1,i2,k                                redm-374
      if (k.eq.0) go to 44                                              redm-375
      do 43 k=k1,k2                                                     redm-376
      if (lo(52)) write (2,1008) k,(iq(j,k),j=1,3),t(4,k)               redm-377
      if (lo(161)) go to 43                                             redm-378
      n=iq(1,k)                                                         redm-379
      m=iq(2,k)                                                         redm-380
      nm=iq(itn+7*n+1,1)                                                redm-381
      ns=iq(itm+3*m+2,1)                                                redm-382
      nj=iq(itm+3*m+3,1)                                                redm-383
      if (ns.le.0) nj=0                                                 redm-384
      if (ns.eq.-2) ns=-1                                               redm-385
      if (nj.eq.0.and.iq(3,k).ne.0) nj=1                                redm-386
      write (7,1005) nm,iq(itm+3*m+1,1),ns,nj,t(4,k)                    redm-387
   43 continue                                                          redm-388
   44 continue                                                          redm-389
   45 continue                                                          redm-390
      if (it.eq.0.or.lo(152)) return                                    redm-391
      write (2,1009) (i,(iq(itm+3*i+j,1),j=1,3),i=1,im)                 redm-392
      write (2,1010) (i,(iq(itn+7*i+j,1),j=1,7),i=1,intc)               redm-393
      write (2,1011) (i,(iq(itp+4*i+j,1),j=1,4),i=1,intv)               redm-394
      return                                                            redm-395
   46 write (2,1012) j1,j2,i1,i2                                        redm-396
      go to 59                                                          redm-397
   47 write (2,1013) nn                                                 redm-398
      go to 59                                                          redm-399
   48 write (2,1014) iq(2,it),ipi(1,i1),ipi(1,i2)                       redm-400
      go to 59                                                          redm-401
   49 write (2,1015)                                                    redm-402
      go to 59                                                          redm-403
   50 write (2,1016)                                                    redm-404
      go to 59                                                          redm-405
   51 write (2,1017)                                                    redm-406
      go to 59                                                          redm-407
   52 write (2,1018)                                                    redm-408
      go to 59                                                          redm-409
   53 write (2,1019) n,ijs,jis                                          redm-410
      go to 59                                                          redm-411
   54 write (2,1020) i,j                                                redm-412
      go to 59                                                          redm-413
   55 write (2,1021) j                                                  redm-414
      go to 59                                                          redm-415
   56 write (2,1022) m,iq(2,it),n                                       redm-416
      go to 59                                                          redm-417
   57 write (2,1023) m,nps                                              redm-418
      go to 59                                                          redm-419
   58 write (2,1024) nm,ijl,jil                                         redm-420
      go to 59                                                          redm-421
   59 write (2,1025)                                                    redm-422
      stop                                                              redm-423
 1000 format (3i5)                                                      redm-424
 1001 format (8h for i =,i4,10h  and ip =,i4,i8,24h reduced matrix elemeredm-425
     1nts)                                                              redm-426
 1002 format (4i5,f20.12)                                               redm-427
 1003 format (10x,13hform factor =,i4,4h l =,i4,4x,5h2*s =,i4,4x,5h2*j =redm-428
     1,i4,4x,23h reduced matrix element,e20.6)                          redm-429
 1004 format (3i5)                                                      redm-430
 1005 format (4i5,f20.12)                                               redm-431
 1006 format (//32h nuclear reduced matrix elements/)                   redm-432
 1007 format (/6h state,i3,12h  with state,i3,10x,5h from,i4,3h to,i4/) redm-433
 1008 format (10x,3hn =,i3,3x,13hform factor =,i3,3x,7hmult. =,i3,3x,8hsredm-434
     1p.-o. =,i3,6x,14hmatrix element,e15.6)                            redm-435
 1009 format (//5x,29h correspondence to multipoles//(20x,3hn =,i3,5x,3hredm-436
     1l =,i3,5x,5h2*s =,i3,5x,5h2*j =,i3))                              redm-437
 1010 format (//4x,52h correspondence to form factors in their computatiredm-438
     1on//(10x,3hn =,i3,4x,6hf.f. =,i6,4x,7hmult. =,i4,4x,8hsp.-o. =,i4,redm-439
     24x,6hcoul =,i4,4x,6hspdo =,i4,4x,5hcor =,i4,4x,3hl =,i4))         redm-440
 1011 format (//4x,44h correspondence to form factors in their use//(10xredm-441
     1,3hn =,i3,4x,7habove =,i4,4x,7hdisp. =,i4,4x,8hsp.-o. =,i4,4x,3hl redm-442
     2=,i4))                                                            redm-443
 1012 format (//55h incorrect order of input for reduced matrix elementsredm-444
     1 :,2i6,11h instead of,2i6)                                        redm-445
 1013 format (//90h a magnetic coulomb interaction cannot be used if theredm-446
     1 coulomb interaction is not deformed:,i3)                         redm-447
 1014 format (/16h multipole order,i4,26h not of the same parity as,2i4)redm-448
 1015 format (37h error for harmonic vibrational model)                 redm-449
 1016 format (39h error for anharmonic vibrational model)               redm-450
 1017 format (37h error for symmetric rotational model)                 redm-451
 1018 format (38h error for asymmetric rotational model)                redm-452
 1019 format (/6h 2*s =,i4,38h incorrect between channels with 2*s =,2i4redm-453
     1)                                                                 redm-454
 1020 format (/32h last form factor identification,i3,32h  new form factredm-455
     1or identification,i3,11h  too large)                              redm-456
 1021 format (/32h last form factor identification,i3,37h  was not alrearedm-457
     1dy read with this sign)                                           redm-458
 1022 format (/6h 2*j =,i4,19h incorrect with l =,i4,10h and 2*s =,i4)  redm-459
 1023 format (/10h j-value =,i4,55h  used as deformed spin-orbit controlredm-460
     1 incorrect. limit:,i2)                                            redm-461
 1024 format (/28h 2*transfer of ang. momentum,i4,12h not between,i4,4h redm-462
     1and,i4)                                                           redm-463
 1025 format (//22h in redm  ... stop ...)                              redm-464
      end                                                               redm-465
c 04/04/98  ibm version   cdc with 'c' to double precision      ecis97  vibm-000
      subroutine vibm(niv,iq,t,ipi,ncoll,it,iph,var,nva,nbta,nbt1,fac,nfvibm-001
     1a,idmt,idt,lo)                                                    vibm-002
c nuclear reduced matrix elements for the harmonic vibrational model    vibm-003
c the control number for form factor is i for beta(i) and i+j*(nbt1+1)  vibm-004
c for beta(i)*beta(j) with j larger than i in the harmonic vibrational  vibm-005
c model (order of derivative in the anharmonic vibrational model)       vibm-006
c for arguments niv to it and fac to lo    see redm                     vibm-007
c input variables: iph(i): number of phonons(0,1,2 phonons or 3 for     vibm-008
c             mixture of 1 and 2 phonons states)                        vibm-009
c                  iph(ncoll+i) for i=1,ncoll: address of the descrip-  vibm-010
c             tion of two phonons and mixed states which are in the samevibm-011
c             table iph for i larger than 2*ncoll.                      vibm-012
c                  var:  1 and 2 phonons mixing coefficients            vibm-013
c                  nva:  number of 1 and 2 phonons mixing coefficients  vibm-014
c                  rbta(i,j)   angular momentum of phonons for i=9      vibm-015
c                        0 for i=10 to be used in second order monopole vibm-016
c                        correction, anything not to be used            vibm-017
c                  nbt1: number of phonons                              vibm-018
c                                                                       vibm-019
c  the deformations beta and factors 1/sqrt(4*pi) are not included in   vibm-020
c the matrix elements which are computed here. the full expressions are:vibm-021
c (0||q2||0) = sum on beta**2/(4*pi) with iq=0                          vibm-022
c (0||q1||i) = (-)**i beta(i)/sqrt(4*pi) with iq=i                      vibm-023
c (i||q1||0) same value without (-)**i                                  vibm-024
c (ip||q2||i) = (-)**i beta(i)*beta(ip)*djcg(i,ip,0,0|iq,0)/(2*pi)      vibm-025
c    plus sum on beta**2*sqrt(2*i+1)/(4*pi) with iq=0 when i=ip         vibm-026
c (0||q2||l1,l2,i) = (-)**i beta(l1)*beta(l2) djcg(l1,l2,0,0|i,0)/      vibm-027
c    (2*pi*sqrt(1+delta(l1,l2)))   with iq=i                            vibm-028
c (l1,l2,i||q2||0) same value without (-)**i                            vibm-029
c (ip||q1||l1,l2,i) = (-)**iq beta(*)*(delta(iq,l1)*delta(ip,l2)+(-)**  vibm-030
c    (ip+i+iq)*delta(iq,l2)*delta(ip,l1)) * sqrt((2*i+1)/((2*iq+1)*     vibm-031
c    (1+delta(l1,l2))*sqrt(4*pi))                                       vibm-032
c (l1,l2,i||q1||ip) same expression but with (-)**ip+i+iq  in front     vibm-033
c (l3,l4,ip||q2||l1,l2,i)  sum on beta**2*(delta(l1,l3)*delta(l2,l4)+   vibm-034
c    (-)**(l1+l2-i)*delta(l1,l4)*delta(l2,l3)) * sqrt(2*ip+1)/(4*pi*sqrtvibm-035
c    ((1+delta(l1,l2))*(1+delta(l3,l4))) with iq=0,when i=ip            vibm-036
c    plus,when two phonons are identical,sum with all the possible va-  vibm-037
c    lues for iq of beta(l5)*beta(l6)*djcg(l5,l6,0,0|iq,0)*dj6j(l6,ip,  vibm-038
c    l7,i,l5,iq) * sqrt((2*i+1)*(2*ip+1))/(2*pi*sqrt((1+delta(l1,l2)*(1+vibm-039
c    delta(l3,l4))   where  l7 is the common phonon ,l5 and l6 the othervibm-040
c    phonons in i and ip, multiplied by the phase                       vibm-041
c      *(-)**(ip-l1) if l1=l3,        *(-)**(l3) if l1=l4,              vibm-042
c      *(-)**(ip+l1-i) if l2=l3,      *(-)**(l1+l3+l4-i) if l2=l4.      vibm-043
c (j||l=iq||i) is multiplied by a phase (-)**((iq+ipi(i)-ipi(j))/2)     vibm-044
c and the factors beta/sqrt(4*pi) are shifted on the form factors       vibm-045
c***********************************************************************vibm-046
      logical lib(4),lo(250)                                            vibm-047
      double precision dj6j,djcg,fac,fs,b,aa,aq,ax,ay                   vibm-048
      dimension iph(1),iq(4,1),t(4,1),ipi(10,1),ia(6,4),b(4),aa(2,2),varvibm-049
     1(1),niv(ncoll,ncoll,2),fac(1),nbta(10,1)                          vibm-050
      it=1                                                              vibm-051
      nsp=0                                                             vibm-052
      ivar=0                                                            vibm-053
      if (lo(13).or.lo(19)) nsp=10                                      vibm-054
      do 39 i1=1,ncoll                                                  vibm-055
      aa(1,1)=1.d0                                                      vibm-056
      aa(1,2)=0.d0                                                      vibm-057
      if (iph(i1).le.2) go to 1                                         vibm-058
      ivar=ivar+1                                                       vibm-059
      ay=1.74532925d-02*var(ivar)                                       vibm-060
      aa(1,1)=dcos(ay)                                                  vibm-061
      aa(1,2)=dsin(ay)                                                  vibm-062
      if (.not.lo(217)) write (2,1000) i1,var(ivar),aa(1,1),aa(1,2)     vibm-063
    1 jvar=ivar                                                         vibm-064
      aa(2,1)=aa(1,1)                                                   vibm-065
      aa(2,2)=aa(1,2)                                                   vibm-066
      do 38 i2=i1,ncoll                                                 vibm-067
      if (i1.eq.i2) go to 2                                             vibm-068
      aa(2,1)=1.d0                                                      vibm-069
      aa(2,2)=0.d0                                                      vibm-070
      if (iph(i2).le.2) go to 2                                         vibm-071
      jvar=jvar+1                                                       vibm-072
      if (jvar.gt.nva) go to 40                                         vibm-073
      ay=1.74532925d-02*var(jvar)                                       vibm-074
      aa(2,1)=dcos(ay)                                                  vibm-075
      aa(2,2)=dsin(ay)                                                  vibm-076
    2 niv(i1,i2,1)=it                                                   vibm-077
      l1=iph(i1)                                                        vibm-078
      ax=aa(1,1)                                                        vibm-079
      if (l1.gt.2) l1=1                                                 vibm-080
      if (abs(ax).lt.1.e-6) go to 27                                    vibm-081
    3 l2=iph(i2)                                                        vibm-082
      if (l2.gt.2) l2=1                                                 vibm-083
      ay=ax*aa(2,1)                                                     vibm-084
      if (abs(ay).lt.1.e-6) go to 26                                    vibm-085
    4 i=l1+l2+1                                                         vibm-086
      if (i.eq.3.and.l1.ne.l2) i=6                                      vibm-087
      if (l1.gt.l2) go to 5                                             vibm-088
      j1=i1                                                             vibm-089
      j2=i2                                                             vibm-090
      go to 6                                                           vibm-091
    5 j1=i2                                                             vibm-092
      j2=i1                                                             vibm-093
c  transposition                                                        vibm-094
      ay=ay*(1-mod(ipi(3,i1)+ipi(3,i2)+2*(ipi(1,i1)+ipi(1,i2)+1),4))    vibm-095
    6 go to ( 7 , 9 , 10 , 14 , 18 , 24 ) , i                           vibm-096
c  (0||q||0)                                                            vibm-097
    7 if ((ipi(3,j1).ne.1).or.(ipi(3,j2).ne.1)) go to 41                vibm-098
      if (lo(102)) go to 26                                             vibm-099
      do 8 l=1,nbt1                                                     vibm-100
      if (nbta(10,l).ne.0) go to 8                                      vibm-101
      if (4*it.gt.idt) call memo(idmt,idmt+4,idt,3,lo)                  vibm-102
      if (lo(216)) go to 42                                             vibm-103
      iq(1,it)=l*(nbt1+2)                                               vibm-104
      iq(2,it)=0                                                        vibm-105
      iq(3,it)=nsp                                                      vibm-106
      t(4,it)=ay                                                        vibm-107
      it=it+1                                                           vibm-108
    8 continue                                                          vibm-109
      go to 26                                                          vibm-110
c  (ip||q||0)  with ip=j2                                               vibm-111
    9 if (4*it.gt.idt) call memo(idmt,idmt+4,idt,3,lo)                  vibm-112
      if (lo(216)) go to 42                                             vibm-113
      n2=iph(j2+ncoll)                                                  vibm-114
      if (iph(j2).gt.2) n2=n2+2                                         vibm-115
      n2=iph(n2)                                                        vibm-116
      if ((ipi(3,j2).ne.(2*nbta(9,n2)+1)).or.(ipi(3,j1).ne.1)) go to 41 vibm-117
      iq(1,it)=n2                                                       vibm-118
      iq(2,it)=nbta(9,n2)                                               vibm-119
      iq(3,it)=nsp                                                      vibm-120
      t(4,it)=ay                                                        vibm-121
      if (mod(iabs(iq(2,it)+ipi(1,j1)-ipi(1,j2)),4).ne.0) t(4,it)=-t(4,ivibm-122
     1t)                                                                vibm-123
      go to 25                                                          vibm-124
c  (ip||q||i)                                                           vibm-125
   10 if (lo(102)) go to 26                                             vibm-126
      n1=iph(j1+ncoll)                                                  vibm-127
      if (iph(j1).gt.2) n1=n1+2                                         vibm-128
      n1=iph(n1)                                                        vibm-129
      n2=iph(j2+ncoll)                                                  vibm-130
      if (iph(j2).gt.2) n2=n2+2                                         vibm-131
      n2=iph(n2)                                                        vibm-132
      if ((ipi(3,j2).ne.(2*nbta(9,n2)+1)).or.(ipi(3,j1).ne.(2*nbta(9,n1)vibm-133
     1+1))) go to 41                                                    vibm-134
      if (n1.ne.n2) go to 12                                            vibm-135
      aq=dsqrt(2.d0*nbta(9,n1)+1.d0)                                    vibm-136
      do 11 l=1,nbt1                                                    vibm-137
      if (nbta(10,l).ne.0) go to 11                                     vibm-138
      if (4*it.gt.idt) call memo(idmt,idmt+4,idt,3,lo)                  vibm-139
      if (lo(216)) go to 42                                             vibm-140
      iq(1,it)=l*(nbt1+2)                                               vibm-141
      iq(2,it)=0                                                        vibm-142
      iq(3,it)=nsp                                                      vibm-143
      t(4,it)=aq*ay                                                     vibm-144
      it=it+1                                                           vibm-145
   11 continue                                                          vibm-146
c factor 2 for non identical phonons added on the 10/03/81              vibm-147
   12 k1=iabs(nbta(9,n2)-nbta(9,n1))+1                                  vibm-148
      k2=nbta(9,n2)+nbta(9,n1)+1                                        vibm-149
      fs=2*(1-2*mod(nbta(9,n1)+iabs(ipi(1,j1)-ipi(1,j2)+k1-1)/2,2))     vibm-150
      do 13 k=k1,k2,2                                                   vibm-151
      if (4*it.gt.idt) call memo(idmt,idmt+4,idt,3,lo)                  vibm-152
      if (lo(216)) go to 42                                             vibm-153
      j=k-1                                                             vibm-154
      aq=fs*djcg(ipi(3,j1)-1,ipi(3,j2)-1,2*j,0,0,fac,nfa)               vibm-155
      iq(1,it)=max0(n1,n2)*(nbt1+1)+min0(n1,n2)                         vibm-156
      iq(2,it)=j                                                        vibm-157
      iq(3,it)=nsp                                                      vibm-158
      t(4,it)=aq*ay                                                     vibm-159
      fs=-fs                                                            vibm-160
   13 it=it+1                                                           vibm-161
      go to 26                                                          vibm-162
c  (l1,l2,ip||q||i) with i=j1 and ip=j2                                 vibm-163
   14 i=iph(j2+ncoll)                                                   vibm-164
      lb1=iph(i)                                                        vibm-165
      lb2=iph(i+1)                                                      vibm-166
      n1=iph(j1+ncoll)                                                  vibm-167
      if (iph(j1).gt.2) n1=n1+2                                         vibm-168
      n1=iph(n1)                                                        vibm-169
      if (ipi(3,j1).ne.(2*nbta(9,n1)+1)) go to 41                       vibm-170
      lib(1)=lb1.eq.n1                                                  vibm-171
      lib(2)=lb2.eq.n1                                                  vibm-172
      if (4*it.gt.idt) call memo(idmt,idmt+4,idt,3,lo)                  vibm-173
      if (lo(216)) go to 42                                             vibm-174
      if (lib(1).and.lib(2)) go to 16                                   vibm-175
      if (lib(2)) go to 15                                              vibm-176
      if (.not.lib(1)) go to 26                                         vibm-177
      iq(1,it)=lb2                                                      vibm-178
      iq(2,it)=nbta(9,lb2)                                              vibm-179
      iq(3,it)=nsp                                                      vibm-180
      t(4,it)=ay*(1-2*mod(iabs(ipi(1,j1)-ipi(1,j2)+iq(2,it))/2,2))      vibm-181
      go to 17                                                          vibm-182
   15 iq(1,it)=lb1                                                      vibm-183
      iq(2,it)=nbta(9,lb1)                                              vibm-184
      iq(3,it)=nsp                                                      vibm-185
      t(4,it)=ay*(1-mod(iabs(ipi(3,j1)+ipi(3,j2)-2+ipi(1,j1)-ipi(1,j2)-ivibm-186
     1q(2,it)),4))                                                      vibm-187
      go to 17                                                          vibm-188
   16 if (mod(ipi(3,j2),4).ne.1) go to 26                               vibm-189
      iq(1,it)=n1                                                       vibm-190
      iq(2,it)=nbta(9,n1)                                               vibm-191
      iq(3,it)=nsp                                                      vibm-192
      t(4,it)=1.4142135*ay*(1-mod(iabs(ipi(1,j1)-ipi(1,j2)+iq(2,it)),4))vibm-193
   17 t(4,it)=t(4,it)*sqrt(ipi(3,j2)/(2.*iq(2,it)+1.))                  vibm-194
      go to 25                                                          vibm-195
c  (l3,l4,ip||q||l1,l2,i)                                               vibm-196
   18 if (lo(102)) go to 26                                             vibm-197
      i=iph(i1+ncoll)                                                   vibm-198
      lb1=iph(i)                                                        vibm-199
      lb2=iph(i+1)                                                      vibm-200
      i=iph(i2+ncoll)                                                   vibm-201
      lb3=iph(i)                                                        vibm-202
      lb4=iph(i+1)                                                      vibm-203
      lib(1)=lb1.ne.lb3                                                 vibm-204
      lib(2)=lb2.ne.lb4                                                 vibm-205
      lib(3)=lb1.ne.lb4                                                 vibm-206
      lib(4)=lb2.ne.lb3                                                 vibm-207
      if (lib(1).and.lib(2).and.lib(3).and.lib(4)) go to 26             vibm-208
      ja1=(ipi(3,j1)-1)/2                                               vibm-209
      ja2=(ipi(3,j2)-1)/2                                               vibm-210
      ia(1,1)=nbta(9,lb2)                                               vibm-211
      ia(2,1)=nbta(9,lb4)                                               vibm-212
      ia(1,2)=nbta(9,lb1)                                               vibm-213
      ia(2,2)=nbta(9,lb3)                                               vibm-214
      ia(1,3)=ia(1,1)                                                   vibm-215
      ia(2,3)=ia(2,2)                                                   vibm-216
      ia(1,4)=ia(1,2)                                                   vibm-217
      ia(2,4)=ia(2,1)                                                   vibm-218
      ia(3,1)=ia(1,2)                                                   vibm-219
      ia(3,2)=ia(1,1)                                                   vibm-220
      ia(3,3)=ia(1,2)                                                   vibm-221
      ia(3,4)=ia(1,1)                                                   vibm-222
      ia(6,1)=max0(lb2,lb4)*(nbt1+1)+min0(lb2,lb4)                      vibm-223
      ia(6,2)=max0(lb1,lb3)*(nbt1+1)+min0(lb1,lb3)                      vibm-224
      ia(6,3)=max0(lb2,lb3)*(nbt1+1)+min0(lb2,lb3)                      vibm-225
      ia(6,4)=max0(lb1,lb4)*(nbt1+1)+min0(lb1,lb4)                      vibm-226
      imin=1000                                                         vibm-227
      imax=0                                                            vibm-228
      do 19 i=1,4                                                       vibm-229
      if (lib(i)) go to 19                                              vibm-230
      ia(4,i)=iabs(ia(1,i)-ia(2,i))                                     vibm-231
      ia(5,i)=ia(1,i)+ia(2,i)                                           vibm-232
      if (ia(4,i).lt.imin) imin=ia(4,i)                                 vibm-233
      if (ia(5,i).gt.imax) imax=ia(5,i)                                 vibm-234
   19 continue                                                          vibm-235
      b(1)=1-2*mod(ja2+ia(1,2),2)                                       vibm-236
      b(2)=1-2*mod(ia(1,2)+ia(2,2)+ia(2,1)+ja1,2)                       vibm-237
      b(3)=1-2*mod(ia(2,2),2)                                           vibm-238
      b(4)=1-2*mod(ja2+ja1+ia(1,2),2)                                   vibm-239
      t0=sqrt((2.*ja1+1.)*(2.*ja2+1.))*2.0                              vibm-240
      if (lb1.eq.lb2) t0=0.707107*t0                                    vibm-241
      if (lb3.eq.lb4) t0=0.707107*t0                                    vibm-242
      if (ja1.ne.ja2) go to 21                                          vibm-243
      tkq=0.                                                            vibm-244
      if ((lb1.eq.lb3).and.(lb2.eq.lb4)) tkq=1.                         vibm-245
      if ((lb1.eq.lb4).and.(lb2.eq.lb3)) tkq=tkq+(1-2*mod(ja1+ia(1,1)+iavibm-246
     1(1,2),2))                                                         vibm-247
      if (tkq.eq.0) go to 21                                            vibm-248
      if (lb1.eq.lb2) tkq=0.5*tkq                                       vibm-249
      do 20 l=1,nbt1                                                    vibm-250
      if (nbta(10,l).ne.0) go to 20                                     vibm-251
      if (4*it.gt.idt) call memo(idmt,idmt+4,idt,3,lo)                  vibm-252
      if (lo(216)) go to 42                                             vibm-253
      iq(1,it)=l*(nbt1+2)                                               vibm-254
      iq(2,it)=0                                                        vibm-255
      iq(3,it)=nsp                                                      vibm-256
      t(4,it)=tkq*dsqrt(2.d0*ja1+1.d0)*ay                               vibm-257
      it=it+1                                                           vibm-258
   20 continue                                                          vibm-259
   21 imin=max0(imin,iabs(ja1-ja2))+1                                   vibm-260
      imax=min0(imax,ja1+ja2)+1                                         vibm-261
      do 23 m=imin,imax                                                 vibm-262
      j=m-1                                                             vibm-263
      do 22 k=1,4                                                       vibm-264
      if (lib(k).or.(j.lt.ia(4,k)).or.(j.gt.ia(5,k)).or.(mod(j+ia(5,k),2vibm-265
     1).ne.0)) go to 22                                                 vibm-266
      if (4*it.gt.idt) call memo(idmt,idmt+4,idt,3,lo)                  vibm-267
      if (lo(216)) go to 42                                             vibm-268
      t3=b(k)*dj6j(2*ia(1,k),2*ia(2,k),2*j,2*ja2,2*ja1,2*ia(3,k),fac,nfavibm-269
     1)*djcg(2*ia(1,k),2*ia(2,k),2*j,0,0,fac,nfa)*(1-mod(iabs(ipi(1,j1)-vibm-270
     2ipi(1,j2)+j),4))                                                  vibm-271
      if (abs(t3).lt.1.e-6) go to 22                                    vibm-272
      iq(1,it)=ia(6,k)                                                  vibm-273
      iq(2,it)=j                                                        vibm-274
      iq(3,it)=nsp                                                      vibm-275
      t(4,it)=t3*t0*ay                                                  vibm-276
      it=it+1                                                           vibm-277
   22 continue                                                          vibm-278
   23 continue                                                          vibm-279
      go to 26                                                          vibm-280
c  (l1,l2,ip||q||0) with ip=j2                                          vibm-281
   24 if (lo(102)) go to 26                                             vibm-282
      k3=(ipi(3,j2)-1)/2                                                vibm-283
      iq(2,it)=k3                                                       vibm-284
      i=iph(j2+ncoll)                                                   vibm-285
      k1=iph(i)                                                         vibm-286
      k2=iph(i+1)                                                       vibm-287
      iq(1,it)=max0(k1,k2)*(nbt1+1)+min0(k1,k2)                         vibm-288
      iq(3,it)=nsp                                                      vibm-289
      w1=1.4142135                                                      vibm-290
      if (k1.ne.k2) w1=2.                                               vibm-291
      t(4,it)=ay*djcg(2*nbta(9,k1),2*nbta(9,k2),ipi(3,j2)-1,0,0,fac,nfa)vibm-292
     1*(1-mod(iabs(ipi(1,j1)-ipi(1,j2)+k3),4))*w1                       vibm-293
   25 it=it+1                                                           vibm-294
   26 if ((aa(2,2).eq.0.).or.(l2.eq.2)) go to 27                        vibm-295
      l2=2                                                              vibm-296
      ay=ax*aa(2,2)                                                     vibm-297
      go to 4                                                           vibm-298
   27 if ((aa(1,2).eq.0.).or.(l1.eq.2)) go to 28                        vibm-299
      l1=2                                                              vibm-300
      ax=aa(1,2)                                                        vibm-301
      go to 3                                                           vibm-302
   28 iti=niv(i1,i2,1)                                                  vibm-303
      if (iti.eq.it) go to 37                                           vibm-304
      itf=it-1                                                          vibm-305
      if (itf.eq.iti) go to 32                                          vibm-306
      it1=iti+1                                                         vibm-307
      it=iti                                                            vibm-308
      do 31 i=it1,itf                                                   vibm-309
      do 29 j=iti,it                                                    vibm-310
      if ((iq(1,i).ne.iq(1,j)).or.(iq(2,i).ne.iq(2,j)).or.(iq(3,i).ne.iqvibm-311
     1(3,j))) go to 29                                                  vibm-312
      t(4,j)=t(4,j)+t(4,i)                                              vibm-313
      go to 31                                                          vibm-314
   29 continue                                                          vibm-315
      it=it+1                                                           vibm-316
      do 30 k=1,3                                                       vibm-317
   30 iq(k,it)=iq(k,i)                                                  vibm-318
      t(4,it)=t(4,i)                                                    vibm-319
   31 continue                                                          vibm-320
      it=it+1                                                           vibm-321
   32 itf=it-1                                                          vibm-322
      do 36 i=iti,itf                                                   vibm-323
      if (it.le.i) go to 37                                             vibm-324
   33 if (abs(t(4,i)).gt.1.e-12) go to 36                               vibm-325
      it1=i+1                                                           vibm-326
      it=it-1                                                           vibm-327
      if (it1.gt.it) go to 37                                           vibm-328
      do 35 j=it1,it                                                    vibm-329
      do 34 k=1,3                                                       vibm-330
   34 iq(k,j-1)=iq(k,j)                                                 vibm-331
   35 t(4,j-1)=t(4,j)                                                   vibm-332
      go to 33                                                          vibm-333
   36 continue                                                          vibm-334
   37 niv(i1,i2,2)=it-1                                                 vibm-335
   38 continue                                                          vibm-336
   39 continue                                                          vibm-337
      it=it-1                                                           vibm-338
      return                                                            vibm-339
   40 write (2,1001) jvar,nva                                           vibm-340
      go to 42                                                          vibm-341
   41 write (2,1002) i1,i2                                              vibm-342
   42 write (2,1003)                                                    vibm-343
      stop                                                              vibm-344
 1000 format (6h state,i4,f15.5,26h degrees      amplitudes =,f15.7,14h vibm-345
     1 1 phonon and,f15.7,11h  2 phonons)                               vibm-346
 1001 format (26h number of variables used:,i5,5x,33hexceeds number of vvibm-347
     1ariables read:,i6)                                                vibm-348
 1002 format (' incorrect description of level',i3,'  or',i3)           vibm-349
 1003 format (//22h in vibm  ... stop ...)                              vibm-350
      end                                                               vibm-351
c 04/04/98  ibm version   cdc with 'c' to double precision      ecis97  rotm-000
      subroutine rotm(niv,iq,t,ipi,ncoll,iph,nbta,var,nva,it,iqmax,aspinrotm-001
     1,fac,nfa,idmt,idt,lo)                                             rotm-002
c nuclear reduced matrix elements for the symmetric rotational model    rotm-003
c the control number for the form factor with the vibration n1 and the  rotm-004
c multipolarity l is 1000*(l+1)+n1                                      rotm-005
c for arguments niv to it and fac to lo    see redm                     rotm-006
c special input: iqmax: maximum multipole expansion                     rotm-007
c                aspin: ground state band value k                       rotm-008
c                iph:   description of levels                           rotm-009
c                nbta:  description of vibrational bands                rotm-010
c                var:   mixture coefficients of bands                   rotm-011
c                nva:   number of values of var                         rotm-012
c                                                                       rotm-013
c    (ip||q||i)   = sqrt(2*i+1) * cg(i,iq,ip,k,0,k)                     rotm-014
c   (ip+v||q||i)  = sqrt(2*i+1) * cg(i,iq,ip,k,v,k+v)                   rotm-015
c  (ip+v||q||i+v) = sqrt(2*i+1) * cg(i,iq,ip,k+v,0,k+v)                 rotm-016
c***********************************************************************rotm-017
      logical lo(250)                                                   rotm-018
      double precision djcg,fac,aa,ax,ay                                rotm-019
      dimension t(4,1),ipi(10,1),niv(ncoll,ncoll,2),iq(4,1),fac(1),var(1rotm-020
     1),iph(1),nbta(10,1),aa(2,2)                                       rotm-021
      it=1                                                              rotm-022
      nsi=2.*aspin+.1                                                   rotm-023
      nsp=0                                                             rotm-024
      if (lo(13).or.lo(19)) nsp=10                                      rotm-025
      ivar=0                                                            rotm-026
      do 24 i1=1,ncoll                                                  rotm-027
      ia1=ipi(3,i1)-1                                                   rotm-028
      n1=iph(i1+ncoll)                                                  rotm-029
      aa(1,1)=1.d0                                                      rotm-030
      aa(1,2)=0.d0                                                      rotm-031
      if (iph(i1).le.1) go to 1                                         rotm-032
      ivar=ivar+1                                                       rotm-033
      ay=1.74532925d-02*var(ivar)                                       rotm-034
      aa(1,1)=dcos(ay)                                                  rotm-035
      aa(1,2)=dsin(ay)                                                  rotm-036
      if (.not.lo(217)) write (2,1000) i1,var(ivar),aa(1,1),aa(1,2)     rotm-037
    1 jvar=ivar                                                         rotm-038
      aa(2,1)=aa(1,1)                                                   rotm-039
      aa(2,2)=aa(1,2)                                                   rotm-040
      do 23 i2=i1,ncoll                                                 rotm-041
      ia2=ipi(3,i2)-1                                                   rotm-042
      n2=iph(i2+ncoll)                                                  rotm-043
      niv(i1,i2,1)=it                                                   rotm-044
      if (i1.eq.i2) go to 2                                             rotm-045
      aa(2,1)=1.d0                                                      rotm-046
      aa(2,2)=0.d0                                                      rotm-047
      if (iph(i2).le.1) go to 2                                         rotm-048
      jvar=jvar+1                                                       rotm-049
      if (jvar.gt.nva) go to 25                                         rotm-050
      ay=1.74532925d-02*var(jvar)                                       rotm-051
      aa(2,1)=dcos(ay)                                                  rotm-052
      aa(2,2)=dsin(ay)                                                  rotm-053
    2 niv(i1,i2,1)=it                                                   rotm-054
      l1=iph(i1)                                                        rotm-055
      ax=aa(1,1)                                                        rotm-056
      if (l1.gt.1) l1=0                                                 rotm-057
      if (abs(ax).lt.1.e-6) go to 12                                    rotm-058
    3 l2=iph(i2)                                                        rotm-059
      if (l2.gt.1) l2=0                                                 rotm-060
      ay=ax*aa(2,1)                                                     rotm-061
      if (abs(ay).lt.1.e-6) go to 11                                    rotm-062
    4 if (l1.ne.l2) go to 7                                             rotm-063
      nsj=nsi                                                           rotm-064
      if (l1.eq.0) go to 5                                              rotm-065
      n3=iph(n1)                                                        rotm-066
      if (n3.ne.iph(n2)) go to 11                                       rotm-067
      nsj=2*nbta(10,n3)+nsj                                             rotm-068
    5 if (ipi(1,i1).ne.ipi(1,i2)) go to 26                              rotm-069
      if ((iabs(nsj).gt.ia2).or.(iabs(nsj).gt.ia1)) go to 27            rotm-070
      iq1=min0(iqmax,(ia1+ia2)/2)                                       rotm-071
      iq2=max0(2,iabs(ia1-ia2)/2)                                       rotm-072
      if (2*(iq2/2).ne.iq2) iq2=iq2+1                                   rotm-073
      if (iq2.gt.iq1) go to 11                                          rotm-074
      do 6 iqz=iq2,iq1,2                                                rotm-075
      if (4*it.gt.idt) call memo(idmt,idmt+4*it-idt,idt,3,lo)           rotm-076
      if (lo(216)) go to 29                                             rotm-077
      iq(1,it)=1000*(iqz+1)                                             rotm-078
      iq(2,it)=iqz                                                      rotm-079
      iq(3,it)=nsp                                                      rotm-080
      t(4,it)=(1-mod(iqz,4))*dsqrt(ia1+1.d0)*djcg(ia1,2*iqz,ia2,nsj,0,farotm-081
     1c,nfa)*ay                                                         rotm-082
      if (abs(t(4,it)).gt.1.e-6) it=it+1                                rotm-083
    6 continue                                                          rotm-084
      go to 11                                                          rotm-085
    7 if (l1.gt.l2) go to 8                                             rotm-086
      n3=iph(n2)                                                        rotm-087
      go to 9                                                           rotm-088
c  transposition                                                        rotm-089
    8 ay=ay*(1-mod(ipi(3,i1)+ipi(3,i2)+2*(ipi(1,i1)+ipi(1,i2)+1),4))    rotm-090
      n3=iph(n1)                                                        rotm-091
c 0 phonons -1 phonon                                                   rotm-092
    9 nsj=2*nbta(10,n3)                                                 rotm-093
      if (mod(ipi(1,i1)+ipi(1,i2)+nbta(9,n3),2).ne.0) go to 28          rotm-094
      if (iabs(nsj+nsi).gt.ia2) go to 27                                rotm-095
      iq1=(ia1+ia2)/2                                                   rotm-096
      iq2=max0(iabs(nsj),iabs(ia1-ia2))/2                               rotm-097
      if (mod(iq2+nbta(9,n3),2).ne.0) iq2=iq2+1                         rotm-098
      if (iq2.gt.iq1) go to 11                                          rotm-099
      do 10 iqz=iq2,iq1,2                                               rotm-100
      if (4*it.gt.idt) call memo(idmt,idmt+4*it-idt,idt,3,lo)           rotm-101
      if (lo(216)) go to 29                                             rotm-102
      iq(1,it)=1000*(iqz+1)+n3                                          rotm-103
      iq(2,it)=iqz                                                      rotm-104
      iq(3,it)=nsp                                                      rotm-105
      t(4,it)=(1-mod(iqz+ipi(1,i1)+ipi(1,i2),4))*dsqrt(ia1+1.d0)*djcg(iarotm-106
     11,2*iqz,ia2,nsi,nsj,fac,nfa)*ay                                   rotm-107
      if (abs(t(4,it)).gt.1.e-6) it=it+1                                rotm-108
   10 continue                                                          rotm-109
   11 if ((aa(2,2).eq.0.).or.(l2.eq.1)) go to 12                        rotm-110
      l2=1                                                              rotm-111
      ay=ax*aa(2,2)                                                     rotm-112
      go to 4                                                           rotm-113
   12 if ((aa(1,2).eq.0.).or.(l1.eq.1)) go to 13                        rotm-114
      l1=1                                                              rotm-115
      ax=aa(1,2)                                                        rotm-116
      go to 3                                                           rotm-117
   13 iti=niv(i1,i2,1)                                                  rotm-118
      if (iti.eq.it) go to 22                                           rotm-119
      itf=it-1                                                          rotm-120
      if (itf.eq.iti) go to 17                                          rotm-121
      it1=iti+1                                                         rotm-122
      it=iti                                                            rotm-123
      do 16 i=it1,itf                                                   rotm-124
      do 14 j=iti,it                                                    rotm-125
      if ((iq(1,i).ne.iq(1,j)).or.(iq(2,i).ne.iq(2,j)).or.(iq(3,i).ne.iqrotm-126
     1(3,j))) go to 14                                                  rotm-127
      t(4,j)=t(4,j)+t(4,i)                                              rotm-128
      go to 16                                                          rotm-129
   14 continue                                                          rotm-130
      it=it+1                                                           rotm-131
      do 15 k=1,3                                                       rotm-132
   15 iq(k,it)=iq(k,i)                                                  rotm-133
      t(4,it)=t(4,i)                                                    rotm-134
   16 continue                                                          rotm-135
      it=it+1                                                           rotm-136
   17 itf=it-1                                                          rotm-137
      do 21 i=iti,itf                                                   rotm-138
      if (it.le.i) go to 22                                             rotm-139
   18 if (abs(t(4,i)).gt.1.e-12) go to 21                               rotm-140
      it1=i+1                                                           rotm-141
      it=it-1                                                           rotm-142
      if (it1.gt.it) go to 22                                           rotm-143
      do 20 j=it1,it                                                    rotm-144
      do 19 k=1,3                                                       rotm-145
   19 iq(k,j-1)=iq(k,j)                                                 rotm-146
   20 t(4,j-1)=t(4,j)                                                   rotm-147
      go to 18                                                          rotm-148
   21 continue                                                          rotm-149
   22 niv(i1,i2,2)=it-1                                                 rotm-150
   23 continue                                                          rotm-151
   24 continue                                                          rotm-152
      it=it-1                                                           rotm-153
      return                                                            rotm-154
   25 write (2,1001) jvar,nva                                           rotm-155
      go to 29                                                          rotm-156
   26 write (2,1002) i1,i2                                              rotm-157
      go to 29                                                          rotm-158
   27 write (2,1003) i1,i2                                              rotm-159
      go to 29                                                          rotm-160
   28 write (2,1004) i1,i2,n3                                           rotm-161
      go to 29                                                          rotm-162
   29 write (2,1005)                                                    rotm-163
      stop                                                              rotm-164
 1000 format (6h state,i4,f15.5,26h degrees      amplitudes =,f15.7,22h rotm-165
     1ground state band and,f15.5,17h vibrational band)                 rotm-166
 1001 format (26h number of variables used:,i5,5x,33hexceeds number of vrotm-167
     1ariables read:,i6)                                                rotm-168
 1002 format (/19h parities of states,i4,5h  and,i4,36h  incorrect for trotm-169
     1he rotational model)                                              rotm-170
 1003 format (49h too large magnetic quantum number between levels,i4,4hrotm-171
     1 and,i4)                                                          rotm-172
 1004 format (/19h parities of states,i4,5h  and,i4,55h  incorrect for trotm-173
     1he rotational model with the vibration,i4)                        rotm-174
 1005 format (//22h in rotm  ... stop ...)                              rotm-175
      end                                                               rotm-176
c 22/02/97  ibm version   cdc with 'c' to double precision      ecis96  roam-000
      subroutine roam(niv,iq,t,ipi,ncoll,it,beta,iph,var,va,iqmax,fac,nfroam-001
     1a,idmt,idt,lo)                                                    roam-002
c nuclear reduced matrix elements for the asymmetric rotational model   roam-003
c the control number for form factor (l=2,k=0) is 2,for (l=2,k=2) is 3, roam-004
c    for (l=4,k=0) is 4,for (l=4,k=2) is 2  ... and so on...            roam-005
c for arguments niv to it and fac to lo    see redm                     roam-006
c special input: beta:  deformations.the gamma parameter beta(*,2) is   roam-007
c                       related to the band mixing param. if lo(2)=.trueroam-008
c                iph(i):number of nuclear parameters for i=1,ncoll      roam-009
c                     their address for i=ncoll+1,2*ncoll               roam-010
c                var:   band mixing coefficients                        roam-011
c                va:    working space for amplitudes (permanent)        roam-012
c                iqmax: maximum order of multipole expansion            roam-013
c                                                                       roam-014
c  (ip||q(iq,kq)||i) = sqrt(2*i+1) *cg(i,iq,ip,k,kq,kp)                 roam-015
c***********************************************************************roam-016
      logical lo(250)                                                   roam-017
      double precision djcg,fac                                         roam-018
      dimension iq(4,1),t(4,1),ipi(10,1),var(1),beta(10,3),niv(ncoll,ncoroam-019
     1ll,2),fac(1),va(5),iph(1)                                         roam-020
      ivar=0                                                            roam-021
      i2=1                                                              roam-022
      if (lo(102)) go to 4                                              roam-023
c var(1) is the angle gamma of davydov and filippov model               roam-024
c the second level must be a the first 2+ and the third one,if present, roam-025
c the second 2+ .their mixing coefficients are computed from var(1).    roam-026
c there can be any number of levels after the third one.                roam-027
      g=var(1)-beta(1,2)                                                roam-028
      do 1 i=1,8                                                        roam-029
    1 beta(i,2)=beta(i,2)+g                                             roam-030
      g=0.0174533*var(1)                                                roam-031
      g1=sin(g)                                                         roam-032
      g2=cos(g)                                                         roam-033
      g3=sin(3.*g)                                                      roam-034
      g4=cos(3.*g)                                                      roam-035
      g=sqrt(9.-8.*g3*g3)                                               roam-036
      g5=-(g1*g3+3.*g2*g4+g)                                            roam-037
      g6=3.*g1*g4-g2*g3                                                 roam-038
      va(1)=1.                                                          roam-039
      if (ncoll.eq.1) go to 2                                           roam-040
      g=sqrt(g6*g6+g5*g5)                                               roam-041
      va(2)=g5/g                                                        roam-042
      va(3)=g6/g                                                        roam-043
      if (ncoll.eq.2) go to 2                                           roam-044
      va(4)=-va(3)                                                      roam-045
      va(5)=va(2)                                                       roam-046
    2 i2=min0(ncoll,3)                                                  roam-047
      do 3 i1=1,i2                                                      roam-048
      if (i1.eq.1.and.ipi(3,i1).ne.1) go to 14                          roam-049
      if (i1.eq.1) go to 3                                              roam-050
      if (ipi(3,i1).ne.5) go to 14                                      roam-051
      if (.not.lo(217)) write (2,1000) i1,va(2*i1-2),va(2*i1-1)         roam-052
    3 continue                                                          roam-053
      ivar=i2-1                                                         roam-054
      i2=4                                                              roam-055
      if (i2.gt.ncoll) go to 7                                          roam-056
c levels not related to the gamma deformation                           roam-057
    4 do 6 i1=i2,ncoll                                                  roam-058
      if (ipi(3,i1).eq.3) go to 16                                      roam-059
      ivar=iph(i1+ncoll)                                                roam-060
      if (mod(ipi(3,i1),4).ne.1) var(ivar+1)=90.                        roam-061
      k1=ivar+i1                                                        roam-062
      va(k1)=1.                                                         roam-063
      if (iph(i1).eq.0) go to 6                                         roam-064
      k2=k1+iph(i1)-1                                                   roam-065
      do 5 k=k1,k2                                                      roam-066
      ivar=ivar+1                                                       roam-067
      g=0.0174533*var(ivar)                                             roam-068
      va(k+1)=va(k)*sin(g)                                              roam-069
    5 va(k)=va(k)*cos(g)                                                roam-070
      if (.not.lo(217)) write (2,1000) i1,(va(k),k=k1,k2),va(k2+1)      roam-071
    6 continue                                                          roam-072
c computation of red. mat. ele. for i=/<ip at the first call            roam-073
    7 it=1                                                              roam-074
      nsp=0                                                             roam-075
      if (lo(13).or.lo(19)) nsp=10                                      roam-076
      do 13 i1=1,ncoll                                                  roam-077
      nt=iph(i1)+1                                                      roam-078
      nv=iph(i1+ncoll)+i1-1                                             roam-079
      ia1=ipi(3,i1)-1                                                   roam-080
      nx=ia1/2-2*(ia1/4)                                                roam-081
      do 12 i2=i1,ncoll                                                 roam-082
      if (ipi(1,i1).ne.ipi(1,i2)) go to 15                              roam-083
      niv(i1,i2,1)=it                                                   roam-084
      mt=iph(i2)+1                                                      roam-085
      mv=iph(i2+ncoll)+i2-1                                             roam-086
      ia2=ipi(3,i2)-1                                                   roam-087
      mx=ia2/2-2*(ia2/4)                                                roam-088
      iq1=min0(iqmax,(ia1+ia2)/2,8)                                     roam-089
      iq2=max0(2,2*((iabs(ia1-ia2)/2+1)/2))                             roam-090
      if (iq2.gt.iq1) go to 11                                          roam-091
c computation of reduced matrix elements                                roam-092
      do 10 iqz=iq2,iq1,2                                               roam-093
      fs=iqz-4*((iqz+2)/4)+1                                            roam-094
      iqy=iqz/2+1                                                       roam-095
      do 9 mqz=1,iqy                                                    roam-096
      if (4*it.gt.idt) call memo(idmt,idmt+4,idt,3,lo)                  roam-097
      if (lo(216)) go to 17                                             roam-098
      iq(1,it)=1000*((iqy*(iqy-1))/2+mqz)                               roam-099
      b=0.                                                              roam-100
      iq(2,it)=iqz                                                      roam-101
      iq(3,it)=nsp                                                      roam-102
      mq=2*mqz-2                                                        roam-103
      do 8 n1=1,nt                                                      roam-104
      if (n1-nx.eq.0) go to 8                                           roam-105
      n=2*n1-2                                                          roam-106
      lm=n-mq                                                           roam-107
      if (iabs(lm).ge.2*mt) go to 8                                     roam-108
      l1=1+iabs(lm)/2                                                   roam-109
      fq=djcg(ia1,2*iqz,ia2,2*n,-2*mq,fac,nfa)*va(nv+n1)*va(mv+l1)      roam-110
      if (lm.lt.0.and.mx.eq.1) fq=-fq                                   roam-111
      if (mq*n*lm.ne.0) fq=.7071068*fq                                  roam-112
      b=b+fq                                                            roam-113
      if (n*mq.eq.0) go to 8                                            roam-114
      lm=mq+n                                                           roam-115
      if (lm.ge.2*mt) go to 8                                           roam-116
      l1=1+lm/2                                                         roam-117
      fq=djcg(ia1,2*iqz,ia2,2*n,2*mq,fac,nfa)*va(nv+n1)*va(mv+l1)       roam-118
      if (mq*n*lm.ne.0) fq=.7071068*fq                                  roam-119
      b=b+fq                                                            roam-120
    8 continue                                                          roam-121
      if (mq.ne.0) b=.7071068*b                                         roam-122
      t(4,it)=sqrt(1.+ia1)*b*fs                                         roam-123
      if (abs(t(4,it)).gt.1.e-6) it=it+1                                roam-124
    9 continue                                                          roam-125
   10 continue                                                          roam-126
   11 niv(i1,i2,2)=it-1                                                 roam-127
   12 continue                                                          roam-128
   13 continue                                                          roam-129
      it=it-1                                                           roam-130
      return                                                            roam-131
   14 write (2,1001)                                                    roam-132
      go to 17                                                          roam-133
   15 write (2,1002) i1,i2                                              roam-134
      go to 17                                                          roam-135
   16 write (2,1003)                                                    roam-136
   17 write (2,1004)                                                    roam-137
      stop                                                              roam-138
 1000 format (/39h band mixing coefficients for the level,i4/(6e20.7))  roam-139
 1001 format (/67h level order incorrect for link between deformation anroam-140
     1d band mixing/39h use 0+-2+-2+ and then the other levels)         roam-141
 1002 format (/19h parities of states,i4,5h  and,i4,36h  incorrect for troam-142
     1he rotational model)                                              roam-143
 1003 format (/30h no spin-1 state in this model)                       roam-144
 1004 format (//22h in roam  ... stop ...)                              roam-145
      end                                                               roam-146
c 31/10/85  ibm version                                         ecis88  djcg-000
      function djcg(j1,j2,j3,m1,m2,fac,nfa)                             djcg-001
c clebsch-gordan coefficients ( j1  j2  m1  m2 | j3  m1+m2 )            djcg-002
c the arguments j1,j2,j3,m1 and m2 are integer doubled values           djcg-003
c fac is a table of logarithm of factorials and nfa its length.         djcg-004
c***********************************************************************djcg-005
      implicit real*8(a-f)                                              djcg-006
      dimension fac(1)                                                  djcg-007
      djcg=0.d0                                                         djcg-008
      m3=m1+m2                                                          djcg-009
      if (j1+j2+j3.gt.2*nfa) go to 18                                   djcg-010
      if ((j1.lt.0).or.(j2.lt.0).or.(j3.lt.0)) go to 16                 djcg-011
      iy1=j1+m1+2                                                       djcg-012
      ix1=iy1/2                                                         djcg-013
      iy2=j2+m2+2                                                       djcg-014
      ix2=iy2/2                                                         djcg-015
      iy3=j3-m3+2                                                       djcg-016
      ix3=iy3/2                                                         djcg-017
      if ((ix1.le.0).or.(ix2.le.0).or.(ix3.le.0)) return                djcg-018
      if ((2*ix1.ne.iy1).or.(2*ix2.ne.iy2).or.(2*ix3.ne.iy3)) go to 17  djcg-019
      iy1=ix1-m1                                                        djcg-020
      iy2=ix2-m2                                                        djcg-021
      iy3=ix3+m3                                                        djcg-022
      if ((iy1.le.0).or.(iy2.le.0).or.(iy3.le.0)) return                djcg-023
c at this point ix1,ix2,ix3 are twice j+m and iy1,iy2,iy3 twice j-m     djcg-024
c search for a zero argument                                            djcg-025
      if (j3.eq.0) go to 4                                              djcg-026
      if ((j1.eq.0).or.(j2.eq.0)) go to 5                               djcg-027
      if (m3.eq.0) go to 6                                              djcg-028
      if (m2.eq.0) go to 7                                              djcg-029
      if (m1.eq.0) go to 8                                              djcg-030
c general case                                                          djcg-031
    1 nx=ix1+ix2+ix3                                                    djcg-032
      iz1=nx-ix1-iy1                                                    djcg-033
      iz2=nx-ix2-iy2                                                    djcg-034
      iz3=nx-ix3-iy3                                                    djcg-035
      if ((iz1.le.0).or.(iz2.le.0).or.(iz3.le.0)) return                djcg-036
      nxy=nx-1                                                          djcg-037
      i1=ix2-iy3                                                        djcg-038
      i2=iy1-ix3                                                        djcg-039
c k1 and k2 are the limits of the sum                                   djcg-040
c m1,m2,m3,k1,k3,k4 have their factorials in the denominator            djcg-041
c nxy=j1+j2+j3+1      iz1,iz2,iz3  are j1+j2-j3                         djcg-042
      k1=max0(i1,i2,0)+1                                                djcg-043
      k2=min0(iy1,ix2,iz3)                                              djcg-044
      k3=k1-i1                                                          djcg-045
      k4=k1-i2                                                          djcg-046
      n1=iy1-k1+1                                                       djcg-047
      n2=ix2-k1+1                                                       djcg-048
      n3=iz3-k1+1                                                       djcg-049
      djcg=dexp(0.5d0*(fac(ix3+iy3)-fac(ix3+iy3-1)-fac(nxy)+fac(iz1)+facdjcg-050
     1(iz2)+fac(iz3)+fac(ix1)+fac(ix2)+fac(ix3)+fac(iy1)+fac(iy2)+fac(iydjcg-051
     23))-fac(n1)-fac(n2)-fac(n3)-fac(k1)-fac(k3)-fac(k4))              djcg-052
      if (2*(k1/2).eq.k1) djcg=-djcg                                    djcg-053
      if (k1.eq.k2) go to 3                                             djcg-054
      a4=djcg                                                           djcg-055
      k=k2-k1                                                           djcg-056
      k3=k2-i1                                                          djcg-057
      k4=k2-i2                                                          djcg-058
      n1=iy1-k2                                                         djcg-059
      n2=ix2-k2                                                         djcg-060
      n3=iz3-k2                                                         djcg-061
c k2,k3,k4,n1,n2,n3 are the arguments of the factorials in the last termdjcg-062
      do 2 i=1,k                                                        djcg-063
      a1=(k2-i)*(k3-i)*(k4-i)                                           djcg-064
      a2=(n1+i)*(n2+i)*(n3+i)                                           djcg-065
    2 djcg=a4-djcg*a2/a1                                                djcg-066
    3 return                                                            djcg-067
c j1,j2 or j3  is zero                                                  djcg-068
    4 if (j1.ne.j2) return                                              djcg-069
      a1=j1+1                                                           djcg-070
      djcg=1.d0/dsqrt(a1)                                               djcg-071
      if (mod(iy1,2).eq.0) djcg=-djcg                                   djcg-072
      return                                                            djcg-073
    5 if (j1+j2.ne.j3) return                                           djcg-074
      djcg=1.d0                                                         djcg-075
      return                                                            djcg-076
c m1,m2 or m3 is zero; if the others m are larger than 1/2,general case djcg-077
    6 if (iabs(m1)-1) 9 , 10 , 1                                        djcg-078
    7 if (iabs(m1).gt.1) go to 1                                        djcg-079
      go to 11                                                          djcg-080
    8 if (iabs(m3).gt.1) go to 1                                        djcg-081
      go to 12                                                          djcg-082
c all the m are zeros                                                   djcg-083
    9 n5=ix1+ix2+ix3-1                                                  djcg-084
      if (2*(n5/2).ne.n5) return                                        djcg-085
      n2=ix1+ix2-ix3                                                    djcg-086
      n3=ix2+ix3-ix1                                                    djcg-087
      n4=ix3+ix1-ix2                                                    djcg-088
      a1=fac(2*ix3)-fac(2*ix3-1)                                        djcg-089
      kc=1                                                              djcg-090
      go to 14                                                          djcg-091
c one m is zero and the others +-1/2  formula of dcgs                   djcg-092
   10 iq=ix3-1                                                          djcg-093
      iz1=ix1+ix2-2                                                     djcg-094
      iz2=ix1-iy2                                                       djcg-095
      lz1=j1                                                            djcg-096
      lz2=j2                                                            djcg-097
      lw2=m2                                                            djcg-098
      lw1=iy1                                                           djcg-099
      go to 13                                                          djcg-100
   11 iq=ix2-1                                                          djcg-101
      iz1=ix1+ix3-2                                                     djcg-102
      iz2=ix3-iy1                                                       djcg-103
      lz1=j1                                                            djcg-104
      lz2=j3                                                            djcg-105
      lw2=m1                                                            djcg-106
      lw1=iy3                                                           djcg-107
      go to 13                                                          djcg-108
   12 iq=ix1-1                                                          djcg-109
      iz1=ix2+ix3-2                                                     djcg-110
      iz2=ix2-iy3                                                       djcg-111
      lz1=j2                                                            djcg-112
      lz2=j3                                                            djcg-113
      lw2=-m3                                                           djcg-114
      lw1=iy2                                                           djcg-115
   13 n2=iz1-iq+1                                                       djcg-116
      n3=iq+iz2+1                                                       djcg-117
      n4=iq-iz2+1                                                       djcg-118
      if (n2.lt.1.or.n3.lt.1.or.n4.lt.1) return                         djcg-119
      n5=iz1+iq+2                                                       djcg-120
      a1=fac(j3+2)-fac(j3+1)-fac(lz1+2)+fac(lz1+1)-fac(lz2+2)+fac(lz2+1)djcg-121
      kc=2                                                              djcg-122
c simple formula                                                        djcg-123
   14 if (n5-1.gt.nfa) go to 18                                         djcg-124
      l1=(n5+1)/2                                                       djcg-125
      l2=(n2+1)/2                                                       djcg-126
      l3=(n3+1)/2                                                       djcg-127
      l4=(n4+1)/2                                                       djcg-128
      djcg=dexp(0.5d0*(a1+fac(n2)+fac(n3)+fac(n4)-fac(n5))+fac(l1)-fac(ldjcg-129
     12)-fac(l3)-fac(l4))                                               djcg-130
      if (kc.eq.2) go to 15                                             djcg-131
      if (mod(l1+ix1-ix2,2).eq.0) djcg=-djcg                            djcg-132
      return                                                            djcg-133
   15 if (lw2.gt.0) l4=l4+n5+1                                          djcg-134
      djcg=2.d0*djcg                                                    djcg-135
      if (mod(l4+lw1+ix1-iy2,2).ne.0) djcg=-djcg                        djcg-136
      return                                                            djcg-137
   16 write (2,1000)                                                    djcg-138
      return                                                            djcg-139
   17 write (2,1001)                                                    djcg-140
      return                                                            djcg-141
   18 write (2,1002)                                                    djcg-142
      return                                                            djcg-143
 1000 format (34h negative angular momentum in djcg)                    djcg-144
 1001 format (71h integer/half-integer rule between quantum numbers trandjcg-145
     1sgressed in djcg)                                                 djcg-146
 1002 format (28h factorial too large in djcg)                          djcg-147
      end                                                               djcg-148
c 28/06/94  ibm version                                         ecis94  dj6j-000
      function dj6j(j1,j2,j3,j4,j5,j6,fac,nfa)                          dj6j-001
c                       ( j1  j2  j3 )                                  dj6j-002
c 6-j coefficients      )            (                                  dj6j-003
c                       ( j4  j5  j6 )                                  dj6j-004
c the arguments j1,j2,j3,j4,j5 and j6 are integer doubled values        dj6j-005
c fac is a table of logarithm of factorials and nfa its length.         dj6j-006
c***********************************************************************dj6j-007
      implicit real*8(a-f)                                              dj6j-008
      dimension ix(6),ia(3,4),iy(4),fac(1)                              dj6j-009
      data ia /1,2,3,1,5,6,4,2,6,4,5,3/                                 dj6j-010
      dj6j=0.d0                                                         dj6j-011
      ix(1)=j1                                                          dj6j-012
      ix(2)=j2                                                          dj6j-013
      ix(3)=j3                                                          dj6j-014
      ix(4)=j4                                                          dj6j-015
      ix(5)=j5                                                          dj6j-016
      ix(6)=j6                                                          dj6j-017
c  the arguments multiplied by 2 are in the table ix                    dj6j-018
c search for a zero argument                                            dj6j-019
      do 1 i=1,6                                                        dj6j-020
      if (ix(i).lt.0) go to 14                                          dj6j-021
      if (ix(i).eq.0) go to ( 5 , 6 , 7 , 8 , 9, 10 ),i                 dj6j-022
    1 continue                                                          dj6j-023
c general case                                                          dj6j-024
c check of the triangular relations and computation of delta            dj6j-025
      do 2 k=1,4                                                        dj6j-026
      iz1=ia(1,k)                                                       dj6j-027
      iz2=ia(2,k)                                                       dj6j-028
      iz3=ia(3,k)                                                       dj6j-029
      ix1=ix(iz1)                                                       dj6j-030
      ix2=ix(iz2)                                                       dj6j-031
      ix3=ix(iz3)                                                       dj6j-032
      n=ix1+ix2+ix3+2                                                   dj6j-033
      i1=n/2                                                            dj6j-034
      if (2*i1.ne.n) go to 12                                           dj6j-035
      if (i1.gt.nfa) go to 13                                           dj6j-036
      n1=i1-ix3                                                         dj6j-037
      n2=i1-ix2                                                         dj6j-038
      n3=i1-ix1                                                         dj6j-039
      if ((i1.le.0).or.(n1.le.0).or.(n2.le.0).or.(n3.le.0)) go to 15    dj6j-040
      iy(k)=i1+1                                                        dj6j-041
    2 dj6j=dj6j+fac(n1)-fac(i1+1)+fac(n2)+fac(n3)                       dj6j-042
      n1=(ix(1)+ix(2)+ix(4)+ix(5))/2                                    dj6j-043
      n2=(ix(1)+ix(3)+ix(4)+ix(6))/2                                    dj6j-044
      n3=(ix(2)+ix(3)+ix(5)+ix(6))/2                                    dj6j-045
c k1 and k2 are the limits of the sum                                   dj6j-046
c k1,l1,l2,l3,l4,m1,m2,m3 are for the factorials of the first term      dj6j-047
      k1=max0(iy(1),iy(2),iy(3),iy(4))                                  dj6j-048
      k2=min0(n1,n2,n3)+2                                               dj6j-049
      l1=k1-iy(1)+1                                                     dj6j-050
      l2=k1-iy(2)+1                                                     dj6j-051
      l3=k1-iy(3)+1                                                     dj6j-052
      l4=k1-iy(4)+1                                                     dj6j-053
      m1=n1-k1+3                                                        dj6j-054
      m2=n2-k1+3                                                        dj6j-055
      m3=n3-k1+3                                                        dj6j-056
      dj6j=dexp(.5d0*dj6j+fac(k1)-fac(l1)-fac(l2)-fac(l3)-fac(l4)-fac(m1dj6j-057
     1)-fac(m2)-fac(m3))                                                dj6j-058
      if (2*(k1/2).ne.k1) dj6j=-dj6j                                    dj6j-059
      if (k2.eq.k1) go to 4                                             dj6j-060
      a2=dj6j                                                           dj6j-061
      k=k2-k1                                                           dj6j-062
    3 a1=(m1-k)*(m2-k)*(m3-k)                                           dj6j-063
      k=k-1                                                             dj6j-064
      a3=(l1+k)*(l2+k)*(l3+k)*(l4+k)                                    dj6j-065
      dj6j=a2-(k1+k)*a1*dj6j/a3                                         dj6j-066
      if (k.gt.0) go to 3                                               dj6j-067
    4 return                                                            dj6j-068
c one quantum number is zero;check of triangular relations              dj6j-069
    5 if (ix(2).ne.ix(3).or.ix(5).ne.ix(6)) go to 15                    dj6j-070
      ix(6)=ix(4)                                                       dj6j-071
      ix(1)=ix(2)                                                       dj6j-072
      ix(4)=ix(5)                                                       dj6j-073
      go to 11                                                          dj6j-074
    6 if (ix(1).ne.ix(3).or.ix(4).ne.ix(6)) go to 15                    dj6j-075
      ix(6)=ix(5)                                                       dj6j-076
      go to 11                                                          dj6j-077
    7 if (ix(1).ne.ix(2).or.ix(4).ne.ix(5)) go to 15                    dj6j-078
      if (ix(4).ne.ix(5)) go to 15                                      dj6j-079
      go to 11                                                          dj6j-080
    8 if (ix(2).ne.ix(6).or.ix(3).ne.ix(5)) go to 15                    dj6j-081
      ix(6)=ix(1)                                                       dj6j-082
      ix(1)=ix(5)                                                       dj6j-083
      ix(4)=ix(2)                                                       dj6j-084
      go to 11                                                          dj6j-085
    9 if (ix(1).ne.ix(6).or.ix(3).ne.ix(4)) go to 15                    dj6j-086
      ix(6)=ix(2)                                                       dj6j-087
      go to 11                                                          dj6j-088
   10 if (ix(1).ne.ix(5).or.ix(2).ne.ix(4)) go to 15                    dj6j-089
      ix(6)=ix(3)                                                       dj6j-090
c value of the 6-j coefficient with an argument zero                    dj6j-091
   11 if (min0(ix(1),ix(4),ix(6)).lt.0) go to 14                        dj6j-092
      if (ix(6).gt.ix(1)+ix(4).or.ix(6).lt.iabs(ix(1)-ix(4))) go to 15  dj6j-093
      if (max0(ix(1),ix(4)).gt.nfa) go to 13                            dj6j-094
      k=ix(1)+ix(4)+ix(6)                                               dj6j-095
      n=k/2                                                             dj6j-096
      if (2*n.ne.k) go to 12                                            dj6j-097
      dj6j=(1-2*mod(n,2))/dsqrt(dfloat((ix(1)+1)*(ix(4)+1)))            dj6j-098
      return                                                            dj6j-099
   12 write (2,1000)                                                    dj6j-100
      go to 15                                                          dj6j-101
   13 write (2,1001)                                                    dj6j-102
      go to 15                                                          dj6j-103
   14 write (2,1002)                                                    dj6j-104
   15 dj6j=0.d0                                                         dj6j-105
      return                                                            dj6j-106
 1000 format (71h integer/half-integer rule between quantum numbers trandj6j-107
     1sgressed in dj6j)                                                 dj6j-108
 1001 format (28h factorial too large in dj6j)                          dj6j-109
 1002 format (34h negative angular momentum in dj6j)                    dj6j-110
      end                                                               dj6j-111
c 30/04/98  ibm version                                         ecis97  extp-000
      subroutine extp(npp,ncoll,ncolt,wv,niv,iq,ivy,ivq,ipi,fac,nfa,va,nextp-001
     1va,ll,idt,idmt,lo)                                                extp-002
c input and setup of external form factors, elastic and transitions     extp-003
c input : npp:  number of different elastic channel potentials          extp-004
c         ncoll:number of coupled nuclear states                        extp-005
c         ncolt:number of nuclear states including uncoupled ones       extp-006
c         wv:   masses of particle and target in wv(1,*) and wv(2,*)    extp-007
c         niv:  addresses in table of nuclear matrix elements (see redm)extp-008
c         iq:   table of reduced nuclear matrix elements (see redm)     extp-009
c         ivy:  table of form factors  (see redm)                       extp-010
c         ivq:  table of angular momenta (see redm)                     extp-011
c         ipi(4,*): reference to potentials                             extp-012
c         fac:  table of logarithm of factorials                        extp-013
c         nfa:  length of fac                                           extp-014
c         idt:  size of available working space                         extp-015
c         idmt: length of total working field                           extp-016
c         lo:   logical controls                                        extp-017
c in common /pote1/   see redm                                          extp-018
c output: va:   for optical model parameters read here                  extp-019
c         nva:  in equivalence by call with va                          extp-020
c         ll:   addresses in va in equivalence with va(4)               extp-021
c           nva(1) first address after ll                               extp-022
c           nva(2) last address before folding parameters               extp-023
c           nva(3) last address of folding parameters                   extp-024
c           ll(1,ityp,k) first address of parameters which can be variedextp-025
c             for ityp and form factor k, 1 for form factors not used   extp-026
c           ll(2,ityp,k) last address for ityp and form factor k, -1 forextp-027
c             form factors not used                                     extp-028
c                                                                       extp-029
c ityp 1 real volume or dirac scalar potential                          extp-030
c      2 imaginary volume or dirac scalar potential                     extp-031
c      3 real surface or dirac vector potential                         extp-032
c      4 imaginary surface or dirac vector potential                    extp-033
c      5 real spin-orbit or dirac tensor potential                      extp-034
c      6 imaginary spin-orbit or dirac tensor potential                 extp-035
c      7 coulomb potential                                              extp-036
c      8 coulomb spin-orbit potential                                   extp-037
c                                                                       extp-038
c l1,l2 controls the level to potential assignment                      extp-039
c ml    is 0 for the potential or the place of the transition form      extp-040
c       factor in the sequence of reduced matrix elements.              extp-041
c       the form factors contain the deformation.                       extp-042
c l1x,l2x,mlx  form factor copied to l1,l2,ml                           extp-043
c                                                                       extp-044
c the spin-orbit transition form factor to be read is the second one    extp-045
c multiplied by r**2. (multipole of an ordinary woods-saxon potential)  extp-046
c                                                                       extp-047
c itypx  -1  woods-saxon potential                                      extp-048
c        -2  first derivative   multiplied by r/sqrt(4*pi)              extp-049
c        -3  second derivative  multiplied by r**2/(8*pi)               extp-050
c        -4  third derivative   multiplied by r**3/(48*pi**(3/2))       extp-051
c        -5  deformed woods-saxon potential                             extp-052
c        -6  derivative of deformed woods-saxon potential               extp-053
c        -7  laguerre polynomial                                        extp-054
c        -8  solution in real woods-saxon potential                     extp-055
c        -9  bessel expansion                                           extp-056
c       -10  laguerre expansion                                         extp-057
c l2x gives the number of deformations, of nodes, of bessel functions,  extp-058
c                      of laguerre polynomials                          extp-059
c mlx is the l-value of bessel or laguerre expansion, or number of boundextp-060
c functions: =0 or 1 for one with the quantum numbers of the transition,extp-061
c            =2 for two functions with the same itypx,                  extp-062
c            =3 when itypx=-8 for laguerre polynomial as the second one.extp-063
c mlx and -l1x are quantum numbers of vibrational band                  extp-064
c -l1x gives the multiplication of step in computing bound function     extp-065
c -l1x is the order of derivation of bessel or laguerre expansion.      extp-066
c                                                                       extp-067
c allowed values of itypx for standard potentials                       extp-068
c ***********************************************                       extp-069
c **** ml is 0 ****                                                     extp-070
c itypx =    -1    -2    -3    -4    -5    -6    -7    -8  -9,-10       extp-071
c ityp = 1   yes   no    no    no    yes   no    no    no    yes        extp-072
c ityp = 2   yes   no    no    no    yes   no    no    no    yes        extp-073
c ityp = 3   yes   no    no    no    yes   no    no    no    yes        extp-074
c ityp = 4   yes   no    no    no    yes   no    no    no    yes        extp-075
c ityp = 5   yes   no    no    no    yes   no    no    no    yes        extp-076
c ityp = 6   yes   no    no    no    yes   no    no    no    yes        extp-077
c ityp = 7   yes   no    no    no    yes   no    no    no    yes        extp-078
c ityp = 8   yes   no    no    no    yes   no    no    no    yes        extp-079
c **** ml is not 0 ****                                                 extp-080
c ityp = 1   yes   yes   yes   yes   yes   yes   yes   yes   yes        extp-081
c ityp = 2   yes   yes   yes   yes   yes   yes   yes   yes   yes        extp-082
c ityp = 3   yes   yes   yes   yes   yes   yes   no    no    yes        extp-083
c ityp = 4   yes   yes   yes   yes   yes   yes   no    no    yes        extp-084
c ityp = 5   yes   yes   yes   yes   yes   yes   no    no    yes        extp-085
c ityp = 6   yes   yes   yes   yes   yes   yes   no    no    yes        extp-086
c ityp = 7   no    yes   yes   yes   yes   yes   no    no    yes        extp-087
c ityp = 8   no    yes   yes   yes   yes   yes   no    no    yes        extp-088
c number of parameters to store                                         extp-089
c            10    10    10    10  11+l2x 13+l2x 11    22   13+l2x      extp-090
c there is one more for coulomb potentials and itypx=-1 to -6.          extp-091
c there are 5 more parameters for itypx=-7 and mlx=2.                   extp-092
c there are 16 or 6 more parameters for itypx=-8 and mlx=2 or mlx=3.    extp-093
c***********************************************************************extp-094
      logical lo(250)                                                   extp-095
      double precision aa,fac,dcgs,wv                                   extp-096
      dimension ivy(7,1),ivq(3,1),niv(ncoll,ncoll,2),iq(4,1),ipi(10,1),fextp-097
     1ac(1),va(300),nva(300),ll(2,8,1),aa(3,8),itz(10),wv(15,1)         extp-098
      common /pote1/ itx(16),imax,intc,inls,invc,invd,itxm              extp-99
      data aa /8h      re,8hal volum,8he/scalar,8h imagina,8hry volum,8hextp-100
     1e/scalar,8h     rea,8hl surfac,8he/vector,8h  imagin,8h. surfac,8hextp-101
     2e/vector,8h  real s,8hpin-orbi,8ht/tensor,8h imag. s,8hpin-orbi,8hextp-102
     3t/tensor,8h        ,8h        ,8h coulomb,8h      sp,8hin-orbit,8hextp-103
     4 coulomb/                                                         extp-104
      data itz /5,5,5,5,6,8,5,6,8,8/                                    extp-105
      data ierm /4hlast/                                                extp-106
      if (lo(99)) go to 42                                              extp-107
      npx=npp+intc                                                      extp-108
      nma=4+16*npx                                                      extp-109
      nva(1)=nma                                                        extp-110
      if (nma.gt.idt) call memo(idmt,idmt+nma-idt,idt,3,lo)             extp-111
      if (lo(216)) go to 43                                             extp-112
c setting the controls of input                                         extp-113
      ntot=0                                                            extp-114
      do 9 i=1,npx                                                      extp-115
      do 1 j=1,16                                                       extp-116
      ll(1,j,i)=-1                                                      extp-117
    1 ll(2,j,i)=-1                                                      extp-118
      if (i.gt.npp) go to 2                                             extp-119
      if (.not.lo(201)) go to 7                                         extp-120
      ll(1,5,i)=1                                                       extp-121
      ll(1,6,i)=1                                                       extp-122
      ll(1,8,i)=1                                                       extp-123
      go to 7                                                           extp-124
    2 k=i-npp                                                           extp-125
      l=ivy(2,k)                                                        extp-126
      if (ivq(2,l).ge.0) go to 4                                        extp-127
      do 3 l=1,6                                                        extp-128
    3 ll(1,l,i)=1                                                       extp-129
      ll(1,8,i)=1                                                       extp-130
      go to 7                                                           extp-131
    4 if (lo(12)) go to 5                                               extp-132
      ll(1,2,i)=1                                                       extp-133
      ll(1,4,i)=1                                                       extp-134
    5 if (lo(100)) go to 6                                              extp-135
      if (k.gt.inls) ll(1,5,i)=1                                        extp-136
      if (lo(114).or.k.gt.inls) ll(1,6,i)=1                             extp-137
      if (k.gt.invc) ll(1,7,i)=1                                        extp-138
      if (k.gt.invd) ll(1,8,i)=1                                        extp-139
      go to 7                                                           extp-140
    6 if (ivy(3,k).eq.0) ll(1,5,i)=1                                    extp-141
      if (lo(114).or.ivy(3,k).eq.0) ll(1,6,i)=1                         extp-142
      if (ivy(4,k).eq.0) ll(1,7,i)=1                                    extp-143
      if (ivy(5,k).eq.0) ll(1,8,i)=1                                    extp-144
c count of form factors to be read                                      extp-145
    7 do 8 j=1,8                                                        extp-146
      if (ll(1,j,i).eq.-1) ntot=ntot+1                                  extp-147
    8 continue                                                          extp-148
    9 continue                                                          extp-149
      nfolt=0                                                           extp-150
   10 if (ntot.le.0) go to 39                                           extp-151
c input of a form factor                                                extp-152
      read (1,1000,err= 44 ) l1,l2,ml,ityp,l1x,l2x,mlx,itypx,nst,nfold,nextp-153
     1int                                                               extp-154
      if (ityp.gt.8.or.iabs(nst).gt.ncolt.or.ityp.le.0) go to 45        extp-155
      nfolt=max0(nfolt,nfold)                                           extp-156
      if (iabs(ml).ne.0) go to 11                                       extp-157
c test for a potential                                                  extp-158
      if (l1.ne.l2.or.l1.gt.ncolt) go to 46                             extp-159
      lz=ipi(4,l1)                                                      extp-160
      if (nst.eq.0) nst=l1                                              extp-161
      if (lo(173)) write (2,1001) (aa(k,ityp),k=1,3),lz                 extp-162
      go to 14                                                          extp-163
c test for a transition                                                 extp-164
   11 if (l1.gt.ncoll.or.l2.gt.ncoll) go to 47                          extp-165
      ly=niv(l1,l2,1)+iabs(ml)-1                                        extp-166
      if (ly.gt.niv(l1,l2,2)) go to 48                                  extp-167
      lx=iq(1,ly)                                                       extp-168
      if (ml.gt.0) go to 12                                             extp-169
      lx=ivy(6,lx)                                                      extp-170
      if (lx.le.0) go to 49                                             extp-171
   12 if (lo(100)) go to 13                                             extp-172
      if ((ityp.eq.5).or.(ityp.eq.6)) lx=ivy(3,lx)                      extp-173
      if (ityp.ge.7) lx=ivy(ityp-3,lx)                                  extp-174
   13 lz=lx+npp                                                         extp-175
      if (nst.eq.0) nst=1                                               extp-176
      if (lo(173)) write (2,1002) (aa(k,ityp),k=1,3),l1,l2,ml           extp-177
c test it is not already read and that there is place                   extp-178
   14 if (ll(1,ityp,lz).ne.-1) go to 50                                 extp-179
      if (nma+38.gt.idt) call memo(idmt,idmt+nma+35-idt,idt,3,lo)       extp-180
      if (lo(216)) go to 43                                             extp-181
      ntot=ntot-1                                                       extp-182
      nva(nma)=8*lz+ityp                                                extp-183
      nva(nma+2)=nfold                                                  extp-184
      if (itypx.lt.0.or.l1x.le.0) go to 21                              extp-185
      nva(nma+4)=nma                                                    extp-186
      nmd=nma+5                                                         extp-187
      ll(1,ityp,lz)=nmd                                                 extp-188
      va(nmd)=1.                                                        extp-189
      if (nint.lt.0) read (1,1006,err= 58 ) va(nmd)                     extp-190
c use of already stored form factor/test existence of copied form factorextp-191
      if (ityp.ne.itypx) go to 51                                       extp-192
      if (ml.ne.0) go to 15                                             extp-193
      if (l1x.ne.l2x.or.l1x.gt.ncolt) go to 52                          extp-194
      lzx=ipi(4,l1x)                                                    extp-195
      if (lo(173)) write (2,1003) l1x,itypx,l1                          extp-196
      go to 17                                                          extp-197
   15 if (l1x.gt.ncoll.or.l2x.gt.ncoll) go to 53                        extp-198
      lyy=niv(l1x,l2x,1)+mlx-1                                          extp-199
      if (lyy.gt.niv(l1x,l2x,2)) go to 54                               extp-200
      lxx=iq(1,lyy)                                                     extp-201
      if (lo(100)) go to 16                                             extp-202
      if ((ityp.eq.5).or.(ityp.eq.6)) lxx=ivy(3,lxx)                    extp-203
      if (ityp.ge.7) lxx=ivy(ityp-3,lxx)                                extp-204
   16 lzx=lxx+npp                                                       extp-205
      if (lo(173)) write (2,1004) l1x,l2x,mlx,itypx,l1,l2,ml            extp-206
   17 nmc=ll(1,ityp,lzx)                                                extp-207
      if (nmc.eq.-1) go to 55                                           extp-208
c use of already stored form factor/test possibility to copy            extp-209
      nmb=nva(nmc-1)                                                    extp-210
      itypx=-nva(nmb+1)                                                 extp-211
      if (nva(nmb+2).eq.0.and.nfold.ne.0) nva(nmb+2)=-1                 extp-212
      if (nva(nmb+2).ne.0.and.nfold.eq.0) nva(nma+2)=-1                 extp-213
      if (itypx.ne.-16) go to 18                                        extp-214
      lzx=(nva(nmb+3)-1)/8                                              extp-215
      go to 17                                                          extp-216
   18 if (itypx.gt.-5.or.ml.eq.0) go to 20                              extp-217
      if (itypx.ne.-7.and.itypx.ne.-8) go to 19                         extp-218
      ll(1,ityp+2,lz)=1                                                 extp-219
      ntot=ntot-1                                                       extp-220
      nmb=nmb+itz(-itypx)                                               extp-221
      if (nva(nmb).eq.1) go to 19                                       extp-222
      if (nva(nmb+3).ne.1.or.nva(nmb+7).ne.1) go to 20                  extp-223
      k=iq(2,ly)                                                        extp-224
      va(nmd)=dcgs(2*ivq(1,k),nva(nmb+4),nva(nmb+8),fac,nfa)*dsqrt(2.d0*extp-225
     1ivq(1,k)+1.d0)/va(nmc)                                            extp-226
      if (va(nmd).eq.0) go to 56                                        extp-227
      go to 20                                                          extp-228
   19 if (iq(2,ly).ne.iq(2,lyy)) go to 57                               extp-229
   20 nva(nma+1)=16                                                     extp-230
      nva(nma+3)=8*lzx+ityp                                             extp-231
      nmb=nma+4                                                         extp-232
      if (lo(173)) write (2,1005) nma,nmb,(nva(i),i=nma,nmb),nmd,va(nmd)extp-233
      ll(2,ityp,lz)=nmd                                                 extp-234
      nma=nmd+1                                                         extp-235
      go to 10                                                          extp-236
   21 nva(nma+3)=nint                                                   extp-237
      nva(nma+4)=nst                                                    extp-238
      if (itypx.lt.0) go to 23                                          extp-239
      nva(nma+5)=nma                                                    extp-240
      ll(1,ityp,lz)=nma+6                                               extp-241
c form factor read from cards                                           extp-242
      read (1,1006,err= 58 ) va(nma+6),va(nma+7)                        extp-243
      if (va(nma+6).eq.0.) va(nma+6)=1.                                 extp-244
      if (va(nma+7).eq.0.) va(nma+7)=1.                                 extp-245
      nm=nma+8                                                          extp-246
   22 nmb=nm+3                                                          extp-247
      if (nmb.gt.idt) call memo(idmt,idmt+nmb-idt,idt,3,lo)             extp-248
      if (lo(216)) go to 43                                             extp-249
      read (1,1007,err= 58 ) (va(i),i=nm,nmb),last                      extp-250
      nm=nmb+1                                                          extp-251
      if (last.ne.ierm) go to 22                                        extp-252
      nvn=nma+7                                                         extp-253
      nm=nvn+1                                                          extp-254
      nva(nma+1)=-(nmb-nvn)/2                                           extp-255
      if (lo(173)) write (2,1008) nma,nvn,(nva(nma+i-1),i=1,6),va(nma+6)extp-256
     1,va(nma+7),nm,nmb,(va(i),i=nm,nmb)                                extp-257
      ll(2,ityp,lz)=nmb                                                 extp-258
      nma=nmb+1                                                         extp-259
      go to 10                                                          extp-260
c standard form factors                                                 extp-261
   23 if (itypx.lt.-10) go to 59                                        extp-262
      itypy=-itypx                                                      extp-263
      if (itypy.lt.9) go to 24                                          extp-264
      if ((ml.ne.0).and.(mlx.eq.0)) mlx=ivy(7,lx)                       extp-265
      if (mlx.lt.0) mlx=0                                               extp-266
      go to 25                                                          extp-267
   24 if (((itypy-1)*(itypy-5).ne.0).and.ml.eq.0) go to 60              extp-268
      if ((itypy.eq.1).and.(ml.ne.0).and.(ityp.ge.7)) go to 61          extp-269
      if ((itypy.ge.7).and.(ityp.gt.2)) go to 62                        extp-270
   25 nmb=nma+itz(itypy)                                                extp-271
      nva(nma+1)=itypy                                                  extp-272
      if (nmb.gt.nma+5) nva(nma+5)=l2x                                  extp-273
      if (nmb.gt.nma+6) nva(nma+6)=mlx                                  extp-274
      if (nmb.gt.nma+7) nva(nma+7)=-l1x                                 extp-275
      if (itypy.eq.7.or.itypy.eq.8) go to 31                            extp-276
      nva(nmb)=nma                                                      extp-277
      ll(1,ityp,lz)=nmb+1                                               extp-278
      if (lo(73)) go to 26                                              extp-279
      if (itypy.ge.9) write (2,1009) nma,nmb,(nva(i),i=nma,nmb)         extp-280
      if (itypy.eq.6) write (2,1010) nma,nmb,(nva(i),i=nma,nmb)         extp-281
      if (itypy.eq.5) write (2,1011) nma,nmb,(nva(i),i=nma,nmb)         extp-282
      if (itypy.lt.5) write (2,1012) nma,nmb,(nva(i),i=nma,nmb)         extp-283
   26 if (itypy.ge.9) go to 28                                          extp-284
      nma=nmb+1                                                         extp-285
      nmb=nmb+4                                                         extp-286
      if (ityp.gt.6) nmb=nmb+1                                          extp-287
      read (1,1006,err= 58 ) (va(i),i=nma,nmb)                          extp-288
      if (itypy.gt.6) go to 27                                          extp-289
      k=iabs(nst)                                                       extp-290
      if (k.eq.nst) go to 27                                            extp-291
      if (lo(173)) write (2,1013) va(nma),va(nma+1)                     extp-292
      ex=wv(2,k)**.33333333333333d0                                     extp-293
      ey=ex                                                             extp-294
      if (lo(16)) ex=ex+wv(1,k)**.33333333333333d0                      extp-295
      ey=ey/ex                                                          extp-296
      va(nma+1)=va(nma+1)*ex                                            extp-297
      if (lo(116).or.ml.eq.0) go to 27                                  extp-298
      ityz=itypy                                                        extp-299
      if (ityz.ge.5) ityz=ityz-4                                        extp-300
      ityw=1                                                            extp-301
      k=iq(2,ly)                                                        extp-302
      if (ityp.gt.6) ityw=ityw*ivq(1,k)                                 extp-303
      if (lo(6)) ityw=ityw-1                                            extp-304
      if (ityz.gt.1) va(nma)=va(nma)*ey**((ityz-1)*ityw)                extp-305
   27 if (lo(173)) write (2,1014) nma,nmb,(va(i),i=nma,nmb)             extp-306
      if (itypy.lt.5) go to 38                                          extp-307
   28 nma=nmb+1                                                         extp-308
      nmc=nma                                                           extp-309
      if (itypy.ge.9) nmc=nmc+2                                         extp-310
      nmb=nmc+l2x-1                                                     extp-311
      if (nmb.gt.idt) call memo(idmt,idmt+nmb-idt,idt,3,lo)             extp-312
      if (lo(216)) go to 43                                             extp-313
      read (1,1006,err= 58 ) (va(i),i=nma,nmb)                          extp-314
      if ((itypy.ge.9).and.(va(nma).eq.0.)) va(nma)=1.                  extp-315
      if (nst.gt.0.or.itypy.ge.9) go to 30                              extp-316
      if (lo(173)) write (2,1015) (va(i),i=nma,nmb)                     extp-317
      do 29 i=nma,nmb                                                   extp-318
      j=i-nma                                                           extp-319
      if (ityp.lt.7) j=0                                                extp-320
      if (lo(106)) j=j+1                                                extp-321
   29 va(i)=va(i)*ey**j                                                 extp-322
   30 if (lo(73)) go to 38                                              extp-323
      if (itypy.ge.9) write (2,1016) nma,nmb,va(nma),va(nma+1),l2x,(i,vaextp-324
     1(i),i=nmc,nmb)                                                    extp-325
      if (itypy.lt.9) write (2,1017) nma,nmb,l2x,(i,va(i),i=nma,nmb)    extp-326
      go to 38                                                          extp-327
   31 ll(1,ityp+2,lz)=1                                                 extp-328
      ntot=ntot-1                                                       extp-329
      if (lo(100)) go to 63                                             extp-330
      if (mlx.eq.0) mlx=1                                               extp-331
      if ((mlx.lt.0.or.mlx.gt.3).or.(mlx.eq.3.and.itypy.eq.7)) go to 64 extp-332
      nva(nmb)=mlx                                                      extp-333
      mly=mlx                                                           extp-334
      nmc=nmb-1                                                         extp-335
      if (lo(173)) write (2,1018) nma,nmc,(nva(i),i=nma,nmc)            extp-336
      nmc=nmb+5                                                         extp-337
      k=iq(2,ly)                                                        extp-338
      if (mlx.gt.1) go to 33                                            extp-339
      nva(nmb+1)=-l1x                                                   extp-340
      do 32 i=1,3                                                       extp-341
   32 nva(nmb+i+1)=ivq(i,k)                                             extp-342
      nva(nmc)=nma                                                      extp-343
      if (lo(173)) write (2,1019) nmb,nmc,(nva(i),i=nmb,nmc)            extp-344
      go to 35                                                          extp-345
   33 read (1,1000) (nva(nmb+i),i=1,8),nvc                              extp-346
      if (nva(nmb+3).eq.1.and.nvc.eq.0) nva(nmb+3)=-3                   extp-347
      nmd=nmc+4                                                         extp-348
      nva(nmd)=nma                                                      extp-349
      nmc=nmd+1                                                         extp-350
      va(nmc)=1.                                                        extp-351
      if (nva(nmb+3).ne.1.or.nva(nmb+7).ne.1.or.nvc.eq.0) go to 34      extp-352
      va(nmc)=dcgs(2*ivq(1,k),nva(nmb+4),nva(nmb+8),fac,nfa)*sqrt(2.*ivqextp-353
     1(1,k)+1.)                                                         extp-354
      if (va(nmc).eq.0) go to 56                                        extp-355
   34 if (lo(173)) write (2,1020) nmb,nmd,(nva(i),i=nmb,nmd),nmc,va(nmc)extp-356
   35 nmc=nmc+1                                                         extp-357
      ll(1,ityp,lz)=nmc-1                                               extp-358
      if (itypy.eq.8) go to 37                                          extp-359
   36 read (1,1006,err= 58 ) (va(nmc+i-1),i=1,mlx)                      extp-360
      if (mlx.eq.2.and.va(nmc+1).eq.0.) va(nmc+1)=va(nmc)               extp-361
      nmb=nmc+mlx-1                                                     extp-362
      if (lo(173)) write (2,1021) nmc,nmb,(va(i),i=nmc,nmb)             extp-363
      go to 38                                                          extp-364
   37 nmb=nmc+10                                                        extp-365
      read (1,1006,err= 58 ) (va(i),i=nmc,nmb)                          extp-366
      if (va(nmc+4).eq.0.) va(nmc+4)=35.                                extp-367
      if (lo(173)) write (2,1022) nmc,nmb,(va(i),i=nmc,nmb)             extp-368
      if (mlx.eq.1.and.mly.eq.2.and.va(nmc-10).lt.0..and.va(nmc).lt.0.) extp-369
     1go to 65                                                          extp-370
      nmc=nmb+1                                                         extp-371
      mlx=mlx-1                                                         extp-372
      if (mlx.eq.2) go to 36                                            extp-373
      if (mlx.eq.1) go to 37                                            extp-374
   38 ll(2,ityp,lz)=nmb                                                 extp-375
      nma=nmb+1                                                         extp-376
      go to 10                                                          extp-377
   39 nva(2)=nma                                                        extp-378
      if (nfolt.eq.0) go to 41                                          extp-379
      nmb=nma                                                           extp-380
      if (lo(173)) write (2,1023) nfolt                                 extp-381
      do 40 i=1,nfolt                                                   extp-382
      read (1,1006,err= 69 ) va(nma),va(nma+1),va(nma+2)                extp-383
      if (lo(173)) write (2,1024) i,va(nma),va(nma+1),va(nma+2)         extp-384
   40 nma=nma+3                                                         extp-385
   41 nva(3)=nma-1                                                      extp-386
      return                                                            extp-387
   42 write (2,1025)                                                    extp-388
      go to 66                                                          extp-389
   43 write (2,1026) nmb,idt                                            extp-390
      go to 66                                                          extp-391
   44 write (2,1027)                                                    extp-392
      go to 66                                                          extp-393
   45 write (2,1028) ityp,nst,ncolt                                     extp-394
      go to 66                                                          extp-395
   46 write (2,1029) ml,l1,l2,ncolt                                     extp-396
      go to 66                                                          extp-397
   47 write (2,1030) ml,l1,l2,ncoll                                     extp-398
      go to 66                                                          extp-399
   48 write (2,1031) ml,l1,l2                                           extp-400
      go to 66                                                          extp-401
   49 write (2,1032) l1,l2,ml                                           extp-402
      go to 66                                                          extp-403
   50 write (2,1033) l1,l2,ml,ityp                                      extp-404
      go to 66                                                          extp-405
   51 write (2,1034) l1,l2,ml,ityp,l1x,l2x,mlx,itypx                    extp-406
      go to 66                                                          extp-407
   52 write (2,1035) mlx,l1x,l2x,ncolt                                  extp-408
      go to 66                                                          extp-409
   53 write (2,1036) mlx,l1x,l2x,ncoll                                  extp-410
      go to 66                                                          extp-411
   54 write (2,1037) mlx,l1x,l2x,ncoll                                  extp-412
      go to 66                                                          extp-413
   55 write (2,1038) mlx,l1x,l2x,itypx                                  extp-414
      go to 66                                                          extp-415
   56 write (2,1039) nva(nmb+4),nva(nmb+8),k                            extp-416
      go to 66                                                          extp-417
   57 write (2,1040) itypx,iq(2,lyy),iq(2,ly)                           extp-418
      go to 66                                                          extp-419
   58 write (2,1041) ityp,lz                                            extp-420
      go to 66                                                          extp-421
   59 write (2,1042) itypx                                              extp-422
      go to 66                                                          extp-423
   60 write (2,1043) itypx,ityp                                         extp-424
      go to 66                                                          extp-425
   61 write (2,1044) itypx,ityp                                         extp-426
      go to 66                                                          extp-427
   62 write (2,1045) itypx,ityp                                         extp-428
      go to 66                                                          extp-429
   63 write (2,1046) itypx                                              extp-430
      go to 66                                                          extp-431
   64 write (2,1047) mlx,itypx                                          extp-432
      go to 66                                                          extp-433
   65 write (2,1048) va(nmc-10),va(nmc)                                 extp-434
   66 if (ntot.eq.0) go to 70                                           extp-435
      write (2,1049) ntot,npp                                           extp-436
      do 68 j=1,npx                                                     extp-437
      do 67 i=1,8                                                       extp-438
      if (ll(1,i,j).eq.-1) write (2,1050) i,j                           extp-439
   67 continue                                                          extp-440
   68 continue                                                          extp-441
      go to 70                                                          extp-442
   69 write (2,1051) i,nfolt                                            extp-443
   70 write (2,1052)                                                    extp-444
      stop                                                              extp-445
 1000 format (12i5)                                                     extp-446
 1001 format (/3a8,14h potential nr(,i2,1h))                            extp-447
 1002 format (/3a8,33h transition potential from level(,i2,11h) to levelextp-448
     1(,i2,20h) and the order ml =,i2)                                  extp-449
 1003 format (26h the elastic potential nr(,i2,6h) typ(,i1,18h) is copieextp-450
     1d to nr(,i2,1h))                                                  extp-451
 1004 format (25h transition potential l1(,i2,5h) l2(,i2,5h) ml(,i2,6h) extp-452
     1typ(,i2,18h) is copied to l1(,i2,5h) l2(,i2,5h) ml(,i2,1h))       extp-453
 1005 format (17h using parameters,i6,3h to,i6,13h for copy to:,i5,5x,7hextp-454
     1(copy):,i3,5x,6hfold =,i3,5x,5hfrom:,i5,5x,6hstart:,i5/16h using pextp-455
     2arameter,i6,26h for multiplicative factor,e15.8)                  extp-456
 1006 format (7f10.5)                                                   extp-457
 1007 format (f10.5,f20.10,f10.5,f20.10,a4)                             extp-458
 1008 format (17h using parameters,i6,3h to,i6,10h to store:,i5,5x,10hnbextp-459
     1 points:,i5,5x,5hfold:,i2,5x,5hintg:,i2,5x,5hstep:,i2,5x,6hstart:,extp-460
     2i5/20x,9hstrength:,f15.6,10x,6hscale:,f15.6/15h and parameters,i6,extp-461
     33h to,i6,10h to store:/4(6x,6hradius,7x,9hpotential,2x)/(4(2x,0p,fextp-462
     410.5,3x,1p,e15.7)))                                               extp-463
 1009 format (17h using parameters,i6,3h to,i6,10h to store:/i5,3x,5htypextp-464
     1e:,i2,3x,5hfold:,i2,3x,5hintg:,i2,3x,5hstep:,i2,i6,14h functions  extp-465
     2l:,i3,i4,20h derivations  start:,i5)                              extp-466
 1010 format (17h using parameters,i6,3h to,i6,10h to store:/i5,3x,5htypextp-467
     1e:,i2,3x,5hfold:,i2,3x,5hintg:,i2,3x,5hstep:,i2,i6,21h deformationextp-468
     2s   lbet:,i5,5x,5hkbet:,i5,5x,6hstart:,i5)                        extp-469
 1011 format (17h using parameters,i6,3h to,i6,10h to store:/i5,3x,5htypextp-470
     1e:,i2,3x,5hfold:,i2,3x,5hintg:,i2,3x,5hstep:,i2,i6,13h deformationextp-471
     2s,5x,6hstart:,i5)                                                 extp-472
 1012 format (17h using parameters,i6,3h to,i6,10h to store:,i4,3x,5htypextp-473
     1e:,i2,3x,5hfold:,i2,3x,5hintg:,i2,3x,5hstep:,i2,5x,6hstart:,i5)   extp-474
 1013 format (13h values read:,f12.6,3x,f9.6)                           extp-475
 1014 format (17h using parameters,i6,3h to,i6,4h for/6h depth,f12.6,12hextp-476
     1 mev  radius,f10.6,15h f  diffuseness,f9.6,20h f at the power (1.+extp-477
     2,f8.6,1h),2x,f8.6,18h (3rd coul. parm.)/)                         extp-478
 1015 format (19h deformations read:,8f10.5/(19x,8f10.5))               extp-479
 1016 format (17h using parameters,i6,3h to,i6,14h for strength:,f12.6,1extp-480
     10x,6hscale:,f12.6/13h and to store,i5,54h bessel function or legenextp-481
     2dre polynomials coefficients:/(6(3x,i5,f10.5)))                   extp-482
 1017 format (17h using parameters,i6,3h to,i6,4h for,i5,14h deformationextp-483
     1s:/(6(3x,i5,f10.5)))                                              extp-484
 1018 format (17h using parameters,i6,3h to,i6,10h to store:,i4,3x,5htypextp-485
     1e:,i2,3x,5hfold:,i2,3x,5hintg:,i2,3x,5hstep:,i2,5x,5hmult:,i3)    extp-486
 1019 format (17h using parameters,i6,3h to,i6,10h to store:,i2,16h funcextp-487
     1tions   n =,i2,3x,3hl =,i3,3x,5h2*s =,i2,3x,5h2*j =,i3,5x,6hstart:extp-488
     2,i5)                                                              extp-489
 1020 format (17h using parameters,i6,3h to,i6,10h to store:/i5,10h funcextp-490
     1tions,2(2x,3hn =,i2,3x,3hl =,i3,3x,5h2*s =,i2,3x,5h2*j =,i3),5x,6hextp-491
     2start:,i5/16h using parameter,i6,26h for multiplicative factor,e18extp-492
     3.8)                                                               extp-493
 1021 format (17h using parameters,i6,3h to,i6,29h for the oscillator paextp-494
     1rameter,2f10.5)                                                   extp-495
 1022 format (17h using parameters,i6,3h to,i6,10h to store:/20h **** biextp-496
     1nding energy,f12.6,9h mev ****,2x,10htotal mass,f12.6,2x,13hparticextp-497
     2le mass,f12.6,2x,18hproduct of charges,f8.2/39h search on depth ofextp-498
     3 real potential from,f12.6,20h with reduced radius,f10.6,22h fermiextp-499
     4 and diffuseness,f10.6,6h fermi/29h spin-orbit potential  depth:,fextp-500
     512.6,13h mev  radius:,f10.6,16h f  diffuseness:,f9.6,19h f  coulomextp-501
     6b radius:,f10.6,2h f/)                                            extp-502
 1023 format (/2x,i3,27h sets of folding parameters)                    extp-503
 1024 format (2x,i2,5x,4h v =,f12.6,5x,4h r =,f9.6,5x,4h a =,f9.6)      extp-504
 1025 format (81h external form factors not allowed with schroedinder eqextp-505
     1uivalent of dirac equation)                                       extp-506
 1026 format (41h storage needed for standard form factors,i4,24h largerextp-507
     1 than the storage,i4,10h available)                               extp-508
 1027 format (53h input error in the first card defining the potential) extp-509
 1028 format (/7h ityp =,i5,21h not allowed or nst =,i5,20h larger than extp-510
     1ncolt =,i3)                                                       extp-511
 1029 format (10h with ml =,i2,5h l1 =,i3,21h is not equal to l2 =,i3,26extp-512
     1h or is larger than ncolt =,i3)                                   extp-513
 1030 format (10h with ml =,i3,5h l1 =,i3,8h or l2 =,i3,23h is larger thextp-514
     1an ncoll =,i3)                                                    extp-515
 1031 format (5h ml =,i3,30h too large between levels l1 =,i3,9h and l2 extp-516
     1=,i3)                                                             extp-517
 1032 format (56h there is no correction term of the form factor for l1 extp-518
     1=,i3,6h  l2 =,i3,6h  ml =,i3)                                     extp-519
 1033 format (25h the form factor for l1 =,i3,6h  l2 =,i3,6h  ml =,i3,12extp-520
     1h  and ityp =,i2,44h is already read or does not have to be read) extp-521
 1034 format (/87h different types not allowed to copy for form factors extp-522
     1l1/l2/ml/ityp/l1x/l2x/mlx/itypx :/30x,8i5)                        extp-523
 1035 format (11h with mlx =,i2,6h l1x =,i3,22h is not equal to l2x =,i3extp-524
     1,26h or is larger than ncolt =,i3)                                extp-525
 1036 format (11h with mlx =,i3,6h l1x =,i3,9h or l2x =,i3,23h is largerextp-526
     1 than ncoll =,i3)                                                 extp-527
 1037 format (6h mlx =,i3,31h too large between levels l1x =,i3,10h and extp-528
     1l2x =,i5)                                                         extp-529
 1038 format (29h form factor defined by l1x =,i3,7h  l2x =,i3,7h  mlx =extp-530
     1,i3,9h  itypx =,i3,16h not yet defined)                           extp-531
 1039 format (38h no particle-hole coupling with 2*jp =,i3,11h and 2*jh extp-532
     1=,i3,7h to l =,i3)                                                extp-533
 1040 format (18h copy with itypx =,i3,53h not allowed between transitioextp-534
     1ns with quantum numbers,i2,4h and,i2)                             extp-535
 1041 format (32h input error for the potential (,i2,1h,,i2,1h))        extp-536
 1042 format (/8h itypx =,i5,38h not allowed for standard form factors) extp-537
 1043 format (13h itypx,ityp =,2i5,71h  not allowed: central potential cextp-538
     1annot be derivative or bound function)                            extp-539
 1044 format (13h itypx,ityp =,2i5,64h  not allowed: coulomb transition extp-540
     1form factor must be derivative)                                   extp-541
 1045 format (13h itypx,ityp =,2i5,86h  not allowed: bound state functioextp-542
     1n can be only real or imaginary transition potential)             extp-543
 1046 format (8h itypx =,i3,32h  not allowed in dirac formalism)        extp-544
 1047 format (6h l2x =,i3,26h  not allowed with itypx =,i4)             extp-545
 1048 format (50h for ityp=-8 and two functions, both are unbounded,2f12extp-546
     1.6)                                                               extp-547
 1049 format (i6,71h form factors to read, for (ityp, n  )  ( potentialsextp-548
     1 for n smaller than,i2,19h transitions after))                    extp-549
 1050 format (33x,1h(,i4,1h,,i3,1h))                                    extp-550
 1051 format (20h input error for the,i4,13hth set of the,i4,40hth sets extp-551
     1of folding parameters to be read)                                 extp-552
 1052 format (24h in extp  .... stop ....)                              extp-553
      end                                                               extp-554
c 05/04/98  ibm version                                         ecis97  cal1-000
      subroutine cal1(w,nw,dw,lo)                                       cal1-001
c this subroutine computes form factors (pote), looks for quantum       cal1-002
c numbers (quan), checks for convergence with respect to total spin,    cal1-003
c computes helicity amplitudes (sche) and computes chi2 (resu)          cal1-004
c the arguments are the working space w, in equivalence by call with nw cal1-005
c and dw and the array of logical controls lo. the common /noeq/ is not cal1-006
c used outside this subroutine and the subroutines called by it.        cal1-007
c nplace is the maximum working space used                              cal1-008
c***********************************************************************cal1-009
      double precision dw(1)                                            cal1-010
      dimension w(1),nw(1)                                              cal1-011
      logical lo(250)                                                   cal1-012
      common /decou/ njit,nipp,nipi,nwv,niph,nscn,npar,nniv,nfis,ngam,npcal1-013
     1ot,nbeta,nfm,ntgx,ndonn,nrc,niw,nde,nise,nnvi,nnwi,ncc,mcc,nxa,namcal1-014
     21,nfac,nfam,npad,nfg,nxg,nsm,nres,nxx,nt,nivq,nivy,nivz,ncoi,mipi,cal1-015
     3nxd,mwv,nixt,nty,ntx,nry,nrco,nrdo,nvc1,nvc2,nnc,ncx,idmt,ncoll,njcal1-016
     4max,iterm,npp,jdm,jit,nsec,lmd,mcm(2),ncols,ncolt,kmax,kmin,nva,nbcal1-017
     5et,nbt1,lmx,lmax1,nlt,ism,iqm,iqmax,ms1,ms2,nct(6),kba,kab,kbc,kcccal1-018
     6,njc,jtx,jth,ncolr,nrec,ntot,nfa,lmax2,ke,itemm,nplace,kxt,nrz,ntzcal1-019
     7,lmax3,ipm,ipk,h,bjm,eiter,aconv,conj,aspin                       cal1-020
      common /pote2/ ity(8),invt,intv,insl,npx                          cal1-021
      common /ncomp/ nsp(3),nfiss,nrd,ncont,ncoj,acn1,acn2,ncons,nie,ncocal1-022
     1lx,ndp,ndq,az(6),bz(3),tg0,bn,fnug,egd,ggd,tg1,sgsq               cal1-023
      common /noequ/ ncxn,nic,nci,nc,ncin,nin,jpi,ipj,aj,r1(2)          cal1-024
      ajmin=0.5*mod(nw(nipi+1)+nw(nipi+2),2)                            cal1-025
      nr5=nnc                                                           cal1-026
      nww=nr5+2*kab                                                     cal1-027
      nxc=nww+4*ism*kab                                                 cal1-028
      if (lo(220).and.lo(151)) go to 2                                  cal1-029
      if (lo(219)) go to 20                                             cal1-030
      if (lo(100)) nxc=nxc+4*ism*kab                                    cal1-031
      if (lo(21)) nxc=nnc                                               cal1-032
      id1=idmt-ncx                                                      cal1-033
c computation of potentials and form factors                            cal1-034
      n=ncx-1                                                           cal1-035
      do 1 i=nrco,n                                                     cal1-036
    1 w(i)=0.                                                           cal1-037
      ncx1=ncx/2+1                                                      cal1-038
      nxc1=nxc/2+1                                                      cal1-039
      call pote(w(nbeta),nw(nbeta),w(nvc1),nw(nivq),nw(nivy),nw(nivz),w(cal1-040
     1ncx),nw(ncx),dw(ncx1),w(npot),nw(npot),w(nrco),w(nrdo),dw(nwv),dw(cal1-041
     2mwv),aconv,ism,ncoll,ncolx-ncont,ncolt,id1,nw(nipi),nw(mipi),nw(nical1-042
     3pp),dw(nixt),iqm,npp,nbt1,mcm,idmt,lo)                            cal1-043
    2 if (lo(220)) go to 20                                             cal1-044
      nplace=max0(nplace,nxc+id1)                                       cal1-045
      if (lo(216)) go to 22                                             cal1-046
      jpi=0                                                             cal1-047
      ip1=1                                                             cal1-048
      if (lo(223)) ip1=2                                                cal1-049
      n=nty+ntz-1                                                       cal1-050
      do 3 i=nty,n                                                      cal1-051
    3 dw(i)=0.d0                                                        cal1-052
      if (lo(181).or.lo(82)) go to 4                                    cal1-053
      nx=nnc/2+1+2*ism                                                  cal1-054
      n=2*nx+4*(ism+2)-1                                                cal1-055
      if (n.gt.idmt) call memo(idmt,n,m,3,lo)                           cal1-056
      if (lo(216)) go to 22                                             cal1-057
      nplace=max0(nplace,n)                                             cal1-058
c loop on the parities  jpi is the parity (0 or 1)                      cal1-059
    4 ipj=1                                                             cal1-060
      lo(227)=.false.                                                   cal1-061
      lo(232)=lo(181)                                                   cal1-062
      iterm=itemm                                                       cal1-063
      do 5 k=1,kab                                                      cal1-064
    5 nw(ncc+k-1)=0                                                     cal1-065
c loop on the values of j                                               cal1-066
c search for quantum numbers and coupling coefficients                  cal1-067
    6 lo(225)=lo(21)                                                    cal1-068
      aj=ajmin+ipj-1                                                    cal1-069
      iterr=0                                                           cal1-070
    7 call quan(ncoll,w,dw(nwv),nw(nipi),nw(nniv),nw(nt),w(nt),nw(nivq),cal1-071
     1nw(nivz),nw(ncc),w(ncc),nw(nxc),w(nxc),dw(nxc1),iu,nw(nnvi),kab,kbcal1-072
     2c,dw(nxa),dw(nfac),nfa,idmt,idmt-nxc-200,lmd,lo)                  cal1-073
      if (ncin.eq.0) go to 15                                           cal1-074
      nx=(nxc+iu*lmd)/2+1                                               cal1-075
      ipx=ipj                                                           cal1-076
      lo(232)=lo(232).or.ipj.gt.kmax                                    cal1-077
      nx1=nx                                                            cal1-078
      ncxn=ncin                                                         cal1-079
      if (lo(224)) ncxn=nc                                              cal1-080
      nwr=2*nx1+20*kab*kab-1                                            cal1-081
      if (nwr.gt.idmt)  call memo(idmt,nwr,m,3,lo)                      cal1-082
      if (lo(216)) go to 22                                             cal1-083
      call mtch(nw(nnwi),ncoll,kab,dw(nwv),nw(mcc),w(mcc),dw(nxg),nw(nxccal1-084
     1),w(nxc),dw(nx1),ism,lmax2,nw(nniv),nw(nivz),dw(nfg),lmax1,lmax3,ncal1-085
     2w(nwr),w(nrco),w(nrdo),dw(nfam),lmd,bjm,lo)                       cal1-086
      if (lo(216)) go to 22                                             cal1-087
      if (lo(227)) go to 12                                             cal1-088
      if (lo(44)) nx=nx+4*kab*kab                                       cal1-089
      if (lo(59)) call hora                                             cal1-090
c  nx  first address which can be used                                  cal1-091
      if (lo(225)) go to 12                                             cal1-092
c iterations                                                            cal1-093
      nfar=nfam+8*kab                                                   cal1-094
      nfai=nfar+ncxn*kab                                                cal1-095
      if (lo(100)) go to 8                                              cal1-096
      nwr=2*nx+4*(ism+2)-1                                              cal1-097
      nr4=nwr+2*nc*ism                                                  cal1-098
      if (lo(210)) nr4=nwr+4*nc*ism                                     cal1-099
      n=nr4+2*ism                                                       cal1-100
      go to 9                                                           cal1-101
    8 nwr=2*(nx+2*(ism+2))-1                                            cal1-102
      nr4=nwr+4*nc*ism                                                  cal1-103
      nin=4*nin                                                         cal1-104
c  n is the first free address and nin the number of coupling potentialscal1-105
c which can be stored                                                   cal1-106
      n=nr4+4*ism                                                       cal1-107
    9 n3=n                                                              cal1-108
      if (n.gt.idmt) call memo(idmt,n,m,3,lo)                           cal1-109
      if (lo(216)) go to 22                                             cal1-110
      lo(207)=lo(124).and.iterm.gt.1                                    cal1-111
      if (bjm.ne.0.) nin=nin+nc                                         cal1-112
      if (lo(207)) n3=n3+nin*ism                                        cal1-113
      if (lo(54)) write (2,1000) n3,aj                                  cal1-114
      if (n3.gt.idmt) call memo(idmt,n3,m,5,lo)                         cal1-115
      if (.not.lo(216)) go to 10                                        cal1-116
      lo(216)=.false.                                                   cal1-117
      lo(207)=.false.                                                   cal1-118
      lo(124)=.false.                                                   cal1-119
      lo(24)=.true.                                                     cal1-120
      n3=n                                                              cal1-121
      write (2,1001)                                                    cal1-122
   10 nplace=max0(nplace,n3)                                            cal1-123
      if (lo(100)) go to 11                                             cal1-124
      call inti(dw(nfam),dw(nx),w(nww),w(nwr),w(nr4),dw(npad),nw(nr5),iscal1-125
     1m,kab,w(n),iterm,nc,w(nvc1),w(nvc2),nw(nnwi),nw(mcc),w(mcc),nw(nxccal1-126
     2),w(nxc),dw(nx1),npx,h,aconv,eiter,ncxn,nni,iterr,lo)             cal1-127
      if (lo(204).or.iterm.eq.1) go to 13                               cal1-128
      if (lo(123)) go to 13                                             cal1-129
      if (lo(210)) write (2,1002) aj,jpi                                cal1-130
      lo(225)=.true.                                                    cal1-131
      lo(228)=.true.                                                    cal1-132
      go to 7                                                           cal1-133
   11 call intr(dw(nfam),dw(nx),w(nww),w(nwr),w(nr4),dw(npad),nw(nr5),iscal1-134
     1m,kab,w(n),iterm,nc,w(nvc1),w(nvc2),nw(nnwi),w(mcc),nw(mcc),nw(nxccal1-135
     2),w(nxc),dw(nx1),h,aconv,eiter,ncxn,nni,iterr,lo)                 cal1-136
      go to 13                                                          cal1-137
c usual coupled channels calculation                                    cal1-138
c nwr is the first address to store potentials and nm the maximum       cal1-139
c number of points   for arguments  see inch                            cal1-140
   12 nwr=2*nx+12*kab*kab-1                                             cal1-141
      if (lo(54)) write (2,1000) nwr,aj                                 cal1-142
      nfai=nx+nc*kab                                                    cal1-143
      nfar=nfai+3*kab*kab                                               cal1-144
      if (lo(227)) go to 13                                             cal1-145
      n=nwr+2*nc*nc*(ism+1)                                             cal1-146
      if (n.gt.idmt) call memo(idmt,n,m,4,lo)                           cal1-147
      nm=(idmt-nwr)/(2*nc*nc)-1                                         cal1-148
      if (nm.le.0) go to 21                                             cal1-149
      nm=min0(nm,ism)                                                   cal1-150
      if (lo(54).and.nm.ne.ism) write (2,1003) nm                       cal1-151
      n3=nwr+(nm+1)*nc*nc                                               cal1-152
      nplace=max0(nplace,2*n3-nwr)                                      cal1-153
      call inch(w(nvc1),w(nvc2),nw(mcc),nw(nxc),w(nxc),nw(nnwi),dw(nfam)cal1-154
     1,dw(nx1),dw(nx),w(nwr),w(n3),ism,kab,nc,ncxn,nm,iterm,npx,nw(nwr),cal1-155
     2lo)                                                               cal1-156
   13 if (lo(59)) call hora                                             cal1-157
c nfar and nfai  addresses of real and imaginary parts of s-matrix      cal1-158
      nwx=(nwr+1)/2                                                     cal1-159
      nmx=nwx+(4+ncin)*(nc+kxt)                                         cal1-160
      n=2*(nmx+max0(4*nc*nc,lmax2+4*ipj))-1                             cal1-161
      if (n.gt.idmt) call memo(idmt,n,m,5,lo)                           cal1-162
      if (lo(216)) go to 22                                             cal1-163
      call scam(dw(nsm),dw(nty),dw(ntx),dw(nry),njmax,kmax,nw(mcc),w(mcccal1-164
     1),nw(ncc),w(ncc),dw(nfar),dw(nfai),dw(nwv),ncoll,ncols,kab,kcc,nw(cal1-165
     2nipi),nw(mipi),w(ngam),w(nfis),dw(nixt),nw(ncoi),dw(nxd),dw(nmx),dcal1-166
     3w(nmx),dw(nwx),nct,ncin+4,dw(nxa),kbc,idmt/2-nmx,lo)              cal1-167
      if (lo(232)) go to 14                                             cal1-168
      lo(232)=r1(2).lt.conj**2.and.ipj.gt.kmin                          cal1-169
      if (.not.lo(232)) ipk=ipj                                         cal1-170
      if (lo(232).and.(lo(218).or.lo(222))) write (2,1004) aj,r1(2)     cal1-171
   14 if (lo(59)) call hora                                             cal1-172
      if (lo(21)) go to 15                                              cal1-173
c reduction of maximum number of iterations if 2 where sufficient(iterr)cal1-174
      if (lo(125).and.(iterr.le.2).and.(ipj.gt.jdm)) iterm=1            cal1-175
c checks of convergence                                                 cal1-176
      if ((nni.eq.nc).and.(ipj.gt.jdm)) lo(227)=.true.                  cal1-177
      if (lo(128).and.nni.eq.nc.and.ipj.gt.jdm+1) go to 18              cal1-178
c increase of the total angular momentum                                cal1-179
   15 if (lo(143)) go to 17                                             cal1-180
      do 16 i=1,jit                                                     cal1-181
      if (ipj.le.nw(njit+2*i-2)) go to 17                               cal1-182
   16 ipj=ipj+nw(njit+2*i-1)*ip1                                        cal1-183
   17 ipj=ipj+ip1                                                       cal1-184
      if (ipj.gt.lmax3-lmx) lo(227)=.true.                              cal1-185
      if (.not.lo(208)) lo(227)=.false.                                 cal1-186
      if ((ipj.le.njmax).and.((r1(1).ge.conj).or.(ipj.le.jdm).or.(ncin.ecal1-187
     1q.0))) go to 6                                                    cal1-188
c change of parity                                                      cal1-189
   18 aj=ajmin+ipx-1                                                    cal1-190
      if (lo(218).or.lo(222)) write (2,1005) aj,r1(1)                   cal1-191
      if (jpi.eq.1) go to 19                                            cal1-192
      jpi=jpi+1                                                         cal1-193
      ipy=ipx                                                           cal1-194
      ipz=ipk                                                           cal1-195
      go to 4                                                           cal1-196
   19 ipm=max0(ipx,ipy)                                                 cal1-197
      ipk=max0(ipk,ipz)                                                 cal1-198
   20 kcb=max0(nct(5),nct(6))                                           cal1-199
      ndx=nxc+8*kcb                                                     cal1-200
      ndy=ndx+jth                                                       cal1-201
      ndz=ndy+jth                                                       cal1-202
      nmy=(ndz+jtx+1)/2+1                                               cal1-203
      nga=nmy+3*njc                                                     cal1-204
      nma=nga+4*kbc*kab                                                 cal1-205
      nmc=nma+ms1*ms2*kcb                                               cal1-206
      n=nmc+2*ipm                                                       cal1-207
      if (2*n.gt.idmt) call memo(idmt,2*n,m,5,lo)                       cal1-208
      if (lo(216)) go to 22                                             cal1-209
      call sche(dw(nsm),njmax,kmax,nw(nipi),ms1,ms2,nw(nfm),w(nfm),dw(ntcal1-210
     1x),dw(nmc),nw(nxc),w,dw(nga),dw(nxg),lmax2,dw(nwv),kab,kba,kcb,ajmcal1-211
     2in,ipm,ipk,dw(nty),ncoll,ncols,nct,dw(nry),dw(nma),jit,nw(njit),nlcal1-212
     3t,idmt,idmt/2-nmc,lo)                                             cal1-213
      id1=idmt-2*nga                                                    cal1-214
c for arguments    see calx and resu                                    cal1-215
      call resu(w,nw(nipi),dw(nsm),dw(ntx),njmax,kmax,ncoll,ncols,w(nfm)cal1-216
     1,nw(nfm),ipm,ipk,w(ndonn),ncolr,nw(2*nam1-1),dw(nam1),dw(nwv),dw(mcal1-217
     2wv),dw(nry),ncont,nw(ncoi),dw(nxd),ajmin,nrz,njc,w(nres),dw(nga),dcal1-218
     3w(nmy),w(ndx),w(ndy),w(ndz),id1,idmt,lo)                          cal1-219
      nplace=max0(nplace,2*nga+id1)                                     cal1-220
      if (lo(59)) call hora                                             cal1-221
      lo(217)=.true.                                                    cal1-222
      lo(222)=.false.                                                   cal1-223
      return                                                            cal1-224
   21 write (2,1006) idmt                                               cal1-225
      lo(216)=.true.                                                    cal1-226
   22 return                                                            cal1-227
 1000 format (10x,22hrequired working field,i10,9h  for j =,f7.1)       cal1-228
 1001 format (/52h working field too small to store all the potentials/1cal1-229
     1x,52(1h*)//31h the 24th control is set .true.//)                  cal1-230
 1002 format (17h warning: for j =,f6.1,14h parity (-1)**,i1,35h the dercal1-231
     1ivative terms are neglected)                                      cal1-232
 1003 format (1h+,60x,28hcomputation of potentials by,i5,11h  at a time)cal1-233
 1004 format (18h maximum j-value =,f6.1,21h for compound nucleus,6x,30hcal1-234
     1maximum coefficient at the end,e12.3)                             cal1-235
 1005 format (18h maximum j-value =,f6.1,16x,41hmaximum scattering coeffcal1-236
     1icient at the end,e12.3)                                          cal1-237
 1006 format (//19h **** working field,i9,16h  too small ****//)        cal1-238
      end                                                               cal1-239
c 05/04/98  ibm version                                         ecis97  pote-000
      subroutine pote(beta,nbta,v,ivq,ivy,ivz,p,np,q,val,nval,vco,vdo,wvpote-001
     1,wvm,aconv,ism,ncoll,ncold,ncolt,idt,ipi,ipim,ipp,tl,iqm,npp,nbt1,pote-002
     2mcm,idmt,lo)                                                      pote-003
c computation and output of form factors                                pote-004
c input variables: beta,nbta: deformations of the target                pote-005
c                  ivq:       table of angular momenta of form factors  pote-006
c                  ivy:       table for computation of form factors     pote-007
c                  ivz:       table for use of form factors             pote-008
c                  val,nval:  optical model and folding parameters      pote-009
c                  wv,wvm:      ( see calx )                            pote-010
c                  aconv:     value below which the pot. can be negl.   pote-011
c                  ism:       number of points                          pote-012
c                  ncoll:     number of coupled nuclear states          pote-013
c                  ncold:     total number of states without continuum  pote-014
c                  ncolt:     total number of states with continuum     pote-015
c                  idt: maximum working field p  returns the place used pote-016
c                  ipi,ipim:    ( see calx )                            pote-017
c                  ipp:       cross-reference to potentials in ipi(1,*) pote-018
c                  iqm:       maximum order of deformation in rot. modelpote-019
c                  npp:       number of optical potentials              pote-020
c                  nbt1:      number of vibrations                      pote-021
c                  mcm:       angular momentum limitation on coul. corr.pote-022
c                  idmt:      size of total working field               pote-023
c                  lo:        logical controls                          pote-024
c commons /pote1/ and /pote2/   see redm                                pote-025
c common /dblpr/   see calc and colf                                    pote-026
c output variables:v(i,j): potential and transition form factors        pote-027
c             for schroedinger equations:                               pote-028
c     after ity(1) (=0) real central potentials in order ipi(10,*)      pote-029
c     after ity(3) real spin-orbit form factors in the same order       pote-030
c     after ity(5) real transition form factors in order ivz(1,*)       pote-031
c     after ity(7) real derived spin-orbit form factors in order        pote-032
c           ivz(1,*) with the r**-2 form factor at the same address+inlspote-033
c     imaginary potentials and form factor follow with the same order   pote-034
c           from ity(2), ity(4), ity(6) and ity(8)                      pote-035
c                                                                       pote-036
c             for dirac equations:                                      pote-037
c     after ity(1) (=0) for each level, 14 form factors v(*,i,*) which  pote-038
c           are central potential for i=1,2   spin-orbit potential for  pote-039
c           i=3,4  d=e+m+v-w for i=5,6   e-m-v-w for i=7,8  d**(1/2) forpote-040
c           i=9,10 d**(-1) for i=11,12  and  - d( tensor ) for i=13,14  pote-041
c     after itx(6) the invt sets of complex scalar + vector form factorspote-042
c           followed by the insl sets of tensor form factors            pote-043
c                                                                       pote-044
c                  vco(2,i): strength of coulomb potential tails        pote-045
c                            scalar in vco(1,i), spin-orbit in vco(2,i) pote-046
c                  vdo(2,i): strength of coulomb transition tails       pote-047
c                            scalar in vdo(1,i), spin-orbit in vdo(2,i) pote-048
c                  tl:   transmission coefficients for uncoupled states pote-049
c working field: p(idt) in equivalence with q, double precision and np. pote-050
c***********************************************************************pote-051
      logical lo(250)                                                   pote-052
      dimension v(ism,1),ivq(3,1),beta(10,1),val(34,1),p(1),ivz(4,1),vcopote-053
     1(2,1),vdo(2,1),bb(2),nval(1),ipi(10,1),ipp(11,1),nbta(10,1),np(1),pote-054
     2ilo(16),mcm(2),ipim(10,1),ipix(10),ivy(7,1)                       pote-055
      double precision q(1),aa(3,8),chi2,chi2m,cm,ck,chb,cmb,ccz,xe,xm,xpote-056
     1n,xz,wv(15,1),pgn(10),xgn(10),w(24),ar,ai,br,bi,cr,ci,er,ei,dd,rr,pote-057
     2xp,xq,wvm(15,1),wvx(15),tl(1)                                     pote-058
      common /pote1/ itx(16),imax,intc,inls,invc,invd,itxm              pote-059
      common /pote2/ ity(8),invt,intv,insl,npx                          pote-060
      common /dblpr/ chi2,chi2m,cm,ck,chb,cmb,ccz,xe,xm,xn,xz           pote-061
      equivalence (itx(1),it1),(itx(2),it2),(itx(3),it3),(itx(4),it4),(ipote-062
     1tx(5),it5),(itx(6),it6),(itx(7),it7),(itx(8),it8),(itx(9),it9),(itpote-063
     2x(10),it0),(itx(11),ita),(itx(12),itb),(itx(13),itc),(itx(14),itd)pote-064
     3,(itx(15),ite),(itx(16),itf)                                      pote-065
      equivalence (ity(1),iv1),(ity(2),iv2),(ity(3),iv3),(ity(4),iv4),(ipote-066
     1ty(5),iv5),(ity(6),iv6),(ity(7),iv7),(ity(8),iv8)                 pote-067
      data pgn( 1),pgn( 2) / 1.52753387130726d-01, 1.49172986472604d-01/pote-068
      data pgn( 3),pgn( 4) / 1.42096109318382d-01, 1.31688638449177d-01/pote-069
      data pgn( 5),pgn( 6) / 1.18194531961518d-01, 1.01930119817240d-01/pote-070
      data pgn( 7),pgn( 8) / 8.32767415767047d-02, 6.26720483341091d-02/pote-071
      data pgn( 9),pgn(10) / 4.06014298003869d-02, 1.76140071391521d-02/pote-072
      data xgn( 1),xgn( 2) / 7.65265211334973d-02, 2.27785851141645d-01/pote-073
      data xgn( 3),xgn( 4) / 3.73706088715420d-01, 5.10867001950827d-01/pote-074
      data xgn( 5),xgn( 6) / 6.36053680726515d-01, 7.46331906460151d-01/pote-075
      data xgn( 7),xgn( 8) / 8.39116971822219d-01, 9.12234428251326d-01/pote-076
      data xgn( 9),xgn(10) / 9.63971927277914d-01, 9.93128599185095d-01/pote-077
      data bb /4h    ,4hlast/                                           pote-078
      data aa /8h      re,8hal volum,8he/scalar,8h imagina,8hry volum,8hpote-079
     1e/scalar,8h     rea,8hl surfac,8he/vector,8h  imagin,8h. surfac,8hpote-080
     2e/vector,8h  real s,8hpin-orbi,8ht/tensor,8h imag. s,8hpin-orbi,8hpote-081
     3t/tensor,8h        ,8h        ,8h coulomb,8h      sp,8hin-orbit,8hpote-082
     4 coulomb/                                                         pote-083
      data ilo /162,162,162,162,201,202,162,203,162,112,162,112,113,114,pote-084
     1111,119/                                                          pote-085
      idy=0                                                             pote-086
      if (lo(220)) go to 66                                             pote-087
      itm=itxm                                                          pote-088
      if (lo(100)) itm=itm-it7                                          pote-089
      if (lo(7)) go to 3                                                pote-090
      invz=intc                                                         pote-091
      iny=1                                                             pote-092
      if (lo(209)) iny=3                                                pote-093
      do 2 ip=1,npp                                                     pote-094
      k=ipp(1,ip)                                                       pote-095
      invy=invz+iny                                                     pote-096
      n1=(invy+1)/2+1                                                   pote-097
      n2=n1+max0(imax,iqm)+1                                            pote-098
      id1=invy+27                                                       pote-099
      idx=10                                                            pote-100
      if (lo(3)) idx=36                                                 pote-101
      if (lo(101)) idx=1                                                pote-102
      idx=max0(2*idx*id1+20*invy+n2,10*ism)                             pote-103
      if (idx.gt.idt) call memo(idmt,idmt+idx-idt,idt,3,lo)             pote-104
      if (lo(216)) go to 74                                             pote-105
      ik=ip                                                             pote-106
      if (lo(100)) ik=it4+24*ip+1                                       pote-107
      call rotp(beta,nbta,beta(1,nbt1+1),ik,v,v(1,it3+1),ivy,np,q(n1),q(pote-108
     1n2),q(10*invy+n2),p(20*invy+2*n2-1),val(1,ip),id1,ism,wv(11,k),invpote-109
     2z,invy,iqm,iny,nbt1,pgn,xgn,lo)                                   pote-110
c  to use the folding model, the spin-orbit potentials and the first    pote-111
c spin-orbit non diagonal form factors are not derived ( v(r) instead ofpote-112
c (1/r)*(d/dr)(v(r)) )  for schroedinger equations. for dirac equations pote-113
c the derivatives are computed but not used.                            pote-114
      idy=max0(idx,idy)                                                 pote-115
      if (lo(59)) call hora                                             pote-116
      if (lo(117)) go to 2                                              pote-117
c  *******  folding model  **********                                   pote-118
      ist=5+ism+int(2.*(abs(val(33,ip))+2.*abs(val(34,ip)))/wv(11,k))   pote-119
      if (val(32,ip)*val(33,ip).eq.0.) ist=ism+5                        pote-120
c the working space in p is shifted from v with the origins in table it pote-121
      nnf=1+ism*itm                                                     pote-122
      idz=nnf+4*itm                                                     pote-123
      idx=idz+4*ist                                                     pote-124
      if (invz.ne.0) idx=idx+2*ist*imax                                 pote-125
      idy=max0(idy,idx)                                                 pote-126
      if (idx.gt.idt) call memo(idmt,idmt+idx-idt,idt,3,lo)             pote-127
      if (lo(216)) go to 74                                             pote-128
      do 1 j=1,nnf                                                      pote-129
    1 p(j)=0.                                                           pote-130
      call fold(v(1,ik),p,val(26,ip),3,ip,ism,ist,aconv,ivy,invz,p(idz),pote-131
     1pgn,xgn,wv,np(nnf),lo)                                            pote-132
      if (lo(59)) call hora                                             pote-133
    2 invz=0                                                            pote-134
      go to 4                                                           pote-135
    3 nnf=2*itm                                                         pote-136
      if (2*nnf.gt.idt) call memo(idmt,idmt+2*nnf-idt,idt,3,lo)         pote-137
      if (lo(216)) go to 74                                             pote-138
      idz=idt-2*nnf                                                     pote-139
      ik=1                                                              pote-140
      if (lo(100)) ik=it7+1                                             pote-141
      call stdp(v(1,ik),ivy,ism,val,nval,idz,idx,q(nnf+1),wv,idmt,pgn,xgpote-142
     1n,npp,np,p(2*nnf+1),aconv,lo)                                     pote-143
      idy=max0(idy,idx+2*nnf)                                           pote-144
    4 if (lo(162)) go to 14                                             pote-145
      ist=2*(ism/2)                                                     pote-146
      idx=2*ist                                                         pote-147
      idy=max0(idy,idx)                                                 pote-148
      if (idx.gt.idt) call memo(idmt,idmt+idx-idt,idt,3,lo)             pote-149
      if (lo(216)) go to 74                                             pote-150
c punch the form factors                                                pote-151
      do 5 i=1,ist                                                      pote-152
      p(i)=i*wv(11,1)                                                   pote-153
    5 p(i+ist)=bb(1)                                                    pote-154
      p(2*ist-1)=bb(2)                                                  pote-155
      ir=0                                                              pote-156
      do 8 ip=1,npp                                                     pote-157
      do 7 ij=1,8                                                       pote-158
      il=ilo(ij)                                                        pote-159
      if (lo(il)) go to 7                                               pote-160
      ji=ip+itx(ij)                                                     pote-161
      if (lo(100)) ji=it7+ij+24*(ip-1)                                  pote-162
      ir=ir+1                                                           pote-163
      write (2,1000) (aa(j,ij),j=1,3),ip,ir                             pote-164
      write (7,1000) (aa(j,ij),j=1,3),ip,ir                             pote-165
      do 6 i=1,ist,2                                                    pote-166
      write (2,1001) p(i),v(i,ji),p(i+1),v(i+1,ji),p(ist+i),ir          pote-167
    6 write (7,1002) p(i),v(i,ji),p(i+1),v(i+1,ji),p(ist+i),ir          pote-168
    7 continue                                                          pote-169
    8 continue                                                          pote-170
      if (intc.eq.0) go to 14                                           pote-171
      do 13 iq=1,intc                                                   pote-172
      do 12 ij=9,16                                                     pote-173
      il=ilo(ij)                                                        pote-174
      if (lo(il)) go to 12                                              pote-175
      ip=iq                                                             pote-176
      if (ij.eq.13.or.ij.eq.14) ip=ivy(3,iq)+inls                       pote-177
      if (ij.ge.15) ip=ivy(ij-11,iq)                                    pote-178
      if (ip.le.0) go to 12                                             pote-179
      ji=ip+itx(ij)                                                     pote-180
      if (lo(100)) ji=it7+24*npp+11*iq+ij-19                            pote-181
      ir=ir+1                                                           pote-182
      write (2,1003) (aa(j,ij-8),j=1,3),iq,ir                           pote-183
      write (7,1003) (aa(j,ij-8),j=1,3),iq,ir                           pote-184
      if (lo(200).and.(ij.ge.13).and.(ij.ne.15)) go to 10               pote-185
      do 9 i=1,ist,2                                                    pote-186
      write (2,1001) p(i),v(i,ji),p(i+1),v(i+1,ji),p(ist+i),ir          pote-187
    9 write (7,1002) p(i),v(i,ji),p(i+1),v(i+1,ji),p(ist+i),ir          pote-188
      go to 12                                                          pote-189
   10 if (ij.eq.16) ji=ji+invd                                          pote-190
      do 11 i=1,ist,2                                                   pote-191
      a1=-v(i,ji)*p(i)**2                                               pote-192
      a2=-v(i+1,ji)*p(i+1)**2                                           pote-193
      write (2,1001) p(i),a1,p(i+1),a2,p(ist+i),ir                      pote-194
   11 write (7,1002) p(i),a1,p(i+1),a2,p(ist+i),ir                      pote-195
   12 continue                                                          pote-196
   13 continue                                                          pote-197
   14 if (intc.eq.invt) go to 26                                        pote-198
c addition of correction terms of form factors                          pote-199
      do 25 k=1,invt                                                    pote-200
      if (ivy(6,k).le.0) go to 25                                       pote-201
      k1=ivy(6,k)                                                       pote-202
      l=ivy(7,k)+2                                                      pote-203
      do 24 n=1,8                                                       pote-204
      il=ilo(n+8)                                                       pote-205
      if ((il.ne.162).and.lo(il)) go to 24                              pote-206
      l1=l                                                              pote-207
      m=0                                                               pote-208
      if (lo(100)) go to 17                                             pote-209
      if (n.gt.6) go to 16                                              pote-210
      if (n.gt.4) go to 15                                              pote-211
      k2=itx(n+8)+k                                                     pote-212
      k3=itx(n+8)+k1                                                    pote-213
      go to 19                                                          pote-214
   15 if (ivy(3,k).eq.0) go to 24                                       pote-215
      k2=itx(n+8)+ivy(3,k)+inls                                         pote-216
      k3=itx(n+8)+ivy(3,k1)+inls                                        pote-217
      l1=l1+2                                                           pote-218
      m=-inls                                                           pote-219
      go to 19                                                          pote-220
   16 if (ivy(n-3,k).eq.0) go to 24                                     pote-221
      k2=itx(n+8)+ivy(n-3,k)                                            pote-222
      k3=itx(n+8)+ivy(n-3,k1)                                           pote-223
      if (n.eq.8) m=invd                                                pote-224
      go to 18                                                          pote-225
   17 if ((n.gt.4).and.(n.ne.7)) m=min0(11-n,4)                         pote-226
      k2=it5+11*k+n                                                     pote-227
      k3=k2+11*(k1-k)                                                   pote-228
      if (n.le.6) go to 19                                              pote-229
   18 ci=v(ism,k3)                                                      pote-230
      cr=v(ism,k2)                                                      pote-231
      go to 21                                                          pote-232
   19 dd=0.d0                                                           pote-233
      ci=0.d0                                                           pote-234
      cr=0.d0                                                           pote-235
      do 20 is=1,ism                                                    pote-236
      dd=dd+wv(11,1)                                                    pote-237
      ci=ci+v(is,k3)*dd**l1                                             pote-238
   20 cr=cr+v(is,k2)*dd**l1                                             pote-239
   21 if ((ci.eq.0.d0).or.(cr.eq.0.d0)) go to 24                        pote-240
      cr=cr/ci                                                          pote-241
      if (.not.lo(217)) write (2,1004) k,n,cr                           pote-242
   22 do 23 is=1,ism                                                    pote-243
   23 v(is,k2)=v(is,k2)-cr*v(is,k3)                                     pote-244
      if (m.eq.0) go to 24                                              pote-245
      k2=k2+m                                                           pote-246
      k3=k3+m                                                           pote-247
      m=0                                                               pote-248
      go to 22                                                          pote-249
   24 continue                                                          pote-250
   25 continue                                                          pote-251
   26 rm=ism*wv(11,1)                                                   pote-252
      if (lo(59)) call hora                                             pote-253
c storage of optical potentials                                         pote-254
      xp=xn/chb                                                         pote-255
      xq=xp**2                                                          pote-256
      do 42 kj=1,ncolt                                                  pote-257
      jj=mod(kj+ncoll-1,ncolt)+1                                        pote-258
      if (jj.gt.ncold) go to 29                                         pote-259
      do 27 i=1,10                                                      pote-260
   27 ipix(i)=ipi(i,jj)                                                 pote-261
      do 28 i=1,15                                                      pote-262
   28 wvx(i)=wv(i,jj)                                                   pote-263
      go to 32                                                          pote-264
   29 do 30 i=1,10                                                      pote-265
   30 ipix(i)=ipim(i,jj-ncold)                                          pote-266
      do 31 i=1,15                                                      pote-267
   31 wvx(i)=wvm(i,jj-ncold)                                            pote-268
   32 if (lo(100)) go to 36                                             pote-269
c potentials for schroedinger equation                                  pote-270
      if (jj.gt.ncoll) go to 33                                         pote-271
      i1=ipix(10)                                                       pote-272
      i2=i1+iv2                                                         pote-273
      i3=i1+iv3                                                         pote-274
      i4=i1+iv4                                                         pote-275
      go to 34                                                          pote-276
   33 i1=1                                                              pote-277
      i2=2                                                              pote-278
      i3=3                                                              pote-279
      i4=4                                                              pote-280
   34 j=ipix(4)                                                         pote-281
      do 35 is=1,ism                                                    pote-282
      v(is,i1)=v(is,j+it1)+v(is,j+it3)+wvx(13)*v(is,j+it2)+wvx(15)*v(is pote-283
     1,j+it4)                                                           pote-284
      v(is,i2)=v(is,j+it2)+v(is,j+it4)+wvx(12)*v(is,j+it2)+wvx(14)*v(is pote-285
     1,j+it4)                                                           pote-286
      if (lo(229)) v(is,i3)=v(is,j+it5)                                 pote-287
      if (lo(230)) v(is,i4)=v(is,j+it6)                                 pote-288
      if (.not.lo(203)) v(is,i3)=v(is,i3)+v(is,j+it8)*xq                pote-289
   35 v(is,i1)=v(is,i1)-v(is,j+it7)                                     pote-290
      if (.not.lo(203)) vco(2,i1)=v(ism,j+it8)*rm**3/xm                 pote-291
      if (lo(199)) go to 41                                             pote-292
      vco(1,i1)=rm*v(ism,j+it7)*xm/(xe*chb)                             pote-293
      vco(2,i1)=vco(2,i1)+vco(1,i1)*chb/(xm+wv(7,1))                    pote-294
      go to 41                                                          pote-295
c potentials for dirac equation                                         pote-296
c at this point:   after v(1,it7),                                      pote-297
c v(*,n,1) scalar potential v for n=1,2 vector potential w for n=3,4    pote-298
c          tensor potential t for n=5,6 coulomb potentials for n=7,8    pote-299
c          their first derivatives for n=9,16                           pote-300
c          their second derivatives for n=17,24                         pote-301
c   the first derivatives of non-coulomb potentials have a reversed signpote-302
   36 m=it4+24*ipix(4)                                                  pote-303
      j=jj                                                              pote-304
      if (j.gt.ncoll) j=1                                               pote-305
      n=14*j-14                                                         pote-306
      rr=0.d0                                                           pote-307
      do 40 is=1,ism                                                    pote-308
      rr=rr+wvx(11)                                                     pote-309
      do 37 k=1,24                                                      pote-310
   37 w(k)=v(is,k+m)                                                    pote-311
      if (lo(110)) go to 39                                             pote-312
      do 38 k=1,24,8                                                    pote-313
      w(k)=w(k)+wvx(13)*w(k+1)                                          pote-314
      w(k+1)=w(k+1)+wvx(12)*w(k+1)                                      pote-315
      w(k+2)=w(k+2)+wvx(15)*w(k+3)                                      pote-316
   38 w(k+3)=w(k+3)+wvx(14)*w(k+3)                                      pote-317
   39 w(3)=w(3)+w(7)                                                    pote-318
      w(11)=w(11)+w(15)                                                 pote-319
      w(19)=w(19)+w(23)                                                 pote-320
      w(13)=(w(13)+w(16))/xm                                            pote-321
      w(21)=(w(21)+w(24))/xm                                            pote-322
      w(14)=w(14)/xm                                                    pote-323
      w(22)=w(22)/xm                                                    pote-324
      w(15)=xm+wvx(7)+w(1)-w(3)                                         pote-325
      w(16)=w(2)-w(4)                                                   pote-326
      v(is,n+7)=(wvx(7)-xm-w(1)-w(3))/chb                               pote-327
      v(is,n+8)=-(w(2)+w(4))/chb                                        pote-328
      dd=w(15)**2+w(16)**2                                              pote-329
      w(5)=w(15)/dd                                                     pote-330
      w(6)=-w(16)/dd                                                    pote-331
      dd=dsqrt(dsqrt(dd)/(xm+wvx(7)))                                   pote-332
      ar=.5*datan2(w(16),w(15))                                         pote-333
      v(is,n+9)=dd*dcos(ar)                                             pote-334
      v(is,n+10)=dd*dsin(ar)                                            pote-335
      ar=w(11)-w(9)                                                     pote-336
      ai=w(12)-w(10)                                                    pote-337
      br=w(17)-w(19)                                                    pote-338
      bi=w(18)-w(20)                                                    pote-339
      cr=ar*w(5)-ai*w(6)+w(13)                                          pote-340
      ci=ar*w(6)+ai*w(5)+w(14)                                          pote-341
      er=br*w(5)-bi*w(6)+w(13)*(cr+cr-w(13))-w(14)*(ci+ci-w(14))-w(21)+2pote-342
     1.d0*cr/rr                                                         pote-343
      ei=br*w(6)+bi*w(5)+w(13)*(ci+ci-w(14))+w(14)*(cr+cr-w(13))-w(22)+2pote-344
     1.d0*ci/rr                                                         pote-345
      v(is,n+1)=-w(1)-w(3)*wvx(7)/xm-(w(1)*w(1)-w(2)*w(2)-w(3)*w(3)+w(4)pote-346
     1*w(4))/(2.d0*xm)-(.75d0*(cr**2-ci**2)-.5d0*er)*xn                 pote-347
      v(is,n+2)=-w(2)-w(4)*wvx(7)/xm-(w(1)*w(2)-w(3)*w(4))/xm-(1.5d0*cr*pote-348
     1ci-.5d0*ei)*xn                                                    pote-349
      v(is,n+3)=.5d0*cr*xn/rr                                           pote-350
      v(is,n+4)=.5d0*ci*xn/rr                                           pote-351
      v(is,n+5)=w(15)/chb                                               pote-352
      v(is,n+6)=w(16)/chb                                               pote-353
      v(is,n+11)=w(5)*chb                                               pote-354
      v(is,n+12)=w(6)*chb                                               pote-355
      v(is,n+13)=w(13)/chb                                              pote-356
   40 v(is,n+14)=w(14)/chb                                              pote-357
      vco(1,j)=w(7)*rr/chb                                              pote-358
      vco(2,j)=rr*(w(7)/(xm+wvx(7))+w(8)/xm)                            pote-359
   41 if (jj.le.ncoll) go to 42                                         pote-360
      nx1=2*ism+5                                                       pote-361
      nx2=nx1+10*(ipix(9)+1)                                            pote-362
      nx3=2*nx2-1                                                       pote-363
      call tlnc(wv(11,1),ipix,wvx,tl(ipix(7)),ism,q,q(nx1),ipix(9)+1,np(pote-364
     1nx3),q(nx2),idt-nx3,v,vco,lo)                                     pote-365
   42 continue                                                          pote-366
      if (intv.eq.0) go to 66                                           pote-367
c storage of transition form factors                                    pote-368
      do 65 j=1,intv                                                    pote-369
      ij=ivz(1,j)                                                       pote-370
      if (lo(200)) go to 43                                             pote-371
      ik=it6+4*j                                                        pote-372
      ki=it5+11*ij                                                      pote-373
   43 l=ivy(4,ij)                                                       pote-374
      if (l.eq.0) go to 48                                              pote-375
      k=ivy(2,ij)                                                       pote-376
      if (ivq(2,k).ge.0) go to 48                                       pote-377
c magnetic coulomb transition                                           pote-378
      dd=2.d0*(wv(11,1)/wv(8,1))**2/chb                                 pote-379
      if (lo(100)) go to 45                                             pote-380
      do 44 is=1,ism                                                    pote-381
      if (lo(12)) v(is,j+iv6)=0.                                        pote-382
   44 v(is,j+iv5)=-v(is,l+ite)*dd                                       pote-383
      if (ivy(7,ij).le.mcm(1)) vdo(1,j)=v(ism,l+ite)*dd*rm**(ivy(7,ij)+1pote-384
     1)                                                                 pote-385
      go to 65                                                          pote-386
   45 do 47 is=1,ism                                                    pote-387
      do 46 m=1,4                                                       pote-388
   46 v(is,ik+m)=0.                                                     pote-389
   47 v(is,ik+3)=v(is,ki+7)*dd                                          pote-390
      if (ivy(7,ij).le.mcm(1)) vdo(1,j)=v(ism,ki+7)*dd*rm**(ivy(7,ij)+1)pote-391
      go to 65                                                          pote-392
c central transition form-factor                                        pote-393
   48 i1=ivz(2,j)/(ncoll+1)                                             pote-394
      i2=mod(ivz(2,j),ncoll+1)                                          pote-395
      do 49 k=1,4                                                       pote-396
      wvx(k)=0.d0                                                       pote-397
      if (i2.ne.0) wvx(k)=.5d0*(wv(k+11,i1)+wv(k+11,i2))                pote-398
   49 continue                                                          pote-399
      if (lo(100)) go to 52                                             pote-400
      do 50 is=1,ism                                                    pote-401
      if (lo(12)) v(is,j+iv6)=v(is,ij+it0)+v(is,ij+itb)+wvx(1)*v(is,ij+ipote-402
     1t0)+wvx(3)*v(is,ij+itb)                                           pote-403
   50 v(is,j+iv5)=v(is,ij+it9)+v(is,ij+ita)+wvx(2)*v(is,ij+it0)+wvx(4)*vpote-404
     1(is,ij+itb)                                                       pote-405
      if (l.eq.0) go to 57                                              pote-406
c coulomb transition form factor for schroedinger equation              pote-407
      do 51 is=1,ism                                                    pote-408
   51 v(is,j+iv5)=v(is,j+iv5)-v(is,l+ite)                               pote-409
      if (ivy(7,ij).le.mcm(1)) vdo(1,j)=v(ism,l+ite)*rm**(ivy(7,ij)+1)  pote-410
      go to 57                                                          pote-411
   52 do 53 is=1,ism                                                    pote-412
      v(is,ik+1)=v(is,ki+1)+wvx(2)*v(is,ki+2)                           pote-413
      v(is,ik+2)=v(is,ki+2)+wvx(1)*v(is,ki+2)                           pote-414
      v(is,ik+3)=v(is,ki+3)+wvx(4)*v(is,ki+4)                           pote-415
   53 v(is,ik+4)=v(is,ki+4)+wvx(3)*v(is,ki+4)                           pote-416
      if (l.eq.0) go to 55                                              pote-417
c coulomb transition form factor for dirac equation                     pote-418
      do 54 is=1,ism                                                    pote-419
   54 v(is,ik+3)=v(is,ik+3)+v(is,ki+7)                                  pote-420
      if (ivy(7,ij).le.mcm(1)) vdo(1,j)=v(ism,ki+7)*rr**(ivy(7,ij)+1)   pote-421
   55 do 56 is=1,ism                                                    pote-422
      cr=v(is,ik+1)                                                     pote-423
      ci=v(is,ik+2)                                                     pote-424
      v(is,ik+1)=xp*(v(is,ik+3)+cr)                                     pote-425
      v(is,ik+2)=xp*(v(is,ik+4)+ci)                                     pote-426
      v(is,ik+3)=xp*(v(is,ik+3)-cr)                                     pote-427
   56 v(is,ik+4)=xp*(v(is,ik+4)-ci)                                     pote-428
   57 if (j.gt.invt) go to 65                                           pote-429
c spin-orbit transition form factor for schroedinger equation           pote-430
      l=ivy(3,ij)                                                       pote-431
      if (l.eq.0) go to 65                                              pote-432
      if (lo(100)) go to 62                                             pote-433
      do 58 is=1,ism                                                    pote-434
      v(is,l+iv7)=v(is,l+itc)                                           pote-435
   58 v(is,l+iv7+insl)=v(is,l+inls+itc)                                 pote-436
      if (lo(114)) go to 60                                             pote-437
      do 59 is=1,ism                                                    pote-438
      v(is,l+iv8)=v(is,l+itd)                                           pote-439
   59 v(is,l+iv8+insl)=v(is,l+inls+itd)                                 pote-440
   60 k=ivy(5,ij)                                                       pote-441
      if (k.eq.0) go to 65                                              pote-442
      do 61 is=1,ism                                                    pote-443
      v(is,l+iv7)=v(is,l+iv7)+v(is,k+itf)*xq                            pote-444
   61 v(is,l+iv7+insl)=v(is,l+iv7+insl)+v(is,k+invd+itf)*xq             pote-445
      if (ivy(7,ij).le.mcm(2)) vdo(2,l)=-v(ism,k+invd+itf)*rm**(ivy(7,i pote-446
     1j)+3)*xq                                                          pote-447
      go to 65                                                          pote-448
c spin-orbit transition form factor for dirac equation                  pote-449
   62 il=it6+4*(l+intv)                                                 pote-450
      rr=0.d0                                                           pote-451
      do 63 is=1,ism                                                    pote-452
      rr=rr+wv(11,1)                                                    pote-453
      v(is,il+1)=-xq*v(is,ki+9)                                         pote-454
      v(is,il+2)=-xq*v(is,ki+10)                                        pote-455
      v(is,il+3)=xq*v(is,ki+5)/rr                                       pote-456
   63 v(is,il+4)=xq*v(is,ki+6)/rr                                       pote-457
      if (ivy(5,ij).eq.0) go to 65                                      pote-458
      rr=0.d0                                                           pote-459
      do 64 is=1,ism                                                    pote-460
      rr=rr+wv(11,1)                                                    pote-461
      v(is,il+1)=v(is,il+1)-xq*v(is,ki+11)                              pote-462
   64 v(is,il+3)=v(is,il+3)+xq*v(is,ki+8)/rr                            pote-463
      if (ivy(7,ij).le.mcm(2)) vdo(2,l)=xp*v(ism,ki+8)*rr**(ivy(7,ij)+1 pote-464
     1)                                                                 pote-465
   65 continue                                                          pote-466
c output of potentials                                                  pote-467
   66 if (lo(151)) go to 73                                             pote-468
      if (lo(100)) go to 70                                             pote-469
      do 67 j=1,npx                                                     pote-470
      write (2,1005) j                                                  pote-471
      write (2,1006) (i,v(i,j+iv1),v(i,j+iv2),i=1,ism)                  pote-472
      if (lo(229)) write (2,1007) (i,v(i,j+iv3),i=1,ism)                pote-473
      if (lo(230)) write (2,1008) (i,v(i,j+iv4),i=1,ism)                pote-474
   67 continue                                                          pote-475
      if (iv2.eq.iv5) go to 73                                          pote-476
      nvx=iv2-iv5                                                       pote-477
      write (2,1009)                                                    pote-478
      nva=min0(nvx,6)                                                   pote-479
      do 68 i=1,ism                                                     pote-480
      write (2,1010) i,(j,v(i,j+iv5),j=1,nva)                           pote-481
      if (nva.ne.nvx) write (2,1011) (j,v(i,j+iv5),j=7,nvx)             pote-482
   68 continue                                                          pote-483
      if (it1.eq.iv6) go to 73                                          pote-484
      mvx=it1-iv6                                                       pote-485
      write (2,1012)                                                    pote-486
      nva=min0(mvx,6)                                                   pote-487
      do 69 i=1,ism                                                     pote-488
      write (2,1010) i,(j,v(i,j+iv6),j=1,nva)                           pote-489
      if (nva.ne.mvx) write (2,1011) (j,v(i,j+iv6),j=7,mvx)             pote-490
   69 continue                                                          pote-491
      go to 73                                                          pote-492
   70 n=0                                                               pote-493
      do 71 l=1,ncoll                                                   pote-494
      write (2,1013) l                                                  pote-495
      write (2,1014) (i,(v(i,n+j),j=1,6),i=1,ism)                       pote-496
      write (2,1015) l                                                  pote-497
      write (2,1014) (i,(v(i,n+j),j=7,12),i=1,ism)                      pote-498
      if (.not.(lo(201).and.lo(203))) write (2,1016) l,(i,(v(i,n+j),j=13pote-499
     1,14),i=1,ism)                                                     pote-500
   71 n=n+14                                                            pote-501
      l=intv+insl                                                       pote-502
      if (l.eq.0) go to 73                                              pote-503
      n=it2                                                             pote-504
      do 72 k=1,l                                                       pote-505
      if (k.le.intv) write (2,1017) k                                   pote-506
      if (k.gt.intv) write (2,1018) k                                   pote-507
      write (2,1019) (i,(v(i,n+j),j=1,4),i=1,ism)                       pote-508
   72 n=n+4                                                             pote-509
   73 idt=idy                                                           pote-510
      return                                                            pote-511
   74 write (2,1020) idx,idt                                            pote-512
      go to 73                                                          pote-513
 1000 format (2x,3a8,14h potential ***,i2,4h ***,5x,i5)                 pote-514
 1001 format (2x,0p,f10.5,1p,e20.6,0p,f10.5,1p,e20.6,a4,i6)             pote-515
 1002 format (0p,f10.5,1p,e20.6,0p,f10.5,1p,e20.6,a4,i6)                pote-516
 1003 format (2x,3a8,25h transition potential ***,i2,4h ***,5x,i5)      pote-517
 1004 format (12h form factor,i4,11h  potential,i3,33h  ratio of correctpote-518
     1ing deformation,e15.6)                                            pote-519
 1005 format (//15h potential ****,i2,5h ****)                          pote-520
 1006 format (//18h central potential//(3(5x,i5,1p,2e14.5,2h i)))       pote-521
 1007 format (//26h real spin-orbit potential//(6(2x,i4,1p,e14.5)))     pote-522
 1008 format (//31h imaginary spin-orbit potential//(6(2x,i4,1p,e14.5)))pote-523
 1009 format (//16h real multipoles/)                                   pote-524
 1010 format (4x,i4,6(i4,1p,e14.5))                                     pote-525
 1011 format ((8x,6(i4,1p,e14.5)))                                      pote-526
 1012 format (//21h imaginary multipoles/)                              pote-527
 1013 format (//50h potentials of schroedinger's equation for channel,i3pote-528
     1/15x,7hcentral,27x,10hspin-orbit,28x,4hd(r))                      pote-529
 1014 format (2x,i3,1p,2e14.7,2h i,5x,2e14.7,2h i,5x,2e14.7,2h i)       pote-530
 1015 format (/17x,4he(r),28x,10hsqrt(d(r)),25x,10hd(r)**(-1),3x,11hfor pote-531
     1channel,i3)                                                       pote-532
 1016 format (/45x,16htensor potential,36x,11hfor channel,i3/(3(2x,i3,1ppote-533
     1,2e14.7,2h i)))                                                   pote-534
 1017 format (//29h scalar and vector multipoles,i6/)                   pote-535
 1018 format (//18h tensor multipoles,i6/)                              pote-536
 1019 format (5x,i5,1p,2e16.7,2h i,10x,2e16.7,2h i)                     pote-537
 1020 format (32h working field too small in pote/17h field requested:,ipote-538
     110,20x,17h field available:,i10)                                  pote-539
      end                                                               pote-540
c 05/04/98  ibm version                                         ecis97  rotp-000
      subroutine rotp(beta,nbta,bta,ip,v,va,ivy,iv,pp,b,p,s,val,id1,ism,rotp-001
     1h,invz,iq1,iqm,iny,nbt1,pgn,xgn,lo)                               rotp-002
c input variables:  beta,nbta: deformations, equivalent by call         rotp-003
c                   bta:       static deformations (rotational model)   rotp-004
c                   ip:        potential number (schroedinger equation) rotp-005
c                              address to temporarily storage of dirac  rotp-006
c                              potentials in v                          rotp-007
c                   ivy:       description of form factors              rotp-008
c                              (see third part of iq in redm)           rotp-009
c                   val:       optical parameters                       rotp-010
c                   id1:       first dimension of the working space p   rotp-011
c                   ism,h:     number and size of steps                 rotp-012
c                   invz:      number of transition form factors        rotp-013
c                   iq1:       iny + number of transition form factors  rotp-014
c                   iqm:       maximum multipolarity of static deform.  rotp-015
c                   iny:       1 + number of derivatives of central     rotp-016
c                              potentials ( schroedinger: 1, dirac: 2)  rotp-017
c                   nbt1:      number of vibrations                     rotp-018
c                   pgn,xgn:   weights, abscissae of legendre integral  rotp-019
c                   lo:        logical controls                         rotp-020
c in common /pote1/ (see redm) number and starting address of different rotp-021
c            potentials and form  factor in v for schroedinger equation rotp-022
c in common /dblpr/ (see calc) hbar, coulomb parameter                  rotp-023
c output variables: v:         potentials and transition form factors   rotp-024
c                              only potentials and derivatives for diracrotp-025
c                   va:        transition form factors for dirac equ.   rotp-026
c working space:    iv:        order of derivative of the iq1 form fac. rotp-027
c                   pp:        intermediate results, weights, ....      rotp-028
c                   b:         for deformations                         rotp-029
c                   p,s:       double and single prec. in equivalence   rotp-030
c***********************************************************************rotp-031
      implicit real*8 (a-h,o-z)                                         rotp-032
      logical lo(250),lq(8,5)                                           rotp-033
      real*4 v(ism,1),va(ism,11,1),beta(10,1),bta(10,1),val(25),hh,s(1) rotp-034
      dimension ivy(7,2),iv(1),iz(8,2),p(id1,3),ep(8),pp(2),zz(2),dd(2),rotp-035
     1q(8,12,3),vr(6,10),b(10,1),nbta(10,1),pgn(10),xgn(10),ldl(8),srd(4rotp-036
     2),vs(14)                                                          rotp-037
      common /pote1/ itx(16),imax,intc,inls,invc,invd,itxm              rotp-038
      common /dblpr/ chi2,chi2m,cm,ck,chb,cmb,ccz,xe,xm,xn,xz           rotp-039
      equivalence (itx(1),it1),(itx(2),it2),(itx(3),it3),(itx(4),it4),(irotp-040
     1tx(5),it5),(itx(6),it6),(itx(7),it7),(itx(8),it8),(itx(9),it9),(itrotp-041
     2x(10),it0),(itx(11),ita),(itx(12),itb),(itx(13),itc),(itx(14),itd)rotp-042
     3,(itx(15),ite),(itx(16),itf)                                      rotp-043
      data ldl /7,112,7,112,113,114,111,119/                            rotp-044
      data srd /1.d0,1.d0,2.d0,6.d0/                                    rotp-045
c checks of diffusenesses                                               rotp-046
      hh=h                                                              rotp-047
      do 2 i=1,8                                                        rotp-048
      j=ldl(i)                                                          rotp-049
      lq(i,5)=lo(j)                                                     rotp-050
      lq(i,1)=val(3*i-2).eq.0.                                          rotp-051
      lq(i,2)=(i.le.6).or.(val(3*i-2)*val(3*i).ne.0.)                   rotp-052
      lq(i,3)=lq(i,1).or.(.not.lq(i,2))                                 rotp-053
      lq(i,2)=lq(i,2).or.lq(i,1)                                        rotp-054
      if (lq(i,1)) go to 2                                              rotp-055
      lq(i,4)=lo(109).or.(val(3*i-1).ge.0.)                             rotp-056
      if (.not.lq(i,2)) go to 1                                         rotp-057
      if (val(3*i).ge.0.02*hh) go to 1                                  rotp-058
      write (2,1000) val(3*i),i,ip                                      rotp-059
      val(3*i)=amax1(-val(3*i),0.02*hh)                                 rotp-060
    1 if (val(3*i-1).ge.hh.or.lo(9)) go to 2                            rotp-061
      write (2,1001) val(3*i-1),i,ip                                    rotp-062
      val(3*i-1)=amax1(-val(3*i-1),hh)                                  rotp-063
    2 continue                                                          rotp-064
      lq(1,2)=lq(7,2).and.lq(8,2)                                       rotp-065
      idg=0                                                             rotp-066
      inx=iny+1                                                         rotp-067
      sr=1.d0                                                           rotp-068
      do 11 i=1,iq1                                                     rotp-069
      iv(i)=i+3                                                         rotp-070
      if (i.le.iny) go to 8                                             rotp-071
      k=mod(ivy(1,i-iny),1000)                                          rotp-072
      if (k.eq.0.or.lo(3)) go to 6                                      rotp-073
      if (k.gt.nbt1) go to 4                                            rotp-074
      iv(i)=2                                                           rotp-075
      idg=max0(idg,1)                                                   rotp-076
      do 3 j=1,8                                                        rotp-077
      if (lo(106)) sr=abs(val(3*j-1))                                   rotp-078
    3 b(j,i)=0.282095*beta(j,k)*sr                                      rotp-079
      go to 10                                                          rotp-080
    4 k1=mod(k,nbt1+1)                                                  rotp-081
      k2=k/(nbt1+1)                                                     rotp-082
      idg=max0(idg,2)                                                   rotp-083
      iv(i)=3                                                           rotp-084
      do 5 j=1,8                                                        rotp-085
      if (lo(106)) sr=abs(val(3*j-1))                                   rotp-086
    5 b(j,i)=0.0397887*beta(j,k1)*beta(j,k2)*sr*sr                      rotp-087
      go to 10                                                          rotp-088
    6 iv(i)=k+1                                                         rotp-089
      idg=max0(idg,k)                                                   rotp-090
      if (lo(1)) go to 8                                                rotp-091
      do 7 j=1,8                                                        rotp-092
      if (lo(106)) sr=abs(val(3*j-1))                                   rotp-093
    7 b(j,i)=sr**k*0.282095*beta(j,k+1)/srd(k+1)                        rotp-094
      go to 10                                                          rotp-095
    8 do 9 j=1,8                                                        rotp-096
    9 b(j,i)=1.d0                                                       rotp-097
   10 b(9,i)=b(5,i)                                                     rotp-098
   11 b(10,i)=b(6,i)                                                    rotp-099
      iv(1)=1                                                           rotp-100
c set up of form factor computation                                     rotp-101
      ids=1                                                             rotp-102
      idr=1                                                             rotp-103
      if (lo(17).or.lo(99)) ids=0                                       rotp-104
      if (lo(209)) idr=0                                                rotp-105
      idt=idr+ids                                                       rotp-106
      do 12 i=1,8                                                       rotp-107
      idz=idg                                                           rotp-108
      if (lq(i,5)) idz=0                                                rotp-109
      iz(i,2)=idz+1                                                     rotp-110
      if (lq(i,3)) go to 12                                             rotp-111
      ep(i)=dexp(h/dble(val(3*i)))                                      rotp-112
      if ((i.eq.3).or.(i.eq.4)) idz=idz+idr                             rotp-113
      if ((i.eq.5).or.(i.eq.6).or.(i.eq.8)) idz=idz+ids                 rotp-114
      if (lo(209)) idz=max0(idz,2)                                      rotp-115
   12 iz(i,1)=idz                                                       rotp-116
c lq(i,1) is .true. if the form factor is not used                      rotp-117
c lq(i,2) is .true. for coulomb form factor with diffuseness            rotp-118
c lq(i,3) is .false. for any woods-saxon form factors                   rotp-119
c lq(i,4) is .false. for symmetrised woods-saxon form factors           rotp-120
c lq(i,5) is .false. for deformed form factors                          rotp-121
      call rotd(nbta,bta,ivy,iv,pp,p,q,val,id1,invz,imax,iq1,iqm,iny,idtrotp-122
     1,lq,dd,pgn,xgn,lo)                                                rotp-123
      zz(1)=ccz*val(19)                                                 rotp-124
      zz(2)=ccz*val(22)                                                 rotp-125
      if (dd(1).ne.0.d0) zz(1)=zz(1)/dd(1)                              rotp-126
      if (dd(2).ne.0.d0) zz(2)=zz(2)/dd(2)                              rotp-127
      do 13 i=1,60                                                      rotp-128
   13 vr(i,1)=0.d0                                                      rotp-129
      r=0.d0                                                            rotp-130
      do 61 is=1,ism                                                    rotp-131
      r=r+h                                                             rotp-132
      do 15 i=1,iq1                                                     rotp-133
      do 14 j=17,27                                                     rotp-134
   14 p(j,i)=0.d0                                                       rotp-135
   15 continue                                                          rotp-136
c integration loop                                                      rotp-137
      do 52 j=1,idt                                                     rotp-138
      do 35 i=1,8                                                       rotp-139
      if (lq(i,3)) go to 35                                             rotp-140
      if (p(i,j).ne.0.d0) go to 16                                      rotp-141
      q(i,j,1)=q(i,j,1)+h                                               rotp-142
      if (q(i,j,1)+50.d0*val(3*i).gt.0.d0) p(i,j)=dexp(q(i,j,1)/val(3*i)rotp-143
     1)                                                                 rotp-144
      go to 17                                                          rotp-145
   16 if (p(i,j).lt.1.d15) p(i,j)=p(i,j)*ep(i)                          rotp-146
   17 if ((.not.lq(i,4)).and.p(i+8,j).gt.1.d-15) p(i+8,j)=p(i+8,j)/ep(i)rotp-147
      idv=iz(i,1)                                                       rotp-148
      vr(1,i)=val(3*i-2)/(1.d0+p(i,j))                                  rotp-149
      if (idv.le.0) go to 18                                            rotp-150
      ar=1.d0/(val(3*i)*(1.d0+p(i,j)))                                  rotp-151
      vr(2,i)=vr(1,i)*ar*p(i,j)                                         rotp-152
      if (idv.gt.1) vr(3,i)=vr(2,i)*ar*(p(i,j)-1.d0)                    rotp-153
      if (idv.gt.2) vr(4,i)=vr(2,i)*(p(i,j)**2-4.d0*p(i,j)+1.d0)*ar*ar  rotp-154
      if (idv.gt.3) vr(5,i)=vr(3,i)*(p(i,j)**2-10.d0*p(i,j)+1.d0)*ar*ar rotp-155
   18 if (lq(i,4)) go to 28                                             rotp-156
      vs(10)=1.d0/(1.d0+p(i+8,j))                                       rotp-157
      if (idv.le.0) go to 19                                            rotp-158
      ar=vs(10)/val(3*i)                                                rotp-159
      vs(11)=vs(10)*ar*p(i+8,j)                                         rotp-160
      if (idv.gt.1) vs(12)=vs(11)*ar*(p(i+8,j)-1.d0)                    rotp-161
      if (idv.gt.2) vs(13)=vs(11)*(p(i+8,j)**2-4.d0*p(i+8,j)+1.d0)*ar*arrotp-162
      if (idv.gt.3) vs(14)=vs(12)*(p(i+8,j)**2-10.d0*p(i+8,j)+1.d0)*ar*arotp-163
     1r                                                                 rotp-164
      if (idv.gt.3) vs(5)=vr(1,i)*vs(14)+4.d0*vr(2,i)*vs(13)+6.d0*vr(3,irotp-165
     1)*vs(12)+4.d0*vr(4,i)*vs(11)+vr(5,i)*vs(10)                       rotp-166
      if (idv.gt.2) vs(4)=vr(1,i)*vs(13)+3.d0*vr(2,i)*vs(12)+3.d0*vr(3,irotp-167
     1)*vs(11)+vr(4,i)*vs(10)                                           rotp-168
      if (idv.gt.1) vs(3)=vr(1,i)*vs(12)+2.d0*vr(2,i)*vs(11)+vr(3,i)*vs(rotp-169
     110)                                                               rotp-170
      if (idv.gt.0) vs(2)=vr(1,i)*vs(11)+vr(2,i)*vs(10)                 rotp-171
   19 vs(1)=vr(1,i)*vs(10)                                              rotp-172
      if ((i.lt.3).or.(i.ge.7).or.(idt.eq.0)) go to 25                  rotp-173
      if (idv.gt.3) vs(9)=vr(1,i)*vs(14)+2.d0*vr(2,i)*vs(13)-2.d0*vr(4,irotp-174
     1)*vs(11)-vr(5,i)*vs(10)                                           rotp-175
      if (idv.gt.2) vs(8)=vr(1,i)*vs(13)+vr(2,i)*vs(12)-vr(3,i)*vs(11)-vrotp-176
     1r(4,i)*vs(10)                                                     rotp-177
      if (idv.gt.1) vs(7)=vr(1,i)*vs(12)-vr(3,i)*vs(10)                 rotp-178
      vs(6)=vr(1,i)*vs(11)-vr(2,i)*vs(10)                               rotp-179
      if (i.gt.4) go to 21                                              rotp-180
      if (idr.eq.0) go to 25                                            rotp-181
      ar=4.d0*r*val(3*i)/val(3*i-1)                                     rotp-182
      do 20 k=1,idv                                                     rotp-183
   20 vr(k,i)=ar*vs(k+5)                                                rotp-184
      go to 35                                                          rotp-185
   21 if (ids.eq.0) go to 25                                            rotp-186
      if (lo(100)) go to 23                                             rotp-187
      do 22 k=1,idv                                                     rotp-188
      vr(k,i+4)=vs(k)/r**2                                              rotp-189
   22 vr(k,i)=-vs(k+5)/r                                                rotp-190
      go to 35                                                          rotp-191
   23 do 24 k=1,idv                                                     rotp-192
   24 vr(k,i+4)=-vs(k+5)                                                rotp-193
   25 if (.not.lo(209)) go to 26                                        rotp-194
      vr(6,i)=vr(3,i)*vs(10)-2.d0*vr(2,i)*vs(11)+vr(1,i)*vs(12)         rotp-195
      vr(5,i)=vr(2,i)*vs(10)-vr(1,i)*vs(11)                             rotp-196
   26 idz=iz(i,2)                                                       rotp-197
      do 27 k=1,idz                                                     rotp-198
   27 vr(k,i)=vs(k)                                                     rotp-199
      go to 35                                                          rotp-200
   28 if ((i.lt.3).or.(i.ge.7).or.(idt.eq.0)) go to 34                  rotp-201
      if (i.gt.4) go to 30                                              rotp-202
      if (idr.eq.0) go to 34                                            rotp-203
      do 29 k=1,idv                                                     rotp-204
   29 vr(k,i)=4.d0*vr(k+1,i)*val(3*i)                                   rotp-205
      go to 34                                                          rotp-206
   30 if (ids.eq.0) go to 34                                            rotp-207
      if (lo(100)) go to 32                                             rotp-208
      do 31 k=1,idv                                                     rotp-209
      vr(k,i+4)=vr(k,i)/r**2                                            rotp-210
   31 vr(k,i)=vr(k+1,i)/r                                               rotp-211
      go to 34                                                          rotp-212
   32 do 33 k=1,idv                                                     rotp-213
   33 vr(k,i+4)=vr(k+1,i)                                               rotp-214
   34 if (.not.lo(209)) go to 35                                        rotp-215
      vr(5,i)=vr(2,i)                                                   rotp-216
      vr(6,i)=vr(3,i)                                                   rotp-217
   35 continue                                                          rotp-218
      if (lo(199)) go to 36                                             rotp-219
      call rotz(vr,xgn,r,q,val,j,iv,b,p,id1,iq1,lo)                     rotp-220
      go to 52                                                          rotp-221
   36 do 38 l=1,iq1                                                     rotp-222
      k=iv(l)                                                           rotp-223
      do 37 m=1,10                                                      rotp-224
   37 p(m+16,l)=p(m+16,l)+vr(k,m)*p(l+27,j)*b(m,l)                      rotp-225
   38 continue                                                          rotp-226
      if (lq(1,2)) go to 52                                             rotp-227
c deformed coulomb potential                                            rotp-228
      do 51 i=7,8                                                       rotp-229
      if (lq(i,2)) go to 51                                             rotp-230
      c=p(i,j)/r                                                        rotp-231
      if (i.eq.8.and.lo(117).and.lo(200)) go to 40                      rotp-232
      if (r.lt.p(i,j)) go to 39                                         rotp-233
      p(i+16,1)=p(i+16,1)+zz(i-6)*(p(i,j)**2)*c*p(28,j)                 rotp-234
      if (lo(200)) go to 41                                             rotp-235
      p(i+16,2)=p(i+16,2)+zz(i-6)*p(i,j)*c**2*p(28,j)                   rotp-236
      p(i+16,3)=p(i+16,3)+zz(i-6)*2.d0*c**3*p(28,j)                     rotp-237
      go to 41                                                          rotp-238
   39 p(i+16,1)=p(i+16,1)+(0.5d0*p(i,j)*p(i,j)-r*r/6.d0)*zz(i-6)*p(28,j)rotp-239
     1*3.d0                                                             rotp-240
      if (lo(200)) go to 41                                             rotp-241
      p(i+16,2)=p(i+16,2)+r*zz(i-6)*p(28,j)                             rotp-242
      p(i+16,3)=p(i+16,3)-zz(i-6)*p(28,j)                               rotp-243
      go to 41                                                          rotp-244
   40 c1=zz(i-6)*p(28,j)                                                rotp-245
      if (r.gt.p(i,j)) c1=c1*c**3                                       rotp-246
      p(24,1)=p(24,1)+c1                                                rotp-247
   41 if (invz.eq.0) go to 51                                           rotp-248
      if (lo(8*i+55)) go to 51                                          rotp-249
      do 50 k=inx,iq1                                                   rotp-250
      if (ivy(i-3,k-iny).eq.0) go to 50                                 rotp-251
      l=ivy(7,k-iny)+1                                                  rotp-252
      d=l                                                               rotp-253
      n=iv(k)                                                           rotp-254
      if (r.lt.p(i,j)) go to 42                                         rotp-255
      c1=(p(i,j)**2)*(c**l)*3.d0/((d+2.d0)*(2.d0*d-1.d0))               rotp-256
      if (n.gt.1) c1=c1*(d+2.d0)/p(i,j)                                 rotp-257
      if (n.gt.2) c1=c1*(d+1.d0)/p(i,j)                                 rotp-258
      if (n.gt.3) c1=c1*d/p(i,j)                                        rotp-259
      go to 44                                                          rotp-260
   42 if (l.ne.3) go to 43                                              rotp-261
      if (n.eq.1) c1=r*r*(0.2d0+dlog(c))*0.6d0                          rotp-262
      if (n.ge.2) c1=0.6d0*r/c                                          rotp-263
      if (n.ge.3) c1=-c1/p(i,j)                                         rotp-264
      if (n.ge.4) c1=-2.d0*c1/p(i,j)                                    rotp-265
      go to 44                                                          rotp-266
   43 if (n.eq.1) c1=r*r*(1.d0/(d+2.d0)-1.d0/(c**(l-3)*(2.d0*d-1.d0)))*3rotp-267
     1.d0/(d-3.d0)                                                      rotp-268
      if (n.ge.2) c1=r/c**(l-2)*3.d0/(2.d0*d-1.d0)                      rotp-269
      if (n.ge.3) c1=-c1*(d-2.d0)/p(i,j)                                rotp-270
      if (n.eq.4) c1=-c1*(d-1.d0)/p(i,j)                                rotp-271
   44 if (i.eq.7.or.lo(17)) go to 49                                    rotp-272
      if (r.lt.p(i,j)) go to 45                                         rotp-273
      c2=-d*c1/r                                                        rotp-274
      go to 47                                                          rotp-275
   45 if (l.ne.3) go to 46                                              rotp-276
      if (n.eq.1) c2=-1.2d0*(0.3d0*r-dlog(c))*r                         rotp-277
      if (n.ge.2) c2=2.d0*c1/r                                          rotp-278
      go to 47                                                          rotp-279
   46 if (n.eq.1) c2=(2.d0/(d+2.d0)-(d-1.d0)/(c**(l-3)*(2.d0*d-1.d0)))*3rotp-280
     1.d0/(d-3.d0)*r                                                    rotp-281
      if (n.ne.1)  c2=(d-1.d0)*c1/r                                     rotp-282
   47 if (lo(100)) go to 48                                             rotp-283
      p(27,k)=p(27,k)-zz(2)*c1*p(k+27,j)*b(i,k)/r**2                    rotp-284
      p(24,k)=p(24,k)-zz(2)*c2*p(k+27,j)*b(i,k)/r                       rotp-285
      go to 50                                                          rotp-286
   48 p(27,k)=p(27,k)-zz(2)*c2*p(k+27,j)*b(i,k)                         rotp-287
      p(24,k)=p(24,k)+zz(2)*c1*p(k+27,j)*b(i,k)                         rotp-288
      go to 50                                                          rotp-289
   49 p(i+16,k)=p(i+16,k)+zz(i-6)*c1*p(k+27,j)*b(i,k)                   rotp-290
   50 continue                                                          rotp-291
   51 continue                                                          rotp-292
   52 continue                                                          rotp-293
c storage of form factors                                               rotp-294
      if (lo(100)) go to 56                                             rotp-295
      v(is,ip+it1)=p(17,1)                                              rotp-296
      v(is,ip+it2)=p(18,1)                                              rotp-297
      v(is,ip+it3)=p(19,1)                                              rotp-298
      v(is,ip+it4)=p(20,1)                                              rotp-299
      if (.not.lo(201)) v(is,ip+it5)=p(21,1)                            rotp-300
      if (.not.lo(202)) v(is,ip+it6)=p(22,1)                            rotp-301
      v(is,ip+it7)=p(23,1)                                              rotp-302
      if (.not.lo(203)) v(is,ip+it8)=p(24,1)                            rotp-303
      if (invz.le.0) go to 61                                           rotp-304
      do 55 j=1,invz                                                    rotp-305
      k=j+iny                                                           rotp-306
      v(is,j+it9)=p(17,k)                                               rotp-307
      v(is,j+ita)=p(19,k)                                               rotp-308
      if (lo(112)) go to 53                                             rotp-309
      v(is,j+it0)=p(18,k)                                               rotp-310
      v(is,j+itb)=p(20,k)                                               rotp-311
   53 ij=ivy(4,j)                                                       rotp-312
      if (ij.ne.0) v(is,ij+ite)=p(23,k)                                 rotp-313
      ij=ivy(3,j)                                                       rotp-314
      if (ij.eq.0) go to 54                                             rotp-315
      v(is,ij+itc)=p(21,k)                                              rotp-316
      v(is,ij+itc+inls)=-p(25,k)                                        rotp-317
      if (lo(114)) go to 54                                             rotp-318
      v(is,ij+itd)=p(22,k)                                              rotp-319
      v(is,ij+itd+inls)=-p(26,k)                                        rotp-320
   54 ij=ivy(5,j)                                                       rotp-321
      if (ij.eq.0) go to 55                                             rotp-322
      v(is,ij+itf)=p(24,k)                                              rotp-323
      v(is,ij+itf+invd)=p(27,k)                                         rotp-324
   55 continue                                                          rotp-325
      go to 61                                                          rotp-326
   56 k=ip                                                              rotp-327
      do 58 i=1,3                                                       rotp-328
      do 57 j=17,24                                                     rotp-329
      v(is,k)=p(j,i)                                                    rotp-330
   57 k=k+1                                                             rotp-331
   58 continue                                                          rotp-332
      if (invz.eq.0) go to 61                                           rotp-333
      do 60 k=1,invz                                                    rotp-334
      do 59 j=1,11                                                      rotp-335
   59 va(is,j,k)=p(j+16,k+3)                                            rotp-336
   60 continue                                                          rotp-337
   61 continue                                                          rotp-338
c coulomb potentials with diffuse charge distribution                   rotp-339
      if (lq(7,3).and.lq(8,3)) return                                   rotp-340
      do 67 i=7,8                                                       rotp-341
      if (lq(i,3)) go to 67                                             rotp-342
      i1=ip+itx(i)                                                      rotp-343
      if (i.eq.8.and.lo(117).and.lo(200)) go to 62                      rotp-344
      if (lo(100)) i1=ip+i-1                                            rotp-345
      call copo(v(1,i1),v(1,i1),p,ism,h,0,val(3*i-2),val(25),ccz,zt,.falrotp-346
     1se.,.false.)                                                      rotp-347
      if (lo(200)) go to 63                                             rotp-348
      call deri(v(1,i1+8),v(1,i1),hh,ism,.true.)                        rotp-349
      call deri(v(1,i1+16),v(1,i1+8),hh,ism,.true.)                     rotp-350
      go to 63                                                          rotp-351
   62 call copo(s,v(1,i1),p,ism,h,0,val(3*i-2),val(25),ccz,zt,.false.,.frotp-352
     1alse.)                                                            rotp-353
      call deri(v(1,i1),s,hh,ism,.false.)                               rotp-354
   63 if (invz.eq.0.or.lo(8*i+55)) go to 67                             rotp-355
      do 66 j=1,invz                                                    rotp-356
      n=ivy(i-3,j)                                                      rotp-357
      if (n.eq.0) go to 66                                              rotp-358
      l=ivy(7,j)                                                        rotp-359
      i1=n+itx(i+8)                                                     rotp-360
      if (lo(100)) i1=it5+11*j+i                                        rotp-361
      i2=i1                                                             rotp-362
      if (lo(200).and.(i.eq.8).and.lo(117)) i2=i2+invd                  rotp-363
      call copo(v(1,i2),v(1,i1),p,ism,h,l,val(3*i-2),val(25),ccz,zt,.falrotp-364
     1se.,.true.)                                                       rotp-365
      if ((i.eq.7).or.lo(17)) go to 66                                  rotp-366
      if (lo(200)) go to 64                                             rotp-367
      call deri(v(1,i1+3),v(1,i1),hh,ism,.true.)                        rotp-368
      go to 66                                                          rotp-369
   64 call deri(v(1,i1),v(1,i2),hh,ism,.false.)                         rotp-370
      rr=0.d0                                                           rotp-371
      do 65 is=1,ism                                                    rotp-372
      rr=rr+h                                                           rotp-373
   65 v(is,i2)=-v(is,i2)/rr**2                                          rotp-374
   66 continue                                                          rotp-375
   67 continue                                                          rotp-376
      return                                                            rotp-377
 1000 format (24h too small diffuseness =,e15.6,18h for the potential,2irotp-378
     14,33h   changed into its minimum value)                           rotp-379
 1001 format (27h too small coulomb radius =,e15.6,18h for the potentialrotp-380
     1,2i4,33h   changed into its minimum value)                        rotp-381
      end                                                               rotp-382
c 05/04/98  ibm version                                         ecis97  rotd-000
      subroutine rotd(nbta,bta,ivy,iv,pp,p,q,val,id1,invz,imax,iq1,iqm,irotd-001
     1ny,idt,lq,dd,pgn,xgn,lo)                                          rotd-002
c       symmetric rotational model                                      rotd-003
c a 20-points gauss-legendre integration method is used, reduced to 10  rotd-004
c values by symmetry                                                    rotd-005
c                                                                       rotd-006
c       asymmetric rotational model                                     rotd-007
c 36 values of (theta,phi) have been chosen. the values of theta are    rotd-008
c n*pi/14. and for each value of 'n' there are n+1 values of phi equi-  rotd-009
c distant between 0. and pi/2.   the matrix,the elements of which are   rotd-010
c the rotation matrix elements for these angles and l given in nl,k in  rotd-011
c nk has been inverted . the coefficients of the 15 lowest (l,k) are    rotd-012
c stored in poids . the 15 reduced rotation matrix elements for the 8   rotd-013
c values of theta are in rb .                                           rotd-014
c                                                                       rotd-015
c       vibrational model                                               rotd-016
c the angular integration is reduced to one point.                      rotd-017
c input variables:  nbta:   informations on vibrations                  rotd-018
c                   bta:    static deformations                         rotd-019
c                   ivy:    informations on form factors                rotd-020
c                   iv:     order of derivative of each form factor     rotd-021
c                   val:    optical parameters                          rotd-022
c                   id1,invz,iq1,iqm,iny,lq:   see rotp                 rotd-023
c                   imax:   maximum angular momentum                    rotd-024
c                   pgn,xgn: weight and abscissae of legendre integral  rotd-025
c                   lo:     logical controls                            rotd-026
c output variables: p(i+27,j):  weight at point j of form factor i      rotd-027
c                   q:      radii in fermis. in rotational model, q(,,2)rotd-028
c                           is first derivative/sin(theta) and q(,,3)   rotd-029
c                           2nd derivative + 1st derivative/tg(theta),  rotd-030
c                           used for schroe. equiv. of dirac equation.  rotd-031
c                   idt:    number of integration points                rotd-032
c                   dd:     charge integrals                            rotd-033
c working space:    pp:     for legendre polynomials                    rotd-034
c***********************************************************************rotd-035
      implicit real*8 (a-h,o-z)                                         rotd-036
      logical lo(250),lq(8,5)                                           rotd-037
      real*4 bta(10,1),val(24)                                          rotd-038
      dimension nl(36),nk(36),ivy(7,1),iv(1),p(id1,1),pp(2),pgn(10),xgn(rotd-039
     110),dd(2),q(8,12,3),nbta(10,1),ff(660),poids(36,15),rb(15,8)      rotd-040
      equivalence (poids(1,1),ff(1)),(rb(1,1),ff(541))                  rotd-041
      data ff(  1),ff(  2) / 5.12820512820513d-03, 2.43496936475441d-02/rotd-042
      data ff(  3),ff(  4) / 2.43496936475441d-02, 2.12528237972895d-02/rotd-043
      data ff(  5),ff(  6) / 5.53147440814732d-02, 2.12528237972895d-02/rotd-044
      data ff(  7),ff(  8) / 2.53452023906582d-02, 4.44873368571440d-02/rotd-045
      data ff(  9),ff( 10) / 4.44873368571440d-02, 2.53452023906582d-02/rotd-046
      data ff( 11),ff( 12) / 1.86559801758989d-02, 4.85184708058446d-02/rotd-047
      data ff( 13),ff( 14) / 4.12568870375796d-02, 4.85184708058446d-02/rotd-048
      data ff( 15),ff( 16) / 1.86559801758989d-02, 2.45925296747690d-02/rotd-049
      data ff( 17),ff( 18) / 3.46398560932081d-02, 4.17933479732147d-02/rotd-050
      data ff( 19),ff( 20) / 4.17933479732147d-02, 3.46398560932081d-02/rotd-051
      data ff( 21),ff( 22) / 2.45925296747690d-02, 1.19673178236678d-02/rotd-052
      data ff( 23),ff( 24) / 4.47278246564596d-02, 3.42917677140348d-02/rotd-053
      data ff( 25),ff( 26) / 3.69076912422490d-02, 3.42917677140348d-02/rotd-054
      data ff( 27),ff( 28) / 4.47278246564596d-02, 1.19673178236678d-02/rotd-055
      data ff( 29),ff( 30) / 1.22068028124735d-02, 1.07129429826274d-02/rotd-056
      data ff( 31),ff( 32) / 1.70796570854178d-02, 1.60746817649944d-02/rotd-057
      data ff( 33),ff( 34) / 1.60746817649944d-02, 1.70796570854178d-02/rotd-058
      data ff( 35),ff( 36) / 1.07129429826274d-02, 1.22068028124735d-02/rotd-059
      data ff( 37),ff( 38) / 1.16509780810355d-02, 5.02196040257258d-02/rotd-060
      data ff( 39),ff( 40) / 5.02196040257258d-02, 3.27291637647035d-02/rotd-061
      data ff( 41),ff( 42) / 9.18762267773519d-02, 3.27291637647035d-02/rotd-062
      data ff( 43),ff( 44) / 2.59023523875124d-02, 3.90112947467209d-02/rotd-063
      data ff( 45),ff( 46) / 3.90112947467209d-02, 2.59023523875124d-02/rotd-064
      data ff( 47),ff( 48) /-1.94110577743667d-03, 1.63152196117813d-02/rotd-065
      data ff( 49),ff( 50) / 4.25393417813309d-03, 1.63152196117813d-02/rotd-066
      data ff( 51),ff( 52) /-1.94110577743667d-03,-2.10440960549142d-03/rotd-067
      data ff( 53),ff( 54) /-2.95605747812527d-02,-1.76788269194279d-02/rotd-068
      data ff( 55),ff( 56) /-1.76788269194279d-02,-2.95605747812527d-02/rotd-069
      data ff( 57),ff( 58) /-2.10440960549142d-03,-2.76725877126884d-02/rotd-070
      data ff( 59),ff( 60) /-2.18051394343160d-02,-3.71237658735663d-02/rotd-071
      data ff( 61),ff( 62) /-3.47941600457989d-02,-3.71237658735663d-02/rotd-072
      data ff( 63),ff( 64) /-2.18051394343160d-02,-2.76725877126884d-02/rotd-073
      data ff( 65),ff( 66) /-2.37727476826438d-03,-2.57698170677382d-02/rotd-074
      data ff( 67),ff( 68) /-1.69793430277171d-02,-1.76582790639056d-02/rotd-075
      data ff( 69),ff( 70) /-1.76582790639056d-02,-1.69793430277171d-02/rotd-076
      data ff( 71),ff( 72) /-2.57698170677382d-02,-2.37727476826438d-03/rotd-077
      data ff( 73),ff( 74) /               0.d+00, 1.72605997389226d-03/rotd-078
      data ff( 75),ff( 76) /-1.72605997389226d-03, 1.25329145074895d-02/rotd-079
      data ff( 77),ff( 78) /               0.d+00,-1.25329145074895d-02/rotd-080
      data ff( 79),ff( 80) / 2.24225003695212d-02, 2.96494182999275d-02/rotd-081
      data ff( 81),ff( 82) /-2.96494182999275d-02,-2.24225003695212d-02/rotd-082
      data ff( 83),ff( 84) / 3.91319410166702d-02, 4.84852241623139d-02/rotd-083
      data ff( 85),ff( 86) /               0.d+00,-4.84852241623139d-02/rotd-084
      data ff( 87),ff( 88) /-3.91319410166702d-02, 3.97624306723559d-02/rotd-085
      data ff( 89),ff( 90) / 8.10325074410309d-02, 2.28106411006477d-02/rotd-086
      data ff( 91),ff( 92) /-2.28106411006477d-02,-8.10325074410309d-02/rotd-087
      data ff( 93),ff( 94) /-3.97624306723559d-02, 5.59851854712431d-02/rotd-088
      data ff( 95),ff( 96) / 6.92750919115029d-02, 5.27666983806334d-02/rotd-089
      data ff( 97),ff( 98) /               0.d+00,-5.27666983806334d-02/rotd-090
      data ff( 99),ff(100) /-6.92750919115029d-02,-5.59851854712431d-02/rotd-091
      data ff(101),ff(102) / 1.57386702462217d-02, 4.84030198418523d-02/rotd-092
      data ff(103),ff(104) / 2.47182393346187d-02, 9.25890190803834d-03/rotd-093
      data ff(105),ff(106) /-9.25890190803834d-03,-2.47182393346187d-02/rotd-094
      data ff(107),ff(108) /-4.84030198418523d-02,-1.57386702462217d-02/rotd-095
      data ff(109),ff(110) / 1.62578391680559d-02, 5.49097361991748d-02/rotd-096
      data ff(111),ff(112) / 5.49097361991748d-02, 8.83119316755724d-03/rotd-097
      data ff(113),ff(114) / 4.65475180836232d-02, 8.83119316755724d-03/rotd-098
      data ff(115),ff(116) /-1.52665570705068d-02,-4.45213321560779d-02/rotd-099
      data ff(117),ff(118) /-4.45213321560779d-02,-1.52665570705068d-02/rotd-100
      data ff(119),ff(120) /-3.25206220517009d-02,-5.00345998670453d-02/rotd-101
      data ff(121),ff(122) /-5.61452437357254d-02,-5.00345998670453d-02/rotd-102
      data ff(123),ff(124) /-3.25206220517009d-02,-5.34880433627418d-03/rotd-103
      data ff(125),ff(126) /-2.71365320807763d-02,-2.11168478505607d-02/rotd-104
      data ff(127),ff(128) /-2.11168478505607d-02,-2.71365320807763d-02/rotd-105
      data ff(129),ff(130) /-5.34880433627418d-03, 5.38896697941338d-03/rotd-106
      data ff(131),ff(132) / 2.71262358172909d-02, 2.30796535753636d-02/rotd-107
      data ff(133),ff(134) / 2.05455707964392d-02, 2.30796535753636d-02/rotd-108
      data ff(135),ff(136) / 2.71262358172909d-02, 5.38896697941338d-03/rotd-109
      data ff(137),ff(138) / 1.18873085059175d-02, 1.57695500564231d-02/rotd-110
      data ff(139),ff(140) / 1.69343260833909d-02, 1.84154828722142d-02/rotd-111
      data ff(141),ff(142) / 1.84154828722142d-02, 1.69343260833909d-02/rotd-112
      data ff(143),ff(144) / 1.57695500564231d-02, 1.18873085059175d-02/rotd-113
      data ff(145),ff(146) /               0.d+00, 8.48270535877333d-03/rotd-114
      data ff(147),ff(148) /-8.48270535877333d-03, 5.07879724674491d-02/rotd-115
      data ff(149),ff(150) /               0.d+00,-5.07879724674491d-02/rotd-116
      data ff(151),ff(152) / 6.07576950711252d-02, 9.00787083612551d-02/rotd-117
      data ff(153),ff(154) /-9.00787083612551d-02,-6.07576950711252d-02/rotd-118
      data ff(155),ff(156) / 6.45377024914683d-02, 6.34461864848980d-02/rotd-119
      data ff(157),ff(158) /               0.d+00,-6.34461864848980d-02/rotd-120
      data ff(159),ff(160) /-6.45377024914683d-02,-5.65537884945032d-03/rotd-121
      data ff(161),ff(162) / 4.77376504465041d-02,-6.49930325424402d-03/rotd-122
      data ff(163),ff(164) / 6.49930325424402d-03,-4.77376504465041d-02/rotd-123
      data ff(165),ff(166) / 5.65537884945032d-03, 1.24655233750459d-03/rotd-124
      data ff(167),ff(168) /-8.76714858478633d-02,-1.18181266709155d-02/rotd-125
      data ff(169),ff(170) /               0.d+00, 1.18181266709155d-02/rotd-126
      data ff(171),ff(172) / 8.76714858478633d-02,-1.24655233750459d-03/rotd-127
      data ff(173),ff(174) /-3.84487336410874d-02,-7.62058619698479d-03/rotd-128
      data ff(175),ff(176) /-3.01133238640137d-02,-1.08854252444356d-02/rotd-129
      data ff(177),ff(178) / 1.08854252444356d-02, 3.01133238640137d-02/rotd-130
      data ff(179),ff(180) / 7.62058619698479d-03, 3.84487336410874d-02/rotd-131
      data ff(181),ff(182),ff(183),ff(184)/3*0.d0, 1.36660942007569d-03/rotd-132
      data ff(185),ff(186) /-2.73321884015139d-03, 1.36660942007569d-03/rotd-133
      data ff(187),ff(188) / 1.10470452782256d-02,-1.10470452782256d-02/rotd-134
      data ff(189),ff(190) /-1.10470452782256d-02, 1.10470452782256d-02/rotd-135
      data ff(191),ff(192) / 2.19899348965421d-02, 7.44598962747265d-03/rotd-136
      data ff(193),ff(194) /-5.88718490480295d-02, 7.44598962747265d-03/rotd-137
      data ff(195),ff(196) / 2.19899348965421d-02, 4.68819219798074d-02/rotd-138
      data ff(197),ff(198) / 1.75997201070024d-02,-6.44816420868098d-02/rotd-139
      data ff(199),ff(200) /-6.44816420868098d-02, 1.75997201070024d-02/rotd-140
      data ff(201),ff(202) / 4.68819219798074d-02, 3.99738678988680d-02/rotd-141
      data ff(203),ff(204) / 7.12682217154704d-02,-6.36366236436914d-02/rotd-142
      data ff(205),ff(206) /-9.52109319412941d-02,-6.36366236436914d-02/rotd-143
      data ff(207),ff(208) / 7.12682217154704d-02, 3.99738678988680d-02/rotd-144
      data ff(209),ff(210) / 3.48854645305456d-02, 1.59406059510446d-02/rotd-145
      data ff(211),ff(212) /-3.85251092517111d-03,-4.69735595564191d-02/rotd-146
      data ff(213),ff(214) /-4.69735595564191d-02,-3.85251092517111d-03/rotd-147
      data ff(215),ff(216) / 1.59406059510446d-02, 3.48854645305456d-02/rotd-148
      data ff(217),ff(218) / 2.09351688388115d-02, 4.48693101517502d-02/rotd-149
      data ff(219),ff(220) / 4.48693101517502d-02,-2.58717911400513d-02/rotd-150
      data ff(221),ff(222) /-2.81401919724747d-02,-2.58717911400513d-02/rotd-151
      data ff(223),ff(224) /-2.67091832939234d-02,-6.48487928844068d-02/rotd-152
      data ff(225),ff(226) /-6.48487928844068d-02,-2.67091832939234d-02/rotd-153
      data ff(227),ff(228) / 7.16351218404911d-03, 1.79021864804572d-02/rotd-154
      data ff(229),ff(230) / 2.15963617795819d-02, 1.79021864804572d-02/rotd-155
      data ff(231),ff(232) / 7.16351218404911d-03, 2.39109798331374d-02/rotd-156
      data ff(233),ff(234) / 4.82363267486100d-02, 4.45971408837992d-02/rotd-157
      data ff(235),ff(236) / 4.45971408837992d-02, 4.82363267486100d-02/rotd-158
      data ff(237),ff(238) / 2.39109798331374d-02,-8.59824516528979d-04/rotd-159
      data ff(239),ff(240) /-8.77138104825350d-03,-1.02303358111611d-03/rotd-160
      data ff(241),ff(242) /-4.79305557318445d-03,-1.02303358111611d-03/rotd-161
      data ff(243),ff(244) /-8.77138104825350d-03,-8.59824516528979d-04/rotd-162
      data ff(245),ff(246) /-1.06844320272751d-02,-1.45408758222938d-02/rotd-163
      data ff(247),ff(248) /-1.99395576475419d-02,-1.82297258567795d-02/rotd-164
      data ff(249),ff(250) /-1.82297258567795d-02,-1.99395576475419d-02/rotd-165
      data ff(251),ff(252) /-1.45408758222938d-02,-1.06844320272751d-02/rotd-166
      data ff(253),ff(254) /               0.d+00, 2.01805115490348d-02/rotd-167
      data ff(255),ff(256) /-2.01805115490348d-02, 8.57318720924763d-02/rotd-168
      data ff(257),ff(258) /               0.d+00,-8.57318720924763d-02/rotd-169
      data ff(259),ff(260) / 3.23094559967599d-02, 8.19417704703203d-02/rotd-170
      data ff(261),ff(262) /-8.19417704703203d-02,-3.23094559967599d-02/rotd-171
      data ff(263),ff(264) /-1.46857629097277d-02,-6.79023750172081d-02/rotd-172
      data ff(265),ff(266) /               0.d+00, 6.79023750172081d-02/rotd-173
      data ff(267),ff(268) / 1.46857629097277d-02,-6.96933563711756d-02/rotd-174
      data ff(269),ff(270) /-4.17790846324735d-02,-3.84574445723291d-02/rotd-175
      data ff(271),ff(272) / 3.84574445723291d-02, 4.17790846324735d-02/rotd-176
      data ff(273),ff(274) / 6.96933563711756d-02, 3.99606295249026d-02/rotd-177
      data ff(275),ff(276) /-3.02669933372692d-02, 1.78196010140318d-02/rotd-178
      data ff(277),ff(278) /               0.d+00,-1.78196010140318d-02/rotd-179
      data ff(279),ff(280) / 3.02669933372692d-02,-3.99606295249026d-02/rotd-180
      data ff(281),ff(282) /-1.85102966735610d-03, 5.84883614463197d-02/rotd-181
      data ff(283),ff(284) / 2.06176299500674d-02, 5.03674288697549d-03/rotd-182
      data ff(285),ff(286) /-5.03674288697549d-03,-2.06176299500674d-02/rotd-183
      data ff(287),ff(288) /-5.84883614463197d-02, 1.85102966735610d-03/rotd-184
      data ff(289),ff(290),ff(291),ff(292)/3*0.d0, 8.75524578710006d-03/rotd-185
      data ff(293),ff(294) /-1.75104915742001d-02, 8.75524578710006d-03/rotd-186
      data ff(295),ff(296) / 5.09492763472956d-02,-5.09492763472956d-02/rotd-187
      data ff(297),ff(298) /-5.09492763472956d-02, 5.09492763472956d-02/rotd-188
      data ff(299),ff(300) / 5.07686792912787d-02, 3.43411087448840d-02/rotd-189
      data ff(301),ff(302) /-1.70219576072325d-01, 3.43411087448840d-02/rotd-190
      data ff(303),ff(304) / 5.07686792912787d-02, 5.95241999935498d-02/rotd-191
      data ff(305),ff(306) /-1.56733778150275d-02,-4.38508221785223d-02/rotd-192
      data ff(307),ff(308) /-4.38508221785223d-02,-1.56733778150275d-02/rotd-193
      data ff(309),ff(310) / 5.95241999935498d-02,-6.35546557275261d-02/rotd-194
      data ff(311),ff(312) / 5.26475282909628d-02,-1.74503883012358d-02/rotd-195
      data ff(313),ff(314) / 5.67150314755984d-02,-1.74503883012358d-02/rotd-196
      data ff(315),ff(316) / 5.26475282909628d-02,-6.35546557275261d-02/rotd-197
      data ff(317),ff(318) / 1.43084825509049d-02,-7.77375076960055d-02/rotd-198
      data ff(319),ff(320) / 2.99695551646778d-02, 3.34594699804229d-02/rotd-199
      data ff(321),ff(322) / 3.34594699804229d-02, 2.99695551646778d-02/rotd-200
      data ff(323),ff(324) /-7.77375076960055d-02, 1.43084825509049d-02/rotd-201
      data ff(325),ff(326),ff(327),ff(328),ff(329),ff(330) / 6*0.d+00 / rotd-202
      data ff(331),ff(332) / 2.45227713022227d-03,-4.90455426044453d-03/rotd-203
      data ff(333),ff(334) / 4.90455426044453d-03,-2.45227713022227d-03/rotd-204
      data ff(335),ff(336) / 1.70476858680581d-02,-2.41090685616840d-02/rotd-205
      data ff(337),ff(338) /               0.d+00, 2.41090685616840d-02/rotd-206
      data ff(339),ff(340) /-1.70476858680581d-02, 2.87679007598782d-02/rotd-207
      data ff(341),ff(342) /-6.25948031834043d-03,-7.67073502036074d-02/rotd-208
      data ff(343),ff(344) / 7.67073502036074d-02, 6.25948031834043d-03/rotd-209
      data ff(345),ff(346) /-2.87679007598782d-02, 6.77534129025308d-02/rotd-210
      data ff(347),ff(348) /-2.45662401760060d-02,-9.29568496692793d-02/rotd-211
      data ff(349),ff(350) /               0.d+00, 9.29568496692793d-02/rotd-212
      data ff(351),ff(352) / 2.45662401760060d-02,-6.77534129025308d-02/rotd-213
      data ff(353),ff(354) / 1.40653464342708d-02, 3.44626025062703d-02/rotd-214
      data ff(355),ff(356) /-6.14715612078917d-02,-3.05058349395271d-02/rotd-215
      data ff(357),ff(358) / 3.05058349395271d-02, 6.14715612078917d-02/rotd-216
      data ff(359),ff(360) /-3.44626025062703d-02,-1.40653464342708d-02/rotd-217
      data ff(361),ff(362) / 2.68196038675183d-02, 2.31031610463596d-02/rotd-218
      data ff(363),ff(364) / 2.31031610463596d-02,-4.28485793267828d-02/rotd-219
      data ff(365),ff(366) /-7.35437975772992d-02,-4.28485793267828d-02/rotd-220
      data ff(367),ff(368) / 8.24684503593131d-03, 1.06081754814925d-02/rotd-221
      data ff(369),ff(370) / 1.06081754814925d-02, 8.24684503593131d-03/rotd-222
      data ff(371),ff(372) / 2.51256208268608d-02, 4.43395667660788d-02/rotd-223
      data ff(373),ff(374) / 5.39942159127383d-02, 4.43395667660788d-02/rotd-224
      data ff(375),ff(376) / 2.51256208268608d-02,-2.19715194066651d-02/rotd-225
      data ff(377),ff(378) /-3.13725579969708d-02,-4.08834934180796d-02/rotd-226
      data ff(379),ff(380) /-4.08834934180796d-02,-3.13725579969708d-02/rotd-227
      data ff(381),ff(382) /-2.19715194066651d-02,-1.88427973024923d-03/rotd-228
      data ff(383),ff(384) /-2.16035578956301d-02,-1.17587068801884d-02/rotd-229
      data ff(385),ff(386) /-1.12062882635935d-02,-1.17587068801884d-02/rotd-230
      data ff(387),ff(388) /-2.16035578956301d-02,-1.88427973024923d-03/rotd-231
      data ff(389),ff(390) / 5.74971871310925d-03, 2.25181635560216d-02/rotd-232
      data ff(391),ff(392) / 1.76219271299887d-02, 1.69776491290416d-02/rotd-233
      data ff(393),ff(394) / 1.69776491290416d-02, 1.76219271299887d-02/rotd-234
      data ff(395),ff(396) / 2.25181635560216d-02, 5.74971871310925d-03/rotd-235
      data ff(397),ff(398) /               0.d+00, 3.55735538800802d-02/rotd-236
      data ff(399),ff(400) /-3.55735538800802d-02, 8.33786715099005d-02/rotd-237
      data ff(401),ff(402) /               0.d+00,-8.33786715099005d-02/rotd-238
      data ff(403),ff(404) /-4.89348970296868d-02,-2.91035565005004d-04/rotd-239
      data ff(405),ff(406) / 2.91035565005004d-04, 4.89348970296868d-02/rotd-240
      data ff(407),ff(408) /-2.62016346104983d-02,-8.33457375352782d-02/rotd-241
      data ff(409),ff(410) /               0.d+00, 8.33457375352782d-02/rotd-242
      data ff(411),ff(412) / 2.62016346104983d-02, 2.62738780028789d-02/rotd-243
      data ff(413),ff(414) / 8.32340348860637d-02, 3.18724837249571d-02/rotd-244
      data ff(415),ff(416) /-3.18724837249571d-02,-8.32340348860637d-02/rotd-245
      data ff(417),ff(418) /-2.62738780028789d-02, 2.62547109771934d-02/rotd-246
      data ff(419),ff(420) / 7.98302855528211d-03, 4.48364778698653d-03/rotd-247
      data ff(421),ff(422) /               0.d+00,-4.48364778698653d-03/rotd-248
      data ff(423),ff(424) /-7.98302855528211d-03,-2.62547109771934d-02/rotd-249
      data ff(425),ff(426) /-2.51077741509568d-02,-2.87429639697600d-02/rotd-250
      data ff(427),ff(428) /-1.79981066009081d-02,-7.87642513464656d-03/rotd-251
      data ff(429),ff(430) / 7.87642513464656d-03, 1.79981066009081d-02/rotd-252
      data ff(431),ff(432) / 2.87429639697600d-02, 2.51077741509568d-02/rotd-253
      data ff(433),ff(434),ff(435),ff(436)/3*0.d0, 2.38959949710526d-02/rotd-254
      data ff(437),ff(438) /-4.77919899421051d-02, 2.38959949710526d-02/rotd-255
      data ff(439),ff(440) / 7.91176151667601d-02,-7.91176151667601d-02/rotd-256
      data ff(441),ff(442) /-7.91176151667601d-02, 7.91176151667601d-02/rotd-257
      data ff(443),ff(444) /-1.24626161171327d-02, 5.33272858981795d-02/rotd-258
      data ff(445),ff(446) /-8.17293395620937d-02, 5.33272858981795d-02/rotd-259
      data ff(447),ff(448) /-1.24626161171327d-02,-1.44916866191644d-02/rotd-260
      data ff(449),ff(450) /-9.04220344262881d-02, 1.04913721045452d-01/rotd-261
      data ff(451),ff(452) / 1.04913721045452d-01,-9.04220344262881d-02/rotd-262
      data ff(453),ff(454) /-1.44916866191644d-02,-5.73533998264151d-02/rotd-263
      data ff(455),ff(456) / 7.23959359228724d-02,-1.77393445770836d-02/rotd-264
      data ff(457),ff(458) / 5.39361696125263d-03,-1.77393445770836d-02/rotd-265
      data ff(459),ff(460) / 7.23959359228724d-02,-5.73533998264151d-02/rotd-266
      data ff(461),ff(462) / 5.42648795710159d-02,-2.39248769146420d-02/rotd-267
      data ff(463),ff(464) / 7.38288973327365d-04,-3.10782916297012d-02/rotd-268
      data ff(465),ff(466) /-3.10782916297012d-02, 7.38288973327365d-04/rotd-269
      data ff(467),ff(468) /-2.39248769146420d-02, 5.42648795710159d-02/rotd-270
      data ff(469),ff(470),ff(471),ff(472),ff(473),ff(474) / 6*0.d+00 / rotd-271
      data ff(475),ff(476) / 1.58592251779111d-02,-3.17184503558222d-02/rotd-272
      data ff(477),ff(478) / 3.17184503558222d-02,-1.58592251779111d-02/rotd-273
      data ff(479),ff(480) / 6.36434740587254d-02,-9.00054641703897d-02/rotd-274
      data ff(481),ff(482) /               0.d+00, 9.00054641703897d-02/rotd-275
      data ff(483),ff(484) /-6.36434740587254d-02, 2.20893694492763d-02/rotd-276
      data ff(485),ff(486) / 2.93554190800171d-02,-1.48336186023447d-01/rotd-277
      data ff(487),ff(488) / 1.48336186023447d-01,-2.93554190800171d-02/rotd-278
      data ff(489),ff(490) /-2.20893694492763d-02, 4.17889616928183d-02/rotd-279
      data ff(491),ff(492) /-9.17122054842361d-02, 7.52722761872573d-02/rotd-280
      data ff(493),ff(494) /               0.d+00,-7.52722761872573d-02/rotd-281
      data ff(495),ff(496) / 9.17122054842361d-02,-4.17889616928183d-02/rotd-282
      data ff(497),ff(498) /-6.41790551032870d-02, 5.94260666825252d-02/rotd-283
      data ff(499),ff(500) / 7.67785691121092d-03, 2.62939467857734d-02/rotd-284
      data ff(501),ff(502) /-2.62939467857734d-02,-7.67785691121092d-03/rotd-285
      data ff(503),ff(504) /-5.94260666825252d-02, 6.41790551032870d-02/rotd-286
      data ff(505),ff(506),ff(507),ff(508),ff(509),ff(510) / 6*0.d+00 / rotd-287
      data ff(511),ff(512),ff(513),ff(514)                 / 4*0.d+00 / rotd-288
      data ff(515),ff(516) / 6.25351913613187d-03,-1.25070382722637d-02/rotd-289
      data ff(517),ff(518) / 1.25070382722637d-02,-1.25070382722637d-02/rotd-290
      data ff(519),ff(520) / 6.25351913613187d-03, 3.11758837931106d-02/rotd-291
      data ff(521),ff(522) /-5.04436396065700d-02, 1.92677558134594d-02/rotd-292
      data ff(523),ff(524) / 1.92677558134594d-02,-5.04436396065700d-02/rotd-293
      data ff(525),ff(526) / 3.11758837931106d-02, 3.58893219026970d-02/rotd-294
      data ff(527),ff(528) /-1.67264809607312d-02,-9.33778447285944d-02/rotd-295
      data ff(529),ff(530) / 1.48430007573257d-01,-9.33778447285944d-02/rotd-296
      data ff(531),ff(532) /-1.67264809607312d-02, 3.58893219026970d-02/rotd-297
      data ff(533),ff(534) / 4.68575275756458d-02,-4.50757375114331d-02/rotd-298
      data ff(535),ff(536) /-3.00076119100051d-02, 2.82258218457924d-02/rotd-299
      data ff(537),ff(538) / 2.82258218457924d-02,-3.00076119100051d-02/rotd-300
      data ff(539),ff(540) /-4.50757375114331d-02, 4.68575275756458d-02/rotd-301
      data ff(541),ff(542),ff(543),ff(544) / 2*1.d+00, 0.d+00, 1.d+00 / rotd-302
      data ff(545),ff(546),ff(547),ff(548) / 2*0.d+00, 1.d+00, 0.d+00 / rotd-303
      data ff(549),ff(550),ff(551),ff(552) / 2*0.d+00, 1.d+00, 0.d+00 / rotd-304
      data ff(553),ff(554),ff(555),ff(556) / 3*0.d+00, 1.d+00         / rotd-305
      data ff(557),ff(558) / 9.25726650926814d-01, 3.03219677861538d-02/rotd-306
      data ff(559),ff(560) / 7.63148756611001d-01, 1.10652387063757d-01/rotd-307
      data ff(561),ff(562) / 1.28207234895501d-03, 5.36257386538795d-01/rotd-308
      data ff(563),ff(564) / 2.17289580469363d-01, 8.13196358030030d-03/rotd-309
      data ff(565),ff(566) / 5.76608786636350d-05, 2.78047174877667d-01/rotd-310
      data ff(567),ff(568) / 3.29131159509191d-01, 2.49657214768430d-02/rotd-311
      data ff(569),ff(570) / 5.20868271692270d-04, 2.66389008100408d-06/rotd-312
      data ff(571),ff(572) /               1.d+00, 7.17617351394050d-01/rotd-313
      data ff(573),ff(574) / 1.15282233550037d-01, 2.13774427323495d-01/rotd-314
      data ff(575),ff(576) / 3.48423989314638d-01, 1.85320103458231d-02/rotd-315
      data ff(577),ff(578) /-2.35732455017163d-01, 4.90294315725551d-01/rotd-316
      data ff(579),ff(580) / 9.85729671840697d-02, 3.16881041332955d-03/rotd-317
      data ff(581),ff(582) /-4.09576022206791d-01, 4.20201210269288d-01/rotd-318
      data ff(583),ff(584) / 2.34245007796887d-01, 2.41313741208102d-02/rotd-319
      data ff(585),ff(586) / 5.56591156140697d-04,               1.d+00/rotd-320
      data ff(587),ff(588) / 4.16890700467236d-01, 2.38053374687832d-01/rotd-321
      data ff(589),ff(590) /-2.82554557772787d-01, 5.03833139973589d-01/rotd-322
      data ff(591),ff(592) / 7.90217156752737d-02,-3.59733444374334d-01/rotd-323
      data ff(593),ff(594) / 2.89718584757935d-01, 3.03418532856755d-01/rotd-324
      data ff(595),ff(596) / 2.79017946123459d-02, 7.08378251175649d-02/rotd-325
      data ff(597),ff(598) /-1.72370094784044d-01, 4.12885596178737d-01/rotd-326
      data ff(599),ff(600) / 1.55306184423031d-01, 1.01200845906307d-02/rotd-327
      data ff(601),ff(602) /               1.d+00, 8.31092995327642d-02/rotd-328
      data ff(603),ff(604) / 3.74319061007963d-01,-4.21630141495484d-01/rotd-329
      data ff(605),ff(606) / 4.15874017677357d-01, 1.95380697242947d-01/rotd-330
      data ff(607),ff(608) / 1.11600329703613d-01,-1.97772479536753d-01/rotd-331
      data ff(609),ff(610) / 4.29387782672098d-01, 1.08476318674788d-01/rotd-332
      data ff(611),ff(612) / 2.63594691134320d-01,-2.34078763472890d-01/rotd-333
      data ff(613),ff(614) / 7.77527093709932d-02, 3.57086142014797d-01/rotd-334
      data ff(615),ff(616) / 6.18663570444226d-02,               1.d+00/rotd-335
      data ff(617),ff(618) /-2.17617351394050d-01, 4.97090202145758d-01/rotd-336
      data ff(619),ff(620) /-1.75906698838214d-01, 1.01968005344553d-01/rotd-337
      data ff(621),ff(622) / 3.44562631700107d-01, 3.21522932835539d-01/rotd-338
      data ff(623),ff(624) /-3.16879195937032d-01, 2.47505734203973d-01/rotd-339
      data ff(625),ff(626) / 2.54047379389696d-01,-2.23915517573357d-01/rotd-340
      data ff(627),ff(628) / 2.47297362843729d-01,-3.04922989721535d-01/rotd-341
      data ff(629),ff(630) / 3.15711860946547d-01, 1.92409975848431d-01/rotd-342
      data ff(631),ff(632) /               1.d+00,-4.25726650926814d-01/rotd-343
      data ff(633),ff(634) / 5.82050467909641d-01, 2.00043214171989d-01/rotd-344
      data ff(635),ff(636) /-2.45486828370620d-01, 4.72409970427464d-01/rotd-345
      data ff(637),ff(638) /-3.40709996864496d-02, 5.77157388195865d-02/rotd-346
      data ff(639),ff(640) /-1.44294709220167d-01, 4.07841145692130d-01/rotd-347
      data ff(641),ff(642) /-9.23304365056544d-02, 7.92778608560820d-02/rotd-348
      data ff(643),ff(644) /-3.36435261948797d-02,-7.14935648162744d-02/rotd-349
      data ff(645),ff(646) / 3.61684038642514d-01,               1.d+00/rotd-350
      data ff(647),ff(648) /              -5.d-01, 6.12372435695795d-01/rotd-351
      data ff(649),ff(650) /             3.75d-01,-3.95284707521047d-01/rotd-352
      data ff(651),ff(652) / 5.22912516583797d-01,           -3.125d-01/rotd-353
      data ff(653),ff(654) / 3.20217211436237d-01,-3.50780380010057d-01/rotd-354
      data ff(655),ff(656) / 4.74958879799083d-01,         2.734375d-01/rotd-355
      data ff(657),ff(658) /-2.77316239832795d-01, 2.90851726077911d-01/rotd-356
      data ff(659),ff(660) /-3.23629924643875d-01, 4.43148525027868d-01/rotd-357
      data nl/0,2,2,4,4,4,6,6,6,6,8,8,8,8,8,10,10,10,10,10,10,12,12,12,1rotd-358
     12,12,12,12,14,14,14,14,14,14,14,14/                               rotd-359
      data nk/0,0,2,0,2,4,0,2,4,6,0,2,4,6,8,0,2,4,6,8,10,0,2,4,6,8,10,12rotd-360
     1,0,2,4,6,8,10,12,14/                                              rotd-361
      data pi/3.1415926535d0/                                           rotd-362
      dd(1)=0.d0                                                        rotd-363
      dd(2)=0.d0                                                        rotd-364
      if (lo(1)) go to 4                                                rotd-365
      idt=1                                                             rotd-366
      do 2 j=1,8                                                        rotd-367
      if (lq(j,1)) go to 2                                              rotd-368
      if (lq(j,3)) go to 1                                              rotd-369
      p(j,1)=0.d0                                                       rotd-370
      q(j,1,1)=-val(3*j-1)                                              rotd-371
      p(j+8,1)=1.d-16                                                   rotd-372
      if (lq(j,4)) go to 2                                              rotd-373
      q(j,1,1)=val(3*j-1)                                               rotd-374
      if (q(j,1,1).gt.-36.*val(3*j)) p(j+8,1)=dexp(q(j,1,1)/val(3*j))   rotd-375
      go to 2                                                           rotd-376
    1 p(j,1)=val(3*j-1)                                                 rotd-377
      dd(j-6)=p(j,1)**3                                                 rotd-378
    2 continue                                                          rotd-379
      do 3 i=1,iq1                                                      rotd-380
    3 p(i+27,1)=1.d0                                                    rotd-381
      return                                                            rotd-382
    4 if (lo(3)) go to 18                                               rotd-383
c *** symmetric rotational model ***************                        rotd-384
      idt=10                                                            rotd-385
      iq=iqm                                                            rotd-386
      if (invz.ne.0) iq=max0(iq,imax)                                   rotd-387
      iq2=iqm/2                                                         rotd-388
      sr=1.d0                                                           rotd-389
      do 6 j=1,8                                                        rotd-390
      if (lq(j,1)) go to 6                                              rotd-391
      if (lo(6)) sr=1.d0/val(3*j-1)                                     rotd-392
      if (.not.lq(j,4)) sr=dabs(sr)                                     rotd-393
      do 5 i=1,iq2                                                      rotd-394
      c=4*i+1                                                           rotd-395
    5 p(16+j,2*i)=sr*bta(j,i)*dsqrt(c/(4.d0*pi))                        rotd-396
    6 continue                                                          rotd-397
      do 17 i=1,10                                                      rotd-398
      pp(2)=xgn(i)                                                      rotd-399
      pp(1)=1.d0                                                        rotd-400
      do 7 j=2,iq                                                       rotd-401
      c=j                                                               rotd-402
      c=1.d0/c                                                          rotd-403
    7 pp(j+1)=(2.d0-c)*pp(2)*pp(j)+(c-1.d0)*pp(j-1)                     rotd-404
      c1=1.d0-pp(2)**2                                                  rotd-405
      do 11 j=1,8                                                       rotd-406
      if (lq(j,1)) go to 11                                             rotd-407
      p(j,i)=0.d0                                                       rotd-408
      q(j,i,2)=0.d0                                                     rotd-409
      q(j,i,3)=0.d0                                                     rotd-410
      q(j,i,1)=1.d0                                                     rotd-411
      do 8 k=2,iqm,2                                                    rotd-412
      c=k                                                               rotd-413
      q(j,i,1)=q(j,i,1)+p(16+j,k)*pp(k+1)                               rotd-414
      q(j,i,2)=q(j,i,2)-c*p(16+j,k)*(pp(2)*pp(k+1)-pp(k))/c1            rotd-415
    8 q(j,i,3)=q(j,i,3)-p(16+j,k)*pp(k+1)*c*(c+1.d0)                    rotd-416
      c2=val(3*j-1)                                                     rotd-417
      if (.not.lq(j,4)) c2=-c2                                          rotd-418
      do 9 k=1,3                                                        rotd-419
    9 q(j,i,k)=-q(j,i,k)*c2                                             rotd-420
      if (lq(j,3)) go to 10                                             rotd-421
      p(j+8,i)=1.d-16                                                   rotd-422
      if (lq(j,4)) go to 11                                             rotd-423
      if (q(j,i,1).gt.-36.*val(3*j)) p(j+8,i)=dexp(q(j,i,1)/val(3*j))   rotd-424
      go to 11                                                          rotd-425
   10 p(j,i)=-q(j,i,1)                                                  rotd-426
      dd(j-6)=dd(j-6)+pgn(i)*(p(j,i)**3)                                rotd-427
   11 continue                                                          rotd-428
      do 16 ij=1,iq1                                                    rotd-429
      k=1                                                               rotd-430
      if (ij.gt.iny) k=ivy(1,ij-iny)/1000                               rotd-431
      c=pp(k)                                                           rotd-432
      if ((iv(ij).eq.1).or.(ij.le.iny)) go to 16                        rotd-433
      kb=mod(ivy(1,ij-iny),1000)                                        rotd-434
      kl=nbta(9,kb)                                                     rotd-435
      kk=nbta(10,kb)                                                    rotd-436
      if (ivy(6,ij-iny).lt.0) kl=mod(kl,2)                              rotd-437
      if (kk.ne.0) go to 12                                             rotd-438
      c=c*pp(kl+1)*dsqrt(2.d0*kl+1.d0)                                  rotd-439
      go to 16                                                          rotd-440
c computation of y(k-1,kk) * y(kl,kk)                                   rotd-441
   12 c=sqrt(2.d0*kl+1.d0)                                              rotd-442
      do 13 kb=1,kk                                                     rotd-443
   13 c=c*c1*(2*kb-1)**2/dsqrt((kl+kb)*(k-kb)*(kl-kb+1.d0)*(k+kb-1.d0)) rotd-444
      kz=k-1-kk                                                         rotd-445
      do 15 j=1,2                                                       rotd-446
      if (kz.le.0) go to 15                                             rotd-447
      d=0.d0                                                            rotd-448
      do 14 kb=1,kz                                                     rotd-449
      c2=d                                                              rotd-450
      d=c                                                               rotd-451
   14 c=c2+(d*pp(2)-c2)*(2.d0*(kk+kb)-1.d0)/kb                          rotd-452
   15 kz=kl-kk                                                          rotd-453
   16 p(ij+27,i)=pgn(i)*c*dsqrt(2.d0*k-1.d0)                            rotd-454
   17 continue                                                          rotd-455
      return                                                            rotd-456
c *** asymmetric rotational model ***************                       rotd-457
   18 idt=36                                                            rotd-458
      do 21 j=1,8                                                       rotd-459
      do 20 i=1,iqm                                                     rotd-460
      if (nk(i+1).eq.0) go to 19                                        rotd-461
      p(16+j,i+1)=p(16+j,i)*dsin(pi*bta(j,i)/180.d0)                    rotd-462
      p(16+j,i)=p(16+j,i)*dcos(pi*bta(j,i)/180.d0)                      rotd-463
      go to 20                                                          rotd-464
   19 c=2*nl(i+1)+1                                                     rotd-465
      p(16+j,i+1)=bta(j,i)*dsqrt(c/(4.d0*pi))                           rotd-466
   20 continue                                                          rotd-467
   21 continue                                                          rotd-468
      sr=1.d0                                                           rotd-469
      do 23 j=1,8                                                       rotd-470
      if (lq(j,1)) go to 23                                             rotd-471
      if (lo(6)) sr=1.d0/val(3*j-1)                                     rotd-472
      if (.not.lq(j,4)) sr=dabs(sr)                                     rotd-473
      do 22 i=1,iqm                                                     rotd-474
      if (nk(i+1).ne.0) p(16+j,i+1)=p(16+j,i+1)*1.414213562d0           rotd-475
   22 p(16+j,i+1)=sr*p(16+j,i+1)                                        rotd-476
   23 continue                                                          rotd-477
      i=0                                                               rotd-478
      do 29 l=1,8                                                       rotd-479
      c=4*max0(1,l-1)                                                   rotd-480
      phi=pi/c                                                          rotd-481
      do 28 m=1,l                                                       rotd-482
      i=i+1                                                             rotd-483
      do 24 j=1,iq1                                                     rotd-484
      k=1                                                               rotd-485
      if (j.gt.iny) k=ivy(1,j-iny)/1000                                 rotd-486
   24 p(j+27,i)=poids(i,k)                                              rotd-487
      do 27 j=1,8                                                       rotd-488
      if (lq(j,1)) go to 27                                             rotd-489
      p(j,i)=0.d0                                                       rotd-490
      r=1.d0                                                            rotd-491
      do 25 k=1,iqm                                                     rotd-492
      c=nk(k+1)*nk(i)                                                   rotd-493
   25 r=r+p(16+j,k+1)*rb(k+1,l)*dcos(c*phi)                             rotd-494
      q(j,i,1)=-r*val(3*j-1)                                            rotd-495
      if (lq(j,3)) go to 26                                             rotd-496
      p(j+8,i)=1.d-16                                                   rotd-497
      if (lq(j,4)) go to 27                                             rotd-498
      q(j,i,1)=-q(j,i,1)                                                rotd-499
      if (q(j,i,1).gt.-36.*val(3*j)) p(j+8,i)=dexp(q(j,i,1)/val(3*j))   rotd-500
      go to 27                                                          rotd-501
   26 p(j,i)=r*abs(val(3*j-1))                                          rotd-502
      dd(j-6)=dd(j-6)+poids(i,1)*(p(j,i)**3)                            rotd-503
   27 continue                                                          rotd-504
   28 continue                                                          rotd-505
   29 continue                                                          rotd-506
      return                                                            rotd-507
      end                                                               rotd-508
c 05/04/98  ibm version                                         ecis97  rotz-000
      subroutine rotz(vr,xgn,r,q,val,j,iv,b,p,id1,iq1,lo)               rotz-001
c deformation of the schroedinger equation which is equivalent to the   rotz-002
c dirac equation only for elastic scattering.                           rotz-003
c     no asymmetric rotational model                                    rotz-004
c     no diffuseness of coulomb charge and no coulomb deformation       rotz-005
c     no vibrational band in rotational model                           rotz-006
c     only first order vibrational model                                rotz-007
c input variables: vr(i,j): potential for i=1, -1rst derivative for i=5 rotz-008
c                           and second derivative for i=6               rotz-009
c                  xgn:     abscissae for legendre integration          rotz-010
c                  r:       radius                                      rotz-011
c                  q(i,j,k):derivatives dr/dtheta for k=2 and 3         rotz-012
c                  val:     optical model                               rotz-013
c                  j:       point of legendre angular integral          rotz-014
c                  iv:      number of phonons plus one                  rotz-015
c                  b:       deformations                                rotz-016
c                  p(i,j):  previous results for i=17 to 26 and weights rotz-017
c                           for i=28 and up in the rotational model     rotz-018
c                  id1:     first dimension of p                        rotz-019
c                  iq1:     number of transition form factors plus 3    rotz-020
c                  lo:      logical controls                            rotz-021
c output variables:p(i,j)   for i=17 to 26, potential for j=1 and       rotz-022
c                           transition form factors for j=4 to iq1.     rotz-023
c***********************************************************************rotz-024
      implicit real*8 (a-h,o-z)                                         rotz-025
      logical lo(250)                                                   rotz-026
      real*4 val(1)                                                     rotz-027
      dimension vr(6,10),q(8,12,3),xgn(10),b(10,1),p(id1,1),iv(1)       rotz-028
      common /dblpr/ chi2,chi2m,cm,ck,chb,cmb,ccz,xe,xm,xn,xz           rotz-029
      do 2 i=7,8                                                        rotz-030
      if (r.gt.val(3*i-1)) go to 1                                      rotz-031
      vr(1,i)=ccz*val(3*i-2)*(1.5d0-.5d0*(r*r)/val(3*i-1)**2)/val(3*i-1)rotz-032
      vr(6,i)=-ccz*val(3*i-2)/val(3*i-1)**3                             rotz-033
      vr(5,i)=-vr(6,i)*r                                                rotz-034
      go to 2                                                           rotz-035
    1 vr(1,i)=ccz*val(3*i-2)/r                                          rotz-036
      vr(5,i)=vr(1,i)/r                                                 rotz-037
      vr(6,i)=2.d0*vr(5,i)/r                                            rotz-038
    2 continue                                                          rotz-039
c computation of d(r) and inverse                                       rotz-040
      c1=xe+xm+vr(1,1)-vr(1,3)-vr(1,7)                                  rotz-041
      c2=vr(1,2)-vr(1,4)                                                rotz-042
      dd=c1**2+c2**2                                                    rotz-043
      dr=c1/dd                                                          rotz-044
      di=-c2/dd                                                         rotz-045
      c3=xe-xm-vr(1,1)-vr(1,3)-vr(1,7)                                  rotz-046
      c4=-vr(1,2)-vr(1,4)                                               rotz-047
      c5=(c1*c3-c2*c4-xe**2+xm**2)/(2.d0*xm)                            rotz-048
      c6=(c1*c4+c2*c3)/(2.d0*xm)                                        rotz-049
      d1=vr(5,3)-vr(5,1)+vr(5,7)                                        rotz-050
      d2=vr(5,4)-vr(5,2)                                                rotz-051
      cr=d1*dr-d2*di+(vr(5,5)+vr(5,8))/xm                               rotz-052
      ci=d2*dr+d1*di+vr(5,6)/xm                                         rotz-053
      cc=vr(1,7)*xe/xm                                                  rotz-054
      br=vr(6,1)-vr(6,7)-vr(6,3)                                        rotz-055
      bi=vr(6,2)-vr(6,4)                                                rotz-056
c square of gradient  and laplacian     radial term                     rotz-057
      er=br*dr-bi*di+(vr(5,5)+vr(5,8))/xm*(cr+cr-(vr(5,5)+vr(5,8))/xm)-vrotz-058
     1r(5,6)/xm*(ci+ci-vr(5,6)/xm)-(vr(6,5)+vr(6,8))/xm+2.d0*cr/r       rotz-059
      ei=br*di+bi*dr+(vr(5,5)+vr(5,8))/xm*(ci+ci-vr(5,6)/xm)+vr(5,6)/xm*rotz-060
     1(cr+cr-(vr(5,5)+vr(5,8))/xm)-vr(6,6)/xm+2.d0*ci/r                 rotz-061
      c5=c5-(.75d0*(cr**2-ci**2)-.5d0*er)*xn                            rotz-062
      c6=c6-(1.5d0*cr*ci-.5d0*ei)*xn                                    rotz-063
      if (lo(101)) go to 5                                              rotz-064
c rotational model                                                      rotz-065
      c=1.d0-xgn(j)**2                                                  rotz-066
      do 3 i=1,8                                                        rotz-067
      vr(4,i)=(vr(6,i)*q(i,j,2)**2*c+vr(5,i)*q(i,j,3))/r**2             rotz-068
    3 vr(3,i)=vr(5,i)*q(i,j,2)/r                                        rotz-069
c square of gradient is d/dr.d/dr + 1/r**2 d/dth.d/dth                  rotz-070
      c3=vr(3,1)-vr(3,3)-vr(3,7)                                        rotz-071
      c4=vr(3,2)-vr(3,4)                                                rotz-072
      c7=c3*dr-c4*di                                                    rotz-073
      c8=c3*di+c4*dr                                                    rotz-074
      c3=(vr(3,5)+vr(3,8))/xm                                           rotz-075
      c4=vr(3,6)/xm                                                     rotz-076
      c5=c5-(.75*(c7**2-c8**2)+.5*(c7*c3-c8*c4)+.75*(c3**2-c4**2))*c*xn rotz-077
      c6=c6-(1.5d0*c7*c8+.5d0*(c7*c4+c8*c3)+1.5d0*c3*c4)*c*xn           rotz-078
c laplacian is d**2/dr**2 + 2/r d/dr + 1/r**2 (d**2/dth**2+d/dth/tg )   rotz-079
      c3=vr(4,1)-vr(4,3)-vr(4,7)                                        rotz-080
      c4=vr(4,2)-vr(4,4)                                                rotz-081
      c5=c5+.5d0*(c3*dr-c4*di+(vr(4,5)+vr(4,8))/xm)*xn                  rotz-082
      c6=c6+.5d0*(c4*dr+c3*di+vr(4,6)/xm)*xn                            rotz-083
c c5 + i c6   central term                                              rotz-084
c cr + i ci   spin-orbit term                                           rotz-085
c dr + i di   1/denominator                                             rotz-086
      p(17,1)=p(17,1)+(c5+cc)*p(28,j)                                   rotz-087
      p(18,1)=p(18,1)+c6*p(28,j)                                        rotz-088
      p(21,1)=p(21,1)+.5d0*xn*(cr-vr(5,8)/xm)*p(28,j)/r                 rotz-089
      p(22,1)=p(22,1)+.5d0*xn*ci*p(28,j)/r                              rotz-090
      p(23,1)=p(23,1)+cc*p(28,j)                                        rotz-091
      p(24,1)=p(24,1)+vr(5,8)/r*p(28,j)                                 rotz-092
      if (iq1.lt.4) return                                              rotz-093
c logarithm of d(r) c9 + i c0                                           rotz-094
      c9=.5d0*dlog(c1**2+c2**2)-(vr(1,5)+vr(1,8))/xm                    rotz-095
      c0=datan2(c2,c1)-vr(1,6)/xm                                       rotz-096
      do 4 i=4,iq1                                                      rotz-097
      if (iv(i).gt.1) go to 7                                           rotz-098
      p(17,i)=p(17,i)+(c5+cc)*p(i+27,j)                                 rotz-099
      p(18,i)=p(18,i)+c6*p(i+27,j)                                      rotz-100
      p(21,i)=p(21,i)+.5d0*xn*(cr-vr(5,8)/xm)*p(i+27,j)/r               rotz-101
      p(22,i)=p(22,i)+.5d0*xn*ci*p(i+27,j)/r                            rotz-102
      p(23,i)=p(23,1)+cc*p(i+27,j)                                      rotz-103
      p(24,i)=p(24,1)+vr(5,8)/r*p(i+27,j)                               rotz-104
      p(25,i)=p(25,i)-.5d0*xn*c9*p(i+27,j)/r**2                         rotz-105
    4 p(26,i)=p(26,i)-.5d0*xn*c0*p(i+27,j)/r**2                         rotz-106
      return                                                            rotz-107
c computation of zeroth order                                           rotz-108
    5 p(17,1)=c5+cc                                                     rotz-109
      p(18,1)=c6                                                        rotz-110
      p(21,1)=.5d0*(cr-vr(5,8)/xm)*xn/r                                 rotz-111
      p(22,1)=.5d0*ci*xn/r                                              rotz-112
      p(23,1)=cc                                                        rotz-113
      p(24,1)=vr(5,8)/r                                                 rotz-114
      if (iq1.lt.4) return                                              rotz-115
      do 6 i=4,iq1                                                      rotz-116
c computation of first order                                            rotz-117
      if (iv(i).ne.2) go to 8                                           rotz-118
      c1r=vr(5,1)*b(1,i)-vr(5,3)*b(3,i)                                 rotz-119
      c2r=vr(5,2)*b(2,i)-vr(5,4)*b(4,i)                                 rotz-120
      drr=-(dr*dr-di*di)*c1r+2.d0*dr*di*c2r                             rotz-121
      dir=-(dr*dr-di*di)*c2r-2.d0*dr*di*c1r                             rotz-122
      c3r=-vr(5,1)*b(1,i)-vr(5,3)*b(3,i)                                rotz-123
      c4r=-vr(5,2)*b(2,i)-vr(5,4)*b(4,i)                                rotz-124
      c5r=(c1r*c3-c2r*c4+c1*c3r-c2*c4r)/(2.d0*xm)                       rotz-125
      c6r=(c1r*c4+c2r*c3+c1*c4r+c2*c3r)/(2.d0*xm)                       rotz-126
      d1r=vr(6,3)*b(3,i)-vr(6,1)*b(1,i)                                 rotz-127
      d2r=vr(6,4)*b(4,i)-vr(6,2)*b(2,i)                                 rotz-128
      crr=d1r*dr-d2r*di+d1*drr-d2*dir+vr(6,5)*b(5,i)/xm                 rotz-129
      cir=d2r*dr+d1r*di+d2*drr+d1*dir+vr(6,6)*b(6,i)/xm                 rotz-130
      err=br*drr-bi*dir+(vr(5,5)+vr(5,8))/xm*(crr+crr-vr(6,5)*b(5,i)/xm)rotz-131
     1-vr(5,6)/xm*(cir+cir-vr(6,6)*b(6,i)/xm)+vr(6,5)*b(5,i)/xm*(cr+cr-(rotz-132
     2vr(5,5)+vr(5,8))/xm)-vr(6,6)*b(6,i)/xm*(ci+ci-vr(5,6)/xm)+2.*crr/rrotz-133
      eir=br*dir+bi*drr+(vr(5,5)+vr(5,8))/xm*(cir+cir-vr(6,6)*b(6,i)/xm)rotz-134
     1+vr(5,6)/xm*(crr+crr-vr(6,5)*b(5,i)/xm)+vr(6,5)*b(5,i)/xm*(ci+ci-vrotz-135
     2r(5,6)/xm)+vr(6,6)*b(6,i)/xm*(cr+cr-vr(6,5)/xm)+2.d0*cir/r        rotz-136
      p(17,i)=c5r-(1.5d0*(cr*crr-ci*cir)-.5d0*err)*xn                   rotz-137
      p(18,i)=c6r-(1.5d0*(crr*ci+cr*cir)-.5d0*eir)*xn                   rotz-138
      p(21,i)=.5d0*crr*xn/r                                             rotz-139
      p(22,i)=.5d0*cir*xn/r                                             rotz-140
      p(23,i)=0.d0                                                      rotz-141
      p(24,i)=0.d0                                                      rotz-142
      p(25,i)=-.5d0*xn*(c1r*dr-c2r*di-vr(5,5)*b(5,i)/xm)/r**2           rotz-143
    6 p(26,i)=-.5d0*xn*(c1r*di+c2r*dr-vr(5,6)*b(6,i)/xm)/r**2           rotz-144
      return                                                            rotz-145
    7 write (2,1000)                                                    rotz-146
      go to 9                                                           rotz-147
    8 write (2,1001)                                                    rotz-148
    9 write (2,1002)                                                    rotz-149
      stop                                                              rotz-150
 1000 format (40h no vibrational band in rotational model)              rotz-151
 1001 format (35h only first order vibrational model)                   rotz-152
 1002 format (19h in rotz   ... stop)                                   rotz-153
      end                                                               rotz-154
c 05/04/98  ibm version                                         ecis97  copo-000
      subroutine copo(w,v,q,ism,h,l,val,vac,ccz,zt,lt,lz)               copo-001
c computes the coulomb potential of the charge distribution stored in v.copo-002
c input variables: v:   charge distribution unnormalised                copo-003
c                  h:   step size                                       copo-004
c                  ism: number of points                                copo-005
c                  l:   angular momentum, return 0 if l is negative     copo-006
c                  val: product of charges is in val(1)                 copo-007
c                  vac: parameter of charge distribution                copo-008
c                  lt:  logical  .true.  form factor already normalised copo-009
c                         .false.  normalisation stored from the centralcopo-010
c                  lz:  logical  .true. to use the normalisation stored copo-011
c                          even if l=0                                  copo-012
c output variables:w:   form factor which can be at the same place as v copo-013
c                  zt:  normalisation factor                            copo-014
c workspace: q,double precision                                         copo-015
c***********************************************************************copo-016
      double precision q(ism,5),h,rr,c,zt,zz,ccz                        copo-017
      dimension v(1),val(1),w(1)                                        copo-018
      logical lt,lz                                                     copo-019
      if (l.ge.0) go to 2                                               copo-020
      do 1 is=1,ism                                                     copo-021
    1 v(is)=0.                                                          copo-022
      return                                                            copo-023
    2 rr=0.d0                                                           copo-024
      do 3 is=1,ism                                                     copo-025
      rr=rr+h                                                           copo-026
      v(is)=v(is)*(1.d0+vac*rr*rr)                                      copo-027
      q(is,4)=rr**l                                                     copo-028
      q(is,3)=q(is,4)/rr                                                copo-029
      q(is,5)=q(is,4)*rr                                                copo-030
    3 q(is,1)=q(is,5)*rr                                                copo-031
      v(ism)=0.                                                         copo-032
      v(ism-1)=0.                                                       copo-033
      q(1,1)=q(1,1)*v(1)                                                copo-034
      q(ism,2)=0.d0                                                     copo-035
      do 4 is=2,ism                                                     copo-036
      js=ism+1-is                                                       copo-037
      q(is,1)=q(is-1,1)+q(is,1)*v(is)                                   copo-038
    4 q(js,2)=q(js+1,2)+v(js+1)/q(js+1,3)                               copo-039
      c=2*l+1                                                           copo-040
      zz=1.d0/c                                                         copo-041
      if (lt) go to 6                                                   copo-042
      if (l.ne.0.or.lz) go to 5                                         copo-043
      zt=ccz*val(1)/q(ism,1)                                            copo-044
    5 zz=zt*zz                                                          copo-045
    6 c=c*h/12.d0                                                       copo-046
      do 7 is=1,ism                                                     copo-047
    7 w(is)=(q(is,1)/q(is,5)+q(is,2)*q(is,4)+c*v(is))*zz                copo-048
      return                                                            copo-049
      end                                                               copo-050
c 22/04/98  ibm version                                         ecis97  stdp-000
      subroutine stdp(v,ivy,ism,va,nva,nx,idx,x,wv,idmt,pgn,xgn,npp,izz,stdp-001
     1p,aconv,lo)                                                       stdp-002
c computes form factors independently of models                         stdp-003
c input : ivy:     table of form factors  (see redm)                    stdp-004
c         ism:     number of integration steps                          stdp-005
c         va,nva:  for optical model parameters to use here             stdp-006
c         nx:      length of working space                              stdp-007
c         wv:      step size in wv(11,*)                                stdp-008
c         idmt:    length of total working field                        stdp-009
c         npp:     number of optical potentials                         stdp-010
c         pgn,xgn: weights and abscissae of gauss-legendre integration  stdp-011
c         aconv:   value below which the folding is neglected           stdp-012
c         lo:      logical controls                                     stdp-013
c in common /pote1/ see redm                                            stdp-014
c in common /dblpr/ see calc and colf                                   stdp-015
c output: v(ism,1) elastic and inelastic form factors in the sequence   stdp-016
c                  central-real, spin-orbit-real, transition real,      stdp-017
c                  transition spin-orbit-real, imaginary potentials     stdp-018
c                  followed by coulomb, coulomb transition potentials.  stdp-019
c         idx:     length of working field used                         stdp-020
c working space: x(3,i) to compute bound functions, fold coulomb poten- stdp-021
c                  tial and compute rotational form factors and bessel  stdp-022
c                  functions.                                           stdp-023
c         izz,p    for folding                                          stdp-024
c***********************************************************************stdp-025
      logical lo(250),lt(9)                                             stdp-026
      double precision vr(5,2),vs(4),sep,xgn(10),pgn(10),hh,rr,a1,a2,a3,stdp-027
     1a4,a5,a6,an,y(3),pis2,wv(15,1),x(3,22),chi2,chi2m,cm,ck,chb,cmb,ccstdp-028
     2z,xe,xm,xn,zb(77),xz,cl(10)                                       stdp-029
      dimension va(3),nva(3),v(ism,1),ivy(7,1),p(1),izz(4,1),nij(3),itz(stdp-030
     110)                                                               stdp-031
      common /pote1/ itx(16),imax,intc,inls,invc,invd,itxm              stdp-032
      common /dblpr/ chi2,chi2m,cm,ck,chb,cmb,ccz,xe,xm,xn,xz           stdp-033
      equivalence (itx(10),it0),(itx(13),itc),(itx(15),ite),(itx(16),itfstdp-034
     1)                                                                 stdp-035
      data nij /1,24,11/                                                stdp-036
      data pis2 /1.5707963267949/                                       stdp-037
      data itz /6,6,6,6,7,9,6,7,9,9/                                    stdp-038
      data zb /4.49340945790906,7.72525183693771,5.76345919689455,9.0950stdp-039
     11133047635,12.3229409705666,6.98793200050052,10.4171185473794,13.6stdp-040
     2980231532492,16.9236212852138,8.18256145257124,11.7049071545704,15stdp-041
     3.0396647076165,18.3012559595420,21.5254177333999,9.35581211104275,stdp-042
     412.9665301727743,16.3547096393505,19.6531521018212,22.904550647903stdp-043
     57,26.1277501372255,10.5128354080940,14.2073924588425,17.6479748701stdp-044
     6659,20.9834630689448,24.2627680423970,27.5078683649043,30.73038073stdp-045
     716466,11.6570321925164,15.4312892102684,18.9229991985461,22.295348stdp-046
     80191308,25.6028559538106,28.8703733470427,32.1111962396826,35.3331stdp-047
     9941827165,12.7907817119721,16.6410028815122,20.1824707649492,23.59stdp-048
     a12748179830,26.9270407788180,30.2172627093614,33.4768008195015,36.stdp-049
     b7145291272447,39.9361278108677,13.9158226105049,17.8386431992053,2stdp-050
     c1.4284869721154,24.8732139238751,28.2371343599681,31.5501883818318stdp-051
     d,34.8286965376857,38.0824790873276,41.3178646902445,44.53914463340stdp-052
     e95,15.0334693037434,19.0258535361278,22.6627206581361,26.142767643stdp-053
     f3791,29.5346341078439,32.8705345976875,36.1681571359112,39.4382144stdp-054
     g800081,42.6876512846611,45.9212017638356,49.1422214247461,16.14474stdp-055
     h29423013,20.2039426328117,23.8865307559684,27.4012592588663,30.820stdp-056
     i7940864510,34.1794746664832,37.4962736357858,40.7827470981251,44.0stdp-057
     j464252109438,47.2924656052694,50.5245397255712,53.7453428657930/  stdp-058
c meaning of internal logical lt:   lt(1) spin-orbit transition (schroe)stdp-059
c lt(2) spin-orbit potential derivative                                 stdp-060
c lt(3) form factor given by points or bound state                      stdp-061
c lt(4) computation of a coulomb potential from the charge density      stdp-062
c lt(5) zero diffuseness coulomb    lt(6) surface potential             stdp-063
c lt(7) first or second passage in woods-saxon/bessel loop              stdp-064
c lt(8) woods-saxon form factor     lt(9) not symmetric                 stdp-065
      idx=0                                                             stdp-066
      hm=1000.                                                          stdp-067
      nfo=0                                                             stdp-068
      n=4*itxm                                                          stdp-069
      if (lo(100)) n=n-4*itx(7)                                         stdp-070
      do 1 i=1,n                                                        stdp-071
    1 izz(i,1)=0                                                        stdp-072
      if (intc.eq.0) go to 7                                            stdp-073
      ntt=24*npp                                                        stdp-074
      do 6 i=1,intc                                                     stdp-075
      if (lo(100)) go to 4                                              stdp-076
      do 2 j=9,12                                                       stdp-077
      if (lo(112).and.(mod(j,2).eq.0)) go to 2                          stdp-078
      k=itx(j)+i                                                        stdp-079
      izz(3,k)=ivy(7,i)                                                 stdp-080
    2 continue                                                          stdp-081
      k=ivy(3,i)                                                        stdp-082
      if (k.eq.0) go to 3                                               stdp-083
      izz(3,k+itc)=ivy(7,i)                                             stdp-084
      if (lo(14)) izz(3,k+it0)=ivy(7,i)                                 stdp-085
    3 k=ivy(4,i)                                                        stdp-086
      if (k.ne.0) izz(3,k+ite)=ivy(7,i)                                 stdp-087
      k=ivy(5,i)                                                        stdp-088
      if (k.ne.0) izz(3,k+itf)=ivy(7,i)                                 stdp-089
      go to 6                                                           stdp-090
    4 do 5 j=1,11                                                       stdp-091
    5 izz(3,ntt+j)=ivy(7,i)                                             stdp-092
    6 ntt=ntt+11                                                        stdp-093
    7 nma=nva(1)                                                        stdp-094
    8 if (nma.ge.nva(2)) go to 100                                      stdp-095
      i1=nva(nma)                                                       stdp-096
      iv=nva(nma+1)                                                     stdp-097
      itv=mod(i1-1,8)+1                                                 stdp-098
      j1=(i1-1)/8                                                       stdp-99
      itt=itv                                                           stdp-100
      lt(1)=(itv-5)*(itv-6)*(itv-8).eq.0                                stdp-101
      inl=0                                                             stdp-102
      if (j1.gt.npp) itt=itv+8                                          stdp-103
      if (lo(100)) go to 9                                              stdp-104
      ji=1                                                              stdp-105
      ij=1                                                              stdp-106
      if (j1.gt.npp) j1=j1-npp                                          stdp-107
      l1=j1+itx(itt)                                                    stdp-108
      if ((itt.eq.13).or.(itt.eq.14)) inl=inls                          stdp-109
      if (itt.eq.16) inl=invd                                           stdp-110
      if (inl.ne.0) ij=2                                                stdp-111
      go to 12                                                          stdp-112
    9 if (j1.le.npp) go to 10                                           stdp-113
      ji=3                                                              stdp-114
      if (lt(1)) inl=4                                                  stdp-115
      if (itt.eq.16) inl=3                                              stdp-116
      l1=24*npp+11*(j1-npp-1)+itv                                       stdp-117
      go to 11                                                          stdp-118
   10 inl=8                                                             stdp-119
      ji=2                                                              stdp-120
      l1=itv+24*(j1-1)                                                  stdp-121
   11 ij=1+inl/3                                                        stdp-122
   12 if (iv.ne.16) go to 15                                            stdp-123
c form factor copied                                                    stdp-124
      l3=0                                                              stdp-125
      l2=l1+nij(ji)*(nva(nma+3)-i1)/8                                   stdp-126
      do 14 j=1,ij                                                      stdp-127
      do 13 is=1,ism                                                    stdp-128
   13 v(is,l1+l3)=v(is,l2+l3)*va(nma+5)                                 stdp-129
   14 l3=l3+inl                                                         stdp-130
      izz(1,l1)=-nva(nma+2)                                             stdp-131
      izz(2,l1)=izz(2,l2)                                               stdp-132
      izz(4,l1)=izz(4,l2)                                               stdp-133
      go to 99                                                          stdp-134
   15 j=max0(iv,1)                                                      stdp-135
      nmb=nma+itz(j)                                                    stdp-136
      lt(7)=.false.                                                     stdp-137
      if ((iv.ge.7).or.(va(nmb).ne.0.)) go to 18                        stdp-138
c zero form factors and go to next                                      stdp-139
      l2=l1                                                             stdp-140
      do 17 j=1,ij                                                      stdp-141
      do 16 is=1,ism                                                    stdp-142
   16 v(is,l2)=0.                                                       stdp-143
   17 l2=l2+inl                                                         stdp-144
      go to 99                                                          stdp-145
   18 lt(1)=lt(1).and.lo(200)                                           stdp-146
      lt(2)=lt(1).and.(itv.eq.itt).and.(nva(nma+2).eq.0)                stdp-147
      lt(3)=.false.                                                     stdp-148
      lt(4)=itv.gt.6                                                    stdp-149
      lt(8)=(iv.gt.0).and.(iv.lt.7)                                     stdp-150
      k=iabs(nva(nma+4))                                                stdp-151
      hh=wv(11,k)                                                       stdp-152
      h=hh                                                              stdp-153
      hm=amin1(h,hm)                                                    stdp-154
      izz(1,l1)=-nva(nma+2)                                             stdp-155
      izz(2,l1)=itt                                                     stdp-156
      izz(4,l1)=k                                                       stdp-157
      if (nva(nma+2).eq.0) go to 19                                     stdp-158
      ij=1                                                              stdp-159
      nfo=nfo+1                                                         stdp-160
   19 l=izz(3,l1)                                                       stdp-161
      ji=ij                                                             stdp-162
      if (lt(2)) ji=ji+1                                                stdp-163
      if ((iv.gt.0).and.(iv.lt.9)) go to 22                             stdp-164
      ap=va(nmb)                                                        stdp-165
      if (iv.ge.9) go to 27                                             stdp-166
      lt(2)=lt(2).and.(nva(nma+3).ne.0)                                 stdp-167
      lt(4)=lt(4).and.((nva(nma+3).ne.0))                               stdp-168
c form factor interpolated                                              stdp-169
      call intp(-iv,ism,h*va(nmb+1),va(nmb),va(nmb+2),v,l1)             stdp-170
      if (ij.eq.1) go to 25                                             stdp-171
   20 l2=l1                                                             stdp-172
      do 21 j=2,ij                                                      stdp-173
      call deri(v(1,l2+inl),v(1,l2),h,ism,.true.)                       stdp-174
   21 l2=l2+inl                                                         stdp-175
      if (iv.gt.0) go to 97                                             stdp-176
      go to 25                                                          stdp-177
   22 if (lt(8)) go to 31                                               stdp-178
c bound state form factor                                               stdp-179
      k=nva(nmb-1)                                                      stdp-180
      ivm=nva(nmb-2)                                                    stdp-181
      ivx=iv                                                            stdp-182
      jv=0                                                              stdp-183
      nmc=nmb+5                                                         stdp-184
      if (k.eq.1) go to 23                                              stdp-185
      jv=ism                                                            stdp-186
      if (jv.gt.nx) call memo(idmt,idmt+jv-nx,nx,3,lo)                  stdp-187
      if (lo(216)) go to 103                                            stdp-188
      idx=idx-jv                                                        stdp-189
      call stbf(p,nva(nmb),ism,va(nmc+5),ivm,nx-jv,idx,x(jv+1,1),idmt,ivstdp-190
     1x,hh,izz(4*itxm+jv+1,1),lo)                                       stdp-191
      nmc=nmc+10*ivx-64                                                 stdp-192
      if (k.eq.3) ivx=ivx-1                                             stdp-193
      nmb=nmb+4                                                         stdp-194
   23 call stbf(v(1,l1),nva(nmb),ism,va(nmc),ivm,nx-jv,idx,x(jv+1,1),idmstdp-195
     1t,ivx,hh,izz(4*itxm+jv+1,1),lo)                                   stdp-196
      if (k.eq.1) go to 99                                              stdp-197
      idx=idx+jv                                                        stdp-198
      do 24 is=1,ism                                                    stdp-199
   24 v(is,l1)=v(is,l1)*p(is)*va(nmb+5)                                 stdp-200
      go to 99                                                          stdp-201
   25 lt(3)=.true.                                                      stdp-202
      if (.not.lt(2).or.lt(4)) go to 26                                 stdp-203
      idx=max0(idx,ism)                                                 stdp-204
      if (idx.gt.nx) call memo(idmt,idmt+idx-nx,nx,3,lo)                stdp-205
      if (lo(216)) go to 103                                            stdp-206
      call deri(p,v(1,l1),h,ism,.true.)                                 stdp-207
   26 if (lt(2).or.(nva(nma+3).ne.0)) go to 48                          stdp-208
      if (ij.eq.1) go to 99                                             stdp-209
      go to 97                                                          stdp-210
c bessel expansion                                                      stdp-211
   27 nmc=nmb+1                                                         stdp-212
      l2x=nva(nma+5)                                                    stdp-213
      ll=nva(nma+6)                                                     stdp-214
      if (iv.eq.9) go to 28                                             stdp-215
      jl=nva(nma+7)                                                     stdp-216
      lj=ji+jl-1                                                        stdp-217
      if (va(nmc).eq.0.) va(nmc)=1.                                     stdp-218
      go to 48                                                          stdp-219
   28 lj=ll+ji+nva(nma+7)                                               stdp-220
      idx=max0(idx,6*max0(l2x,lj))                                      stdp-221
      if (idx.gt.nx) call memo(idmt,idmt+idx-nx,nx,3,lo)                stdp-222
      if (lo(216)) go to 103                                            stdp-223
c computation of zeros of bessel functions - the l+1 zeros for l=1 to   stdp-224
c l=11 are in data zb. the others are computed with mc mahon's formula  stdp-225
c page 371, handbook of math. functions, abramovitz and stegun          stdp-226
      if (va(nmc).eq.0.) va(nmc)=ism*h                                  stdp-227
      do 30 ii=1,l2x                                                    stdp-228
      if ((ll.ne.0).and.((ll.lt.12).and.(ii.le.ll+1))) go to 29         stdp-229
      x(1,ii)=(2*ii+ll)*pis2                                            stdp-230
      if (ll.eq.0) go to 30                                             stdp-231
      a1=2.d0*x(1,ii)                                                   stdp-232
      a2=ll*(ll+1)                                                      stdp-233
      x(1,ii)=x(1,ii)-a2*(1.d0+(7.d0*a2-6.d0+((166.d0*a2-408.d0)*a2+360.stdp-234
     1d0+(((6949.d0*a2-33252.d0)*a2+81180.d0)*a2-75600.d0)/(7.d0*a1**2))stdp-235
     2/(5.d0*a1**2))/(3.d0*a1**2))/a1                                   stdp-236
      go to 30                                                          stdp-237
   29 k=(ll*(ll+1))/2+ii-1                                              stdp-238
      x(1,ii)=zb(k)                                                     stdp-239
   30 x(1,ii)=x(1,ii)/va(nmc)                                           stdp-240
      lm=ll+1                                                           stdp-241
      lt(6)=lt(2).and.(nva(nma+3).eq.0)                                 stdp-242
      go to 48                                                          stdp-243
c woods-saxon and its derivatives to some power                         stdp-244
   31 nmc=nmb+4                                                         stdp-245
      lt(5)=((va(nmb+2).eq.0.).and.lt(4))                               stdp-246
      lt(4)=((va(nmb+2).ne.0.).and.lt(4))                               stdp-247
      lt(6)=(((itv.eq.3).or.(itv.eq.4)).and.lo(200))                    stdp-248
      lt(9)=lo(109).or.(va(nmb+1).ge.0.).or.lt(5)                       stdp-249
      if (itv.gt.6) nmc=nmc+1                                           stdp-250
      if (lt(5)) go to 32                                               stdp-251
      sep=dexp(hh/dble(va(nmb+2)))                                      stdp-252
      if (va(nmb+2).gt.0.02*h)  go to 33                                stdp-253
      write (2,1000) va(nmb+2),nma,i                                    stdp-254
      va(nmb+2)=amax1(-va(nmb+2),0.02*h)                                stdp-255
      go to 33                                                          stdp-256
   32 if (va(nmb+1).ge.h) go to 33                                      stdp-257
      write (2,1001) va(nmb+1),nma,i                                    stdp-258
      va(nmb+1)=amax1(-va(nmb+1),h)                                     stdp-259
   33 if (iv.le.4) go to 44                                             stdp-260
c initialisation of do loops for deformed potentials                    stdp-261
      iqm=nva(nma+5)                                                    stdp-262
      ix=20                                                             stdp-263
      iq=max0(l,iqm)                                                    stdp-264
      if (iv.eq.6) iq=max0(iq,nva(nma+5))                               stdp-265
      idx=max0(idx,6*iq+240)                                            stdp-266
      if (idx.gt.nx) call memo(idmt,idmt+idx-nx,nx,3,lo)                stdp-267
      if (lo(216)) go to 103                                            stdp-268
      a2=0.d0                                                           stdp-269
      a1=1.d0                                                           stdp-270
      if (lo(6)) a1=abs(va(nmb+1))                                      stdp-271
      do 34 i=1,iqm                                                     stdp-272
      a4=2*i+1                                                          stdp-273
   34 x(1,40+i)=va(nmc+i-1)*dsqrt(a4/(8.d0*pis2))/a1                    stdp-274
      do 43 ii=1,20                                                     stdp-275
      i=1+mod(ii-1,10)                                                  stdp-276
      x(2,22)=xgn(i)                                                    stdp-277
      if (i.ne.ii) x(2,22)=-x(2,22)                                     stdp-278
      x(2,21)=1.d0                                                      stdp-279
      do 35 j=2,iq                                                      stdp-280
      a4=j                                                              stdp-281
   35 x(2,j+21)=((2.d0*a4-1.d0)*x(2,22)*x(2,j+20)+(1.d0-a4)*x(2,j+19))/astdp-282
     14                                                                 stdp-283
      x(3,ii+20)=0.5d0*pgn(i)                                           stdp-284
      x(2,ii)=0.d0                                                      stdp-285
      a5=x(2,l+21)                                                      stdp-286
      if (iv.eq.5) go to 40                                             stdp-287
      kl=nva(nma+6)                                                     stdp-288
      if (nva(nma+7).ne.0) go to 36                                     stdp-289
      a5=a5*x(2,kl+21)*dsqrt(2.d0*kl+1.d0)                              stdp-290
      go to 40                                                          stdp-291
c computation of y(l,kk) * y(kl,kk)                                     stdp-292
   36 a5=dsqrt(2.d0*kl+1.d0)                                            stdp-293
      kk=nva(nma+7)                                                     stdp-294
      do 37 n=1,kk                                                      stdp-295
   37 a5=a5*(1.d0-xgn(i)**2)*(2*n-1)**2/dsqrt((kl+n)*(l+n)*(kl-n+1.d0)*(stdp-296
     1l-n+1.d0))                                                        stdp-297
      kz=l-kk                                                           stdp-298
      do 39 j=1,2                                                       stdp-299
      if (kz.le.0) go to 39                                             stdp-300
      a4=0.d0                                                           stdp-301
      do 38 k=1,kz                                                      stdp-302
      a3=a4                                                             stdp-303
      a4=a5                                                             stdp-304
   38 a5=a3+(a4*x(2,22)-a3)*(2.d0*(kk+k)-1.d0)/k                        stdp-305
   39 kz=kl-kk                                                          stdp-306
   40 x(3,ii)=x(3,ii+20)*a5*dsqrt(2.d0*l+1.d0)                          stdp-307
      rr=1.d0                                                           stdp-308
      do 41 k=1,iqm                                                     stdp-309
   41 rr=rr+x(1,40+k)*x(2,k+21)                                         stdp-310
      x(2,ii)=-rr*va(nmb+1)                                             stdp-311
      x(1,ii)=0.d0                                                      stdp-312
      x(1,20+ii)=1.d-16                                                 stdp-313
      if (lt(9)) go to 42                                               stdp-314
      x(2,ii)=-x(2,ii)                                                  stdp-315
      if (x(2,ii).gt.-36.*va(nmb+2)) x(1,20+ii)=dexp(x(2,ii)/dble(va(nmbstdp-316
     1+2)))                                                             stdp-317
   42 if (.not.lt(5)) go to 43                                          stdp-318
      x(2,ii)=dabs(x(2,ii))                                             stdp-319
      a2=a2+x(2,ii)**3*x(3,20+ii)                                       stdp-320
   43 continue                                                          stdp-321
      go to 46                                                          stdp-322
c initialisation of do loops for not deformed potentials                stdp-323
   44 iqm=0                                                             stdp-324
      ix=1                                                              stdp-325
      idx=max0(idx,126)                                                 stdp-326
      if (idx.gt.nx) call memo(idmt,idmt+idx-nx,nx,3,lo)                stdp-327
      if (lo(216)) go to 103                                            stdp-328
      x(1,1)=0.d0                                                       stdp-329
      x(2,1)=-va(nmb+1)                                                 stdp-330
      x(3,1)=1.d0                                                       stdp-331
      x(3,21)=1.d0                                                      stdp-332
      x(1,21)=1.d-16                                                    stdp-333
      if (lt(9)) go to 45                                               stdp-334
      x(2,1)=-x(2,1)                                                    stdp-335
      if (x(2,1).gt.-36.*va(nmb+2)) x(1,21)=dexp(x(2,1)/dble(va(nmb+2)))stdp-336
   45 if (.not.lt(5)) go to 46                                          stdp-337
      x(2,1)=-x(2,1)                                                    stdp-338
      a2=x(2,1)**3                                                      stdp-339
   46 iv1=1+mod(iv-1,4)                                                 stdp-340
      ap=va(nmb)                                                        stdp-341
      an=va(nmb+1)                                                      stdp-342
      if (lo(6)) an=an/abs(va(nmb+1))                                   stdp-343
      if (.not.lt(9)) an=-an                                            stdp-344
      if (iv1.gt.1) ap=ap*an/dsqrt(8.d0*pis2)                           stdp-345
      if (iv1.gt.2) ap=ap*an*0.5d0                                      stdp-346
      if (iv1.gt.3) ap=ap*an/3.d0                                       stdp-347
      if (va(nmb+3).gt.-1.) go to 47                                    stdp-348
      write (2,1002) va(nmb+3),nma                                      stdp-349
      va(nmb+3)=-.8                                                     stdp-350
   47 a1=va(nmb+3)                                                      stdp-351
      a5=l+1                                                            stdp-352
      iv2=iv1                                                           stdp-353
      iv3=iv2-1                                                         stdp-354
      iv2=iv3+ji                                                        stdp-355
      if (lt(6)) iv2=iv2+1                                              stdp-356
      if (itv.gt.6) ap=ap*ccz                                           stdp-357
      if (lt(5)) ap=ap/a2                                               stdp-358
   48 if (lt(4)) ji=1                                                   stdp-359
      rr=0.d0                                                           stdp-360
      an=0.d0                                                           stdp-361
      a6=0.d0                                                           stdp-362
      do 90 is=1,ism                                                    stdp-363
      rr=rr+hh                                                          stdp-364
      if (lt(3)) go to 89                                               stdp-365
      do 49 i=1,3                                                       stdp-366
   49 y(i)=0.d0                                                         stdp-367
      if (iv.ge.9) go to 70                                             stdp-368
c integration loop                                                      stdp-369
      do 69 i=1,ix                                                      stdp-370
      if (lt(5)) go to 60                                               stdp-371
      if (x(1,i).ne.0.d0) go to 50                                      stdp-372
      x(2,i)=x(2,i)+hh                                                  stdp-373
      if (x(2,i)+50.d0*va(nmb+2).gt.0.d0) x(1,i)=dexp(x(2,i)/dble(va(nmbstdp-374
     1+2)))                                                             stdp-375
      go to 51                                                          stdp-376
   50 if (x(1,i).lt.1.d15) x(1,i)=x(1,i)*sep                            stdp-377
   51 if ((.not.lt(9)).and.x(1,i+20).gt.1.d-15) x(1,i+20)=x(1,i+20)/sep stdp-378
      j=i                                                               stdp-379
      k=1                                                               stdp-380
   52 vr(1,k)=1.d0/(1.d0+x(1,j))                                        stdp-381
      if (iv2.eq.1) go to 53                                            stdp-382
      a2=vr(1,k)/va(nmb+2)                                              stdp-383
      vr(2,k)=vr(1,k)*a2*x(1,j)                                         stdp-384
      if (iv2.gt.2) vr(3,k)=vr(2,k)*a2*(x(1,j)-1.d0)                    stdp-385
      if (iv2.gt.3) vr(4,k)=vr(2,k)*(x(1,j)**2-4.d0*x(1,j)+1.d0)*a2*a2  stdp-386
      if (iv2.gt.4) vr(5,k)=vr(3,k)*(x(1,j)**2-10.d0*x(1,j)+1.d0)*a2*a2 stdp-387
   53 if (a1.eq.0.d0) go to 54                                          stdp-388
      if (iv2.gt.4) vr(5,k)=(a1+1.d0)*(a1*(a1-1.d0)*((a1-2.d0)*vr(2,k)**stdp-389
     12+6.d0*vr(1,k)*vr(3,k))*vr(2,k)**2+a1*vr(1,k)**2*(3.d0*vr(3,k)**2+stdp-390
     24.d0*vr(2,k)*vr(4,k))+vr(1,k)**3*vr(5,k))*vr(1,k)**(a1-3.d0)      stdp-391
      if (iv2.gt.3) vr(4,k)=(a1+1.d0)*(a1*((a1-1.d0)*vr(2,k)**2+3.d0*vr(stdp-392
     11,k)*vr(3,k))*vr(2,k)+vr(1,k)**2*vr(4,k))*vr(1,k)**(a1-2.d0)      stdp-393
      if (iv2.gt.2) vr(3,k)=(a1+1.d0)*(a1*vr(2,k)**2+vr(3,k)*vr(1,k))*vrstdp-394
     1(1,k)**(a1-1.d0)                                                  stdp-395
      if (iv2.gt.1) vr(2,k)=(a1+1.d0)*vr(1,k)**a1*vr(2,k)               stdp-396
      vr(1,k)=vr(1,k)**(a1+1.d0)                                        stdp-397
   54 if (.not.lt(9)) go to 55                                          stdp-398
      if (lt(6)) vr(iv1,1)=vr(iv2,1)*4.d0*va(nmb+2)                     stdp-399
      go to 58                                                          stdp-400
   55 j=j+20                                                            stdp-401
      k=k+1                                                             stdp-402
      if (k.eq.2) go to 52                                              stdp-403
      if (lo(200).or.(ij.ne.3)) go to 56                                stdp-404
      vr(3,1)=vr(1,1)*vr(3,2)-2.d0*vr(2,1)*vr(2,2)+vr(3,1)*vr(1,2)      stdp-405
      vr(2,1)=vr(2,1)*vr(1,2)-vr(1,1)*vr(2,2)                           stdp-406
      go to 57                                                          stdp-407
   56 if (iv2.gt.4) vs(4)=vr(1,1)*vr(5,2)+2.d0*vr(2,1)*vr(4,2)-2.d0*vr(4stdp-408
     1,1)*vr(2,2)-vr(5,1)*vr(1,2)                                       stdp-409
      if (iv2.gt.3) vs(3)=vr(1,1)*vr(4,2)+vr(2,1)*vr(3,2)-vr(3,1)*vr(2,2stdp-410
     1)-vr(4,i)*vr(1,2)                                                 stdp-411
      if (iv2.gt.2) vs(2)=vr(1,1)*vr(3,2)-vr(3,1)*vr(1,2)               stdp-412
      vs(1)=vr(1,1)*vr(2,2)-vr(2,1)*vr(1,2)                             stdp-413
      if (iv2.gt.4) vr(5,1)=vr(1,1)*vr(5,2)+4.d0*vr(2,1)*vr(4,2)+6.d0*vrstdp-414
     1(3,1)*vr(3,2)+4.d0*vr(4,1)*vr(2,2)+vr(5,1)*vr(1,2)                stdp-415
      if (iv2.gt.3) vr(4,1)=vr(1,1)*vr(4,2)+3.d0*vr(2,1)*vr(3,2)+3.d0*vrstdp-416
     1(3,1)*vr(2,2)+vr(4,1)*vr(1,2)                                     stdp-417
      if (iv2.gt.2) vr(3,1)=vr(1,1)*vr(3,2)+2.d0*vr(2,1)*vr(2,2)+vr(3,1)stdp-418
     1*vr(1,2)                                                          stdp-419
      if (iv2.gt.1) vr(2,1)=vr(1,1)*vr(2,2)+vr(2,1)*vr(1,2)             stdp-420
   57 vr(1,1)=vr(1,1)*vr(1,2)                                           stdp-421
      if (lt(6)) vr(iv1,1)=rr*(4.d0*va(nmb+2)**(a1+1.d0))/va(nmb+1)*vs(istdp-422
     1v1)                                                               stdp-423
      if (lt(1)) vr(iv3+2,1)=-vs(iv3+1)                                 stdp-424
   58 if (lt(4)) a6=a6+vr(1,1)*rr**2*x(3,i+20)*(1.d0+va(nmb+4)*rr**2)   stdp-425
      do 59 j=1,ji                                                      stdp-426
   59 y(j)=y(j)+vr(iv3+j,1)*x(3,i)                                      stdp-427
      go to 69                                                          stdp-428
c deformed coulomb potential                                            stdp-429
   60 a4=x(2,i)/rr                                                      stdp-430
      if (itv.ne.itt) go to 62                                          stdp-431
      if (a4.gt.1.d0) go to 61                                          stdp-432
      y(1)=y(1)+(x(2,i)**2)*a4*x(3,i)                                   stdp-433
      y(2)=y(2)+x(2,i)*a4**2*x(3,i)                                     stdp-434
      y(3)=y(3)+2.d0*a4**3*x(3,i)                                       stdp-435
      go to 69                                                          stdp-436
   61 y(1)=y(1)+(0.5d0*x(2,i)*x(2,i)-rr*rr/6.d0)*x(3,i)*3.d0            stdp-437
      y(2)=y(2)+rr*x(3,i)                                               stdp-438
      y(3)=y(3)-x(3,i)                                                  stdp-439
      go to 69                                                          stdp-440
   62 if (a4.gt.1.d0) go to 63                                          stdp-441
      a3=(x(2,i)**2)*(a4**(l+1))*3.d0/((a5+2.d0)*(2.d0*a5-1.d0))        stdp-442
      if (iv1.gt.1) a3=a3*(a5+2.d0)/x(2,i)                              stdp-443
      if (iv1.gt.2) a3=a3*(a5+1.d0)/x(2,i)                              stdp-444
      if (iv1.gt.3) a3=a3*a5/x(2,i)                                     stdp-445
      go to 65                                                          stdp-446
   63 if (l.ne.2) go to 64                                              stdp-447
      if (iv1.eq.1) a3=rr*rr*(0.2d0+dlog(a4))*0.6d0                     stdp-448
      if (iv1.ge.2) a3=0.6d0*rr/a4                                      stdp-449
      if (iv1.ge.3) a3=-a3/x(2,i)                                       stdp-450
      if (iv1.ge.4) a3=-2.d0*a3/x(2,i)                                  stdp-451
      go to 65                                                          stdp-452
   64 if (iv1.eq.1) a3=rr*rr*(1.d0/(a5+2.d0)-1.d0/(a4**(l-2)*(2.d0*a5-1.stdp-453
     1d0)))*3.d0/(a5-3.d0)                                              stdp-454
      if (iv1.ge.2) a3=rr/a4**(l-1)*3.d0/(2.d0*a5-1.d0)                 stdp-455
      if (iv1.ge.3) a3=-a3*(a5-2.d0)/x(2,i)                             stdp-456
      if (iv1.eq.4) a3=-a3*(a5-1.d0)/x(2,i)                             stdp-457
   65 y(1)=y(1)+a3*x(3,i)                                               stdp-458
      if (ji.eq.1) go to 69                                             stdp-459
      if (a4.gt.1.d0) go to 66                                          stdp-460
      a3=-a5*a3/rr                                                      stdp-461
      go to 68                                                          stdp-462
   66 if (l.ne.2) go to 67                                              stdp-463
      if (iv2.eq.1) a3=-1.2d0*(0.3d0*rr-dlog(a4))*rr                    stdp-464
      if (iv2.ge.2) a3=2.d0*a3/rr                                       stdp-465
      go to 68                                                          stdp-466
   67 if (iv2.eq.1) a3=(2.d0/(a5+2.d0)-(a5-1.d0)/(a4**(l-2)*(2.d0*a5-1.dstdp-467
     10)))*3.d0/(a5-3.d0)*rr                                            stdp-468
      if (iv2.ne.1) a3=(a5-1.d0)*a3/rr                                  stdp-469
   68 y(2)=y(2)-a3*x(3,i)                                               stdp-470
   69 continue                                                          stdp-471
      go to 87                                                          stdp-472
c computation of bessel functions                                       stdp-473
   70 if (iv.gt.9) go to 79                                             stdp-474
      if (rr.gt.va(nmc)) go to 90                                       stdp-475
      do 78 ii=1,l2x                                                    stdp-476
      a1=rr*x(1,ii)                                                     stdp-477
      x(2,1)=dsin(a1)/a1                                                stdp-478
      if (lj.eq.1) go to 75                                             stdp-479
      k=1.d0+a1                                                         stdp-480
      if (k.lt.lj) go to 72                                             stdp-481
      x(2,2)=(x(2,1)-dcos(a1))/a1                                       stdp-482
      if (lj.eq.2) go to 75                                             stdp-483
      do 71 j=3,lj                                                      stdp-484
   71 x(2,j)=(2*j-3)*x(2,j-1)/a1-x(2,j-2)                               stdp-485
      go to 75                                                          stdp-486
   72 a3=lj                                                             stdp-487
      a4=dmax1(dsqrt(10.5d0*a1)-0.5d0,a3)                               stdp-488
      k=a4+3.d0+21.d0*a1/(a4+a4+1.d0)                                   stdp-489
      a2=0.d0                                                           stdp-490
   73 a2=a1/(2.d0*k+1.d0-a2*a1)                                         stdp-491
      if (k.le.lj) x(2,k+1)=a2                                          stdp-492
      k=k-1                                                             stdp-493
      if (k.ge.1) go to 73                                              stdp-494
      do 74 k=2,lj                                                      stdp-495
   74 x(2,k)=x(2,k)*x(2,k-1)                                            stdp-496
c computation of derivatives of bessel functions (- derivative)         stdp-497
   75 jl=lj-1                                                           stdp-498
      do 77 j=lm,lj                                                     stdp-499
      kk=ji+j-lj                                                        stdp-500
      if (kk.ge.1) y(kk)=y(kk)+va(nmc+ii)*x(2,lm)                       stdp-501
      if (kk.eq.ji) go to 78                                            stdp-502
      a3=0.d0                                                           stdp-503
      a5=0.d0                                                           stdp-504
      do 76 k=1,jl                                                      stdp-505
      a2=(a5+1.d0)*x(2,k+1)-a5*a3                                       stdp-506
      a3=x(2,k)                                                         stdp-507
      x(2,k)=x(1,ii)*a2/(2.d0*a5+1.d0)                                  stdp-508
   76 a5=a5+1.d0                                                        stdp-509
   77 jl=jl-1                                                           stdp-510
   78 continue                                                          stdp-511
      go to 87                                                          stdp-512
c computation of laguerre polynomials x**ll l(2x**2) dexp(-x**2)        stdp-513
   79 do 86 j=1,l2x,2                                                   stdp-514
      if (j.ne.1) go to 80                                              stdp-515
      a1=rr/va(nmc)                                                     stdp-516
      a2=2.d0*a1*a1                                                     stdp-517
      cl(1)=a1**ll*dexp(-a1*a1)                                         stdp-518
      cl(2)=(ll+1.5d0-a2)*cl(1)                                         stdp-519
      go to 81                                                          stdp-520
   80 cl(1)=(cl(2)*(ll+2*j-2.5d0-a2)-cl(1)*(ll+j-1.5d0))/dfloat(j-1)    stdp-521
      cl(2)=(cl(1)*(ll+2*j-0.5d0-a2)-cl(2)*(ll+j-0.5d0))/dfloat(j)      stdp-522
   81 if (jl.ne.0) go to 82                                             stdp-523
      y(1)=y(1)+cl(1)*va(nmc+j)                                         stdp-524
      if (j.lt.l2x) y(1)=y(1)+cl(2)*va(nmc+j+1)                         stdp-525
   82 if (lj.eq.0) go to 86                                             stdp-526
      do 83 l=5,8                                                       stdp-527
   83 cl(l)=0.d0                                                        stdp-528
c -derivative of laguerre polynomials x**ll l(2x**2) dexp(-x**2)        stdp-529
      do 85 k=1,lj                                                      stdp-530
      do 84 l=3,8                                                       stdp-531
   84 cl(l)=cl(l+2)                                                     stdp-532
      cl(9)=((ll+2*j+k-a2)*cl(7)-2*j*cl(8)-2*(k-1)*(k-2)*cl(3))/a1+4*(k-stdp-533
     11)*cl(5)                                                          stdp-534
      cl(10)=-((ll+2*j+1-k-a2)*cl(8)-(2*j+1+2*ll)*cl(7)-2*(k-1)*(k-2)*clstdp-535
     1(4))/a1-4*(k-1)*cl(6)                                             stdp-536
      if (k.lt.jl) go to 86                                             stdp-537
      y(k+1-jl)=y(k+1-jl)+cl(9)*va(nmc+j)                               stdp-538
      if (j.lt.l2x) y(k+1-jl)=y(k+1-jl)+cl(10)*va(nmc+j+1)              stdp-539
   85 continue                                                          stdp-540
   86 continue                                                          stdp-541
   87 l2=l1                                                             stdp-542
      do 88 j=1,ji                                                      stdp-543
      v(is,l2)=ap*y(j)                                                  stdp-544
   88 l2=l2+inl                                                         stdp-545
      go to 90                                                          stdp-546
   89 y(1)=v(is,l1)/ap                                                  stdp-547
      if (lt(2).and.(.not.lt(4))) v(is,l1)=p(is)                        stdp-548
   90 an=an+ap*y(1)*rr**(l+2)                                           stdp-549
      if (lt(7)) go to 97                                               stdp-550
      if (.not.lt(4)) go to 92                                          stdp-551
c folding of charge distribution with coulomb potential                 stdp-552
      idx=max0(idx,10*ism)                                              stdp-553
      if (idx.gt.nx) call memo(idmt,idmt+idx-nx,nx,3,lo)                stdp-554
      if (lo(216)) go to 103                                            stdp-555
      a7=0.                                                             stdp-556
      if (lt(8)) a7=va(nmb+4)                                           stdp-557
      call copo(v(1,l1),v(1,l1),x,ism,hh,l,ap,a7,ccz,a6,.true.,.false.) stdp-558
      if (a6.eq.0.d0) a6=dabs(v(ism,l1)*(2*l+1)*(ism*hh)**(l+1)/(ccz*va(stdp-559
     1nmb)))                                                            stdp-560
      do 91 is=1,ism                                                    stdp-561
   91 v(is,l1)=v(is,l1)/a6                                              stdp-562
   92 if (nva(nma+3).eq.0) go to 96                                     stdp-563
      an=dabs(an*hh/ap)                                                 stdp-564
      if (itv.gt.6) an=dabs(v(ism,l1)*(2*l+1)*(ism*hh)**(l+1)/(ccz*va(nmstdp-565
     1b)))                                                              stdp-566
      if (lt(2).and.(itt.eq.8).and.(nva(nma+2).eq.0).and.(va(nmb+2).eq.0stdp-567
     1.).and.lt(8)) an=an*hh*ism                                        stdp-568
      if (nva(nma+3).gt.0) go to 93                                     stdp-569
      nva(nma+3)=-nva(nma+3)                                            stdp-570
      ap=va(nmb)                                                        stdp-571
      va(nmb)=ap*an                                                     stdp-572
      write (2,1003) ap,va(nmb),itt,j1                                  stdp-573
      go to 96                                                          stdp-574
   93 l2=l1                                                             stdp-575
      do 95 j=1,ij                                                      stdp-576
      do 94 is=1,ism                                                    stdp-577
   94 v(is,l2)=v(is,l2)/an                                              stdp-578
   95 l2=l2+inl                                                         stdp-579
   96 if (.not.lt(4)) go to 97                                          stdp-580
      lt(4)=.false.                                                     stdp-581
      lt(7)=.true.                                                      stdp-582
      if (lt(2)) go to 25                                               stdp-583
      if (ij.ne.1) go to 20                                             stdp-584
   97 if (.not.lt(1).or.(nva(nma+2).ne.0)) go to 99                     stdp-585
      rr=0.d0                                                           stdp-586
      do 98 is=1,ism                                                    stdp-587
      rr=rr+h                                                           stdp-588
      a1=v(is,l1+inl)                                                   stdp-589
      v(is,l1+inl)=-v(is,l1)/rr**2                                      stdp-590
   98 v(is,l1)=a1/rr                                                    stdp-591
   99 nma=nva(2*i1-13)+1                                                stdp-592
      go to 8                                                           stdp-593
  100 if (nfo.eq.0) return                                              stdp-594
c folding                                                               stdp-595
      nnf=ism*itxm+1                                                    stdp-596
      if (lo(100)) nnf=nnf-ism*itx(7)                                   stdp-597
      do 101 i=1,nnf                                                    stdp-598
  101 p(i)=0                                                            stdp-599
      n1=nva(2)                                                         stdp-600
      n2=nva(3)                                                         stdp-601
      ist=0                                                             stdp-602
      do 102 n=n1,n2,3                                                  stdp-603
      is=5+ism+2.*(abs(va(n+1))+2.*abs(va(n+2)))/hm                     stdp-604
      if (va(n)*va(n+1).eq.0.) is=ism+5                                 stdp-605
  102 ist=max0(is,ist)                                                  stdp-606
      idy=nnf+2*ist*(imax+1)                                            stdp-607
      idx=max0(idy,idx)                                                 stdp-608
      if (idx.gt.nx) call memo(idmt,idmt+idx-nx,nx,3,lo)                stdp-609
      if (lo(216)) go to 103                                            stdp-610
      n3=(n2+1-n1)/3                                                    stdp-611
      call fold(v,p,va(n1),n3,1,ism,ist,aconv,ivy,intc,p(nnf),pgn,xgn,wvstdp-612
     1,izz,lo)                                                          stdp-613
      return                                                            stdp-614
  103 write (2,1004) idx,nx                                             stdp-615
      stop                                                              stdp-616
 1000 format (24h too small diffuseness =,e15.8,47h   changed into minimstdp-617
     1um value in stdp for nma =,i5,8h and i =,i2)                      stdp-618
 1001 format (27h too small coulomb radius =,e15.8,47h   changed into mistdp-619
     1nimum value in stdp for nma =,i5,8h and i =,i2)                   stdp-620
 1002 format (9h power 1+,e15.6,25h  changed to .2 for nma =,i4)        stdp-621
 1003 format (9h strength,e15.6,25h replaced by the integral,e15.6,20h fstdp-622
     1or the form factor,i4,17h of the potential,i4)                    stdp-623
 1004 format (32h working field too small in stdp/17h field requested:,istdp-624
     110,20x,17h field available:,i10)                                  stdp-625
      end                                                               stdp-626
c 22/04/98  ibm version                                         ecis97  stbf-000
      subroutine stbf(v,ivx,ism,va,ivm,nx,idx,xx,idmt,iv,h,iex,lo)      stbf-001
c computes bound state form factors                                     stbf-002
c input : ivx:  table of quantum numbers                                stbf-003
c         ism:  number of integration steps                             stbf-004
c         va:   for optical model parameters to use here                stbf-005
c         ivm:  step factor for woods-saxon wave functions              stbf-006
c         nx:   length of working space                                 stbf-007
c         idmt: length of total working field                           stbf-008
c         lo:   logical controls                                        stbf-009
c output: v(ism):  bound state wave function                            stbf-010
c         idx:  length of working field used                            stbf-011
c working space: xx(3,i): to compute bound functions                    stbf-012
c                iex: for coulomb function, in equivalence with xx      stbf-013
c***********************************************************************stbf-014
      double precision h,rr,a1,a2,a3,a4,a5,a6,x1,x2,x3,x4,x5,xx,y1,y2,y3stbf-015
     1,y4,y5,chi2,chi2m,cm,ck,chb,cmb,ccz,xe,xm,xn,xz,z1,z2,z3,z4       stbf-016
      logical lo(250)                                                   stbf-017
      dimension va(11),v(1),ivx(4),xx(3,1),iex(1)                       stbf-018
      common /dblpr/ chi2,chi2m,cm,ck,chb,cmb,ccz,xe,xm,xn,xz           stbf-019
      l=ivx(2)                                                          stbf-020
      if (iv.eq.8) go to 7                                              stbf-021
      n=ivx(1)                                                          stbf-022
c computation of the normalisation of laguerre polynomials              stbf-023
      a1=2.256758334191d0                                               stbf-024
      a3=l                                                              stbf-025
      if (l.eq.0) go to 2                                               stbf-026
      do 1 i=1,l                                                        stbf-027
    1 a1=a1/(i+.5d0)                                                    stbf-028
    2 if (n.eq.0) go to 4                                               stbf-029
      do 3 i=1,n                                                        stbf-030
      a2=i                                                              stbf-031
    3 a1=a1*(a2+a3+.5d0)/a2                                             stbf-032
    4 a1=dsqrt(a1)                                                      stbf-033
c computation of laguerre polynomials                                   stbf-034
      rr=0.d0                                                           stbf-035
      do 6 is=1,ism                                                     stbf-036
      rr=rr+h                                                           stbf-037
      x1=(va(1)*rr)**2                                                  stbf-038
      x3=a1*dexp(.5d0*(a3*dlog(x1)-x1))                                 stbf-039
      if (n.eq.0) go to 6                                               stbf-040
      x2=x3                                                             stbf-041
      do  5 i=1,n                                                       stbf-042
      x2=2.d0*x2*(i-n-1)*x1/(i*(2.d0*(a3+i)+1.d0))                      stbf-043
    5 x3=x3+x2                                                          stbf-044
    6 v(is)=x3                                                          stbf-045
      return                                                            stbf-046
c bound state in woods-saxon potential                                  stbf-047
c control of storage and step size                                      stbf-048
    7 ireb=ivm                                                          stbf-049
      if (ireb.eq.0) ireb=4                                             stbf-050
      kn=ireb*ism                                                       stbf-051
      idx=max0(idx,6*kn+6)                                              stbf-052
      if (idx.gt.nx) call memo(idmt,idmt+idx-nx,nx,3,lo)                stbf-053
      if (lo(216)) go to 35                                             stbf-054
      a4=ireb                                                           stbf-055
      a4=h/a4                                                           stbf-056
      if (va(3).eq.0.) va(3)=1.                                         stbf-057
      y3=(va(2)-va(3))**0.33333333333333d0                              stbf-058
      a2=y3*va(6)                                                       stbf-059
      kr=a2/a4                                                          stbf-060
      y2=va(1)                                                          stbf-061
      if (y2.eq.0.) y2=0.01                                             stbf-062
      jl=ivx(4)                                                         stbf-063
      if (ivx(3).eq.0) jl=2*l                                           stbf-064
      if (lo(51)) write (2,1000) ivx,kn,ireb,kr,y2,(va(i),i=2,11)       stbf-065
      a1=a4*a4                                                          stbf-066
      y1=va(3)*(va(2)-va(3))/va(2)                                      stbf-067
      y5=ck*y1*a1                                                       stbf-068
      a5=y2*y5                                                          stbf-069
      rr=dsqrt(dabs(a5))/a4                                             stbf-070
      x5=0.5d0*ck*ccz*y1*va(4)/rr                                       stbf-071
      if (va(1).gt.0.) go to 8                                          stbf-072
c matching of unbound functions                                         stbf-073
      idx=max0(idx,10*l+10)                                             stbf-074
      if (idx.gt.nx) call memo(idmt,idmt+idx-nx,nx,3,lo)                stbf-075
      if (lo(216)) go to 35                                             stbf-076
      call fcou(l,x5,rr*a4*kn,xx(l+2,1),xx(2*l+3,1),xx(3*l+4,1),xx(4*l+5stbf-077
     1,1),iex,xx(5*l+6,1))                                              stbf-078
      z1=xx(2*l+2,1)                                                    stbf-079
      z2=xx(4*l+4,1)                                                    stbf-080
      call fcou(l,x5,rr*a4*(kn-2),xx(l+2,1),xx(2*l+3,1),xx(3*l+4,1),xx(4stbf-081
     1*l+5,1),iex,xx(5*l+6,1))                                          stbf-082
      z3=xx(2*l+2,1)                                                    stbf-083
      z4=xx(4*l+4,1)                                                    stbf-084
    8 x1=y3*va(11)                                                      stbf-085
      a3=y3*va(9)                                                       stbf-086
      y3=2.d0*va(8)*y5                                                  stbf-087
      y4=ivx(3)*(ivx(3)+2)-jl*(jl+2)+4*l*(l+1)                          stbf-088
      y4=.25d0*y4                                                       stbf-089
      a6=l*(l+1)                                                        stbf-090
      a6=a6*a1                                                          stbf-091
      x4=x5*2.d0*a1*rr                                                  stbf-092
      x3=0.d0                                                           stbf-093
      k=kn+1                                                            stbf-094
c computation of optical potentials                                     stbf-095
      do 10 i=1,k                                                       stbf-096
      x3=x3+a4                                                          stbf-097
      x2=dexp((x3-a3)/va(10))                                           stbf-098
      xx(2,i)=a6/(x3*x3)+y4*y3*x2/((1.d0+x2)**2*x3*va(10))+a5           stbf-099
      xx(3,i)=-1.d0/(1.d0+dexp((x3-a2)/va(7)))                          stbf-100
      if (x3.gt.x1) go to 9                                             stbf-101
      xx(2,i)=xx(2,i)+x4*(1.5d0-0.5d0*x3*x3/(x1*x1))/x1                 stbf-102
      go to 10                                                          stbf-103
    9 xx(2,i)=xx(2,i)+x4/x3                                             stbf-104
   10 continue                                                          stbf-105
      if (va(1).lt.0.) go to 15                                         stbf-106
c matching conditions                                                   stbf-107
      x1=(x3-a4)*rr                                                     stbf-108
      x3=x3*rr                                                          stbf-109
      a6=a6/a1                                                          stbf-110
      n=5.d0*(x3-x1)+1.d0                                               stbf-111
      y3=n                                                              stbf-112
      y3=(x3-x1)/y3                                                     stbf-113
      ig=1.d0/y3                                                        stbf-114
      jg=min0(100,ig)                                                   stbf-115
      a5=y3*y3                                                          stbf-116
      a3=1.d0                                                           stbf-117
      do 12 i=1,20                                                      stbf-118
      m=2*i*jg                                                          stbf-119
      a4=m                                                              stbf-120
      a4=x3+y3*a4                                                       stbf-121
      y1=dexp(y3)                                                       stbf-122
      y4=0.5d0/y3+0.5d0                                                 stbf-123
      y2=(a6/(a4*a4)+2.d0*x5/a4+1.d0)*a5                                stbf-124
      do 11 j=1,m                                                       stbf-125
      y1=(2.d0+y2/(1.d0-y2/12.d0))-1.d0/y1                              stbf-126
      a2=y2                                                             stbf-127
      a4=a4-y3                                                          stbf-128
      y2=(a6/(a4*a4)+2.d0*x5/a4+1.d0)*a5                                stbf-129
      a1=y1*(1.d0-a2/12.d0)/(1.d0-y2/12.d0)                             stbf-130
   11 y4=y4/(a1*a1)+1.d0                                                stbf-131
      if (dabs(y1-a3).lt.0.1d-4*dabs(y1-1.d0)) go to 13                 stbf-132
   12 a3=y1                                                             stbf-133
      if (lo(51)) write (2,1001)                                        stbf-134
   13 y4=(y4-0.5d0)*y3                                                  stbf-135
      if (lo(51)) write (2,1002) i,m                                    stbf-136
      x2=1.d0/y1                                                        stbf-137
      x3=1.d0                                                           stbf-138
      x4=y2                                                             stbf-139
      do 14 i=1,n                                                       stbf-140
      x1=x2                                                             stbf-141
      x2=x3                                                             stbf-142
      x3=(2.d0+x4/(1.d0-x4/12.d0))*x2-x1                                stbf-143
      a4=a4-y3                                                          stbf-144
   14 x4=(a6/(a4*a4)+2.d0*x5/a4+1.d0)*a5                                stbf-145
      a3=x3*(1.d0-y2/12.d0)/(1.d0-x4/12.d0)                             stbf-146
      go to 16                                                          stbf-147
   15 kr=k                                                              stbf-148
   16 ks=2.d0+dsqrt(a6/12.d0)                                           stbf-149
c starting values                                                       stbf-150
      do 17 i=1,ks                                                      stbf-151
   17 xx(1,i)=0.d0                                                      stbf-152
      xx(1,ks)=1.d0                                                     stbf-153
      if (l.eq.1) xx(1,ks-1)=-.2d0                                      stbf-154
      a4=va(5)                                                          stbf-155
      ik=2*ivx(1)                                                       stbf-156
      ist=0                                                             stbf-157
      x1=0.d0                                                           stbf-158
      y1=-1.d0                                                          stbf-159
      in1=0                                                             stbf-160
      in2=0                                                             stbf-161
c search for the eigenvalue                                             stbf-162
   18 x3=x1+a4                                                          stbf-163
   19 ist=ist+1                                                         stbf-164
      in3=0                                                             stbf-165
      x4=x3*y5                                                          stbf-166
c upwards integration                                                   stbf-167
      do 20 i=ks,kr                                                     stbf-168
      x5=x4*xx(3,i-1)+xx(2,i-1)                                         stbf-169
      xx(1,i+1)=(2.d0+x5/(1.d0-x5/12.d0))*xx(1,i)-xx(1,i-1)             stbf-170
      if (xx(1,i+1)*xx(1,i).lt.0.d0) in3=in3+2                          stbf-171
   20 continue                                                          stbf-172
      if (va(1).lt.0.) go to 29                                         stbf-173
      a1=xx(1,kr)                                                       stbf-174
      a2=xx(1,kr+1)                                                     stbf-175
      xx(1,kn+2)=1.d0                                                   stbf-176
      xx(1,kn+1)=a3*(1.d0-(x4*xx(3,kn)+xx(2,kn))/12.d0)/(1.d0-(x4*xx(3,kstbf-177
     1n+1)+xx(2,kn+1))/12.d0)                                           stbf-178
c backwards integration                                                 stbf-179
      do 21 i=kr,kn                                                     stbf-180
      j=kn+kr-i                                                         stbf-181
      x5=x4*xx(3,j)+xx(2,j)                                             stbf-182
      if (xx(1,j+1)*xx(1,j+2).lt.0.d0) in3=in3+2                        stbf-183
   21 xx(1,j)=(2.d0+x5/(1.d0-x5/12.d0))*xx(1,j+1)-xx(1,j+2)             stbf-184
      y3=a1/a2-xx(1,kr)/xx(1,kr+1)                                      stbf-185
      if (y3.gt.0.d0) in3=in3+1                                         stbf-186
      if (lo(51)) write (2,1003) ist,in3,x3,y3                          stbf-187
      if (dabs(y3).le.1.d-10.or.x2.eq.x3.or.x1.eq.x3) go to 27          stbf-188
      if (in2.ne.0) go to 24                                            stbf-189
      if (in3.gt.ik) go to 22                                           stbf-190
      y1=y3                                                             stbf-191
      x1=x3                                                             stbf-192
      in1=in3                                                           stbf-193
      a4=x1                                                             stbf-194
      go to 18                                                          stbf-195
   22 if (lo(51)) write (2,1004) ik,in1,in3                             stbf-196
      x2=x3                                                             stbf-197
      in2=in3                                                           stbf-198
      y2=y3                                                             stbf-199
c interpolation of solution                                             stbf-200
   23 x3=x1+0.5d0*(x2-x1)                                               stbf-201
      if (in2.eq.in1+1) x3=(y1*x2-y2*x1)/(y1-y2)                        stbf-202
      go to 19                                                          stbf-203
   24 x4=(y1*y2*x3*(x2-x1)+y1*y3*x2*(x1-x3)+y2*y3*x1*(x3-x2))/(y1*y2*(x2stbf-204
     1-x1)+y1*y3*(x1-x3)+y2*y3*(x3-x2))                                 stbf-205
      if (in2.gt.in1+2) x4=1.d20                                        stbf-206
      if (in3.gt.ik) go to 25                                           stbf-207
      x1=x3                                                             stbf-208
      y1=y3                                                             stbf-209
      in1=in3                                                           stbf-210
      go to 26                                                          stbf-211
   25 x2=x3                                                             stbf-212
      y2=y3                                                             stbf-213
      in2=in3                                                           stbf-214
   26 if ((x1-x4)*(x4-x2).lt.0.d0) go to 23                             stbf-215
      x3=x4                                                             stbf-216
      go to 19                                                          stbf-217
   27 y3=a1/xx(1,kr)                                                    stbf-218
      k=kn+2                                                            stbf-219
      do 28 i=kr,k                                                      stbf-220
   28 xx(1,i)=y3*xx(1,i)                                                stbf-221
   29 do 30 i=1,kn                                                      stbf-222
   30 xx(1,i)=(xx(1,i)+10.d0*xx(1,i+1)+xx(1,i+2))/12.d0                 stbf-223
      if (va(1).gt.0.d0) go to 31                                       stbf-224
      x1=xx(1,kn)*z4-xx(1,kn-2)*z2                                      stbf-225
      x2=xx(1,kn-2)*z1-xx(1,kn)*z3                                      stbf-226
      x3=z1*z4-z2*z3                                                    stbf-227
      y2=datan2(x2,x1)                                                  stbf-228
      y1=(x1**2+x2**2)/x3**2                                            stbf-229
      x3=va(5)                                                          stbf-230
      go to 33                                                          stbf-231
   31 y1=0.d0                                                           stbf-232
      do 32 i=1,kn                                                      stbf-233
   32 y1=y1+xx(1,i)**2                                                  stbf-234
      y1=y1-0.5d0*xx(1,kn)**2                                           stbf-235
      y2=y4*xx(1,kn)**2/rr                                              stbf-236
      y3=ireb                                                           stbf-237
      y1=y1*h/y3+y2                                                     stbf-238
      y2=100.d0*y2/y1                                                   stbf-239
   33 y1=1.d0/dsqrt(y1)                                                 stbf-240
      is=0                                                              stbf-241
      rr=0.d0                                                           stbf-242
      do 34 i=ireb,kn,ireb                                              stbf-243
      is=is+1                                                           stbf-244
      rr=rr+h                                                           stbf-245
   34 v(is)=y1*xx(1,i)/rr                                               stbf-246
      if (lo(51)) write (2,1005) x3,y2,(is,v(is),is=1,ism)              stbf-247
      return                                                            stbf-248
   35 write (2,1006) idx,nx                                             stbf-249
      stop                                                              stbf-250
 1000 format (//45h woods-saxon potential eigenfunction with n =,i2,3x,3stbf-251
     1hl =,i3,3x,5h2*s =,i2,3x,5h2*j =,i3,3x,i4,18h steps (divided by,i3stbf-252
     2,17h) matching at the,i4,2hth/20h **** binding energy,f12.6,9h mevstbf-253
     3 ****,4x,10htotal mass,f12.6,4x,13hparticle mass,f12.6,4x,18hprodustbf-254
     4ct of charges,f8.2/39h search on depth of real potential from,f12.stbf-255
     56,20h with reduced radius,f10.6,22h fermi and diffuseness,f10.6,6hstbf-256
     6 fermi/28h spin orbit potential depth:,f12.6,12h mev radius:,f10.6stbf-257
     7,19h fermi diffuseness:,f9.6,22h fermi coulomb radius:,f10.6,6h festbf-258
     8rmi)                                                              stbf-259
 1001 format (10x,33hno convergence on matching values)                 stbf-260
 1002 format (10x,30hmatching value obtained for i=,i3,5h with,i6,7h poistbf-261
     1nts)                                                              stbf-262
 1003 format (2x,i3,5x,12h2*n (+0/1) =,i3,5x,3hv =,d20.10,5x,3hd =,d20.1stbf-263
     10)                                                                stbf-264
 1004 format (24h interpolation for 2*n =,i4,5x,7hbetween,i4,4h and,i4) stbf-265
 1005 format (//11h depth used,d20.10,4h mev,15x,30htail percentage or pstbf-266
     1hase-shift,f10.5//(6(i6,e15.6)))                                  stbf-267
 1006 format (32h working field too small in stbf/17h field requested:,istbf-268
     110,20x,17h field available:,i10)                                  stbf-269
      end                                                               stbf-270
c 05/08/89  ibm and cdc version                                 ecis94  deri-000
      subroutine deri(x,y,h,n,lt)                                       deri-001
c numerical derivation of the function y known in n points with step h  deri-002
c it needs at least 7 points and returns in x the value of -d(y)/dr     deri-003
c if lt is false, the result is divided by r.                           deri-004
c***********************************************************************deri-005
      logical lt                                                        deri-006
      dimension x(7),y(7)                                               deri-007
      n3=n-3                                                            deri-008
      if (n3.ge.4) go to 1                                              deri-009
      write (2,1000) n                                                  deri-010
      stop                                                              deri-011
    1 hh=-h*60.                                                         deri-012
      x(1)=(-147.*y(1)+360.*y(2)-450.*y(3)+400.*y(4)-225.*y(5)+72.*y(6)-deri-013
     110.*y(7))/hh                                                      deri-014
      x(2)=(-10.*y(1)-77.*y(2)+150.*y(3)-100.*y(4)+50.*y(5)-15.*y(6)+2.*deri-015
     1y(7))/hh                                                          deri-016
      x(3)=(2.*y(1)-24.*y(2)-35.*y(3)+80.*y(4)-30.*y(5)+8.*y(6)-y(7))/hhderi-017
      do 2 i=4,n3                                                       deri-018
    2 x(i)=(45.*(y(i+1)-y(i-1))-9.*(y(i+2)-y(i-2))+y(i+3)-y(i-3))/hh    deri-019
      x(n-2)=(y(n-6)-8.*y(n-5)+30.*y(n-4)-80.*y(n3)+35*y(n-2)+24.*y(n-1)deri-020
     1-2.*y(n))/hh                                                      deri-021
      x(n-1)=(-2.*y(n-6)+15.*y(n-5)-50.*y(n-4)+100.*y(n3)-150.*y(n-2)+77deri-022
     1.*y(n-1)+10.*y(n))/hh                                             deri-023
      x(n)=(10.*y(n-6)-72.*y(n-5)+225.*y(n-4)-400.*y(n3)+450.*y(n-2)-360deri-024
     1.*y(n-1)+147.*y(n))/hh                                            deri-025
      if (lt) return                                                    deri-026
      r=0.                                                              deri-027
      do 3 i=1,n                                                        deri-028
      r=r+h                                                             deri-029
    3 x(i)=x(i)/r                                                       deri-030
      return                                                            deri-031
 1000 format (5x,i5,43h points insufficient for derivation in deri//10x,deri-032
     115h ...  stop  ...)                                               deri-033
      end                                                               deri-034
c 29/10/85  ibm and cdc version                                 ecis88  intp-000
      subroutine intp(i,ism,h,g,rr,v,lx)                                intp-001
c interpolation routine for radial form factors                         intp-002
c input variables: i:   number of points where the function is given    intp-003
c                  ism: number of points where the function is needed   intp-004
c                  h:   step size                                       intp-005
c                  g:   normalisation factor                            intp-006
c                  rr(2,1): radii (j=1) and values (j=2) to interpolate intp-007
c                  lx:  address of result in v                          intp-008
c output variable: v(i,lx) for i=1 to ism                               intp-009
c***********************************************************************intp-010
      dimension rr(2,1),v(ism,1)                                        intp-011
      if (i.lt.4) go to 4                                               intp-012
      ir=1                                                              intp-013
      do 3 is=1,ism                                                     intp-014
      x0=is*h                                                           intp-015
    1 if (x0.lt.rr(1,ir+2)) go to 2                                     intp-016
      if (ir.ge.i-3) go to 2                                            intp-017
      ir=ir+1                                                           intp-018
      go to 1                                                           intp-019
    2 x1=(x0-rr(1,ir+1))*(x0-rr(1,ir+2))*(x0-rr(1,ir+3))/((rr(1,ir)-rr(1intp-020
     1,ir+1))*(rr(1,ir)-rr(1,ir+2))*(rr(1,ir)-rr(1,ir+3)))              intp-021
      x2=(x0-rr(1,ir))*(x0-rr(1,ir+2))*(x0-rr(1,ir+3))/((rr(1,ir+1)-rr(1intp-022
     1,ir))*(rr(1,ir+1)-rr(1,ir+2))*(rr(1,ir+1)-rr(1,ir+3)))            intp-023
      x3=(x0-rr(1,ir))*(x0-rr(1,ir+1))*(x0-rr(1,ir+3))/((rr(1,ir+2)-rr(1intp-024
     1,ir))*(rr(1,ir+2)-rr(1,ir+1))*(rr(1,ir+2)-rr(1,ir+3)))            intp-025
      x4=(x0-rr(1,ir))*(x0-rr(1,ir+1))*(x0-rr(1,ir+2))/((rr(1,ir+3)-rr(1intp-026
     1,ir))*(rr(1,ir+3)-rr(1,ir+1))*(rr(1,ir+3)-rr(1,ir+2)))            intp-027
    3 v(is,lx)=g*(x1*rr(2,ir)+x2*rr(2,ir+1)+x3*rr(2,ir+2)+x4*rr(2,ir+3))intp-028
      return                                                            intp-029
    4 do 5 is=1,ism                                                     intp-030
    5 v(is,lx)=0.                                                       intp-031
      return                                                            intp-032
      end                                                               intp-033
c 18/11/97  ibm version   cdc with 'c' to double precision      ecis96  fold-000
      subroutine fold(v1,v2,val,nfo,ip,ism,ist,aconv,ivy,invz,fr,pgn,xgnfold-001
     1,wv,izz,lo)                                                       fold-002
c v1 are the potentials and form factors, unfolded as input, folded as  fold-003
c output. v2 are working fields in which 0. are stored before the call. fold-004
c input variables: val(i,j),i=1,3,j=1,nfo  folding parameters           fold-005
c                  nfo:    number of sets of folding parameters         fold-006
c                  ip:     potential to be folded if lo(7)=.false.      fold-007
c                  ism:    number of points                             fold-008
c                  ist:    maximum number of steps for folding functionsfold-009
c                  aconv:  value below which the folding is neglected   fold-010
c                  ivy:    table of form factors (see redm)             fold-011
c                  invz:   number of transition form factors to fold    fold-012
c                  pgn,xgn: 20-point gauss legendre integration         fold-013
c                  wv:     masses, wave numbers, step size (see calx)   fold-014
c                  lo(i):  logical controls (see calc)                  fold-015
c in common /pote1/  see redm                                           fold-016
c working fields:  fr(i,j),i=1,ist: gaussian or saxon folding functions fold-017
c          for j=1,imt.  for yukawa or hulthen folding: h-functions for fold-018
c          j=1,imt, j-functions for j=imt+1,2*imt; these functions are  fold-019
c          multiplied by r*r*exp(+\-r/va)                               fold-020
c          integrals with h and j-functions for j=2*imt+1,2*imt+2       fold-021
c                  izz(i,*) address of folding parameters below for i=1 fold-022
c                           type of form factor from 1 to 16 for i=2    fold-023
c                           angular momentum for i=3                    fold-024
c                           address of step size for i=4                fold-025
c                    (this part is an input with external form factors) fold-026
c folding conventions : val(*,1) real potential, val(*,2) imaginary one fold-027
c if val(1,*)=0  no folding                      val(*,3) coulomb       fold-028
c if val(3,*)=0 gaussian form factor with range val(2,*)                fold-029
c if val(2,*)=0 hulthen form factor with ranges val(1,*) and val(3,*)   fold-030
c if val(2,*)=val(3,*)=0 yukawa form factor with range val(1,*)         fold-031
c all other cases  saxon form factor with radius val(2,*) and diffuse-  fold-032
c ness val(3,*) - all form factors are normalised - val(1,*) is used    fold-033
c only for hulthen form factor                                          fold-034
c the diffuseness of a saxon form factor and the ranges of a hulthen or fold-035
c yukawa form factor are positive by taking the absolute value          fold-036
c***********************************************************************fold-037
      double precision xgn,pgn,wv                                       fold-038
      dimension v1(ism,1),v2(ism,1),fr(ist,2),val(3,3),ivy(7,1),izz(4,1)fold-039
     1,mm(3),xgn(10),pgn(10),wv(15,1)                                   fold-040
      logical lo(250)                                                   fold-041
      common /pote1/ itx(16),imax,intc,inls,invc,invd,itxm              fold-042
      data pim2 /6.2831853070e0/                                        fold-043
      ac=-alog(aconv)                                                   fold-044
      jsl=ism+1                                                         fold-045
      itxn=itxm                                                         fold-046
      if (lo(100)) itxn=itxn-itx(2)                                     fold-047
      if (lo(7)) go to 9                                                fold-048
c initialisation of the table izz when potentials are not external      fold-049
      mm(1)=1                                                           fold-050
      mm(2)=2                                                           fold-051
      mm(3)=3                                                           fold-052
      if ((val(1,2).eq.val(1,1)).and.(val(2,2).eq.val(2,1)).and.(val(3,2fold-053
     1).eq.val(3,1))) mm(2)=1                                           fold-054
      if ((val(1,3).eq.val(1,2)).and.(val(2,3).eq.val(2,2)).and.(val(3,3fold-055
     1).eq.val(3,2))) mm(3)=2                                           fold-056
      if ((val(1,3).eq.val(1,1)).and.(val(2,3).eq.val(2,1)).and.(val(3,3fold-057
     1).eq.val(3,1))) mm(3)=1                                           fold-058
      nfox=max0(mm(1),mm(2),mm(3))                                      fold-059
      do 2 j=1,itxn                                                     fold-060
      do 1 i=1,3                                                        fold-061
    1 izz(i,j)=0                                                        fold-062
    2 izz(4,j)=ip                                                       fold-063
      do 3 i=1,8                                                        fold-064
      if ((i.eq.5).and.lo(201)) go to 3                                 fold-065
      if ((i.eq.6).and.lo(202)) go to 3                                 fold-066
      if ((i.eq.8).and.lo(203)) go to 3                                 fold-067
      m=mod(i+1,2)+1                                                    fold-068
      if (i.gt.6) m=3                                                   fold-069
      n=i                                                               fold-070
      if (lo(200)) n=1+itx(i)                                           fold-071
      izz(1,n)=-mm(m)                                                   fold-072
      izz(2,n)=i                                                        fold-073
    3 continue                                                          fold-074
      if (invz.eq.0) go to 9                                            fold-075
      ij=itx(3)-itx(7)                                                  fold-076
      do 8 j=1,intc                                                     fold-077
      do 7 i=1,8                                                        fold-078
      m=mod(i+1,2)+1                                                    fold-079
      n=i+ij                                                            fold-080
      if (i.gt.6) go to 5                                               fold-081
      if (i.gt.4) go to 4                                               fold-082
      if ((m.eq.2).and.lo(112)) go to 7                                 fold-083
      if (lo(200)) n=j+itx(i+8)                                         fold-084
      go to 6                                                           fold-085
    4 if (lo(108+i)) go to 7                                            fold-086
      if (lo(200)) n=ivy(3,j)+itx(i+8)                                  fold-087
      go to 6                                                           fold-088
    5 if (lo(55+8*i)) go to 7                                           fold-089
      if (lo(200)) n=itx(i+8)+ivy(i-3,j)                                fold-090
      m=3                                                               fold-091
    6 izz(1,n)=-mm(m)                                                   fold-092
      izz(2,n)=i+8                                                      fold-093
      izz(3,n)=ivy(7,j)                                                 fold-094
    7 continue                                                          fold-095
    8 ij=ij+11                                                          fold-096
c classification of step sizes                                          fold-097
    9 do 11 i=2,itxn                                                    fold-098
      if (izz(1,i).eq.0) go to 11                                       fold-099
      do 10 j=2,i                                                       fold-100
      if (izz(1,j-1).ne.izz(1,i)) go to 10                              fold-101
      if (izz(4,j-1).eq.izz(4,i)) go to 10                              fold-102
      i1=izz(4,i)                                                       fold-103
      j1=izz(4,j-1)                                                     fold-104
      if (wv(11,i1).ne.wv(11,j1)) go to 10                              fold-105
      izz(4,i)=j1                                                       fold-106
      go to 11                                                          fold-107
   10 continue                                                          fold-108
   11 continue                                                          fold-109
      nfot=-nfo                                                         fold-110
c for external potentials, add 1 for dummy folding                      fold-111
      if (lo(7)) nfox=nfo+1                                             fold-112
c loop on foldings                                                      fold-113
      do 64 ii=1,nfox                                                   fold-114
      if (ii.gt.nfo) go to 54                                           fold-115
      ic=0                                                              fold-116
      do 12 j=1,3                                                       fold-117
      if (val(j,ii).ne.0.) ic=ic+2**(3-j)                               fold-118
      if (val(j,ii).ge.0.) go to 12                                     fold-119
      write (2,1000) val(j,ii),j,ii                                     fold-120
      val(j,ii)=-val(j,ii)                                              fold-121
   12 continue                                                          fold-122
      if (ic.lt.4) go to 64                                             fold-123
      ih=0                                                              fold-124
   13 imt=1                                                             fold-125
      jh=0                                                              fold-126
      kh=0                                                              fold-127
c separation of foldings with respect to the step size                  fold-128
      do 14 j=1,itxn                                                    fold-129
      if (izz(1,j)+ii.ne.0) go to 14                                    fold-130
      if (izz(4,j).lt.ih) go to 14                                      fold-131
      kh=kh+1                                                           fold-132
      if ((jh.ne.0).and.(izz(4,j).gt.ih)) go to 14                      fold-133
      jh=jh+1                                                           fold-134
      ih=izz(4,j)                                                       fold-135
      izz(1,j)=nfot-1                                                   fold-136
      imt=max0(imt,izz(3,j)+1)                                          fold-137
   14 continue                                                          fold-138
      if (jh.eq.0) go to 64                                             fold-139
      nfot=nfot-1                                                       fold-140
      h=wv(11,ih)                                                       fold-141
c computation of the strength of the folding functions                  fold-142
      cn=1.                                                             fold-143
      if (ic.gt.5) go to 15                                             fold-144
c yukawa folding                                                        fold-145
      if (val(3,ii).eq.val(1,ii)) val(3,ii)=.99*val(1,ii)               fold-146
      cn=h/(2.*pim2*(val(1,ii)**2-val(3,ii)**2))                        fold-147
      jst=ism+5                                                         fold-148
      go to 18                                                          fold-149
   15 if (ic.eq.7) go to 16                                             fold-150
c gaussian folding                                                      fold-151
      isy=1.+val(2,ii)*sqrt(ac)/h                                       fold-152
      cn=h/(0.5*pim2*sqrt(0.5*pim2)*val(2,ii)**3)                       fold-153
      go to 18                                                          fold-154
c saxon folding                                                         fold-155
   16 is=1+(val(2,ii)+10.*val(3,ii))/h                                  fold-156
      isy=1.+(val(2,ii)+2.*val(3,ii)*ac)/h                              fold-157
      cn=0.                                                             fold-158
      do 17 k=1,is                                                      fold-159
      rr=h*k                                                            fold-160
   17 cn=cn+rr*rr/(1.+exp((rr-val(2,ii))/val(3,ii)))                    fold-161
      cn=.5/(pim2*cn)                                                   fold-162
c gaussian or saxon folding                                             fold-163
   18 an=imt-1                                                          fold-164
      if (ic.lt.6) go to 36                                             fold-165
c do loop on the points of potentials                                   fold-166
      fs=0.                                                             fold-167
      is=0                                                              fold-168
   19 is=is+1                                                           fold-169
      jst=is+isy                                                        fold-170
      jsm=min0(ism,jst)                                                 fold-171
      r=val(2,ii)                                                       fold-172
      a=val(3,ii)                                                       fold-173
      x1=h*is                                                           fold-174
      if (jst.le.ism) go to 20                                          fold-175
      jsz=max0(ism,1+is+2*int((r+2.*a)/h))                              fold-176
      jst=min0(jst,jsz+4)                                               fold-177
      isz=jsz-1                                                         fold-178
      isx=jst-jsz                                                       fold-179
c loop on the points of the folding function for which the symmetry     fold-180
c between the two arguments is used                                     fold-181
   20 ji=is-1                                                           fold-182
   21 ji=ji+1                                                           fold-183
      a3=h*ji                                                           fold-184
      a4=2.*x1*a3                                                       fold-185
      y=x1*x1+a3*a3                                                     fold-186
      if (a.eq.0.) go to 25                                             fold-187
c saxon folding function  by a 20-points gaussian integration           fold-188
c the saxon form factor itself is the variable                          fold-189
      do 22 k=1,imt                                                     fold-190
   22 fr(ji,k)=0.                                                       fold-191
      r1=amin1(70.,(abs(x1-a3)-r)/a)                                    fold-192
      r2=amin1(70.,(x1+a3-r)/a)                                         fold-193
      e1=1./(1.+exp(r1))                                                fold-194
      e2=1./(1.+exp(r2))                                                fold-195
      em=0.5*(e1+e2)                                                    fold-196
      es=0.5*(e1-e2)                                                    fold-197
      p1=es*2.*a*pim2/a4                                                fold-198
      do 24 ij=1,10                                                     fold-199
      pp=p1*pgn(ij)                                                     fold-200
      e1=1./(em+es*xgn(ij))-1.                                          fold-201
      e2=1./(em-es*xgn(ij))-1.                                          fold-202
      u1=r+a*alog(e1)                                                   fold-203
      u2=r+a*alog(e2)                                                   fold-204
      r1=pp*u1*(1.+e1)/e1                                               fold-205
      r2=pp*u2*(1.+e2)/e2                                               fold-206
      fr(ji,1)=fr(ji,1)+r1+r2                                           fold-207
      if (imt.eq.1) go to 24                                            fold-208
      e1=(y-u1*u1)/a4                                                   fold-209
      e2=(y-u2*u2)/a4                                                   fold-210
      r3=r1*e1                                                          fold-211
      r4=r2*e2                                                          fold-212
      fr(ji,2)=fr(ji,2)+r3+r4                                           fold-213
      if (imt.eq.2) go to 24                                            fold-214
c recurrence for legendre polynomials                                   fold-215
      do 23 k=3,imt                                                     fold-216
      r5=r1                                                             fold-217
      r6=r2                                                             fold-218
      r1=r3                                                             fold-219
      r2=r4                                                             fold-220
      r3=((2.*k-3.)*r1*e1-r5*(k-2.))/(k-1.)                             fold-221
      r4=((2.*k-3.)*r2*e2-r6*(k-2.))/(k-1.)                             fold-222
   23 fr(ji,k)=fr(ji,k)+r3+r4                                           fold-223
   24 continue                                                          fold-224
      go to 29                                                          fold-225
c gaussian folding function                                             fold-226
   25 a4=a4/(r*r)                                                       fold-227
      y=y/(r*r)                                                         fold-228
      b1=exp(a4-y)                                                      fold-229
      b2=0.                                                             fold-230
      if (a4+y.lt.50.) b2=exp(-a4-y)                                    fold-231
      dn=1./a4                                                          fold-232
   26 fr(ji,1)=pim2*(b1-b2)*dn                                          fold-233
      if (imt.eq.1) go to 29                                            fold-234
c downwards recurrence for small arguments                              fold-235
      q=amax1(sqrt(10.5*a4)-0.5,an)                                     fold-236
      k=int(q+3.+21.*a4/(q+q+1.))                                       fold-237
      a1=0.                                                             fold-238
   27 a1=a4/(2.*k+1.+a4*a1)                                             fold-239
      if (k.lt.imt) fr(ji,k+1)=a1                                       fold-240
      k=k-1                                                             fold-241
      if (k.gt.0) go to 27                                              fold-242
      do 28 k=2,imt                                                     fold-243
   28 fr(ji,k)=fr(ji,k)*fr(ji,k-1)                                      fold-244
   29 if (ic.lt.6) go to 39                                             fold-245
      if (ji.lt.jst) go to 21                                           fold-246
      ik=1                                                              fold-247
      go to 46                                                          fold-248
   30 ik=2                                                              fold-249
      if (jst.le.ism) go to 46                                          fold-250
c form the coulomb potentials,asymptotic correction                     fold-251
c the form factors are assumed to decrease as (r)**(-l-1)               fold-252
      a1=ism                                                            fold-253
      do 32 i=jsl,jst                                                   fold-254
      a2=i                                                              fold-255
      y=a1/a2                                                           fold-256
      a4=y*(h*i)**2                                                     fold-257
      do 31 j=1,imt                                                     fold-258
      fr(i,j)=fr(i,j)*a4                                                fold-259
   31 a4=a4*y                                                           fold-260
   32 continue                                                          fold-261
c correction of the last value by sum between ism and jsz and a pade    fold-262
c approximation limited to four terms (between jsz+1 and jst)           fold-263
      do 35 i=1,imt                                                     fold-264
      a1=0.                                                             fold-265
      a2=0.                                                             fold-266
      a3=0.                                                             fold-267
      a4=0.                                                             fold-268
      y=0.                                                              fold-269
      if (jsl.gt.isz) go to 34                                          fold-270
      do 33 j=jsl,isz                                                   fold-271
   33 y=y+fr(j,i)                                                       fold-272
   34 if (isx.eq.0.or.fr(jsz,i).eq.0.) go to 35                         fold-273
      a1=-fr(jsz+1,i)/fr(jsz,i)                                         fold-274
      if (isx.eq.1.or.fr(jsz+1,i).eq.0.) go to 35                       fold-275
      b1=fr(jsz+2,i)/fr(jsz+1,i)                                        fold-276
      a2=-a1-b1                                                         fold-277
      if (isx.eq.2.or.a2.eq.0.) go to 35                                fold-278
      b2=fr(jsz+3,i)/fr(jsz+1,i)                                        fold-279
      c1=-(b1*a1+b2)/a2                                                 fold-280
      a3=b1-c1                                                          fold-281
      if (isx.eq.3.or.a3.eq.0.) go to 35                                fold-282
      a4=c1-(b2+(b2*a1+fr(jsz+4,i)/fr(jsz+1,i))/a2)/a3                  fold-283
   35 fr(jsl,i)=y+fr(jsz,i)/(1.+a1/(1.+a2/(1.+a3/(1.+a4))))             fold-284
      go to 46                                                          fold-285
c loop on the two yukawa form factors                                   fold-286
   36 fs=1.                                                             fold-287
      va=val(1,ii)                                                      fold-288
   37 if (va.eq.0.) go to 53                                            fold-289
c computation of bessel functions multiplied by r*r and exp(r/va)       fold-290
      ji=0                                                              fold-291
      b1=1.                                                             fold-292
      b2=1.                                                             fold-293
      b4=exp(-h/va)                                                     fold-294
   38 ji=ji+1                                                           fold-295
      a2=h*ji                                                           fold-296
      a4=a2/va                                                          fold-297
      b2=b2*b4**2                                                       fold-298
      fr(ji,imt+1)=fs*a2                                                fold-299
      dn=a2*va                                                          fold-300
      go to 26                                                          fold-301
c upwards recurrence for the irregular function                         fold-302
   39 fr(ji,imt+2)=fr(ji,imt+1)*(1.+1./a4)                              fold-303
      if (imt.eq.2) go to 41                                            fold-304
      do 40 k=3,imt                                                     fold-305
   40 fr(ji,k+imt)=fr(ji,k-2+imt)+fr(ji,k-1+imt)*(2*k-3)/a4             fold-306
   41 if (ji.lt.jst) go to 38                                           fold-307
c corrections for singular first derivative (yukawa form factor)        fold-308
      vr=-fs*h*pim2/6.                                                  fold-309
      ik=1                                                              fold-310
      go to 46                                                          fold-311
c correction for coulomb potentials                                     fold-312
   42 a6=ism                                                            fold-313
      do 44 i=jsl,jst                                                   fold-314
      a2=i                                                              fold-315
      y=a6/a2                                                           fold-316
      a1=y                                                              fold-317
      do 43 j=1,imt                                                     fold-318
      fr(i,j+imt)=fr(i,j+imt)*a1                                        fold-319
   43 a1=a1*y                                                           fold-320
   44 continue                                                          fold-321
c estimation of the last value by a pade of four terms                  fold-322
      do 45 i=1,imt                                                     fold-323
      a6=-fr(jsl+1,i+imt)/fr(jsl,i+imt)                                 fold-324
      if (i.eq.1) go to 45                                              fold-325
      b2=fr(jsl+2,i+imt)/fr(jsl+1,i+imt)                                fold-326
      a2=-a6-b2                                                         fold-327
      b3=fr(jsl+3,i+imt)/fr(jsl+1,i+imt)                                fold-328
      c1=-(b2*a6+b3)/a2                                                 fold-329
      a4=b2-c1                                                          fold-330
      a1=c1-(b3+(b3*a6+fr(jsl+4,i+imt)/fr(jsl+1,i+imt))/a2)/a4          fold-331
      a6=a6/(1.+b4*a2/(1.+b4*a4/(1.+b4*a1)))                            fold-332
   45 fr(jsl,i+imt)=fr(jsl,i+imt)/(1.+b4*a6)                            fold-333
      ik=2                                                              fold-334
c folding of the potentials                                             fold-335
   46 do 51 k=1,itxn                                                    fold-336
      if (izz(1,k).ne.nfot) go to 51                                    fold-337
      if ((ik.eq.1).and.mod(izz(2,k),8).gt.6) go to 51                  fold-338
      if ((ik.eq.2).and.mod(izz(2,k),8).le.6) go to 51                  fold-339
      n=izz(3,k)+1                                                      fold-340
      if (ic.lt.6) go to 48                                             fold-341
      do 47 js=is,jsm                                                   fold-342
      b1=(h*js)**2                                                      fold-343
      if (js.eq.is) go to 47                                            fold-344
      v2(js,k)=v2(js,k)+v1(is,k)*fr(js,n)*x1**2                         fold-345
   47 v2(is,k)=v2(is,k)+v1(js,k)*fr(js,n)*b1                            fold-346
      if ((ik.eq.2).and.(jst.gt.ism)) v2(is,k)=v2(is,k)+v1(ism,k)*fr(jslfold-347
     1,n)                                                               fold-348
      go to 51                                                          fold-349
   48 b2=0.                                                             fold-350
      b3=fr(jsl,n+imt)*v1(ism,k)                                        fold-351
      do 49 is=1,ism                                                    fold-352
      js=jsl-is                                                         fold-353
      fr(js,2*imt+1)=b3*b4                                              fold-354
      b2=b2*b4+fr(is,n)*v1(is,k)                                        fold-355
      b3=b3*b4+fr(js,n+imt)*v1(js,k)                                    fold-356
   49 fr(is,2*imt+2)=b2                                                 fold-357
      do 50 is=1,ism                                                    fold-358
      rr=(is*h)**2                                                      fold-359
   50 v2(is,k)=v2(is,k)+(fr(is,n)*fr(is,2*imt+1)+fr(is,n+imt)*fr(is,2*imfold-360
     1t+2))/rr+v1(is,k)*vr                                              fold-361
   51 continue                                                          fold-362
      if (ic.lt.6) go to 52                                             fold-363
      if (ik.eq.1) go to 30                                             fold-364
      if (is.lt.ism) go to 19                                           fold-365
   52 if (ik.eq.1) go to 42                                             fold-366
   53 fs=-fs                                                            fold-367
      if (fs.ge.0.) go to 55                                            fold-368
      va=val(3,ii)                                                      fold-369
      go to 37                                                          fold-370
c transfer of potentials from working space                             fold-371
   54 nfot=1                                                            fold-372
   55 do 63 j=1,itxn                                                    fold-373
      if (izz(1,j).ne.nfot) go to 63                                    fold-374
      if (nfot.eq.1) go to 57                                           fold-375
      do 56 is=1,ism                                                    fold-376
   56 v1(is,j)=cn*v2(is,j)                                              fold-377
      go to 58                                                          fold-378
c step size for dummy folding                                           fold-379
   57 ih=izz(4,j)                                                       fold-380
      h=wv(11,ih)                                                       fold-381
   58 if (lo(200).or.(izz(2,j).gt.8)) go to 59                          fold-382
      call deri(v1(1,j+8),v1(1,j),h,ism,.true.)                         fold-383
      call deri(v1(1,j+16),v1(1,j+8),h,ism,.true.)                      fold-384
      go to 63                                                          fold-385
   59 ix=mod(izz(2,j)-1,8)+1                                            fold-386
      if ((ix.lt.5).or.(ix.eq.7)) go to 63                              fold-387
      iml=0                                                             fold-388
      inl=0                                                             fold-389
      if (lo(100)) go to 60                                             fold-390
      if (izz(2,j).le.8) go to 61                                       fold-391
      inl=inls                                                          fold-392
      if (ix.eq.8) inl=invd                                             fold-393
      go to 61                                                          fold-394
   60 if (izz(2,j).le.8) go to 63                                       fold-395
      iml=4                                                             fold-396
      if (ix.eq.8) iml=3                                                fold-397
   61 call deri(v2(1,j),v1(1,j),h,ism,lo(100))                          fold-398
      do 62 is=1,ism                                                    fold-399
      if (inl.eq.0) go to 62                                            fold-400
      ay=is*h                                                           fold-401
      v1(is,j+inl)=-v1(is,j)/ay**2                                      fold-402
   62 v1(is,j+iml)=v2(is,j)                                             fold-403
   63 continue                                                          fold-404
      if (kh.ne.jh.and.nfot.ne.1) go to 13                              fold-405
   64 continue                                                          fold-406
      return                                                            fold-407
 1000 format (15h negative value,e15.5,4x,25hof folding parameter val(,ifold-408
     13,1h,,i3,1h))                                                     fold-409
      end                                                               fold-410
c 22/04/98  ibm version                                         ecis97  conu-000
      subroutine conu(ix,sp,ipi,wv,ipim,wvm,nci,xd,scn,ipp,pip,kxt,lo)  conu-001
c discretisation of continua for compound nucleus                       conu-002
c input variables:   ix:  0 for count of points                         conu-003
c               any other value for computation of points, weights, ... conu-004
c                    sp,ipi,wv:  see calx                               conu-005
c                    scn:    descriptions of level densities            conu-006
c                    ipp,pip:equivalent by call  (see calx)             conu-007
c                    lo:     logical controls                           conu-008
c output variables:  ipim,wvm:  ipi,wv for continua of comp. nucleus    conu-009
c                    nci:    starting and final addresses for continua  conu-010
c                    xd:     steps of discretisation of continua        conu-011
c                          energy and spin dependence of level densitiesconu-012
c                    kxt:    number of transmission coefficients        conu-013
c in scn:  1-sa  2-ux   3-tau  4-sg   5-e0   6-ex   7-nz  8-b           conu-014
c for common /ncomp/  see calx, lect and colf                           conu-015
c***********************************************************************conu-016
      implicit real*8 (a-h,o-z)                                         conu-017
      real*4 sp,acn1,acn2,acn3,az,bz,tg0,bn,fnug,egd,ggd,tg1,sgsq,scn,piconu-018
     1p                                                                 conu-019
      logical lo(250)                                                   conu-020
      dimension sp(3,1),ipi(10,1),wv(15,1),ipim(10,1),wvm(15,1),nci(2,1)conu-021
     1,xd(3,1),scn(8,1),pip(11,1),ipp(11,1)                             conu-022
      common /dblpr/ chi2,chi2m,cm,ck,chb,cmb,ccz,xe,xm,xn,xz           conu-023
      common /ncomp/ nsp(3),nfiss,nrd,ncont,ncoj,acn1,acn2,ncons,nie,ncoconu-024
     1lx,ndp,ndq,az(6),bz(3),tg0,bn,fnug,egd,ggd,tg1,sgsq               conu-025
c discretisation of continuum for compound nucleus                      conu-026
      nie=0                                                             conu-027
      if (ix.eq.0) go to 1                                              conu-028
      amrd=xm/cm                                                        conu-029
      amr=wv(3,1)/cm+wv(1,1)+wv(2,1)                                    conu-030
      kxt=ipi(7,ncolx+1-ncont)                                          conu-031
    1 do 14 i=1,ncont                                                   conu-032
      iv=i-ncont+ncolx                                                  conu-033
      nci(1,i)=nie+1                                                    conu-034
      if (wv(3,iv).le.0.) go to 13                                      conu-035
      ne=0                                                              conu-036
      e=wv(3,iv)                                                        conu-037
      acn3=1./acn2                                                      conu-038
      if (e*acn2.lt.1.d0) acn3=e/1.9d0                                  conu-039
      if (ix.eq.0) go to 2                                              conu-040
      hrec=wv(11,iv)                                                    conu-041
      rec=1.d0                                                          conu-042
      if (lo(193).and.wv(1,1).ne.wv(1,iv)) rec=wv(2,1)/wv(2,iv)         conu-043
      if (lo(108)) go to 2                                              conu-044
      amt=wv(2,iv)                                                      conu-045
      if (lo(209)) go to 2                                              conu-046
      if (lo(44)) amt=wv(2,1)                                           conu-047
      amrd=(amr**4-(wv(1,iv)**2-amt**2)**2)/(4.d0*amr**3)               conu-048
    2 if (e.le.0.d0) go to 13                                           conu-049
      nie=nie+1                                                         conu-050
      if (ne.ne.0) go to 4                                              conu-051
      if (e.lt.acn1*acn3) go to 3                                       conu-052
      estp=e/acn1                                                       conu-053
      go to 5                                                           conu-054
    3 ne=e/acn3+1.d0                                                    conu-055
      if (ne.eq.1) ne=2                                                 conu-056
      acn3=e/dfloat(ne)*1.000001 d0                                     conu-057
    4 estp=acn3                                                         conu-058
    5 if (e.lt.estp) estp=e                                             conu-059
      ecn=e-.5d0*estp                                                   conu-060
      e=e-estp                                                          conu-061
      if (ix.eq.0) go to 2                                              conu-062
      do 6 k=1,15                                                       conu-063
    6 wvm(k,nie)=wv(k,iv)                                               conu-064
      do 7 k=1,10                                                       conu-065
    7 ipim(k,nie)=ipi(k,iv)                                             conu-066
      wvm(3,nie)=ecn                                                    conu-067
      xd(2,nie)=estp                                                    conu-068
      if (lo(8)) go to 8                                                conu-069
      wsk2=ck*wvm(3,nie)*amrd                                           conu-070
      go to 9                                                           conu-071
    8 wvm(2,nie)=wv(1,1)+wv(2,1)-wvm(1,nie)+ecn/cm                      conu-072
      wsk2=0.125d0*ck*wvm(3,nie)*(wvm(3,nie)/cm+2.d0*wvm(1,nie)+2.d0*amtconu-073
     1)*(wvm(3,nie)/cm+2.d0*wvm(1,nie))*(wvm(3,nie)/cm+2.d0*amt)/amr**2 conu-074
    9 wvm(4,nie)=dsqrt(dabs(wsk2))                                      conu-075
      wvm(9,nie)=wvm(4,nie)*rec                                         conu-076
      wvm(8,nie)=hrec*dsqrt(ck*amrd)                                    conu-077
      wvm(10,nie)=hrec*hrec*wsk2                                        conu-078
      if (lo(209)) go to 10                                             conu-079
      wvm(5,nie)=0.5d0*ck*ccz*amrd*sp(3,iv)/wvm(4,nie)                  conu-080
      go to 11                                                          conu-081
   10 hpc=chb*wvm(4,nie)                                                conu-082
      wvm(7,nie)=dsqrt(hpc**2+xm**2)                                    conu-083
      wvm(5,nie)=ccz*sp(3,iv)/wvm(4,nie)*wvm(7,nie)/chb**2              conu-084
   11 ly=4.d0+3.3d0*dsqrt(wvm(3,nie))                                   conu-085
      if (dabs(wvm(5,nie)).gt.400.d0) go to 13                          conu-086
      ipim(9,nie)=ly-1                                                  conu-087
      ipim(7,nie)=kxt                                                   conu-088
      kxt=kxt+ly*ipim(2,nie)                                            conu-089
      if (wv(3,1)-wvm(3,nie).gt.scn(6,i)) go to 12                      conu-090
      xd(1,nie)=xd(2,nie)*dexp((wv(3,1)-wvm(3,nie)-scn(5,i))/scn(3,i))/sconu-091
     1cn(3,i)                                                           conu-092
      xd(3,nie)=2.*scn(4,i)**2                                          conu-093
      go to 2                                                           conu-094
   12 exd=wv(3,1)-wvm(3,nie)+scn(2,i)-scn(6,i)                          conu-095
      ebyt=dsqrt(scn(1,i)*exd)                                          conu-096
      xd(1,nie)=xd(2,nie)*dexp(2.d0*ebyt)/(ebyt*exd*scn(8,i))           conu-097
      xd(3,nie)=2.*scn(4,i)**2*dsqrt(exd/scn(2,i))                      conu-098
      go to 2                                                           conu-099
   13 if (ix.eq.0) go to 14                                             conu-100
      jy=nie-nci(1,i)+1                                                 conu-101
      write (2,1000) i,jy                                               conu-102
      nci(2,i)=nie                                                      conu-103
   14 continue                                                          conu-104
      if (ix.ne.0) call disp(1,ipim,wvm,ipp,pip,n,nie,m,lo)             conu-105
      return                                                            conu-106
 1000 format (15h ***** start of,i4,18hth continuum *****,5x,i5,22h discconu-107
     1retisation points)                                                conu-108
      end                                                               conu-109
c 22/04/98  ibm version                                         ecis97  quan-000
      subroutine quan(ncoll,sp,wv,ipi,niv,iq,tq,ivq,ivz,mc,cc,nat,at,dt,quan-001
     1it,nvi,kab,kbc,aa,fac,nfa,idmt,nmax,id,lo)                        quan-002
c input variables: ncoll:   number of coupled nuclear states            quan-003
c                  sp,wv:   see calx                                    quan-004
c                  ipi:     projectile and target multiplicity, parity  quan-005
c                           and maximum angular momentum.  see calx     quan-006
c                  niv(i1,i2,1/2): first/last address in the table of   quan-007
c                           reduced nuclear matrix elements. see redm   quan-008
c                  iq,tq:   table of reduced nuclear matrix elements    quan-009
c                  ivq(i):  table of multipoles.   see redm             quan-010
c                  ivz(i):  table of form factors.   see redm           quan-011
c                  kab:     maximum number of coupled channels          quan-012
c                  kbc:     maximum number of solutions                 quan-013
c                  fac:     table of logarithms of factorials           quan-014
c                  nfa:     length of fac                               quan-015
c                  idmt:    available total working space               quan-016
c                  nmax:  available length of dt/at/nat(less 100 for 9j)quan-017
c                  id:      first dimension of tables nat and at        quan-018
c                  lo(i):   logical controls. see comments in calc      quan-019
c in common /ncomp/  parametrisation of the deformed spin-orbit         quan-020
c in common /pote2/ity(5):  number of diagonal potentials               quan-021
c                  intv:    number of non spin-orbit form factors       quan-022
c                  insl:    number of spin-orbit form factors           quan-023
c in common /noequ/jpi:     channel parity (0/1)                        quan-024
c                  aj:      channel spin                                quan-025
c output variables:mc(ic,i) equivalent with cc(ic,i)                    quan-026
c                      mc(ic,1): nuclear state numbers, ic = 1,nc       quan-027
c                      mc(ic,2): orbital momentum                       quan-028
c                      cc(ic,3): orbital spin                           quan-029
c                      mc(ic,4): reference to potential or copy         quan-030
c                      cc(ic,5): lc*(lc+1)                              quan-031
c                      cc(ic,6): eigenvalue of l.s                      quan-032
c                  at(id,i),nat(id,i),dt(i) in equivalence by call      quan-033
c                       table of coupling coefficients for i=1,it       quan-034
c                    nat(1,i)  address of the form factor, negative for quan-035
c                        a complex term                                 quan-036
c                    at(2,i)  geometrical coefficient                   quan-037
c                    at(3,i)  idem for small components (dirac equation)quan-038
c                  it: number of non zero coupling coefficients         quan-039
c                  nvi(i1,i2,1-3): address in the table at(i), analogousquan-040
c                    to the niv addresses: nvi(i1,i2,1) to nvi(i1,i2,2) quan-041
c                    for the non derivatives couplings, nvi(i1,i2,2)+1  quan-042
c                    to nvi(i1,i2,3)  for the derivative couplings      quan-043
c for identical particle and target, mc and cc results are in mc(*,*+7) quan-044
c    nat and at results are after the usual ones, nvi results are in    quan-045
c    nvi(*,*,*+3), nc and ncin are different from nic and nci.          quan-046
c    the coefficients of the symmetrisation are in aa.                  quan-047
c in common /noequ/nic:  number of equations at the channel spin aj     quan-048
c                  nci:  number of solutions                            quan-049
c                  nc:   number of equations for identical particles    quan-050
c                  ncin: number of solutions for identical particles    quan-051
c                  nin:  number of coupling potentials                  quan-052
c working space:   dt(i):   double precision, working space for dj9j    quan-053
c***********************************************************************quan-054
      logical lo(250),llo                                               quan-055
      double precision fac(1),a1,a2,cmatel,dj6j,dj9j,dcgs,fx,dt(1),wv(15quan-056
     1,1),aa(kbc,1),cx,a,f1,f2,f3                                       quan-057
      dimension niv(ncoll,ncoll,3),nvi(kab,kab,6),nat(id,1),at(id,1),mc(quan-058
     1kab,10),cc(kab,12),sp(3,1),ivz(4,1),ipi(10,1),ivq(3,1),ip(2),iq(4,quan-059
     21),tq(4,1)                                                        quan-060
      common /ncomp/ nsp(7),ac(2),ncos(5),az1,az2,az3,az4,az5,az6,bz(10)quan-061
      common /pote2/ ity(8),invt,intv,insl,npx                          quan-062
      common /noequ/ ncxn,nic,nci,nc,ncin,nin,jpi,ipj,aj,r1(2)          quan-063
      data ip /2h+ ,2h- /                                               quan-064
c find quantum number of coupled channels                               quan-065
      nc=0                                                              quan-066
      ia=2.*aj+.1                                                       quan-067
      do 6 i=1,ncoll                                                    quan-068
      sj1=aj-sp(2,i)                                                    quan-069
      sj2=abs(sj1)-.1                                                   quan-070
      nj=ipi(3,i)                                                       quan-071
      nl=ipi(2,i)                                                       quan-072
      do 5 j=1,nj                                                       quan-073
      l1=(ia-nj-nl)/2+j                                                 quan-074
      l2=iabs(l1)                                                       quan-075
      do 4 k=1,nl                                                       quan-076
      if (mod(l1+ipi(1,i)+jpi,2).ne.0) go to 3                          quan-077
      if ((l1.lt.l2).or.(sj1.lt.sj2).or.(l1.gt.ipi(9,i))) go to 3       quan-078
      nc=nc+1                                                           quan-079
      mc(nc,4)=ipi(10,i)                                                quan-080
      if (lo(228)) go to 2                                              quan-081
      if (lo(100)) mc(nc,4)=i                                           quan-082
      do 1 m=nc,kab                                                     quan-083
      if (mc(m,1).ne.i) go to 1                                         quan-084
      if (mc(m,2).ne.l1) go to 1                                        quan-085
      if (cc(m,3).ne.sj1) go to 1                                       quan-086
      mc(nc,4)=-m                                                       quan-087
      go to 2                                                           quan-088
    1 continue                                                          quan-089
    2 mc(nc,1)=i                                                        quan-090
      mc(nc,2)=l1                                                       quan-091
      cc(nc,3)=sj1                                                      quan-092
      cc(nc,5)=mc(nc,2)*(mc(nc,2)+1)                                    quan-093
      cc(nc,6)=cc(nc,3)*(cc(nc,3)+1.)-sp(1,i)*(sp(1,i)+1.)-cc(nc,5)     quan-094
    3 l1=l1+1                                                           quan-095
    4 continue                                                          quan-096
    5 sj1=sj1+1.                                                        quan-097
      if (i.ne.1) go to 6                                               quan-098
      ncin=nc                                                           quan-099
      if (ncin.eq.0) return                                             quan-100
    6 continue                                                          quan-101
      if (lo(58)) write (2,1000) aj,ip(jpi+1),nc,ncin,(j,mc(j,1),mc(j,2)quan-102
     1,cc(j,3),mc(j,4),cc(j,5),cc(j,6),j=1,nc)                          quan-103
c computation of coupling coefficients for the form factors             quan-104
c when the spin-orbit is deformed,there is no symmetry, the total       quan-105
c table is calculated. with no spin-orbit deformation,only one half is  quan-106
c calculated. lo(210) returns .true. if they are derivative couplings   quan-107
      lo(210)=.false.                                                   quan-108
      it=0                                                              quan-109
      nin=0                                                             quan-110
      invz=intv+ity(5)                                                  quan-111
      do 39 i1=1,nc                                                     quan-112
      j1=mc(i1,1)                                                       quan-113
      k1=ipi(10,j1)                                                     quan-114
      if (lo(100)) k1=j1                                                quan-115
      if (lo(227)) mc(i1,4)=k1                                          quan-116
      do 38 i2=1,i1                                                     quan-117
      j2=mc(i2,1)                                                       quan-118
      a2=wv(8,j1)*wv(8,j2)                                              quan-119
      it1=it+1                                                          quan-120
      nvi(i2,i1,1)=it1                                                  quan-121
      k1=niv(j2,j1,1)                                                   quan-122
      k2=niv(j2,j1,2)                                                   quan-123
      if (k1.gt.k2) go to 30                                            quan-124
      if (4*(k2-k1+3+it).gt.nmax) call memo(idmt,idmt+4*(k2-k1+3+it)-nmaquan-125
     1x,nmax,3,lo)                                                      quan-126
      if (lo(216)) go to 67                                             quan-127
      il=2*mc(i2,2)                                                     quan-128
      ilp=2*mc(i1,2)                                                    quan-129
      isj=2.*cc(i2,3)+.1                                                quan-130
      isjp=2.*cc(i1,3)+.1                                               quan-131
      iai=ipi(3,j2)-1                                                   quan-132
      iaip=ipi(3,j1)-1                                                  quan-133
      is=ipi(2,j2)-1                                                    quan-134
      isp=ipi(2,j1)-1                                                   quan-135
      do 20 k=k1,k2                                                     quan-136
      ni=iq(2,k)                                                        quan-137
c coefficient of a central multipole with angular momentum iq=ivq(1,ni) quan-138
c transfer of spin is=ivq(2,ni)/2 and of total momentum ij=ivq(3,ni)/2  quan-139
c noting the spin s,the orbital angular momentum l,the total spin of thequan-140
c particle j,the spin of the target ai,the eigenvalue of l.s g......    quan-141
c and 'k'=sqrt(2*k+1)   the most general expression of (i2||iq||i1) is  quan-142
c  (-)**(aj+ai2+1+j1+(l2+iq-l1)/2)*'l1'*'l2'*'j1'*'j2'*'iq'*'ij'*       quan-143
c cgs(iq,l2,l1)*c6j(j1,ij,j2,ai2,aj,ai1)*c9j(l2,l1,iq,s2,s1,is,j2,j1,ij)quan-144
c in a macroscopic model, is=0 and ij=iq, the expressions used are      quan-145
c  (-)**(aj+ai2+1-s+(l1+l2+iq)/2)*'l1'*'l2'*'j1'*'j2'*'iq'*cgs(iq,l2,l1)quan-146
c    *c6j(j1,iq,j2,ai2,aj,ai1)*c6j(l1,iq,l2,j2,s,j1)                    quan-147
c for s=1/2 (-)**(aj+ai2-j2+(l1-l2+iq)/2)*'iq'*cgs(iq,j2,j1)            quan-148
c for s=0   (-)**(aj+ai2+1+(l1+l2+iq)/2)*'l1'*'l2'*'iq'*cgs(iq,l2,l1)*  quan-149
c           c6j(l1,iq,l2,ai2,aj,ai1)                                    quan-150
      iiq=2*ivq(1,ni)                                                   quan-151
      do 14 ix=2,id                                                     quan-152
      cx=0.d0                                                           quan-153
      cmatel=0.d0                                                       quan-154
      if ((iiq.gt.il+ilp).or.(iiq.lt.iabs(il-ilp))) go to 11            quan-155
      fx=1.d0                                                           quan-156
      kk=mc(i1,2)+mc(i2,2)+ivq(1,ni)                                    quan-157
      iis=ivq(2,ni)                                                     quan-158
      if (iis.lt.0) go to 9                                             quan-159
      iij=ivq(3,ni)                                                     quan-160
      cmatel=dj6j(isj,iij,isjp,iaip,ia,iai,fac,nfa)                     quan-161
      a1=iij+1                                                          quan-162
      if (is.gt.1.or.iis.ne.0) go to 7                                  quan-163
      cmatel=cmatel*dcgs(iij,isjp,isj,fac,nfa)                          quan-164
      kk=kk+ia+iaip                                                     quan-165
      if (is.eq.1) kk=kk+2+il-isjp                                      quan-166
      if (is.ne.1) a1=a1*(isj+1)*(isjp+1)                               quan-167
      go to 10                                                          quan-168
    7 a1=a1*(il+1)*(ilp+1)                                              quan-169
      a1=a1*(isj+1)*(isjp+1)                                            quan-170
      kk=(ia+iaip-is)+kk                                                quan-171
      cmatel=cmatel*dcgs(iiq,ilp,il,fac,nfa)                            quan-172
      if (iis.ne.0) go to 8                                             quan-173
      fx=dj6j(il,isj,is,isjp,ilp,iij,fac,nfa)                           quan-174
      go to 10                                                          quan-175
    8 cmatel=cmatel*dj9j(il,ilp,iiq,is,isp,iis,isj,isjp,iij,dt(id*it+1),quan-176
     1100)                                                              quan-177
      a1=a1*(iiq+1)*(iis+1)                                             quan-178
      kk=kk+isjp+ilp+is                                                 quan-179
      go to 10                                                          quan-180
c magnetic coulomb excitation of the particle:                          quan-181
    9 iij=iiq-2                                                         quan-182
      if (iiq.gt.il+ilp+2.or.iiq.lt.iabs(il-ilp)+2) go to 11            quan-183
      cmatel=dj6j(isj,isjp,iij,ilp,il,is,fac,nfa)*dj6j(isj,isjp,iiq-2,iaquan-184
     1ip,iai,ia,fac,nfa)*dcgs(iiq,ilp,il,fac,nfa)                       quan-185
      kk=kk+ia+iaip-is-2                                                quan-186
      a1=(iiq+1)**3*float((isj+1)*(isjp+1))*float((il+1)*(ilp+1))*float(quan-187
     1(il+ilp+iiq+2)*(il+ilp-iij))*(il-ilp+iiq)*(ilp-il+iiq)/float((iiq-quan-188
     21)*iij)**2/16.                                                    quan-189
   10 if (mod(kk,4).eq.0) cmatel=-cmatel                                quan-190
      cmatel=tq(4,k)*cmatel*dsqrt(a1)                                   quan-191
      cx=cmatel*fx                                                      quan-192
   11 if (ix.eq.3) go to 12                                             quan-193
      it=it+1                                                           quan-194
      nat(1,it)=iq(1,k)                                                 quan-195
   12 at(ix,it)=cx*a2                                                   quan-196
      if (lo(200)) go to 15                                             quan-197
      if (ix.eq.3) go to 20                                             quan-198
      if (iiq.ne.iij) go to 13                                          quan-199
      at(3,it)=at(2,it)                                                 quan-200
      if (iis.ne.0) at(3,it)=-at(3,it)                                  quan-201
      go to 20                                                          quan-202
   13 il=2*isj-il                                                       quan-203
   14 ilp=2*isjp-ilp                                                    quan-204
   15 nat(1,it)=nat(1,it)+ity(5)                                        quan-205
      if (lo(12)) nat(1,it)=-nat(1,it)                                  quan-206
      if (iq(3,k).eq.0) go to 20                                        quan-207
c deformed spin-orbit                                                   quan-208
c form factor (1/r)(d/dr)v(r)         coefficient:  (i2||iq||i1)*g1     quan-209
c parametrisation:  (i2||iq||i1)*(az3*g1+az4*g2+az1)                    quan-210
      a=cx*(cc(i2,6)*az3+cc(i1,6)*az4+az1)                              quan-211
      if (abs(a).lt.1.e-10) go to 16                                    quan-212
      it=it+1                                                           quan-213
      nat(1,it)=iq(3,k)+invz                                            quan-214
      if (lo(14)) nat(1,it)=-nat(1,it)                                  quan-215
      at(2,it)=2.*a*a2                                                  quan-216
c form factor v(r)/r**2   coefficient: (i2||iq||i1)*(s*(iq*(iq+1)-l1*(l1quan-217
c   +1)-l2*(l2+1)+g2*(1+g1)/(2*s))+xxx)                                 quan-218
c parametrisation:   (i2||iq||i1)*az5*(s*(iq*(iq+1)*az2........         quan-219
c xxx is -sqrt(f1*f2)*c6j(l1,j1,s-1,j2,l2,iq)/(2*s*c6j(l1,j1,s,j2,l2,iq)quan-220
c  with f=(l*l+l-(j-s)*(j-s+1))*((j+s)*(j+s+1)-l*l-l)                   quan-221
c  for s=1/2  xxx=0                                                     quan-222
c  for s=1  xxx=-4*l1*l2*(l1+1)*(l2+1)/iq*iq+iq-l1*l1-l1-l2*l2-l2)      quan-223
c when j1=l1 and j2=l2 , else  xxx=0                                    quan-224
   16 azi=ivq(1,ni)*(ivq(1,ni)+1)                                       quan-225
      aspi=is                                                           quan-226
      smatel=(sp(1,j1)*(az2*azi-cc(i1,5)-cc(i2,5))+cc(i1,6)*(1.+cc(i2,6)quan-227
     1/aspi))*fx                                                        quan-228
      if (is-2) 19 , 17 , 18                                            quan-229
   17 if (il.ne.isj.or.ilp.ne.isjp) go to 19                            quan-230
      a1=azi-cc(i1,5)-cc(i2,5)                                          quan-231
      if (a1.eq.0.) go to 18                                            quan-232
      smatel=smatel-4.*cc(i1,5)*cc(i2,5)*fx/a1                          quan-233
      go to 19                                                          quan-234
   18 f1=(cc(i1,5)-(cc(i1,3)-sp(1,j1))*(cc(i1,3)-sp(1,j1)+1.))*((cc(i1,3quan-235
     1)+sp(1,j1))*(cc(i1,3)+sp(1,j1)+1.)-cc(i1,5))                      quan-236
      f2=(cc(i2,5)-(cc(i2,3)-sp(1,j1))*(cc(i2,3)-sp(1,j1)+1.))*((cc(i2,3quan-237
     1)+sp(1,j1))*(cc(i2,3)+sp(1,j1)+1.)-cc(i2,5))                      quan-238
      f3=f1*f2                                                          quan-239
      if (f3.gt.0.d0) smatel=smatel-dsqrt(f3)*dj6j(il,isj,is-2,isjp,ilp,quan-240
     1iiq,fac,nfa)/aspi                                                 quan-241
   19 a=cmatel*az5*smatel                                               quan-242
      if (abs(a).lt.1.e-10) go to 20                                    quan-243
      it=it+1                                                           quan-244
      nat(1,it)=iq(3,k)+invz+insl                                       quan-245
      if (lo(14)) nat(1,it)=-nat(1,it)                                  quan-246
      at(2,it)=2.d0*a*a2                                                quan-247
   20 continue                                                          quan-248
      llo=.false.                                                       quan-249
   21 if (it-it1) 30 , 25 , 22                                          quan-250
c  summation of coefficients related to the same form factor            quan-251
   22 it2=it-1                                                          quan-252
      do 24 i=it1,it2                                                   quan-253
      do 23 j=i,it2                                                     quan-254
      if (nat(1,i).ne.nat(1,j+1)) go to 23                              quan-255
      at(2,i)=at(2,i)+at(2,j+1)                                         quan-256
      at(2,j+1)=0.                                                      quan-257
      if (lo(200)) go to 23                                             quan-258
      at(3,i)=at(3,i)+at(3,j+1)                                         quan-259
      at(3,j+1)=0.                                                      quan-260
   23 continue                                                          quan-261
   24 continue                                                          quan-262
c elimination of too small coefficients                                 quan-263
   25 it2=it                                                            quan-264
      it=it1-1                                                          quan-265
      nmr=0                                                             quan-266
      nmi=0                                                             quan-267
      do 26 i=it1,it2                                                   quan-268
      cx=abs(at(2,i))                                                   quan-269
      if (lo(100)) cx=cx+abs(at(3,i))                                   quan-270
      if (cx.lt.1.e-10) go to 26                                        quan-271
      it=it+1                                                           quan-272
      nat(1,it)=nat(1,i)                                                quan-273
      at(2,it)=at(2,i)                                                  quan-274
      if (lo(100)) at(3,it)=at(3,i)                                     quan-275
      nmr=nmr+1                                                         quan-276
      if (nat(1,it).lt.0) nmi=nmi+1                                     quan-277
   26 continue                                                          quan-278
      if (nmr.ne.0) nin=nin+1                                           quan-279
      if (nmi.ne.0) nin=nin+1                                           quan-280
      if (llo) go to 34                                                 quan-281
      if (lo(113).and.lo(119)) go to 30                                 quan-282
      nvi(i2,i1,2)=it                                                   quan-283
c coefficients of the derivative coupling                               quan-284
c form factor  v(r)/r**2  coefficient: (i2||iq||i1)*(g1-g2)             quan-285
c parametrisation: (i2||iq||i1)*(g1-g2)*az6                             quan-286
      it2=it                                                            quan-287
      if (lo(100)) go to 28                                             quan-288
      do 27 i=it1,it2                                                   quan-289
      if (iabs(nat(1,i)).gt.invz) go to 27                              quan-290
      ij=iabs(nat(1,i))-ity(5)                                          quan-291
      if (ivz(3,ij).eq.0) go to 27                                      quan-292
      a=at(2,i)*(cc(i2,6)-cc(i1,6))*az6*2.                              quan-293
      if (abs(a).lt.1.e-10) go to 27                                    quan-294
      lo(210)=.true.                                                    quan-295
      it=it+1                                                           quan-296
      nat(1,it)=ivz(3,ij)+invz+insl                                     quan-297
      if (lo(14)) nat(1,it)=-nat(1,it)                                  quan-298
      at(2,it)=a                                                        quan-299
   27 continue                                                          quan-300
      go to 31                                                          quan-301
   28 do 29 i=it1,it2                                                   quan-302
      ij=nat(1,i)                                                       quan-303
      if (ivz(3,ij).eq.0) go to 29                                      quan-304
      lo(210)=.true.                                                    quan-305
      it=it+1                                                           quan-306
      nat(1,it)=ivz(3,ij)+intv                                          quan-307
      at(2,it)=at(2,i)                                                  quan-308
      at(3,it)=at(2,it)*(cc(i2,6)-cc(i1,6))                             quan-309
   29 continue                                                          quan-310
      if (it.gt.it2) nin=nin+1                                          quan-311
      go to 31                                                          quan-312
   30 nvi(i2,i1,2)=it                                                   quan-313
   31 nvi(i2,i1,3)=it                                                   quan-314
      if (lo(100).or.(nvi(i2,i1,3).eq.nvi(i2,i1,2))) go to 36           quan-315
c copy of the coefficients and corrections in order to obtain           quan-316
c an hermitian interaction                                              quan-317
      k1=nvi(i2,i1,1)                                                   quan-318
      k2=nvi(i2,i1,2)                                                   quan-319
      it1=it+1                                                          quan-320
      nvi(i1,i2,1)=it1                                                  quan-321
      do 32 k=k1,k2                                                     quan-322
      it=it+1                                                           quan-323
      nat(1,it)=nat(1,k)                                                quan-324
   32 at(2,it)=at(2,k)                                                  quan-325
      k1=k2+1                                                           quan-326
      k2=nvi(i2,i1,3)                                                   quan-327
      do 33 k=k1,k2                                                     quan-328
      it=it+1                                                           quan-329
      nat(1,it)=nat(1,k)-insl                                           quan-330
      if (nat(1,k).lt.0) nat(1,it)=nat(1,it)+2*insl                     quan-331
      at(2,it)=-at(2,k)                                                 quan-332
      it=it+1                                                           quan-333
      nat(1,it)=nat(1,k)                                                quan-334
   33 at(2,it)=at(2,k)                                                  quan-335
      llo=.true.                                                        quan-336
      go to 21                                                          quan-337
   34 nvi(i1,i2,2)=it                                                   quan-338
      do 35 k=k1,k2                                                     quan-339
      it=it+1                                                           quan-340
      nat(1,it)=nat(1,k)                                                quan-341
   35 at(2,it)=-at(2,k)                                                 quan-342
      nvi(i1,i2,3)=it                                                   quan-343
      nin=nin+2                                                         quan-344
      if (lo(14)) nin=nin+2                                             quan-345
      go to 38                                                          quan-346
c symmetrisation of the table when there is no deformed spin-orbit      quan-347
   36 do 37 k=1,3                                                       quan-348
   37 nvi(i1,i2,k)=nvi(i2,i1,k)                                         quan-349
   38 continue                                                          quan-350
   39 continue                                                          quan-351
      if (lo(158)) go to 40                                             quan-352
c output of coupling coefficients                                       quan-353
      write (2,1001) ((j,i,(nvi(j,i,k),k=1,3),i=1,nc),j=1,nc)           quan-354
      if (it.eq.0) go to 40                                             quan-355
      if (lo(200)) write (2,1002) (i,nat(1,i),at(2,i),i=1,it)           quan-356
      if (lo(100)) write (2,1003) (i,nat(1,i),at(2,i),at(3,i),i=1,it)   quan-357
   40 nci=ncin                                                          quan-358
      nic=nc                                                            quan-359
      if (.not.lo(231)) return                                          quan-360
c find quantum number of coupled channels for identical particles. not  quan-361
c used for dirac formalism (incorrect meaning of cc(*,10[3]) in mtch)   quan-362
      ncin=0                                                            quan-363
      ja=ia/2                                                           quan-364
      isi=ipi(2,1)-1                                                    quan-365
      nsm=isi+1                                                         quan-366
      nsb=jpi+1                                                         quan-367
      do 42 is=nsb,nsm,2                                                quan-368
      lp=ja+is                                                          quan-369
      lm=iabs(ja-is+1)+1                                                quan-370
      do 41 l=lm,lp                                                     quan-371
      if (mod(l+jpi,2).ne.1) go to 41                                   quan-372
      ncin=ncin+1                                                       quan-373
      mc(ncin,10)=ipi(10,1)                                             quan-374
      mc(ncin,7)=1                                                      quan-375
      mc(ncin,8)=l-1                                                    quan-376
      cc(ncin,9)=is-1                                                   quan-377
      cc(ncin,11)=mc(ncin,8)*(mc(ncin,8)+1)                             quan-378
      cc(ncin,12)=0.5*(aj*(aj+1.)-l*(l-1)-is*(is-1))                    quan-379
   41 continue                                                          quan-380
   42 continue                                                          quan-381
      nc=ncin                                                           quan-382
      if (lo(58)) write (2,1004) nci,ncin                               quan-383
      if (ncin.eq.0) return                                             quan-384
      if (nic.eq.nci) go to 44                                          quan-385
      n=nci+1                                                           quan-386
      do 43 i=n,nic                                                     quan-387
      nc=nc+1                                                           quan-388
      mc(nc,7)=mc(i,1)                                                  quan-389
      mc(nc,8)=mc(i,2)                                                  quan-390
      cc(nc,9)=cc(i,3)                                                  quan-391
      mc(nc,10)=mc(i,4)                                                 quan-392
      cc(nc,11)=cc(i,5)                                                 quan-393
   43 cc(nc,12)=cc(i,6)                                                 quan-394
   44 if (lo(58)) write (2,1000) aj,ip(jpi+1),nc,ncin,(j,mc(j,7),mc(j,8)quan-395
     1,cc(j,9),mc(j,10),cc(j,11),cc(j,12),j=1,nc)                       quan-396
c computation of transformation coefficients                            quan-397
      iti=it+1                                                          quan-398
      do 46 j=1,ncin                                                    quan-399
      do 45 i=1,nci                                                     quan-400
      aa(i,j)=0.d0                                                      quan-401
      if (mc(j,8).ne.mc(i,2)) go to 45                                  quan-402
      ij=2.*cc(i,3)+.1                                                  quan-403
      is=2.*cc(j,9)+.1                                                  quan-404
      aa(i,j)=(1-mod(2*mc(i,2)+ia+2*isi,4))*dsqrt((ij+1.d0)*(is+1.d0))*dquan-405
     1j6j(2*mc(i,2),isi,ij,isi,ia,is,fac,nfa)                           quan-406
   45 continue                                                          quan-407
   46 continue                                                          quan-408
      lo(210)=.false.                                                   quan-409
      nin=0                                                             quan-410
      ni=nci-ncin                                                       quan-411
      ibb=2                                                             quan-412
      if ((lo(201).and.lo(203)).or.lo(200)) ibb=1                       quan-413
      do 66 i1=1,nc                                                     quan-414
      if (i1.gt.ncin) go to 47                                          quan-415
      j1=1                                                              quan-416
      k1=nci                                                            quan-417
      go to 48                                                          quan-418
   47 j1=i1+ni                                                          quan-419
      k1=j1                                                             quan-420
   48 do 65 i2=1,nc                                                     quan-421
      if ((i2.gt.i1).and.(ibb.eq.1)) go to 66                           quan-422
      do 63 ib=1,ibb                                                    quan-423
      if (i2.gt.ncin) go to 49                                          quan-424
      j2=1                                                              quan-425
      k2=nci                                                            quan-426
      go to 50                                                          quan-427
   49 j2=i2+ni                                                          quan-428
      k2=j2                                                             quan-429
   50 it1=it+1                                                          quan-430
      if (ib.eq.1) nvi(i2,i1,4)=it1                                     quan-431
      do 54 l1=j1,k1                                                    quan-432
      a1=1.d0                                                           quan-433
      if (l1.le.nci) a1=aa(l1,i1)                                       quan-434
      if (a1.eq.0.d0) go to 54                                          quan-435
      do 53 l2=j2,k2                                                    quan-436
      a2=1.d0                                                           quan-437
      if (l2.le.nci) a2=aa(l2,i2)                                       quan-438
      if (a2.eq.0.d0) go to 53                                          quan-439
      m1=nvi(l2,l1,ib)                                                  quan-440
      m2=nvi(l2,l1,ib+1)                                                quan-441
      if (ib.eq.2) m1=m1+1                                              quan-442
      if (m1.gt.m2) go to 53                                            quan-443
      if (4*(m2-m1+3+it).gt.nmax) call memo(idmt,idmt+4*(k2-k1+3+it)-nmaquan-444
     1x,nmax,3,lo)                                                      quan-445
      if (lo(216)) go to 67                                             quan-446
      do 52 m=m1,m2                                                     quan-447
      it=it+1                                                           quan-448
      nat(1,it)=nat(1,m)                                                quan-449
      do 51 ix=2,id                                                     quan-450
   51 at(ix,it)=at(ix,m)*a1*a2                                          quan-451
   52 continue                                                          quan-452
   53 continue                                                          quan-453
   54 continue                                                          quan-454
      if (it-it1) 62 , 59 , 55                                          quan-455
c  summation of coefficients related to the same form factor            quan-456
   55 it2=it-1                                                          quan-457
      do 58 i=it1,it2                                                   quan-458
      do 57 j=i,it2                                                     quan-459
      if (nat(1,i).ne.nat(1,j+1)) go to 57                              quan-460
      do 56 ix=2,id                                                     quan-461
      at(ix,i)=at(ix,i)+at(ix,j+1)                                      quan-462
   56 at(ix,j+1)=0.                                                     quan-463
   57 continue                                                          quan-464
   58 continue                                                          quan-465
c elimination of too small coefficients                                 quan-466
   59 it2=it                                                            quan-467
      it=it1-1                                                          quan-468
      nmr=0                                                             quan-469
      nmi=0                                                             quan-470
      do 61 i=it1,it2                                                   quan-471
      cx=abs(at(2,i))                                                   quan-472
      if (lo(100)) cx=cx+abs(at(3,i))                                   quan-473
      if (cx.lt.1.e-10) go to 61                                        quan-474
      it=it+1                                                           quan-475
      nat(1,it)=nat(1,i)                                                quan-476
      do 60 ix=2,id                                                     quan-477
   60 at(ix,it)=at(ix,i)                                                quan-478
      if (lo(100)) at(3,it)=at(3,i)                                     quan-479
      nmr=nmr+1                                                         quan-480
      if (nat(1,it).lt.0) nmi=nmi+1                                     quan-481
   61 continue                                                          quan-482
      if (nmr.ne.0) nin=nin+1                                           quan-483
      if (nmi.ne.0) nin=nin+1                                           quan-484
      if ((ib.eq.2).and.(nmr.ne.0)) lo(210)=.true.                      quan-485
   62 nvi(i2,i1,ib+4)=it                                                quan-486
   63 continue                                                          quan-487
      if (ibb.eq.2) go to 66                                            quan-488
      nvi(i2,i1,6)=it                                                   quan-489
c symmetrisation of the table when there is no deformed spin-orbit      quan-490
      do 64 k=4,6                                                       quan-491
   64 nvi(i1,i2,k)=nvi(i2,i1,k)                                         quan-492
   65 continue                                                          quan-493
   66 continue                                                          quan-494
      if (lo(158)) return                                               quan-495
c output of coupling coefficients                                       quan-496
      write (2,1001) ((i,j,(nvi(i,j,k),k=4,6),i=1,nc),j=1,nc)           quan-497
      if (it.lt.iti) return                                             quan-498
      if (lo(200)) write (2,1002) (i,nat(1,i),at(2,i),i=iti,it)         quan-499
      if (lo(100)) write (2,1003) (i,nat(1,i),at(2,i),at(3,i),i=iti,it) quan-500
      return                                                            quan-501
   67 write (2,1005)                                                    quan-502
      stop                                                              quan-503
 1000 format (/24h channel spin and parity,f6.1,a2,i10,21h coupled channquan-504
     1els and,i3,10h solutions//8x,2h i,3x,2h v,3x,2h l,3x,2h j,9x,4h poquan-505
     2t,5x,3h cl,6x,3h cj//(5x,3i5,f6.1,i11,2f9.1))                     quan-506
 1001 format (/77h pairs of channels n1 n2, and coupling coefficient numquan-507
     1bers nvi(n1,n2,k),k=1,3/(1x,6(i3,i3,1h,,3i4,1h;)))                quan-508
 1002 format (//5x,12hcoefficients/(4(2x,2i4,1p,e15.6)))                quan-509
 1003 format (//5x,12hcoefficients/(3(2x,2i4,1p,2e15.6)))               quan-510
 1004 format (/33h number of solutions reduced from,i3,3h to,i3)        quan-511
 1005 format (22h in quan  ... stop ...)                                quan-512
      end                                                               quan-513
c 29/10/85  ibm version                                         ecis88  dcgs-000
      function dcgs(l,j1,j2,fac,nfa)                                    dcgs-001
c   cgs(l,j1,j2) =                                                      dcgs-002
c                                 /~~~~~~~~~~~~~~~~   ( j2   l   j1  )  dcgs-003
c  cgs(l,j1,j2) = (-)**(j1+1/2)  / (2*j1+1)*(2*j2+1)  (              )  dcgs-004
c                               v                     (-1/2  0   1/2 )  dcgs-005
c  when j1 and j2 are half-integers                                     dcgs-006
c                              ( j2  l  j1 )                            dcgs-007
c  cgs(l,j1,j2) = (-)**(j1-1)  (           )                            dcgs-008
c                              (  0  0  0  )                            dcgs-009
c  when j1 and j2  are integers                                         dcgs-010
c l,j1,j2 are integer double values.                                    dcgs-011
c fac is a table of logarithm of factorials and nfa its length.         dcgs-012
c***********************************************************************dcgs-013
      implicit real*8 (a-h,o-z)                                         dcgs-014
      dimension fac(1)                                                  dcgs-015
      if (l.lt.0.or.j1.lt.0.or.j2.lt.0) go to 1                         dcgs-016
      ll=l+j1+j2+2                                                      dcgs-017
      lt=ll/2                                                           dcgs-018
      if (2*lt.ne.ll) go to 1                                           dcgs-019
      if (lt.ge.nfa) go to 1                                            dcgs-020
      l1=lt-j1                                                          dcgs-021
      l2=lt-j2                                                          dcgs-022
      l3=lt-l                                                           dcgs-023
      if (l1.le.0.or.l2.le.0.or.l3.le.0) go to 1                        dcgs-024
      l4=lt+1                                                           dcgs-025
      n1=(l1+1)/2                                                       dcgs-026
      n2=(l2+1)/2                                                       dcgs-027
      n3=(l3+1)/2                                                       dcgs-028
      n4=(l4+1)/2                                                       dcgs-029
      dcgs=dexp(fac(n4)-fac(n1)-fac(n2)-fac(n3)-.5d0*(fac(l4)-fac(l1)-fadcgs-030
     1c(l2)-fac(l3)))                                                   dcgs-031
      if (2*(n1/2).ne.n1) dcgs=-dcgs                                    dcgs-032
      if (n4-n1-n2-n3+1) 3 , 2 , 1                                      dcgs-033
    1 dcgs=0.d0                                                         dcgs-034
    2 dcgs=2.d0*dcgs                                                    dcgs-035
    3 return                                                            dcgs-036
      end                                                               dcgs-037
c 19/09/96  ibm version                                         ecis96  dj9j-000
      function dj9j(j1,j2,j3,j4,j5,j6,j7,j8,j9,aa,ito)                  dj9j-001
c computation of                                                        dj9j-002
c                                     | j1  j2  j3 |                    dj9j-003
c                                     |            |                    dj9j-004
c   9j(j1,j2,j3,j4,j5,j6,j7,j8,j9) =  | j4  j5  j6 |                    dj9j-005
c                                     |            |                    dj9j-006
c                                     | j7  j8  j9 |                    dj9j-007
c                                                                       dj9j-008
c the arguments are integer double values                               dj9j-009
c aa is a working space and ito its length                              dj9j-010
c***********************************************************************dj9j-011
      implicit real*8 (a-f)                                             dj9j-012
      dimension aa(1),j(5),ix(9),jx(3,3),js(3),jf(3),ia(5,3),ib(3)      dj9j-013
      equivalence (ix(1),jx(1,1)),(ib(1),ib1),(ib(2),ib2),(ib(3),ib3)   dj9j-014
      data ia /1,2,3,6,9,6,4,5,8,2,8,9,7,1,4/                           dj9j-015
      dj9j=0.d0                                                         dj9j-016
      ix(1)=j1                                                          dj9j-017
      ix(2)=j2                                                          dj9j-018
      ix(3)=j3                                                          dj9j-019
      ix(4)=j4                                                          dj9j-020
      ix(5)=j5                                                          dj9j-021
      ix(6)=j6                                                          dj9j-022
      ix(7)=j7                                                          dj9j-023
      ix(8)=j8                                                          dj9j-024
      ix(9)=j9                                                          dj9j-025
      do 2 i=1,3                                                        dj9j-026
      do 1 k=1,3                                                        dj9j-027
      if (jx(k,i).lt.0) go to 13                                        dj9j-028
    1 continue                                                          dj9j-029
c check of triangular relations                                         dj9j-030
      if (mod(jx(1,i)+jx(2,i)+jx(3,i),2).ne.0.or.mod(jx(i,1)+jx(i,2)+jx(dj9j-031
     1i,3),2).ne.0) go to 11                                            dj9j-032
      if (iabs(jx(1,i)-jx(2,i)).gt.jx(3,i).or.jx(1,i)+jx(2,i).lt.jx(3,i)dj9j-033
     1) return                                                          dj9j-034
      if (iabs(jx(i,1)-jx(i,2)).gt.jx(i,3).or.jx(i,1)+jx(i,2).lt.jx(i,3)dj9j-035
     1) return                                                          dj9j-036
    2 continue                                                          dj9j-037
c search of the configuration for which the sum on products of 6-j      dj9j-038
c coefficients is the smallest one                                      dj9j-039
      k1=min0(ix(3),ix(5),ix(7))                                        dj9j-040
      k2=min0(ix(2),ix(4),ix(9))                                        dj9j-041
      k3=min0(ix(1),ix(6),ix(8))                                        dj9j-042
      kt=max0(k1,k2,k3)                                                 dj9j-043
      if (kt.eq.k1) go to 6                                             dj9j-044
      if (k2.gt.k3) go to 4                                             dj9j-045
      do 3 i=1,3                                                        dj9j-046
      ii=ix(i)                                                          dj9j-047
      ix(i)=ix(i+3)                                                     dj9j-048
      ix(i+3)=ix(i+6)                                                   dj9j-049
    3 ix(i+6)=ii                                                        dj9j-050
      go to 6                                                           dj9j-051
    4 do 5 i=1,3                                                        dj9j-052
      ii=ix(i+6)                                                        dj9j-053
      ix(i+6)=ix(i+3)                                                   dj9j-054
      ix(i+3)=ix(i)                                                     dj9j-055
    5 ix(i)=ii                                                          dj9j-056
    6 do 7 k=1,3                                                        dj9j-057
      ia1=ia(1,k)                                                       dj9j-058
      ia2=ia(2,k)                                                       dj9j-059
      ia4=ia(4,k)                                                       dj9j-060
      ia5=ia(5,k)                                                       dj9j-061
      js(k)=max0(iabs(ix(ia1)-ix(ia5)),iabs(ix(ia4)-ix(ia2)))+1         dj9j-062
    7 jf(k)=min0(ix(ia1)+ix(ia5),ix(ia2)+ix(ia4))+1                     dj9j-063
      if=min0(jf(1),jf(2),jf(3))                                        dj9j-064
      kt=2+(if-max0(js(1),js(2),js(3)))/2                               dj9j-065
c loop on the three 6-j coefficients                                    dj9j-066
      itx=0                                                             dj9j-067
      az=1.d0                                                           dj9j-068
      do 9 k=1,3                                                        dj9j-069
      ij=itx                                                            dj9j-070
      ib(k)=itx+(jf(k)-if)/2                                            dj9j-071
      do 8 i=1,5                                                        dj9j-072
      ia1=ia(i,k)                                                       dj9j-073
    8 j(i)=ix(ia1)                                                      dj9j-074
      jt=2+(jf(k)-js(k))/2                                              dj9j-075
      itx=itx+jt                                                        dj9j-076
      if (itx.gt.ito) go to 12                                          dj9j-077
      at=jf(k)                                                          dj9j-078
      call dx6j(aa(1+ij),at,j,jt)                                       dj9j-079
    9 az=az*at*(j(3)+1)                                                 dj9j-080
c summation on products of 6-j                                          dj9j-081
      af=if                                                             dj9j-082
      do 10 i=2,kt                                                      dj9j-083
      dj9j=dj9j+af*aa(i+ib1)*aa(i+ib2)*aa(i+ib3)                        dj9j-084
   10 af=af-2.d0                                                        dj9j-085
c normalisation                                                         dj9j-086
      dj9j=dj9j/dsqrt(az)                                               dj9j-087
      return                                                            dj9j-088
   11 write (2,1000)                                                    dj9j-089
      return                                                            dj9j-090
   12 write (2,1001)                                                    dj9j-091
      return                                                            dj9j-092
   13 write (2,1002)                                                    dj9j-093
      return                                                            dj9j-094
 1000 format (71h integer/half-integer rule between quantum numbers trandj9j-095
     1sgressed in dj9j)                                                 dj9j-096
 1001 format (28h too many 6-j needed in dj9j)                          dj9j-097
 1002 format (34h negative angular momentum in dj9j)                    dj9j-098
      end                                                               dj9j-099
c 22/04/98  ibm version                                         ecis97  mtch-000
      subroutine mtch(nvi,ncoll,kab,wv,mc,sc,bg,nat,st,aa,ism,lmax2,niv,mtch-001
     1ivz,fg,lmax1,lmax3,kr,vco,vdo,fam,id,pjm,lo)                      mtch-002
c computation of coulomb corrections as integrals from the matching     mtch-003
c point if lo(227)=.false. or from the origin if lo(227)=.true.         mtch-004
c input variables: nvi:   addresses of couplings in table at            mtch-005
c                  nc:    number of equations                           mtch-006
c                  ncoll: number of nuclear states                      mtch-007
c                  kab:   maximum number of coupled channels            mtch-008
c                  wv:    wave numbers and coulomb parameters           mtch-009
c                  mc,sc: nuclear state number and angular momentum     mtch-010
c                  bg:    table of coulomb integrals from 0 to infinity mtch-011
c                           for coupled equations or when lo(227)=.true.mtch-012
c                  nat,st:table of coupling coefficients                mtch-013
c                  ism:   number of integration points                  mtch-014
c                  lmax2: first dimension of table bg                   mtch-015
c                  niv:   address in the table of reduced matrix elementmtch-016
c                  ivz:   table of form factors (see redm 3rd part)     mtch-017
c                  fg:    coulomb functions                             mtch-018
c                  lmax1: first dimension of table fg                   mtch-019
c                  lmax3: maximum number of coulomb integrals from the  mtch-020
c                           matching point to infinity                  mtch-021
c                  vco:   strength of tails of coulomb potentials       mtch-022
c                  vdo:   strength of tails of coulomb transitions      mtch-023
c                  id:    first dimension of nat,st                     mtch-024
c                  pjm:   coefficient of increase of imaginary potentialmtch-025
c                  lo:    logical controls                              mtch-026
c in common /dblpr/  see calc and colf                                  mtch-027
c in common /pote2/ity(5):number of diagonal potentials                 mtch-028
c                  intv:  number of form factors                        mtch-029
c                  insl:  number of spin-orbit form factors             mtch-030
c in common /noequ/ncxn:  number of solutions needed                    mtch-031
c                  nc:    number of equations                           mtch-032
c output variables:aa:    coulomb integrals from the matching point to  mtch-033
c                           infinity for iterations lo(225)=.false.     mtch-034
c                  fam(i,j): matching values and wave number for j=1 to mtch-035
c                         6, coefficient of central potential for j=7,  mtch-036
c                         coefficient of spin-orbit potential for j=8,  mtch-037
c                         energy for j=9, centrifugal potential for j=10mtch-038
c working space:   aa(1,1,i) for i=7,10 if lo(227) or lo(225)=.true.    mtch-039
c                  kr:    for lins                                      mtch-040
c local tables la(3,11) and ba(2,11) are set mcm(1)=5 and mcm(2)=4      mtch-041
c***********************************************************************mtch-042
      implicit real*8 (a-h,w-z)                                         mtch-043
      logical lo(250),lv                                                mtch-044
      dimension aa(kab,kab,4),wv(15,1),nat(id,1),st(id,1),b(4),c(2,2),mcmtch-045
     1(kab,4),nvi(kab,kab,3),niv(ncoll,ncoll,3),ivz(4,1),sc(kab,6),fg(lmmtch-046
     2ax1,4,1),g(4),ab(4,2),kr(1),vco(2,1),vdo(2,1),bg(lmax2,1),fam(kab,mtch-047
     310),av(5),la(3,11),ba(2,11)                                       mtch-048
      common /dblpr/ chi2,chi2m,cm,ck,chb,cmb,ccz,xe,xm,xn,xz           mtch-049
      common /pote2/ ity(8),invt,intv,insl,npx                          mtch-050
      common /noequ/ ncxn,nic,nci,nc,ncin,nin,jpi,ipj,naj(3)            mtch-051
      lv=lo(44).and.(lo(57).or.lo(58))                                  mtch-052
      ll4=4                                                             mtch-053
      if (lo(227)) ll4=1                                                mtch-054
      if (lv) write (2,1000)                                            mtch-055
c loops on equations                                                    mtch-056
      do 56 ic=1,nc                                                     mtch-057
      i1=mc(ic,1)                                                       mtch-058
      k1=mc(ic,4)                                                       mtch-059
      l1=mc(ic,2)                                                       mtch-060
      if (k1.ge.0.or.lo(227)) go to 2                                   mtch-061
c transfer of informations when uncoupled functions are not recomputed  mtch-062
      k1=-k1                                                            mtch-063
      if (lo(200)) sc(ic,6)=0.                                          mtch-064
      if (k1.eq.ic) go to 5                                             mtch-065
      do 1 i=1,8                                                        mtch-066
    1 fam(ic,i)=fam(k1,i)                                               mtch-067
      go to 5                                                           mtch-068
c values of long range tails of central potentials                      mtch-069
    2 f2=vco(1,k1)**2                                                   mtch-070
      f3=vco(2,k1)*sc(ic,6)                                             mtch-071
      jc=0                                                              mtch-072
      if (i1.le.ncoll) jc=niv(i1,i1,3)                                  mtch-073
      if (wv(3,i1).gt.0.d0.and.jc.gt.0) go to 3                         mtch-074
      f2=0.d0                                                           mtch-075
      f3=0.d0                                                           mtch-076
    3 if (lo(227)) go to 5                                              mtch-077
c integration region - set up of potential in five points for           mtch-078
c transformation of matching values                                     mtch-079
      b1=wv(11,1)*wv(11,1)/48.d0                                        mtch-080
      c1=(ism-1)*wv(11,1)                                               mtch-081
      a1=wv(9,i1)**2                                                    mtch-082
      if (wv(3,i1).lt.0.d0) a1=-a1                                      mtch-083
      do 4 k=1,5                                                        mtch-084
      av(k)=b1*(2.d0*wv(9,i1)*wv(5,i1)/c1-a1+(sc(ic,5)-f2-f3/c1)/c1**2) mtch-085
    4 c1=c1+0.5d0*wv(11,1)                                              mtch-086
c computation of coulomb corrections                                    mtch-087
    5 az=ism*wv(11,i1)                                                  mtch-088
      do 48 ip=1,ic                                                     mtch-089
      do 6 l=1,8                                                        mtch-090
    6 ab(l,1)=0.d0                                                      mtch-091
      i2=mc(ip,1)                                                       mtch-092
      ilm=1                                                             mtch-093
      if (lo(144)) go to 45                                             mtch-094
      l2=mc(ip,2)                                                       mtch-095
      i3=niv(i2,i1,3)                                                   mtch-096
      if (i3.eq.0) go to 45                                             mtch-097
      ay=dsqrt(wv(9,i1)*wv(9,i2))                                       mtch-098
      aw=ay*az                                                          mtch-099
c scan the couplings between equations                                  mtch-100
      is=0                                                              mtch-101
      if (lo(200).and.lo(19).and.(ic.ne.ip)) ilm=2                      mtch-102
      k1=nvi(ip,ic,1)                                                   mtch-103
      k2=nvi(ip,ic,2)                                                   mtch-104
      if (lo(111).or.(k1.gt.k2)) go to 15                               mtch-105
      iml=1                                                             mtch-106
c central contribution                                                  mtch-107
      i=1                                                               mtch-108
    7 if (vdo(1,i).eq.0.d0) go to 29                                    mtch-109
      ii=i+ity(5)                                                       mtch-110
      do 8 k=k1,k2                                                      mtch-111
      if (iabs(nat(1,k)).eq.ii) go to 9                                 mtch-112
    8 continue                                                          mtch-113
      go to 29                                                          mtch-114
    9 if (st(2,k).eq.0.and.lo(200)) go to 29                            mtch-115
      la1=mc(ic,2)                                                      mtch-116
      la2=mc(ip,2)                                                      mtch-117
      la3=ivz(4,i)                                                      mtch-118
      zt=st(2,k)*ay**la3*vdo(1,i)/wv(11,i1)**2                          mtch-119
      if (lo(100)) zt=zt*.5d0*dsqrt((xm+wv(7,i1))*(xm+wv(7,i2)))/xm     mtch-120
      im=1                                                              mtch-121
   10 if (im.lt.5) yt=zt                                                mtch-122
      if ((yt.eq.0.).and.(zt.eq.0.)) go to 13                           mtch-123
      if (is.eq.0) go to 12                                             mtch-124
      do 11 j=1,is                                                      mtch-125
      if ((la(1,j).ne.la1).or.(la(2,j).ne.la2).or.(la(3,j).ne.la3)) go tmtch-126
     1o 11                                                              mtch-127
      ba(1,j)=ba(1,j)+zt                                                mtch-128
      ba(2,j)=ba(2,j)+yt                                                mtch-129
      go to 13                                                          mtch-130
   11 continue                                                          mtch-131
   12 is=is+1                                                           mtch-132
      la(1,is)=la1                                                      mtch-133
      la(2,is)=la2                                                      mtch-134
      la(3,is)=la3                                                      mtch-135
      ba(1,is)=zt                                                       mtch-136
      ba(2,is)=yt                                                       mtch-137
   13 go to ( 14 , 29 , 19 , 29 , 26 , 27 , 28 , 29 ),im                mtch-138
   14 if (lo(200)) go to 29                                             mtch-139
c vector contribution in dirac equation                                 mtch-140
      im=2                                                              mtch-141
      la1=2.*sc(ic,3)+.1-mc(ic,2)                                       mtch-142
      la2=2.*sc(ip,3)+.1-mc(ip,2)                                       mtch-143
      la3=ivz(4,i)                                                      mtch-144
      zt=st(3,k)*ay**la3*vdo(1,i)*chb**2*wv(9,i1)*wv(9,i2)/(2.*xm*(wv(7,mtch-145
     1i2)+xm)*wv(11,i1)**2)                                             mtch-146
      if ((la1-mc(ic,2))*(la2-mc(ip,2)).lt.0) zt=-zt                    mtch-147
      go to 10                                                          mtch-148
   15 if (lo(119)) go to 30                                             mtch-149
      k3=nvi(ip,ic,3)                                                   mtch-150
c tensor contribution in dirac equation                                 mtch-151
      if (lo(200)) go to 20                                             mtch-152
      iml=2                                                             mtch-153
      k4=k2+1                                                           mtch-154
      if (k4.gt.k3) go to 30                                            mtch-155
      i=1                                                               mtch-156
   16 if (vdo(2,i).eq.0.) go to 29                                      mtch-157
      do 17 k=k4,k3                                                     mtch-158
      if (iabs(nat(1,k)).eq.ivz(3,i)+intv) go to 18                     mtch-159
   17 continue                                                          mtch-160
      go to 29                                                          mtch-161
   18 im=3                                                              mtch-162
      la1=2.*sc(ic,3)+.1-mc(ic,2)                                       mtch-163
      la2=mc(ip,2)                                                      mtch-164
      la3=ivz(4,i)+1                                                    mtch-165
      zt=.5d0*(st(3,k)+la3*st(2,k))*ay**la3*vdo(2,i)*chb*wv(9,i1)/(wv(11mtch-166
     1,i1)**2*xm)                                                       mtch-167
      if ((la1-mc(ic,2)).gt.0) zt=-zt                                   mtch-168
      go to 10                                                          mtch-169
   19 im=4                                                              mtch-170
      la1=mc(ic,2)                                                      mtch-171
      la2=2.*sc(ip,3)+.1-la2                                            mtch-172
      zt=-.5d0*(st(3,k)-la3*st(2,k))*ay**la3*vdo(2,i)*chb*wv(9,i2)/(wv(1mtch-173
     11,i2)**2*xm)                                                      mtch-174
      if ((la2-mc(ip,2)).gt.0) zt=-zt                                   mtch-175
      go to 10                                                          mtch-176
   20 i=1                                                               mtch-177
      iml=3                                                             mtch-178
c spin-orbit contribution in schroedinger equation                      mtch-179
      kp1=nvi(ic,ip,1)                                                  mtch-180
      kp2=nvi(ic,ip,2)                                                  mtch-181
      kp3=nvi(ic,ip,3)                                                  mtch-182
   21 if (vdo(2,i).eq.0.d0) go to 29                                    mtch-183
      ii=ivz(3,i)+ity(5)+insl+intv                                      mtch-184
      ax1=0.d0                                                          mtch-185
      ax2=0.d0                                                          mtch-186
      ax3=0.d0                                                          mtch-187
      if (k1.gt.k3) go to 23                                            mtch-188
      do 22 k=k1,k3                                                     mtch-189
      if (iabs(nat(1,k))+insl.eq.ii) ax1=st(2,k)                        mtch-190
      if ((k.le.k2).and.(iabs(nat(1,k)).eq.ii)) ax2=st(2,k)             mtch-191
      if ((k.gt.k2).and.(iabs(nat(1,k)).eq.ii)) ax3=st(2,k)             mtch-192
   22 continue                                                          mtch-193
   23 ay1=0.d0                                                          mtch-194
      ay2=0.d0                                                          mtch-195
      ay3=0.d0                                                          mtch-196
      if (kp1.gt.kp3) go to 25                                          mtch-197
      do 24 k=kp1,kp3                                                   mtch-198
      if (iabs(nat(1,k))+insl.eq.ii) ay1=st(2,k)                        mtch-199
      if ((k.le.kp2).and.(iabs(nat(1,k)).eq.ii)) ay2=st(2,k)            mtch-200
      if ((k.gt.kp2).and.(iabs(nat(1,k)).eq.ii)) ay3=st(2,k)            mtch-201
   24 continue                                                          mtch-202
   25 if ((k1.gt.k3).and.(kp1.gt.kp3)) go to 29                         mtch-203
      la1=mc(ic,2)                                                      mtch-204
      la2=mc(ip,2)                                                      mtch-205
      la3=ivz(4,i)+2                                                    mtch-206
      if (la3.gt.la1+la2) go to 29                                      mtch-207
      xt=ay**la3*vdo(2,i)/wv(11,i1)**2                                  mtch-208
      zt=(ax2-(la3-1)*ax1+(la1+1)*ax3)*xt                               mtch-209
      yt=(ay2-(la3-1)*ay1+(la2+1)*ay3)*xt                               mtch-210
      im=5                                                              mtch-211
      go to 10                                                          mtch-212
   26 la3=la3-1                                                         mtch-213
      xt=xt/ay                                                          mtch-214
      zt=ax3*wv(9,i1)*wv(5,i1)/dfloat(la1+1)*xt                         mtch-215
      yt=ay3*wv(9,i2)*wv(5,i2)/dfloat(la2+1)*xt                         mtch-216
      im=6                                                              mtch-217
      go to 10                                                          mtch-218
   27 la2=la2+1                                                         mtch-219
      yt=-ay3*dsqrt(1.d0+(wv(5,i2)/dfloat(la2))**2)*wv(9,i2)*xt         mtch-220
      zt=0.d0                                                           mtch-221
      im=7                                                              mtch-222
      go to 10                                                          mtch-223
   28 la1=la1+1                                                         mtch-224
      la2=la2-1                                                         mtch-225
      zt=-ax3*dsqrt(1.d0+(wv(5,i1)/dfloat(la1))**2)*wv(9,i1)*xt         mtch-226
      yt=0.d0                                                           mtch-227
      im=8                                                              mtch-228
      go to 10                                                          mtch-229
   29 i=i+1                                                             mtch-230
      if (i.le.intv) go to ( 7 , 16 , 21 ),iml                          mtch-231
      if (iml.eq.1) go to 15                                            mtch-232
   30 if (is.eq.0) go to 45                                             mtch-233
      do 44 ik=1,is                                                     mtch-234
      if (dabs(ba(1,ik))+dabs(ba(2,ik)).lt.1.d-8) go to 44              mtch-235
      l4=la(1,ik)                                                       mtch-236
      l5=la(2,ik)                                                       mtch-237
      li=min0(l4,l5)                                                    mtch-238
      lf=max0(l4,l5)                                                    mtch-239
      ll=la(3,ik)                                                       mtch-240
      i4=i1                                                             mtch-241
      if (li.ne.la(2,ik)) i4=i2                                         mtch-242
      i5=i1+i2-i4                                                       mtch-243
      ei=wv(5,i5)                                                       mtch-244
      ef=wv(5,i4)                                                       mtch-245
      xi=wv(9,i5)*az                                                    mtch-246
      xf=wv(9,i4)*az                                                    mtch-247
      l3=(li+lf-ll+3)/2                                                 mtch-248
      if (l3.le.0) go to 44                                             mtch-249
      call cora(l3,ll,lf-li+1,ei,ef,xi,xf,b,c,lo(227))                  mtch-250
c order in c   (li,lf),(li,lf+1),(li+1,lf),(li+1,lf+1)                  mtch-251
c order in fg   f(ei)*f(ef),g(ei)*f(ef),f(ei)*g(ef),g(ei)*g(ef)         mtch-252
      if (lo(227)) go to 41                                             mtch-253
c integration region - integrals from matching point to infinity        mtch-254
      if (max0(l3+3,lf+2).gt.lmax3) go to 65                            mtch-255
      if (li.ne.l5) go to 31                                            mtch-256
      a1=c(1,2)                                                         mtch-257
      c(1,2)=c(2,1)                                                     mtch-258
      c(2,1)=a1                                                         mtch-259
c computation of the integrals from the matching point using b and c    mtch-260
   31 do 35 n1=1,4                                                      mtch-261
      g(n1)=0.d0                                                        mtch-262
      do 32 n3=1,4                                                      mtch-263
   32 g(n1)=g(n1)+b(n3)*fg(l3+n3-1,n1,i3)                               mtch-264
      nn2=2*((n1-1)/2)+1                                                mtch-265
      nn1=2*(n1-nn2)+1                                                  mtch-266
      do 34 n3=1,2                                                      mtch-267
      do 33 n4=1,2                                                      mtch-268
   33 g(n1)=g(n1)-c(n4,n3)*fg(l3+n3,nn1,i1)*fg(l3+n4,nn2,i2)            mtch-269
   34 continue                                                          mtch-270
   35 continue                                                          mtch-271
      do 37 il=1,ilm                                                    mtch-272
      do 36 l=1,4                                                       mtch-273
   36 ab(l,il)=ab(l,il)+ba(il,ik)*g(l)                                  mtch-274
   37 continue                                                          mtch-275
      if (lo(225).or.(lo(29).and.(ip.eq.ic))) go to 39                  mtch-276
      do 38 il=1,ilm                                                    mtch-277
      yt=ba(il,ik)*wv(11,i1)**2*ay/(12.d0*aw**(ll+1))                   mtch-278
c with the green's functions method,we must add h**2*fp(r)/12           mtch-279
c which is vre(ism-1)*(ki*fp(i)*g(f)+kf*f(i)*gp(f)-(ll+1)/r)/12.        mtch-280
      c0=-(ll+1)/az+6.d0/wv(11,i1)                                      mtch-281
      ab(1,il)=ab(1,il)-yt*(wv(9,i1)*fg(l4+1,2,i1)*fg(l5+1,1,i2)+wv(9,i2mtch-282
     1)*fg(l4+1,1,i1)*fg(l5+1,2,i2)+c0*fg(l4+1,1,i1)*fg(l5+1,1,i2))     mtch-283
      ab(2,il)=ab(2,il)-yt*(wv(9,i1)*fg(l4+1,4,i1)*fg(l5+1,1,i2)+wv(9,i2mtch-284
     1)*fg(l4+1,3,i1)*fg(l5+1,2,i2)+c0*fg(l4+1,3,i1)*fg(l5+1,1,i2))     mtch-285
      ab(3,il)=ab(3,il)-yt*(wv(9,i1)*fg(l4+1,2,i1)*fg(l5+1,3,i2)+wv(9,i2mtch-286
     1)*fg(l4+1,1,i1)*fg(l5+1,4,i2)+c0*fg(l4+1,1,i1)*fg(l5+1,3,i2))     mtch-287
      ab(4,il)=ab(4,il)-yt*(wv(9,i1)*fg(l4+1,4,i1)*fg(l5+1,3,i2)+wv(9,i2mtch-288
     1)*fg(l4+1,3,i1)*fg(l5+1,4,i2)+c0*fg(l4+1,3,i1)*fg(l5+1,3,i2))     mtch-289
   38 continue                                                          mtch-290
      go to 44                                                          mtch-291
c correction of the potential in five points for matching values        mtch-292
   39 c1=(ism-1)*wv(11,i1)*ay                                           mtch-293
      do 40 i=1,5                                                       mtch-294
      av(i)=av(i)+ba(1,ik)*ay*wv(11,i1)**2/c1**(ll+1)/48.d0             mtch-295
   40 c1=c1+0.5d0*wv(11,i1)*ay                                          mtch-296
      go to 44                                                          mtch-297
c computation of integrals from 0 to infinity using b                   mtch-298
   41 ax=0.d0                                                           mtch-299
      if (l3+3.gt.lmax2) go to 66                                       mtch-300
      do 42 n1=1,4                                                      mtch-301
   42 ax=ax+b(n1)*bg(l3+n1-1,i3)                                        mtch-302
      do 43 il=1,ilm                                                    mtch-303
   43 ab(1,il)=ab(1,il)+ba(il,ik)*ax                                    mtch-304
   44 continue                                                          mtch-305
c limitation for too large integral of irregular functions              mtch-306
   45 if (dabs(ab(4,1)).gt.wv(9,i1)) ab(4,1)=ab(1,1)                    mtch-307
      if ((ilm.eq.2).and.(dabs(ab(4,2)).gt.wv(9,i2))) ab(4,2)=ab(1,2)   mtch-308
      if (.not.lv) go to 46                                             mtch-309
      write (2,1001) ic,ip,l1,l2,(ab(i,1),i=1,ll4)                      mtch-310
      if (ilm.eq.2) write (2,1001) ip,ic,l2,l1,(ab(i,2),i=1,ll4)        mtch-311
c build up of matrix of corrections                                     mtch-312
   46 do 47 l=1,ll4                                                     mtch-313
      if (ic.ne.ip) aa(ip,ic,l)=ab(l,ilm)                               mtch-314
   47 aa(ic,ip,l)=ab(l,1)                                               mtch-315
      if (lo(227).or.(ic.eq.ip)) go to 48                               mtch-316
      aa(ip,ic,2)=ab(3,ilm)                                             mtch-317
      aa(ip,ic,3)=ab(2,ilm)                                             mtch-318
   48 continue                                                          mtch-319
      if (.not.lo(227)) go to 49                                        mtch-320
      if (jc.le.0) go to 56                                             mtch-321
      if (wv(5,i1).eq.0.d0) f2=f3*wv(9,i1)                              mtch-322
      aa(ic,ic,1)=aa(ic,ic,1)-f2*bg(l1+1,jc)*wv(9,i1)                   mtch-323
      if ((wv(5,i1).eq.0.d0).or.(f3.eq.0.d0)) go to 56                  mtch-324
      b1=2.d0*wv(5,i1)*l1*(l1+1)                                        mtch-325
      b2=(l1+1)**2+wv(5,i1)**2                                          mtch-326
      c1=-((2*l1+1)*b2+2*wv(5,i1)**2)/b1                                mtch-327
      c2=(2*l1+3)*b2/b1                                                 mtch-328
      aa(ic,ic,1)=aa(ic,ic,1)-f3*(c1*bg(l1+1,jc)+c2*bg(l1+2,jc))*wv(9,i1mtch-329
     1)**2                                                              mtch-330
      go to 56                                                          mtch-331
   49 if (mc(ic,4).lt.0) go to 56                                       mtch-332
c matching values                                                       mtch-333
      do 50 k=1,4                                                       mtch-334
   50 b(k)=fg(l1+1,k,i1)                                                mtch-335
      if (jc.le.0.) go to 54                                            mtch-336
      if (lo(129).and.(f2.eq.0.d0.and.f3.eq.0.d0)) go to 54             mtch-337
      if (wv(5,i1).ne.0.d0) go to 51                                    mtch-338
      f2=f3*wv(9,i1)                                                    mtch-339
      f3=0.d0                                                           mtch-340
   51 do 52 k=1,4                                                       mtch-341
   52 g(k)=-fg(l1+1,k,jc)*f2+ab(k,1)/wv(9,i1)                           mtch-342
      if (f3.eq.0.d0) go to 53                                          mtch-343
      b1=2.d0*wv(5,i1)*l1*(l1+1)                                        mtch-344
      b2=(l1+1)**2+wv(5,i1)**2                                          mtch-345
      c1=-((2*l1+1)*b2+2*wv(5,i1)**2)/b1                                mtch-346
      c2=(2*l1+3)*b2/b1                                                 mtch-347
      a1=ism*wv(11,i1)*wv(9,i1)                                         mtch-348
      d1=(b2+(l1+1)*wv(5,i1)/a1)/a1/b1                                  mtch-349
      d2=-wv(5,i1)*dsqrt(b2)/b1/a1                                      mtch-350
      a1=b2/b1/a1                                                       mtch-351
      a3=f3*wv(9,i1)                                                    mtch-352
      g(1)=g(1)-a3*(c1*fg(l1+1,1,jc)+c2*fg(l1+2,1,jc)-d1*fg(l1+1,1,i1)**mtch-353
     12-d2*2.d0*fg(l1+1,1,i1)*fg(l1+2,1,i1)-a1*fg(l1+2,1,i1)**2)        mtch-354
      g(2)=g(2)-a3*(c1*fg(l1+1,2,jc)+c2*fg(l1+2,2,jc)-d1*fg(l1+1,1,i1)*fmtch-355
     1g(l1+1,3,i1)-d2*(fg(l1+1,1,i1)*fg(l1+2,3,i1)+fg(l1+2,1,i1)*fg(l1+1mtch-356
     2,3,i1))-a1*fg(l1+2,1,i1)*fg(l1+2,3,i1))                           mtch-357
      g(4)=g(4)-a3*(c1*fg(l1+1,4,jc)+c2*fg(l1+2,4,jc)-d1*fg(l1+1,3,i1)**mtch-358
     12-d2*2.d0*fg(l1+1,3,i1)*fg(l1+2,3,i1)-a1*fg(l1+2,3,i1)**2)        mtch-359
   53 a4=1.d0+(g(1)*g(4)-g(2)**2)                                       mtch-360
      g(3)=b(1)                                                         mtch-361
      b(1)=(b(1)*(1.d0-g(2))+g(1)*b(3))/a4                              mtch-362
      b(3)=(-g(3)*g(4)+(1.d0+g(2))*b(3))/a4                             mtch-363
      g(3)=b(2)                                                         mtch-364
      b(2)=(b(2)*(1.d0-g(2))+g(1)*b(4))/a4                              mtch-365
      b(4)=(-g(3)*g(4)+(1.d0+g(2))*b(4))/a4                             mtch-366
   54 a1=(1.d0-av(2))/(2.d0+10.d0*av(2))                                mtch-367
      b1=(1.d0-av(4))/(2.d0+10.d0*av(4))                                mtch-368
      a2=a1*(1.d0-av(1))/(1.d0-4.d0*av(1))                              mtch-369
      b2=b1*(1.d0-av(5))/(1.d0-4.d0*av(5))                              mtch-370
      c1=(2.d0+10.d0*av(3))-(1.d0-av(3))*(a1+b1)                        mtch-371
      a1=(16.d0-144.d0*av(2))/(2.d0+10.d0*av(2))                        mtch-372
      b1=(16.d0-144.d0*av(4))/(2.d0+10.d0*av(4))                        mtch-373
      c2=(7.d0+a1*(1.d0-av(1)))/(1.d0-4.d0*av(1))                       mtch-374
      d2=(7.d0+b1*(1.d0-av(5)))/(1.d0-4.d0*av(5))                       mtch-375
      d1=(b1-a1)*(1.d0-av(3))                                           mtch-376
      a1=a2*d2+b2*c2                                                    mtch-377
      b1=(c1*d2+d1*b2)/a1                                               mtch-378
      b2=30.d0*wv(11,1)*b2*wv(9,i1)/a1                                  mtch-379
      fam(ic,1)=b1*b(1)-b2*b(2)                                         mtch-380
      fam(ic,3)=b1*b(3)-b2*b(4)                                         mtch-381
      b1=(c2*c1-a2*d1)/a1                                               mtch-382
      a2=-30.d0*wv(11,1)*a2*wv(9,i1)/a1                                 mtch-383
      fam(ic,2)=b1*b(1)-a2*b(2)                                         mtch-384
      fam(ic,4)=b1*b(3)-a2*b(4)                                         mtch-385
      fam(ic,5)=wv(9,i1)                                                mtch-386
      if (lo(100)) fam(ic,5)=fam(ic,5)*chb/(xm+wv(7,i1))                mtch-387
      bt=fam(ic,2)*fam(ic,3)-fam(ic,1)*fam(ic,4)                        mtch-388
      if (bt.eq.0.d0) bt=1.d0                                           mtch-389
      do 55 i=1,4                                                       mtch-390
   55 fam(ic,i)=fam(ic,i)/bt                                            mtch-391
      fam(ic,6)=fam(ic,5)/bt                                            mtch-392
      if (lo(100)) fam(ic,5)=fam(ic,5)*wv(11,i1)                        mtch-393
      fam(ic,7)=wv(8,i1)**2                                             mtch-394
      fam(ic,8)=2.d0*fam(ic,7)*sc(ic,6)                                 mtch-395
      fam(ic,9)=wv(10,i1)                                               mtch-396
      fam(ic,10)=sc(ic,5)                                               mtch-397
      if (lo(200)) sc(ic,6)=pjm*fam(ic,7)                               mtch-398
   56 continue                                                          mtch-399
      do 59 ic=1,nc                                                     mtch-400
      i1=mc(ic,1)                                                       mtch-401
      do 58 l=1,ll4                                                     mtch-402
      do 57 ip=1,nc                                                     mtch-403
   57 aa(ic,ip,l)=aa(ic,ip,l)/wv(9,i1)                                  mtch-404
   58 continue                                                          mtch-405
   59 continue                                                          mtch-406
      if (.not.lo(227)) return                                          mtch-407
      if (.not.lo(225)) go to 62                                        mtch-408
c transposition if coupled equations are used                           mtch-409
      do 61 ic=1,nc                                                     mtch-410
      do 60 ip=1,ic                                                     mtch-411
      ax=aa(ip,ic,1)                                                    mtch-412
      aa(ip,ic,1)=aa(ic,ip,1)                                           mtch-413
   60 aa(ic,ip,1)=ax                                                    mtch-414
   61 continue                                                          mtch-415
c linear system for computation of the s-matrix from the k-matrix       mtch-416
   62 do 64 ic=1,nc                                                     mtch-417
      do 63 ip=1,nc                                                     mtch-418
      aa(ic,nc+ip,1)=0.d0                                               mtch-419
      aa(ic,ip,4)=0.d0                                                  mtch-420
   63 aa(ic,nc+ip,4)=-aa(ic,ip,1)                                       mtch-421
   64 aa(ic,ic,4)=1.d0                                                  mtch-422
      call lins(aa(1,1,4),kab,aa,kab,nc,ncxn,kr,ier)                    mtch-423
      lo(216)=ier.ne.0                                                  mtch-424
      return                                                            mtch-425
   65 write (2,1002) l3,lf,lmax3                                        mtch-426
      go to 67                                                          mtch-427
   66 write (2,1003) l3,lmax2                                           mtch-428
   67 lo(216)=.true.                                                    mtch-429
      return                                                            mtch-430
 1000 format (/62h channels  l-values     coulomb integrals: f*f,g*f,f*gmtch-431
     1 and g*g)                                                         mtch-432
 1001 format (2x,2i3,2x,2i4,3x,4d18.10)                                 mtch-433
 1002 format (16h starting values,i3,18h for integrals and,i3,48h for comtch-434
     1ulomb functions too large . limitation at,i4)                     mtch-435
 1003 format (15h starting value,i4,57h too large for coulomb integrals mtch-436
     1which are computed up to,i5)                                      mtch-437
      end                                                               mtch-438
c 22/04/98  ibm version                                         ecis97  tlnc-000
      subroutine tlnc(hh,ipix,wvx,tl,ism,x,ff,lm,nn,dd,id,v,vco,lo)     tlnc-001
c transmission coefficients of uncoupled states for compound nucleus    tlnc-002
c input variables: hh:        step size for the ground state            tlnc-003
c                  ipix,wvx:  ipi and wv for this state (see calx)      tlnc-004
c                  ism:       number of steps                           tlnc-005
c                  lm:        number of coulomb functions needed        tlnc-006
c                  id:        length of working space, single precision tlnc-007
c                  v:         potentials real and imaginary             tlnc-008
c                  vco:       strength of long range coulomb correction tlnc-009
c                  lo:        logical controls                          tlnc-010
c output variables:tl:     transmission coefficients of uncoupled levelstlnc-011
c working space:   x:      for the integration                          tlnc-012
c                  ff:     for coulomb functions and corrections        tlnc-013
c                  nn:     needed by subroutine fcou                    tlnc-014
c                  dd:     needed by subroutine cori                    tlnc-015
c***********************************************************************tlnc-016
      logical lo(250)                                                   tlnc-017
      double precision hh,wvx(11),x(2,2),ff(lm,6),dd(200),fam(7),b(4),g(tlnc-018
     14),av(5),a1,b1,c1,f2,f3,d1,a2,b2,c2,d2,a3,a4,tl(1)                tlnc-019
      dimension ipix(9),v(ism,4),nn(1),vco(2)                           tlnc-020
      if (wvx(3).le.0.d0) return                                        tlnc-021
      j=1                                                               tlnc-022
      call fcou(ipix(9),wvx(5),ism*wvx(11)*wvx(9),ff,ff(1,2),ff(1,3),ff(tlnc-023
     11,4),nn,ff(1,5))                                                  tlnc-024
      jc=0                                                              tlnc-025
      if (lo(203).and.lo(144)) go to 1                                  tlnc-026
      jc=5                                                              tlnc-027
      call cori(wvx(5),wvx(5),wvx(9),wvx(9),ism*wvx(11),dd,ff(1,5),ff(1,tlnc-028
     15),ff,ff,dd(200),lm,lm,id,lm,ff(1,6),id,lo)                       tlnc-029
    1 l=ipix(9)+1                                                       tlnc-030
      if (l.le.0) return                                                tlnc-031
      ij=ipix(2)                                                        tlnc-032
      do 17 lj=1,l                                                      tlnc-033
      do 16 jl=1,ij                                                     tlnc-034
      jj=2*(lj+jl)-ij-3                                                 tlnc-035
      j=j+1                                                             tlnc-036
      tl(j)=0.d0                                                        tlnc-037
      if (jj.lt.ij+1-2*lj) go to 16                                     tlnc-038
      l1=lj-1                                                           tlnc-039
      fam(5)=lj*(lj-1)                                                  tlnc-040
      fam(6)=.25d0*dfloat(jj*(jj+2)-ij*ij+1)-fam(5)                     tlnc-041
c values of long range tails of central potentials                      tlnc-042
      f2=vco(1)**2                                                      tlnc-043
      f3=vco(2)*fam(6)                                                  tlnc-044
      if (wvx(3).gt.0.d0.and.jc.gt.0) go to 2                           tlnc-045
      f2=0.d0                                                           tlnc-046
      f3=0.d0                                                           tlnc-047
c integration region - set up of potential in five points for           tlnc-048
c transformation of matching values                                     tlnc-049
    2 b1=hh*hh/48.d0                                                    tlnc-050
      c1=(ism-1)*hh                                                     tlnc-051
      a1=wvx(9)**2                                                      tlnc-052
      if (wvx(3).lt.0.d0) a1=-a1                                        tlnc-053
      do 3 k=1,5                                                        tlnc-054
      av(k)=b1*(2.d0*wvx(9)*wvx(5)/c1-a1+(fam(5)-f2-f3/c1)/c1**2)       tlnc-055
    3 c1=c1+0.5d0*hh                                                    tlnc-056
c computation of coulomb corrections                                    tlnc-057
      do 4 k=1,4                                                        tlnc-058
    4 b(k)=ff(l1+1,k)                                                   tlnc-059
      if (jc.le.0.) go to 8                                             tlnc-060
      if (wvx(5).ne.0.d0) go to 5                                       tlnc-061
      f2=f3*wvx(9)                                                      tlnc-062
      f3=0.d0                                                           tlnc-063
    5 do 6 k=1,4                                                        tlnc-064
    6 g(k)=-ff(l1+1,k+jc)*f2                                            tlnc-065
      if (f3.eq.0.d0) go to 7                                           tlnc-066
      b1=2.d0*wvx(5)*l1*(l1+1)                                          tlnc-067
      b2=(l1+1)**2+wvx(5)**2                                            tlnc-068
      c1=-((2*l1+1)*b2+2*wvx(5)**2)/b1                                  tlnc-069
      c2=(2*l1+3)*b2/b1                                                 tlnc-070
      a1=ism*wvx(11)*wvx(9)                                             tlnc-071
      d1=(b2+(l1+1)*wvx(5)/a1)/a1/b1                                    tlnc-072
      d2=-wvx(5)*dsqrt(b2)/b1/a1                                        tlnc-073
      a1=b2/b1/a1                                                       tlnc-074
      a3=f3*wvx(9)                                                      tlnc-075
      g(1)=g(1)-a3*(c1*ff(l1+1,1+jc)+c2*ff(l1+2,1+jc)-d1*ff(l1+1,1)**   tlnc-076
     12-d2*2.d0*ff(l1+1,1)*ff(l1+2,1)-a1*ff(l1+2,1)**2)                 tlnc-077
      g(2)=g(2)-a3*(c1*ff(l1+1,2+jc)+c2*ff(l1+2,2+jc)-d1*ff(l1+1,1)*f   tlnc-078
     1f(l1+1,3)-d2*(ff(l1+1,1)*ff(l1+2,3)+ff(l1+2,1)*ff(l1+1            tlnc-079
     2,3))-a1*ff(l1+2,1)*ff(l1+2,3))                                    tlnc-080
      g(4)=g(4)-a3*(c1*ff(l1+1,4+jc)+c2*ff(l1+2,4+jc)-d1*ff(l1+1,3)**   tlnc-081
     12-d2*2.d0*ff(l1+1,3)*ff(l1+2,3)-a1*ff(l1+2,3)**2)                 tlnc-082
    7 a4=1.d0+(g(1)*g(4)-g(2)**2)                                       tlnc-083
      g(3)=b(1)                                                         tlnc-084
      b(1)=(b(1)*(1.d0-g(2))+g(1)*b(3))/a4                              tlnc-085
      b(3)=(-g(3)*g(4)+(1.d0+g(2))*b(3))/a4                             tlnc-086
      g(3)=b(2)                                                         tlnc-087
      b(2)=(b(2)*(1.d0-g(2))+g(1)*b(4))/a4                              tlnc-088
      b(4)=(-g(3)*g(4)+(1.d0+g(2))*b(4))/a4                             tlnc-089
    8 a1=(1.d0-av(2))/(2.d0+10.d0*av(2))                                tlnc-090
      b1=(1.d0-av(4))/(2.d0+10.d0*av(4))                                tlnc-091
      a2=a1*(1.d0-av(1))/(1.d0-4.d0*av(1))                              tlnc-092
      b2=b1*(1.d0-av(5))/(1.d0-4.d0*av(5))                              tlnc-093
      c1=(2.d0+10.d0*av(3))-(1.d0-av(3))*(a1+b1)                        tlnc-094
      a1=(16.d0-144.d0*av(2))/(2.d0+10.d0*av(2))                        tlnc-095
      b1=(16.d0-144.d0*av(4))/(2.d0+10.d0*av(4))                        tlnc-096
      c2=(7.d0+a1*(1.d0-av(1)))/(1.d0-4.d0*av(1))                       tlnc-097
      d2=(7.d0+b1*(1.d0-av(5)))/(1.d0-4.d0*av(5))                       tlnc-098
      d1=(b1-a1)*(1.d0-av(3))                                           tlnc-099
      a1=a2*d2+b2*c2                                                    tlnc-100
      b1=(c1*d2+d1*b2)/a1                                               tlnc-101
      b2=30.d0*hh*b2*wvx(9)/a1                                          tlnc-102
      fam(1)=b1*b(1)-b2*b(2)                                            tlnc-103
      fam(3)=b1*b(3)-b2*b(4)                                            tlnc-104
      b1=(c2*c1-a2*d1)/a1                                               tlnc-105
      a2=-30.d0*hh*a2*wvx(9)/a1                                         tlnc-106
      fam(2)=b1*b(1)-a2*b(2)                                            tlnc-107
      fam(4)=b1*b(3)-a2*b(4)                                            tlnc-108
      fam(7)=wvx(8)**2                                                  tlnc-109
      fam(6)=2.d0*fam(7)*fam(6)                                         tlnc-110
c computation of the regular solution                                   tlnc-111
      do 9 is=1,ism                                                     tlnc-112
      a1=is*is                                                          tlnc-113
      x(1,is+2)=wvx(10)-fam(5)/a1+fam(7)*v(is,1)                        tlnc-114
      x(2,is+2)=fam(7)*v(is,2)                                          tlnc-115
      if (lo(229)) x(1,is+2)=x(1,is+2)+fam(6)*v(is,3)                   tlnc-116
      if (lo(230)) x(2,is+2)=x(2,is+2)+fam(6)*v(is,4)                   tlnc-117
    9 continue                                                          tlnc-118
      if (lo(27)) go to 11                                              tlnc-119
c modified numerov method                                               tlnc-120
      do 10 is=1,ism                                                    tlnc-121
      a1=x(1,is+2)**2-x(2,is+2)**2                                      tlnc-122
      if (lo(26)) a1=a1*(1.d0-x(1,is+2)*.033333333333333d0)             tlnc-123
      x(2,is+2)=x(2,is+2)*(1.d0-x(1,is+2)*.166666666666667d0)           tlnc-124
   10 x(1,is+2)=x(1,is+2)-a1*.083333333333333d0                         tlnc-125
      go to 13                                                          tlnc-126
c numerov method                                                        tlnc-127
   11 do 12 is=1,ism                                                    tlnc-128
      a2=(12.d0+x(1,is+2))**2+x(2,is+2)**2                              tlnc-129
      a1=12.d0*(x(1,is+2)*(12.d0+x(1,is+2))+x(2,is+2)**2)/a2            tlnc-130
      if (lo(26)) a1=a1*(1.d0+x(1,is+2)**2*.416666666666667d-2)         tlnc-131
      x(1,is+2)=a1                                                      tlnc-132
   12 x(2,is+2)=144.d0*x(2,is+2)/a2                                     tlnc-133
   13 x(1,1)=0.d0                                                       tlnc-134
      x(2,1)=0.d0                                                       tlnc-135
      x(1,2)=1.d-15                                                     tlnc-136
      x(2,2)=0.d0                                                       tlnc-137
      do 15 is=1,ism                                                    tlnc-138
      b1=x(1,is+1)*x(1,is+2)-x(2,is+1)*x(2,is+2)                        tlnc-139
      b2=x(2,is+1)*x(1,is+2)+x(1,is+1)*x(2,is+2)                        tlnc-140
      x(1,is+2)=x(1,is+1)+x(1,is+1)-x(1,is)-b1                          tlnc-141
      x(2,is+2)=x(2,is+1)+x(2,is+1)-x(2,is)-b2                          tlnc-142
      if (dabs(x(1,is+2)).lt.1.d15) go to 15                            tlnc-143
c renormalisation of large function values                              tlnc-144
      js=2*is+4                                                         tlnc-145
      do 14 i=3,js                                                      tlnc-146
   14 x(i,1)=x(i,1)*1.d-30                                              tlnc-147
   15 continue                                                          tlnc-148
c end of integration                                                    tlnc-149
c matching                                                              tlnc-150
      a1=x(1,ism)*fam(4)-fam(3)*x(1,ism+2)                              tlnc-151
      a2=x(2,ism)*fam(4)-fam(3)*x(2,ism+2)                              tlnc-152
      b1=x(1,ism)*fam(2)-fam(1)*x(1,ism+2)                              tlnc-153
      b2=x(2,ism)*fam(2)-fam(1)*x(2,ism+2)                              tlnc-154
      a2=a2+b1                                                          tlnc-155
      a1=a1-b2                                                          tlnc-156
      a3=a1*a1+a2*a2                                                    tlnc-157
      a1=-a1/a3                                                         tlnc-158
      a2=a2/a3                                                          tlnc-159
      fam(7)=a1*b1-a2*b2                                                tlnc-160
      fam(6)=b1*a2+b2*a1                                                tlnc-161
      tl(j)=4.d0*(fam(6)-fam(7)**2-fam(6)**2)                           tlnc-162
   16 continue                                                          tlnc-163
   17 continue                                                          tlnc-164
      return                                                            tlnc-165
      end                                                               tlnc-166
c 22/02/97  ibm version                                         ecis96  dx6j-000
      subroutine dx6j(aa,at,j,jt)                                       dx6j-001
c  recurrence computation of unnormalised                               dx6j-002
c                       ( j(1)  j(2)  j(3) )                            dx6j-003
c 6-j coefficients      )                  (                            dx6j-004
c                       ( j(4)  j(5)   jj  )                            dx6j-005
c for all values of jj.  the arguments j are integer doubled values.    dx6j-006
c input data:  jt:   number of 6j coefficients plus one                 dx6j-007
c              at:   jj+1 for maximum value of jj (usual 2j+1)          dx6j-008
c output data: aa:   unnormalised 6j coefficients in aa(2) to aa(jt)    dx6j-009
c                    starting from the largest value of jj; aa(1)=0     dx6j-010
c              at:   normalisation: the values aa must be divided by    dx6j-011
c                      (-)**(j(1)+j(2)+j(4)+j(5))*sqrt((j(3)+1)*at)     dx6j-012
c***********************************************************************dx6j-013
      implicit real*8 (a-f)                                             dx6j-014
      dimension aa(2),j(5)                                              dx6j-015
      aa(1)=0.d0                                                        dx6j-016
      aa(2)=1.d0                                                        dx6j-017
      if (jt.le.2) return                                               dx6j-018
      al=at                                                             dx6j-019
      c2=0.d0                                                           dx6j-020
      bk1=(j(1)-j(5))**2                                                dx6j-021
      bk3=(j(2)-j(4))**2                                                dx6j-022
      bk2=(j(1)+j(5)+2)**2                                              dx6j-023
      bk4=(j(2)+j(4)+2)**2                                              dx6j-024
      d1=(j(1)-j(5))*(j(1)+j(5)+2.d0)*(j(4)-j(2))*(j(2)+j(4)+2.d0)/16.d0dx6j-025
      d2=(bk1+bk2+bk3+bk4-4*j(3)*(j(3)+2))/8.d0-1.d0                    dx6j-026
      bk=(al+1.d0)**2                                                   dx6j-027
      do 2 i=3,jt                                                       dx6j-028
      c1=c2                                                             dx6j-029
      bk=bk-al*4.d0                                                     dx6j-030
      c2=.03125d0*dsqrt((bk3-bk)*(bk1-bk)*(bk2-bk)*(bk4-bk))            dx6j-031
      d4=.5d0*(al+.5d0*bk-1.d0)                                         dx6j-032
      aa(i)=-(al*(d1+(d2-d4)*d4)*aa(i-1)+(al-1.d0)*c1*aa(i-2))/(c2*(al+1dx6j-033
     1.d0))                                                             dx6j-034
      al=al-2.d0                                                        dx6j-035
      at=at+al*aa(i)*aa(i)                                              dx6j-036
      if (at.lt.1.d12) go to 2                                          dx6j-037
      at=at*1.d-24                                                      dx6j-038
      do 1 ii=2,i                                                       dx6j-039
    1 aa(ii)=aa(ii)*1.d-12                                              dx6j-040
    2 continue                                                          dx6j-041
      return                                                            dx6j-042
      end                                                               dx6j-043
c 27/04/98  ibm version                                         ecis97  cora-000
      subroutine cora(l,lq,ll,e,f,v,w,b,c,lt)                           cora-001
c coefficients for coulomb integrals                                    cora-002
c m(l1,l2,lq,r)=sum from r to infinity of h(l1)*k(l2)/r**(lq+1)         cora-003
c expressed as sum on i of b(i)*m(l+i-2,l+i-2,1) + c1(r)*h(l)*k(l)      cora-004
c + c2(r)*h(l)*k(l+1) + c3(r)*h(l+1)*k(l) + c4(r)*h(l+1)*k(l+1)         cora-005
c where h and k are regular or irregular coulomb functions              cora-006
c l=integer part of (l1+l2-lq+3)/2 and i ranges from 1 to 4.            cora-007
c input variables: l,lq:   l,lq in the expressions above                cora-008
c                  ll:     value of l2-l1+1 which must be >1.           cora-009
c                  e,f:    coulomb parameters                           cora-010
c                  v,w:    product of r with the wave numbers           cora-011
c                  lt:     .true. for only integrals from 0 to infinity cora-012
c output variables:b(4):   coefficients b in the expressions above      cora-013
c                  c(4):   coefficients c                               cora-014
c                                                                       cora-015
c these results are obtained by expressing                              cora-016
c h(l1)*k(l2)/r**(lq+1)- sum on i of b(i)*h(l+i-2)*k(l+i-2)/r**2        cora-017
c as p1*h(l)*k(l) + p2*h(l)*k(l+1) + p3*h(l+1)*k(l) + p4*h(l+1)*q(l+1)  cora-018
c where p1,p2,p3,p4 are polynomial in 1/r and identification term by    cora-019
c term starting from the highest degree in 1/r with the derivative of   cora-020
c  q1*h(l)*k(l) + q2*h(l)*k(l+1) + q3*h(l+1)*k(l) + q4*h(l+1)*q(l+1)    cora-021
c this as been done using amp ( j.-m. drouffe, amp language reference   cora-022
c manual - version 6 - note cea-n-2297 1982).                           cora-023
c                                                                       cora-024
c the non relativistic results for lq=6 l2-l1=0,2,4 and all the         cora-025
c coefficients up to lq=5 have been obtained. but, this is a version    cora-026
c limited to lq=4. to use all the coefficients, suppress 'c' in column 1cora-027
c of the fortran cards and put 'c' in column 1 of cora-063, cora-214 andcora-028
c cora-901, replace in subroutine calx                                  cora-029
c     if (mc1.gt.0) mcm(1)=min0(mc1,4)                        calx-231  cora-030
c     if (lo(200).and.(mc2.gt.0)) mcm(2)=min0(mc2,2)          calx-232  cora-031
c     if (lo(100).and.(mc2.gt.0)) mcm(2)=min0(mc2,3)          calx-233  cora-032
c by                                                                    cora-033
c     if (lo(200).and.(mc1.gt.0)) mcm(1)=min0(mc1,6)          calx-231  cora-034
c     if (lo(100).and.(mc1.gt.0)) mcm(1)=min0(mc1,5)          calx-232  cora-035
c     if (mc2.gt.0) mcm(2)=min0(mc2,4)                        calx-233  cora-036
c and use lo(45)=.true. in the tests to read mc1 and mc2.               cora-037
c                                                                       cora-038
c***********************************************************************cora-039
      implicit real*8 (a-h,o-z)                                         cora-040
      dimension b(4),c(4)                                               cora-041
      logical lt                                                        cora-042
      do 1 i=1,4                                                        cora-043
      b(i)=0                                                            cora-044
    1 c(i)=0                                                            cora-045
      if ((lq.gt.6).or.(ll*(lq-ll+2).le.0)) go to 68                    cora-046
      a=l+1                                                             cora-047
      s=v/w                                                             cora-048
      x=e*s-f                                                           cora-049
      if (dabs(x).lt.1.d-10) x=0                                        cora-050
      u=s**2-1                                                          cora-051
      if (dabs(u).lt.1.d-10) u=0                                        cora-052
      if ((x.eq.0).and.(e.eq.0)) go to 47                               cora-053
      p=s**2*(a**2+e**2)                                                cora-054
      q=a**2+f**2                                                       cora-055
      y=e*s+f                                                           cora-056
      z=e**2-f**2                                                       cora-057
      if (dabs(z).lt.1.d-10) z=0                                        cora-058
      if (x.eq.0.d0.and.z.eq.0.d0) z=1.d0                               cora-059
      den=2*x**2*(p-q)+8*z*s**2                                         cora-060
      z=u                                                               cora-061
      if (x.eq.0.and.z.eq.0) z=-1/(e*f)                                 cora-062
c     go to ( 2 , 7 , 11 , 18 , 26 , 39 ) , lq                          cora-063
      go to ( 2 , 7 , 11 , 18 , 69 , 69 ) , lq                          cora-064
    2 go to ( 3 , 4 ) , ll                                              cora-065
c multipole lq=1 l1=l2                                                  cora-066
    3 b(1)=1                                                            cora-067
      return                                                            cora-068
    4 if ((e.ne.f).or.(v.ne.w)) go to 5                                 cora-069
c multipole lq=1 l1=l2-1 with e=f and v=w                               cora-070
      b1=dsqrt((a-1)**2+e**2)                                           cora-071
      b(2)=-(a-.5d0)*q/(e*b1)                                           cora-072
      b(3)=(a+.5d0)*q/(e*b1)                                            cora-073
      if (lt) return                                                    cora-074
      c(1)=(q+(2.d0*a-1.d0)*e/v)/(2.d0*e*v*b1)                          cora-075
      c(3)=-dsqrt(q)/(2.d0*v*a*b1)                                      cora-076
      c(2)=c(3)*(2.d0*a-1.d0)                                           cora-077
      c(4)=q/(2.d0*e*v*b1)                                              cora-078
      return                                                            cora-079
c multipole lq=1 l1=l2-1                                                cora-080
    5 a1=-2.d0*f*(2.d0*(a-1.d0)*q-a**2*u)                               cora-081
      a2=f*(4.d0*q*(a-1.d0)*((6.d0*a+1.d0)*q-4.d0*a**2+1.d0)+u*((((16.d0cora-082
     1*a-24.d0)*a+4.d0)*a**2-2.d0)*q+a**2*(2.d0*a-1.d0-u*(a-1.d0)**2)*(4cora-083
     2.d0*a+2.d0)))                                                     cora-084
      a3=-f*(a-1.d0)*((24.d0*a-4.d0)*q+16.d0*a**2-4.d0+u*(((8.d0*a+8.d0)cora-085
     1*a+2.d0)*a-2.d0))                                                 cora-086
      a4=4.d0*(a-1.d0)*f                                                cora-087
      if (x.eq.0.d0) go to 6                                            cora-088
      a1=a1-x*(q*(a-1.d0)*(2.d0*a+6.d0)+a**2*(4.d0+a*u)+x*((2.d0*a-2.d0)cora-089
     1*f+a*x))                                                          cora-090
      a2=a2+x*(q*((a-1.d0)*(a+5.d0)*(12.d0*a+2.d0)*q-(((40.d0*a-16.d0)*acora-091
     1-34.d0)*a-8.d0)*a-6.d0+(((((8.d0*a+12.d0)*a-38.d0)*a+8.d0)*a+5)*a-cora-092
     24)*u+(((16.d0*a+40.d0)*a-44.d0)*a-12.d0)*f*x+(((4.d0*a+20.d0)*a-13cora-093
     3.d0)*a-8.d0)*x**2)+(2.d0*a+1.d0)*(a**2*(4.d0-8.d0*a+((6.d0*a-7.d0)cora-094
     4*a+4.d0)*u+a*(a-1.d0)**2*u**2)+x*(((4.d0*a+6.d0)*a-2.d0+(a-1.d0)*(cora-095
     5(4.d0*a-4.d0)*a+2.d0)*u)*f+x*(a*(((2.d0*a-2.d0)*a+1.d0)*u-(4.d0*a-cora-096
     66.d0)*a+1)+(4.d0*a-2.d0)*f*x+a*x**2))))                           cora-097
      a3=a3+x*(a-1.d0)*(((8.d0*a-8.d0)*a+6.d0)*a+2.d0-(2.d0*a+6.d0)*(6.dcora-098
     10*a-1.d0)*q-((((4.d0*a+12.d0)*a+5.d0)*a-3.d0)*a-2.d0)*u-2.d0*x*(((cora-099
     24.d0*a+8.d0)*a-3.d0)*f-x))                                        cora-100
      a4=a4+x*2.d0*(a**2-1.d0)                                          cora-101
    6 bd=.5d0*den*dsqrt((a-1.d0)**2+e**2)                               cora-102
      if (.not.lt) c(1)=.5d0-a                                          cora-103
      go to 46                                                          cora-104
    7 go to ( 8 , 9 , 10 ) , ll                                         cora-105
c multipole lq=2 l1=l2                                                  cora-106
    8 a1=2.d0*z*a**2*y                                                  cora-107
      a2=-z*y*(2.d0*a+1.d0)*(((a-1.d0)*a-.5d0)*y**2+2.d0*a**2*(a-1.d0)**cora-108
     12*(s**2+1.d0))                                                    cora-109
      a3=2.d0*z*(2.d0*a+1.d0)*(a-1.d0)**2*y                             cora-110
      a4=0.d0                                                           cora-111
      bd=den*(a-1.d0)/dsqrt(s)                                          cora-112
      if (.not.lt) c(1)=-1.d0                                           cora-113
      if (x.eq.0) go to 46                                              cora-114
      a1=a1+x*(4.d0*f*e*s-2.d0*a*(a+q+a*s**2+p))                        cora-115
      a2=a2+x*((a+.5d0)*((((4.d0*a-6.d0)*a+2.d0)*a-1.d0)*(q+p*s**2)+4.d0cora-116
     1*(2.d0*a-3.d0)*f*e*s*(q+p+s**2+1.d0)+(((4.d0*a+2.d0)*a-14.d0)*a+1.cora-117
     2d0)*(q*s**2+p)+a**2*((s**4+1.d0)*((2.d0*a-6.d0)*a+5.d0)-s**2*(4.d0cora-118
     3*(a+1.d0)*a-14.d0)))+p*q*((8.d0*a-4.d0)*a+8.d0))                  cora-119
      a3=a3-2.d0*x*(a-1.d0)*((2.d0*a-3.d0)*(f**2+e**2*s**2)+4.d0*(2.d0*acora-120
     1+1.d0)*f*e*s+(s**2+1.d0)*(a+1.d0)*((6.d0*a+1.d0)*a-3.d0))         cora-121
      a4=4.d0*(a-1.d0)*x                                                cora-122
      go to 46                                                          cora-123
c multipole lq=2 l1=l2-1                                                cora-124
    9 b1=x*(a-1.d0)-e*s                                                 cora-125
      b3=-(a-1.d0)**2                                                   cora-126
      b2=b3/(a-.5d0)                                                    cora-127
      bd=-den*a*(a-1.d0)*(2.d0*a-3.d0)*dsqrt(s*((a-1.d0)**2+e**2))/(2.d0cora-128
     1*a-1.d0)                                                          cora-129
      if (lt) go to 13                                                  cora-130
      c(1)=b1+2.d0*a*(a-1.d0)**2/w                                      cora-131
      c(2)=b3                                                           cora-132
      c(3)=b2                                                           cora-133
      go to 13                                                          cora-134
c multipole lq=2 l1=l2-2                                                cora-135
   10 b1=q                                                              cora-136
      b3=-3.d0*e*s-x*(a-1.d0)                                           cora-137
      b4=(a-1.d0)/(a-.5d0)                                              cora-138
      bd=-3.d0*den*a*dsqrt(s*q*((a-1.d0)**2+e**2))/(2.d0*a-1.d0)        cora-139
      if (lt) go to 15                                                  cora-140
      c(1)=b1                                                           cora-141
      c(2)=b3-2.d0*a*(a-1.d0)/w                                         cora-142
      c(4)=b4                                                           cora-143
      go to 15                                                          cora-144
   11 go to ( 12 , 14 , 16 , 17 ) , ll                                  cora-145
c multipole lq=3 l1=l2                                                  cora-146
   12 b1=y/(a-1.d0)                                                     cora-147
      b2=1.d0                                                           cora-148
      b3=1.d0                                                           cora-149
      bd=den*a*(2.d0*a-3.d0)                                            cora-150
      if (lt) go to 13                                                  cora-151
      c(1)=b1-2.d0*a/w                                                  cora-152
      c(2)=b3                                                           cora-153
      c(3)=b2                                                           cora-154
   13 a1=-2.d0*a**2*y*b1*z                                              cora-155
      a2=y*((2.d0*a+1.d0)*((2.d0*(a**2-a)**2*(1.d0+s**2)+y**2*(a**2-a-.5cora-156
     1d0))*b1-y*(p*b2+q*b3)))*z                                         cora-157
      a3=-y*((2.d0*a-1.d0)*(-y*(b2+b3))+(4.d0*a+2.d0)*(a-1.d0)**2*b1)*z cora-158
      a4=0.d0                                                           cora-159
      if (x.eq.0.d0) go to 46                                           cora-160
      a1=a1+x*2.d0*p*(a*x-2.d0*f)*b2                                    cora-161
      a2=a2+x*p*(2.d0*q*((2.d0*a+3.d0)*(a+1.d0)*f+((2.d0*a+3.d0)*a-4.d0)cora-162
     1*e*s)-2.d0*p*(2.d0*a-3.d0)*(2.d0*a+1.d0)*f+(2.d0*a+1.d0)*((((2.d0*cora-163
     2a-1.d0)*a-8.d0)*a+5.d0)*f-s*((a+1.d0)*((6.d0*a-9.d0)*a+1.d0)*e-s*(cora-164
     3(6.d0*a-7.d0)*(a**2-1.d0)*f-s*((((2.d0*a-5.d0)*a+2.d0)*a-1.d0)*e))cora-165
     4)))*b2                                                            cora-166
      a3=a3+x*(2.d0*p*((2.d0*a-3.d0)*(a-1.d0)*e*s+f*((2.d0*a-3.d0)*a-4.dcora-167
     10))-2.d0*q*e*s*(2.d0*a+3.d0)*(2.d0*a-1.d0)-(2.d0*a-1.d0)*((((2.d0*cora-168
     2a+5.d0)*a+2.d0)*a+1.d0)*f-s*((6.d0*a+7.d0)*(a**2-1.d0)*e-s*((a-1.dcora-169
     30)*((6.d0*a+9.d0)*a+1.d0)*f-s*((((2.d0*a+1.d0)*a-8.d0)*a-5.d0)*e))cora-170
     4)))*b2                                                            cora-171
      if (lq.eq.3) go to 45                                             cora-172
      a4=a4+x*2.d0*(2.d0*e*s-a*x)*b2                                    cora-173
      go to 44                                                          cora-174
c multipole lq=3 l1=l2-1                                                cora-175
   14 b1=q/(a-1.d0)                                                     cora-176
      b3=-x                                                             cora-177
      b4=1.d0/(a+1.d0)                                                  cora-178
      bd=-3.d0*den*a*dsqrt(q)                                           cora-179
      if (lt) go to 15                                                  cora-180
      c(1)=b1                                                           cora-181
      c(2)=b3-2.d0*a/w                                                  cora-182
      c(4)=b4                                                           cora-183
   15 a1=-2.d0*a**2*y*b1*z                                              cora-184
      a2=y*((2.d0*a+1.d0)*((2.d0*(a**2-a)**2*(1.d0+s**2)+y**2*(a**2-a-.5cora-185
     1d0))*b1-y*q*b3)+(4.d0*a-2.d0)*(a+1.d0)**2*p*q*b4)*z               cora-186
      a3=-y*((2.d0*a-1.d0)*((2.d0*(a**2+a)**2*(1.d0+s**2)+y**2*(a**2+a-.cora-187
     15d0))*b4-y*b3)+(4.d0*a+2.d0)*(a-1.d0)**2*b1)*z                    cora-188
      a4=2.d0*a**2*y*b4*z                                               cora-189
      if (x.eq.0.d0) go to 46                                           cora-190
      a1=a1-x*4.d0*p*q*(a+1.d0)*b4                                      cora-191
      a2=a2+x*2.d0*p*q*(a+1.d0)*((2.d0*a+3.d0)*(q+p)+(2.d0*a-1.d0)*(4.d0cora-192
     1*e*f*s+(1.d0+s**2)*((2.d0*a-4.d0)*a-3.d0)))*b4                    cora-193
      a3=a3+x*(-4.d0*p*q*((2.d0*a+1.d0)*a+2.d0)-(2.d0*a-1.d0)*(2.d0*s*e*cora-194
     1f*(2.d0*a+3.d0)*(q+p+s**2+1)-a**2*(((a+3.d0)*a+2.5d0)*(1.d0+s**4)-cora-195
     2s**2*((2.d0*a-2.d0)*a-7.d0))+a*(a-1.d0)*(2.d0*a+3.d0)*(1.d0+s**2)*cora-196
     3(p+q)-(s**2-1.d0)*((2.d0*a+4.d0)*a+.5d0)*(q-p)))*b4               cora-197
      a4=a4+x*2.d0*((a-1.d0)*(p+q)+y**2)*b4                             cora-198
      go to 44                                                          cora-199
c multipole lq=3 l1=l2-2                                                cora-200
   16 b1=-q*(2.d0*a-1.d0)*((2.d0*a-3.d0)*(a+1.d0)*x+(a-3.d0)*y)/(a-1.d0)cora-201
      b2=6.d0*q*(a-1.d0)                                                cora-202
      b3=((a-1.d0)*(6.d0*a-3.d0)*q+(2.d0*a-1.d0)*((a+1.d0)*x+2.d0*y)*(2.cora-203
     1d0*a-3.d0)*x-(a-1.d0)*(6.d0*a-9.d0)*p)                            cora-204
      b4=-((2.d0*a-1.d0)*x+y)*(2.d0*a-3.d0)                             cora-205
      bd=12.d0*a**2*(2.d0*a-3.d0)*den*s*dsqrt(q*((a-1.d0)**2+e**2))     cora-206
      if (lt) go to 43                                                  cora-207
      c(1)=b1-6.d0*q*a*(a-1.d0)*(2.d0*a-1.d0)/w                         cora-208
      c(2)=b3+a*(4.d0*a-6.d0)*(2.d0*a-1.d0)*((a+1.d0)*x+2.d0*y+3.d0*a*(acora-209
     1-1.d0)/w)/w                                                       cora-210
      c(3)=b2                                                           cora-211
      c(4)=b4-6.d0*a*(a-1.d0)*(2.d0*a-3.d0)/w                           cora-212
      go to 43                                                          cora-213
c multipole lq=3 l1=l2-3                                                cora-214
   17 b1=-q*(3.d0*e*s*y+a*(3.d0*x*y+2.d0*(a+1.d0)*(x**2+2.d0*a-1.d0-2.d0cora-215
     1*(a-1.d0)*s**2)))                                                 cora-216
      b2=3.d0*q*(a*x+y)                                                 cora-217
      b4=-(3.d0*f*y+a*(3.d0*x*y+2.d0*(a-1.d0)*(x**2+2.d0*a+2.d0-(2.d0*a+cora-218
     11.d0)*s**2)))                                                     cora-219
      b3=-x*b4*(a+1.d0)+3.d0*q*(y+a*x)+a*(3.d0*a+1.5d0)*(1.d0-s**2)*((3.cora-220
     1d0*a-2.d0)*y+((a-2.d0)*a+2.d0)*x)                                 cora-221
      bd=30.d0*a**2*den*s*dsqrt(q*((a-1.d0)**2+e**2)*((a+1.d0)**2+f**2))cora-222
      if (lt) go to 43                                                  cora-223
      c(1)=b1-3.d0*q*(2.d0*a-1.d0)*((6.d0*a+4.d0)*f+(a+1.d0)*(a+4.d0)*x+cora-224
     14.d0*a*(a**2-1.d0)/w)/w                                           cora-225
      c(2)=b3+((4.d0*a**2*(a**2-1.d0)*(2.d0*a-1.d0-s**2*(2.d0*a+1.d0))+(cora-226
     118.d0*a**2-3.d0)*y**2+a*(12.d0*a**2+3.d0)*x*y+(a**2-1.d0)*(4.d0*a*cora-227
     2*2-3.d0)*x**2)+3.d0*a*(4.d0*a**2-1.d0)*(5.d0*a*y+(a**2+4.d0)*x+4.dcora-228
     30*a*(a**2-1.d0)/w)/w)/w                                           cora-229
      c(3)=b2+12.d0*q*(a**2-1.d0)/w                                     cora-230
      c(4)=b4-3.d0*(2.d0*a+1.d0)*((6.d0*a-4.d0)*f+a*(a+1.d0)*x+4.d0*a*(acora-231
     1**2-1.d0)/w)/w                                                    cora-232
      go to 43                                                          cora-233
c  18 go to ( 19 , 20 , 21 , 22 , 24 ) , ll                             cora-234
   18 go to ( 19 , 69 , 21 , 69 , 24 ) , ll                             cora-235
c multipole lq=4 l1=l2                                                  cora-236
   19 b1=-p*q*(2.d0*a+3.d0)/(a-1.d0)                                    cora-237
      b2=-q*(3.d0*e*s+a*x)                                              cora-238
      b3=-p*(3.d0*f-a*x)                                                cora-239
      b4=-((p+q)*(a+1.5d0)-1.5d0*y**2)/(a+1.d0)                         cora-240
      bd=3.d0*den*a**2*(2.d0*a+3.d0)*(a+2.d0)*dsqrt(s*p*q)              cora-241
      if (lt) go to 43                                                  cora-242
      c(1)=b1                                                           cora-243
      c(2)=(b3+p*a*(2.d0*a+3.d0)/w)                                     cora-244
      c(3)=(b2+q*a*(2*a+3.d0)/w)                                        cora-245
      c(4)=(b4-3.d0*a*(y-a*(2.d0*a+3.d0)/w)/w)                          cora-246
      go to 43                                                          cora-247
c multipole lq=4 l1=l2-1                                                cora-248
c  20 b1=q*(3*e*s-a*x)*(4*a+6)/(a-1)                                    cora-249
c     b2=18*q                                                           cora-250
c     b3=((2*a+3)*(3*q+(2*a-3)*x**2)-(6*a-9)*p)                         cora-251
c     b4=(3*f-a*x)*(4*a-6)/(a+1)                                        cora-252
c     bd=12*den*a**2*dsqrt(s*q)*(4*a**2-9)                              cora-253
c     if (lt) go to 43                                                  cora-254
c     c(1)=b1-6*q*a*(2*a+3)/w                                           cora-255
c     c(2)=b3+2*a*(4*a**2-9)*(x+3*a/w)/w                                cora-256
c     c(3)=b2                                                           cora-257
c     c(4)=b4-6*a*(2*a-3)/w                                             cora-258
c     go to 43                                                          cora-259
c multipole lq=4 l1=l2-2                                                cora-260
   21 b1=((2.d0*a-e**2)*s**2+(a+2.d0)*(2.d0*e*f*s-a*(2.d0*a+2.d0+f**2)/(cora-261
     1a-1.d0))/(a+1.d0))                                                cora-262
      b2=6.d0*q*((a+1.d0)*x-3.d0*f)                                     cora-263
      b3=(-x*(4.d0*a+6.d0)*b1*(a**2-1.d0)+3.d0*(p*((2.d0*a+5.d0)*x-3.d0*cora-264
     1y)+(1.d0-s**2)*a*(a+2.d0)*(2.d0*a+3.d0)*(a*x+e*s)))               cora-265
      b4=((4.d0*a+6.d0)*(b1*(a-1.d0)+3.d0*a*(s**2-1.d0))+3.d0*y*(3.d0*y-cora-266
     1(2.d0*a+5.d0)*x)/(a+1.d0))                                        cora-267
      b1=q*(a+1.d0)*(4.d0*a+6.d0)*b1                                    cora-268
      bd=60.d0*den*a**2*(a+2.d0)*(2.d0*a+3.d0)*dsqrt(s*q*((a+1.d0)**2+f*cora-269
     1*2))                                                              cora-270
      if (lt) go to 43                                                  cora-271
      c(1)=b1-6.d0*q*(a+2.d0)*(2.d0*a+3.d0)*(e*s+a*(x+4.d0*(a+1.d0)/w))/cora-272
     1w                                                                 cora-273
      c(2)=b3+2.d0*(2.d0*a+3.d0)*(6.d0*e*f*s+a*(f*((2.d0*a+13.d0)*x+6.d0cora-274
     1*f)+(a+1.d0)*(2.d0*a*(2.d0*a+4.d0-(2.d0*a+1.d0)*s**2)+(2.d0*a+1.d0cora-275
     2)*x**2))+3.d0*a*(a+2.d0)*(2.d0*a+1.d0)*((a+1.d0)*x+5.d0*f+a*(4.d0*cora-276
     2a+4.d0)/w)/w)/w                                                   cora-277
      c(3)=b2+12.d0*q*(a+1.d0)*(2.d0*a+3.d0)/w                          cora-278
      c(4)=b4-(12.d0*a+6.d0)*((a+6.d0)*f+a*(a+1.d0)*(x+(4.d0*a+6.d0)/w))cora-279
     1/w                                                                cora-280
      go to 43                                                          cora-281
c multipole lq=4 l1=l2-3                                                cora-282
c  22 b1=f*q*(12*(q-(2*a-1)*(2*a-5))/((2*a-3)*(a-1))+(26*a-10)*u)       cora-283
c     b2=q*(36*(q+4*a**2-5)/(2*a-3)-30*(a**2-1)*u)/(2*a+3)              cora-284
c     b3=b2+u*(a**2*(6*a+3)*((4*a+10)+5*(a**2-1)*u)-18*q*a*(3*a+4))/(2*acora-285
c    1+3)                                                               cora-286
c     b4=f*(12*(q-(2*a+5)*(2*a+1))+u*(4*a+2)*((13*a+22)*a-15))/((a+1)*(2cora-287
c    1*a+3))                                                            cora-288
c     if (x.eq.0) go to 23                                              cora-289
c     b1=b1-2*q*x*((6*q*(a-2)+(((28*a-30)*a-46)*a+30))/((2*a-3)*(a-1))-(cora-290
c    1a+1)*((9*a-5)*u-2*x**2))                                          cora-291
c     b2=b2-12*q*x*(f-x*(a+1))/(2*a+3)                                  cora-292
c     b3=b3+x*(24*q*(a*x-f)+(2*a+1)*(12*(2*a+5)*f-((44*a+80)*a-30)*f*u+xcora-293
c    1*a*(28*a+52-u*(24*a+2)*(a+1))+12*f*x**2+4*a*x**3*(a+1)))/(2*a+3)  cora-294
c     b4=b4-x*(12*(a-1)*q+(4*a+2)*(6*f*x+a*(14*a+26-(a+1)*((9*a+1)*u-2*xcora-295
c    1**2))))/((2*a+3)*(a+1))                                           cora-296
c  23 bd=360*den*a**2*s*dsqrt(s*q*((a+1)**2+f**2)*((a-1)**2+e**2))      cora-297
c     if (lt) go to 43                                                  cora-298
c     c(1)=b1+q*(12*(a*(2*a-1)*(2*a-5)-q*(9*a-12))/(2*a-3)+30*a*u*(a**2-cora-299
c    11)-24*(2*a-1)*(f*(7*a+5)+5*a*(a**2-1)/w)/w)/w                     cora-300
c     c(2)=b3+(f*(48*q-8*a*u*(2*a+1)*(7*a-5))+6*(10*q*(11*a**2-2)-a**2*(cora-301
c    12*a+1)*(30*(2*a-1)+5*u*(a**2-1)-(8*a-4)*(12*f+5*(a**2-1)/w)/w))/w)cora-302
c    2/w                                                                cora-303
c     c(3)=b2+24*q*(2*f+5*(a**2-1)/w)/w                                 cora-304
c     c(4)=b4+((12*a*(2*a+1)*(2*a+5)-36*q*(3*a+4)+30*a*u*(2*a+1)*(a**2-1cora-305
c    1))/(2*a+3)-24*(2*a+1)*(f*(7*a-5)+5*a*(a**2-1)/w)/w)/w             cora-306
c     if (x.eq.0) go to 43                                              cora-307
c     c(1)=c(1)-12*x*q*((a+2)*(3*f+(a+1)*x)+(4*a-2)*(a+1)*(a+5)/w)/w    cora-308
c     c(2)=c(2)+x*((12*q*(5*a+6)+(2*a+1)*(12*f*x*(a+2)-2*a*(4*a+10+(a+1)cora-309
c    1*(u*(9*a-5)-2*x**2))))+12*(2*a+1)*(f*((7*a+24)*a-10)+a*(a+1)*((a+2cora-310
c    2)*x+(4*a-2)*(a+5)/w))/w)/w                                        cora-311
c     c(3)=c(3)+24*x*q*(a+1)/w                                          cora-312
c     c(4)=c(4)-12*x*(2*a+1)*((3*f*(a+2)+a*x*(a+1))/(2*a+3)+2*a*(a+1)/w)cora-313
c    1/w                                                                cora-314
c     go to 43                                                          cora-315
c multipole lq=4 l1=l2-4                                                cora-316
   24 b1=6.d0*q*(q*((42.d0*a+3.d0)*u-36.d0)+a*(24.d0*a-12.d0-u*((34.d0*acora-317
     1+3.d0)*a+8.d0)-(8.d0*a+12.d0)*(a**2-1.d0)*u**2))                  cora-318
      b2=18.d0*q*(12.d0-u*(9.d0*a+1.d0))*f                              cora-319
      b3=9.d0*f*(q*(24.d0-u*(38.d0*a+2.d0))+u*a*(2.d0*a+1.d0)*(a+1.d0)*(cora-320
     14.d0+(17.d0*a-12.d0)*u))                                          cora-321
      b4=6.d0*(q*((42.d0*a+3.d0)*u-36.d0)+a*(2.d0*a+1.d0)*(12.d0-(17.d0*cora-322
     1a-2.d0)*u-u**2*(4.d0*a+6.d0)*(a-1)))                              cora-323
      if (x.eq.0.d0) go to 25                                           cora-324
      b1=b1-q*x*(x*(24.d0*q+(56.d0*a+188.d0)*a+108.d0)+108.d0*(2.d0*a+3.cora-325
     1d0)*f-2.d0*(2.d0*a+3.d0)*(58.d0*a+7.d0)*f*u-2.d0*(a+1.d0)*(2.d0*a+cora-326
     23.d0)*(15.d0*a+4.d0)*u*x+12.d0*(2.d0*a+3.d0)*f*x**2+4.d0*(a+1.d0)*cora-327
     3(2.d0*a+3.d0)*x**3)                                               cora-328
      b2=b2+q*x*(24.d0*f*x+(a+1.d0)*(108.d0-(66.d0*a+24.d0)*u+12.d0*x**2cora-329
     1))                                                                cora-330
      b3=b3+x*(24.d0*f*q*x+(a+1.d0)*(q*(324.d0+36.d0*x**2-(498.d0*a+42.dcora-331
     10)*u)+(2.d0*a+1.d0)*(f*x*(108.d0-(152.d0*a+24.d0)*u+12.d0*x**2)-a*cora-332
     2(72.d0-(168.d0*a-12.d0)*u-((57.d0*a+24.d0)*a-36.d0)*u**2-x**2*(28.cora-333
     3d0-(36.d0*a+20.d0)*u+4.d0*x**2)))))                               cora-334
      b4=b4+x*(x*(a*(2.d0*a+1.d0)*(30.d0*a+20.d0)*u-24.d0*q)-(8.d0*a+4.dcora-335
     10)*(f*(27.d0-(29.d0*a+6.d0)*u)+x*(7.d0*a+3.d0*f*x+a*x**2)))       cora-336
   25 bd=2520.d0*den*a**2*s*dsqrt(s*q*((a+1.d0)**2+f**2)*((a-1.d0)**2+e*cora-337
     1*2)*((a+2.d0)**2+f**2))                                           cora-338
      if (lt) go to 43                                                  cora-339
      c(1)=b1+18.d0*q*(f*((a-1.d0)*(8.d0*a-4.d0)-20.d0*q+(2.d0*a+3.d0)*(cora-340
     1(17.d0*a-3.d0)*a-4.d0)*u)-4.d0*(15.d0*q*((4.d0*a+4.d0)*a-1.d0)-a*(cora-341
     22.d0*a-1.d0)*((34.d0*a+55.d0)*a+16.d0)-(2.d0*a+3.d0)*(2.d0*a*u*(a+cora-342
     31.d0)*(a-1.d0)*(a+2.d0)-5.d0*(2.d0*a-1.d0)*(f*((5.d0*a+5.d0)*a+4.dcora-343
     40)+2.d0*a*(a**2-1.d0)*(a+2.d0)/w)/w))/w)/w                        cora-344
      c(2)=b3+(360.d0*q**2-72.d0*q*(4.d0*a**2+1.d0)-24.d0*(a+1.d0)*u*(q*cora-345
     1((66.d0*a-12.d0)*a-9.d0)-a**2*(2.d0*a+1.d0)*(34.d0*a-19.d0+u*(a-1.cora-346
     2d0)*(2.d0*a+3.d0)))+18.d0*(20.d0*q*f*((20.d0*a+14.d0)*a-3.d0)-(a+1cora-347
     3.d0)*(a*f*((4.d0*a**2-1.d0)*140.d0+u*(10.d0*a+15.d0)*(2.d0*a+1.d0)cora-348
     4*(5.d0*a-4.d0))-4.d0*(10.d0*q*(((30.d0*a+19.d0)*a-1.d0)*a-6.d0)-a*cora-349
     5*2*(2.d0*a+1.d0)*((2.d0*a-1.d0)*(84.d0*a+56.d0)+(2.d0*a+3.d0)*((2.cora-350
     6d0*a-2.d0)*(a+2.d0)*u-(10.d0*a-5.d0)*(7.d0*f+2.d0*(a-1.d0)*(a+2.d0cora-351
     7)/w)/w)))/w))/w)/w                                                cora-352
      c(3)=b2+72.d0*q*(5.d0*q-4.d0*a**2-1.d0-(2.d0*a+3.d0)*((a**2-1.d0)*cora-353
     1u-5.d0*(f*(3.d0*a-1.d0)+2.d0*(a**2-1.d0)*(a+2.d0)/w)/w))/w        cora-354
      c(4)=b4-18.d0*(20.d0*q*f-(a+1.d0)*((2.d0*a+1.d0)*f*(4.d0+u*(17.d0*cora-355
     1a-12.d0))-4.d0*(15.d0*q*(4.d0*a-1.d0)-(2.d0*a+1.d0)*(a*(34.d0*a-19cora-356
     2.d0)+(2.d0*a+3.d0)*(a*(a-1.d0)*u-5.d0*(f*(5.d0*a-4.d0)+2.d0*a*(a-1cora-357
     3.d0)*(a+2.d0)/w)/w)))/w))/w                                       cora-358
      if (x.eq.0.d0) go to 43                                           cora-359
      c(1)=c(1)-6.d0*q*x*((a+2.d0)*(60.d0*q-(44.d0*a-10.d0)*a-6.d0-(2.d0cora-360
     1*a+3.d0)*((a+1.d0)*((11.d0*a-6.d0)*u-2.d0*x**2)-12.d0*f*x))+(8.d0*cora-361
     2a+12.d0)*(((20.d0*a+90.d0)*a-5.d0)*f+(a+1.d0)*(a+2.d0)*((2.d0*a+5.cora-362
     3d0)*x+(10.d0*a-5.d0)*(a+6.d0)/w))/w)/w                            cora-363
      c(2)=c(2)+x*((2.d0*a+3.d0)*(240.d0*f*q+(a+1.d0)*(144.d0*q*x-(2.d0*cora-364
     1a+1.d0)*((24.d0-24.d0*x**2+(182.d0*a-72.d0)*u)*f+a*x*(44.d0+(30.d0cora-365
     2*a+8.d0)*u-4.d0*x**2))))+(a+1.d0)*(q*((2400.d0*a+8400.d0)*a-360.d0cora-366
     3)-(24.d0*a+12.d0)*(a*((102.d0*a+357.d0)*a-114.d0)-(2.d0*a+3.d0)*((cora-367
     4a+2.d0)*(10.d0*f*x+a*(x**2-(5.5d0*a-3.d0)*u))+(f*((60.d0*a+270.d0)cora-368
     5*a-120.d0)+a*(a+2.d0)*(x*(4.d0*a+10.d0)+(20.d0*a-10.d0)*(a+6.d0)/wcora-369
     6))/w)))/w)/w                                                      cora-370
      c(3)=c(3)+24.d0*x*q*(2.d0*a+3.d0)*(5.d0*f+(a+1.d0)*(x+5.d0*(a+2.d0cora-371
     1)/w))/w                                                           cora-372
      c(4)=c(4)-6.d0*x*(a+1.d0)*(60.d0*q-(2.d0*a+1.d0)*(22.d0*a+(11.d0*acora-373
     1+4.d0)*a*u-12.d0*f*x-2.d0*a*x**2-(8.d0*a+12.d0)*(10.d0*f+a*(x+5.d0cora-374
     2*(a+2.d0)/w))/w))/w                                               cora-375
      go to 43                                                          cora-376
c  26 go to ( 27 , 29 , 31 , 33 , 35 , 37 ) , ll                        cora-377
c multipole lq=5 l1=l2                                                  cora-378
c  27 bd=12*den*a**2*(a+2)*(2*a+5)*(4*a**2-9)*s*dsqrt(p*q)              cora-379
c     b1=28*p*q*f*(2*a+3)/(a-1)                                         cora-380
c     b2=q*(84*q-a*(48*a-72-u*(a+2)*(6*a+27)))                          cora-381
c     b3=p*(84*q-a*(6*a-9)*(8+(a+2)*u))                                 cora-382
c     b4=(4*a-6)*(14*q+a*(24+(7*a+12)*u))*f/(a+1)                       cora-383
c     if (x.eq.0) go to 28                                              cora-384
c     b1=b1+(28*a+42)*x*p*q/(a-1)                                       cora-385
c     b2=b2+q*x*((28*a+126)*f+((4*a+22)*a+42)*x)                        cora-386
c     b3=b3-p*x*(2*a-3)*(14*f-2*a*x)                                    cora-387
c     b4=b4+x*(4*a-6)*(21*q-a*(14*a-12+(a**2-3)*u)-x*((2*a-7)*f+a*x))/(acora-388
c    1+1)                                                               cora-389
c  28 if (lt) go to 43                                                  cora-390
c     c(1)=b1-p*q*(a+2)*(24*a+36)/w                                     cora-391
c     c(2)=b3-p*(4*a**2-9)*(8*f-a*(6*a+12)/w)/w                         cora-392
c     c(3)=b2-q*(4*a**2-9)*(8*f-a*(6*a+12)/w)/w                         cora-393
c     c(4)=b4-(12*a-18)*((2*a-4)*q+a*(a*(8+(a+2)*u)+(8*a+12)*(f-(a+2)*a/cora-394
c    1w)/w))/w                                                          cora-395
c     if (x.eq.0) go to 43                                              cora-396
c     c(3)=c(3)-x*q*(8*a**2-18)*(a+4)/w                                 cora-397
c     c(2)=c(2)+x*p*a*(8*a**2-18)/w                                     cora-398
c     c(4)=c(4)-x*(12*a-18)*((2*a-4)*f+a*(x+(4*a+6)/w))/w               cora-399
c     go to 43                                                          cora-400
c multipole lq=5 l1=l2-1                                                cora-401
c  29 bd=-60*a**2*(2*a+5)*(2*a+3)*(a+3)*(a+2)*den*s*dsqrt(p*q*((a+1)**2+cora-402
c    1f**2))                                                            cora-403
c     b1=p*q*(4*a+6)*((28*q-(12*a-56)*a+40)/(a-1)-(2*a+5)*(a+1)*u)      cora-404
c     b2=q*f*(168*q+480*a+240+((48*a+120)*a+30)*u)                      cora-405
c     b3=p*f*(168*q+480*a+240-(12*a+6)*((2*a+2)*a-5)*u)                 cora-406
c     b4=((2*a-3)*(56*q-(24*a-208)*a+80-(((4*a-18)*a-52)*a-10)*u)*q+a**2cora-407
c    1*(2*a+1)*(480-((24*a-56)*a-180)*u-(2*a+5)*(2*a+3)*(a+1)*u**2))/(a+cora-408
c    21)                                                                cora-409
c     if (x.eq.0) go to 30                                              cora-410
c     b1=b1-x*p*q*(4*a+6)*(7*f-x*(a+1))                                 cora-411
c     b2=b2+x*q*((14*a+210)*q-(56*a-380)*a+240-(6*a+6)*(a**2-5)*u-(12*a-cora-412
c    136)*f*x-(6*a+6)*x**2)                                             cora-413
c     b3=b3-x*p*((98*a-42)*q-(2*a+1)*(a*(24*a-116+(a+1)*((7*a+16)*u-2*x*cora-414
c    1*2))+(14*a-6)*f*x))                                               cora-415
c     b4=b4-x*((2*a-3)*(((2*a+1)*(24*a-80)+(14*a-70)*q)*f-((2*a-22)*a+12cora-416
c    1)*q*x)+(4*a+2)*((((11*a+17)*a+1)*a+15)*f*u-x*((a-1)*(2*a-3)*f*x+a*cora-417
c    2((14*a-18)*a+58+(a+1)*((a+2)*(a-4)*u+x**2)))))/(a+1)              cora-418
c  30 if (lt) go to 43                                                  cora-419
c     c(1)=b1-12*p*q*(2*a+3)*(a+2)*(2*f-(2*a+5)*(a+1)/w)/w              cora-420
c     c(2)=b3-p*(4*a+6)*((16*a-24)*q+(2*a+1)*(40*a-a*(2*a+5)*(a+1)*(u-(6cora-421
c    1*a+12)/w**2)+(30*a+60)*f/w))/w                                    cora-422
c     c(3)=b2-q*(4*a+6)*((16*a-24)*q+(2*a+1)*(40*a+(30*a+60)*f/w)+a*(a+1cora-423
c    1)*(6*a+15)*(u-(10*a+20)/w**2))/w                                  cora-424
c     c(4)=b4-6*(f*(((8*a-28)*a+24)*q+a*(4*a+2)*(((2*a+2)*a-5)*u-40))-(2cora-425
c    1*a+3)*((((4*a+6)*a+62)*a+20)*q+a*(2*a+1)*((2*a+5)*(a+1)*u*a-40*a-(cora-426
c    210*a+20)*(4*f+a*(a+1)*(2*a+5)/w)/w))/w)/w                         cora-427
c     if (x.eq.0) go to 43                                              cora-428
c     c(1)=c(1)+x*p*q*(12*a+18)*(a+1)*(a+2)/w                           cora-429
c     c(2)=c(2)+x*p*(4*a+6)*(((8*a-8)*a-6)*f-a*(a+1)*(2*a+1)*(x+(3*a+6)/cora-430
c    1w))/w                                                             cora-431
c     c(3)=c(3)-x*q*(24*a+36)*((2*a-3)*f+(a+1)*(x+(5*a+10)/w))/w        cora-432
c     c(4)=c(4)+6*x*((a-2)*(a-3)*(2*a-3)*q+(2*a+1)*(((8*a-12)*a+40)*a+((cora-433
c    12*a-2)*a+6)*f*x+a*(a+1)*((a**2-5)*u+x**2)+(4*a+6)*(((2*a+2)*a+10)*cora-434
c    2f+a*(a+1)*(x+(5*a+10)/w))/w))/w                                   cora-435
c     go to 43                                                          cora-436
c multipole lq=5 l1=l2-2                                                cora-437
c  31 dn=720*a**2*(4*a**2-9)*(2*a+5)*(a+2)                              cora-438
c     bd=den*dn*s*dsqrt(q*((a+1)**2+f**2))/2                            cora-439
c     b1=2*(2*a+3)*(24*((2*a+5)*(a+2)+7*q)/(a-1)-(2*a-3)*(11*a-10)*u)*f cora-440
c     b2=-6*(24*(2*a**2-15*a-10)-168*q+5*(a+1)*(2*a**2+a-6)*u)          cora-441
c     b3=((1008*q-144*(2*a**2-15*a-10))*q-(2*a-3)*u*(6*(17*a**2-9*a+10)*cora-442
c    1q+a**2*(2*a+1)*(24*(a+10)-15*(a+1)*(a+2)*u)))                     cora-443
c     b4=2*(2*a-3)*(168*q+(2*a+1)*(24*(a+10)-(11*a**2-a-30)*u))*f/(a+1) cora-444
c     if (x.eq.0) go to 32                                              cora-445
c     b1=b1+x*2*(2*a+3)*((20*a**3-198*a**2+316*a+240-42*(2*a-5)*q)/(a-1)cora-446
c    1+(2*a-3)*(12*f*x+(a+1)*((9*a+10)*u-2*x**2)))                      cora-447
c     b2=b2-x*12*(7*(2*a-3)*f-(a+1)*(2*a-3)*x)                          cora-448
c     b3=b3-x*(2*a-3)*((420*f-36*(5*a-2)*x)*q+(2*a+1)*(48*(a+10)*f-(40*acora-449
c    1**2-38*a-60)*f*u+4*(5*a-58)*a*x+12*(2*a-1)*f*x**2+a*(a+1)*x*(8*(3*cora-450
c    2a+4)*u-4*x**2)))                                                  cora-451
c     b4=b4-x*2*(2*a-3)*(42*(2*a-1)*q-(2*a+1)*(6*(2*a-1)*f*x+a*((10*a-11cora-452
c    16)+(a+1)*((9*a+16)*u-2*x**2))))/(a+1)                             cora-453
c  32 if (lt) go to 43                                                  cora-454
c     b1=b1*q                                                           cora-455
c     b2=b2*q                                                           cora-456
c     c(1)=b1-6*q*(a+2)*(2*a+3)*(8*a*(2*a+5)+24*q-5*a*(a+1)*(2*a-3)*u+4*cora-457
c    1(2*a-3)*(2*a+5)*(f+5*a*(a+1)/w)/w)/w                              cora-458
c     c(2)=b3-(4*a**2-9)*(8*(12*q+a*(a+10)*(2*a+1)*u)*f-(6*a+12)*((a+1)*cora-459
c    1(20*q-a**2*(10*a+5)*u)+(8*a+4)*a*(2*a+5)*(6*f+5*a*(a+1)/w)/w)/w)/wcora-460
c     c(3)=b2-q*24*(4*a**2-9)*(4*f-5*(a+1)*(a+2)/w)/w                   cora-461
c     c(4)=b4-6*(2*a-3)*(24*(a-2)*q+a*(2*a+1)*(8*(a+10)-5*(a+1)*(a+2)*u)cora-462
c    1+4*(2*a+3)*(2*a+1)*((a+10)*f+5*a*(a+1)*(a+2)/w)/w)/w              cora-463
c     if (x.eq.0) go to 43                                              cora-464
c     c(1)=c(1)+x*q*(12*a+24)*(4*a**2-9)*(3*f-(a+1)*(x+(4*a+10)/w))/w   cora-465
c     c(2)=c(2)+x*(8*a**2-18)*(36*(a-1)*q-(2*a+1)*(6*(a-2)*f*x-a*(8*(a+1cora-466
c    10)-(a+1)*((9*a+10)*u-2*x**2))-6*(a+2)*((a+10)*f+a*(a+1)*(x+(4*a+10cora-467
c    2)/w))/w))/w                                                       cora-468
c     c(3)=c(3)+x*q*24*(4*a**2-9)*(a+1)/w                               cora-469
c     c(4)=c(4)+x*12*(2*a+1)*(2*a-3)*(3*(a-2)*f-a*(a+1)*(x+(4*a+6)/w))/wcora-470
c     go to 43                                                          cora-471
c multipole lq=5 l1=l2-3                                                cora-472
c  33 bd=-2520*den*a**2*(a+2)*(a+3)*(2*a+3)*(2*a+5)*s*dsqrt(q*((a+1)**2+cora-473
c    1f**2)*((a+2)**2+f**2))                                            cora-474
c     b1=q*(4*a+6)*(((24*((a+36)*a+40)+168*q)*q+48*a*(a+2)*(a+3)*(2*a+5)cora-475
c    1)/(a-1)-(a*(((80*a+620)*a+966)*a+540)+((28*a-26)*a+60)*q-6*a*(a+1)cora-476
c    2*(a+2)*(2*a+3)*(2*a+5)*u)*u)                                      cora-477
c     b2=6*f*q*(48*((2*a+21)*a+20)+168*q-(((16*a+36)*a-22)*a-60)*u)     cora-478
c     b3=6*f*((48*((2*a+21)*a+20)+168*q-(10*a-12)*(4*a**2+5)*u)*q+a*(a+1cora-479
c    1)*(2*a+1)*(((16*a+168)*a+720)-(2*a+3)*(a+2)*(8*a+45)*u)*u)        cora-480
c     b4=((2*a-3)*(48*((a+48)*a+40)+336*q)*q/(a+1)-(4*a**2-9)*(28*a-40)*cora-481
c    1q*u+a*(2*a+1)*(96*((2*a+21)*a+90)-(4*a+6)*(((40*a+282)*a+180)-(a+2cora-482
c    2)*(2*a+3)*(6*a+15)*u)*u))                                         cora-483
c     if (x.eq.0) go to 34                                              cora-484
c     b1=b1+x*q*(4*a+6)*((((28*a+402)*a+704)*a+360)*x-((88*a+700)*a+600)cora-485
c    1*f-126*f*q+(54*a+24)*q*x+(2*a+3)*(((5*a-53)*a-70)*f*u-(8*a+2)*f*x*cora-486
c    2*2-(a+1)*(a+2)*((15*a+25)*u-2*x**2)*x))                           cora-487
c     b2=b2-x*6*q*((((8*a+372)*a+696)*a+360)+(70*a+42)*q-(2*a+3)*((10*a+cora-488
c    16)*f*x+(a+1)*(a+2)*((11*a+25)*u-2*x**2)))                         cora-489
c     b3=b3+x*((48*((13*a-7)*a-3)*f*x-(((144*a+6696)*a+1104)*a-3600)-84*cora-490
c    1(13*a-9)*q)*q+(a+1)*(((((352*a+224)*a+1518)*a+1260)*u-12*((20*a-14cora-491
c    2)*a-3)*x**2)*q+(2*a+1)*((2*a-3)*((88*a+720)+(16*a+24)*x**2)*f*x+a*cora-492
c    3((((280*a+2292)*a+2772)*a+1080)*u-(192*a+2016)*a-8640-28*((2*a+31)cora-493
c    4*a+24)*x**2)-(2*a+3)*(((16*a-230)*a-300)*f*u*x+a*(a+2)*(((57*a+171cora-494
c    5)*a+90)*u**2-(36*a+62)*u*x**2+4*x**4)))))                         cora-495
c     b4=b4-x*((4*a-6)*(126*a+42)*f*q/(a+1)-36*(2*a-3)*(3*a+1)*q*x-(4*a+cora-496
c    12)*(a*((28*a+434)*a+336)*x-(2*a-3)*(44*a+360)*f+(2*a+3)*(((5*a-79)cora-497
c    2*a-150)*f*u-(8*a-12)*f*x**2-a*(a+2)*((15*a+31)*u-2*x**2)*x)))     cora-498
c  34 if (lt) go to 43                                                  cora-499
c     c(1)=b1-12*q*(2*a+3)*(a+2)*((12*q+(2*a+3)*((8*a+41)*a+15)*u)*f-(4*cora-500
c    1a+10)*((a+3)*4*f+((33+13*a)*q-a*(a+3)*(4*a-6)-(2*a+3)*(3*a*(a+1)*(cora-501
c    2a+2)*u-10*(a+3)*((4*a+1)*f+3*a*(a+1)*(a+2)/w)/w))/w))/w           cora-502
c     c(3)=b2-12*q*(2*a+3)*((((32*a+288)*a+456)*a+240)+8*(2*a-3)*q-(a+2)cora-503
c    1*(2*a+3)*(3*(a+1)*(2*a+5)*u-10*((2*a+11)*f+3*(2*a+5)*(a+1)*(a+2)/wcora-504
c    2)/w))/w                                                           cora-505
c     c(2)=b3-(4*a+6)*((((192*a+1728)*a+2736)*a+1440+48*(2*a-3)*q)*q-(a+cora-506
c    11)*((((176*a+964)*a+2166)*a+540)*q-a**2*(2*a+1)*(((16*a+168)*a+720cora-507
c    2)+6*(a+2)*(2*a+3)*(2*a+5)*u))*u-6*(a+2)*((2*a+3)*((a+1)*(2*a+1)*(2cora-508
c    30*a+75)*a*u-(20*a+110)*q)*f+(a+1)*(2*a+5)*(6*(28*a**2*(2*a+1)*(a+3cora-509
c    4)-((52*a+161)*a+30)*q+a**2*(a+2)*(2*a+1)*(2*a+3)*u)-10*a*(a+3)*(2*cora-510
c    5a+1)*(2*a+3)*(14*f+6*a*(a+2)/w)/w)/w)/w)/w                        cora-511
c     c(4)=b4+12*(((2*a+1)*(a+1)*(((16*a+168)*a+720)-(a+2)*(2*a+3)*(8*a+cora-512
c    145)*u)-12*(2*a-3)*(a-2)*q)*f+(2*a+3)*(a+1)*(((52*a+266)*a+660)*q-acora-513
c    2*(2*a+1)*((8*a+84)*a+360)-(a+2)*(2*a+1)*(2*a+3)*(3*a*(2*a+5)*u-10*cora-514
c    3((8*a+30)*f+3*a*(2*a+5)*(a+2)/w)/w))/w)/w                         cora-515
c     if (x.eq.0) go to 43                                              cora-516
c     c(1)=c(1)+6*q*x*(2*a+3)*(a+2)*(((40*a+300)*a+476)*a+240+(18*a-6)*qcora-517
c    1-(2*a+3)*((2*a-10)*f*x+(a+1)*(a+2)*((11*a+15)*u-2*x**2)-(8*a+20)*(cora-518
c    2(3*a+13)*f+(a+1)*(a+2)*(x+(5*a+15)/w))/w))/w                      cora-519
c     c(2)=c(2)+x*(4*a+6)*(12*(2*a-3)*(4*a-1)*f*q-(a+1)*(((60*a-42)*a+18cora-520
c    10)*q*x+(2*a+1)*(((32*a+336)*a+1440)*f-(2*a+3)*((28*a+202)*a+180)*fcora-521
c    2*u+a*(((40*a+308)*a+120)-(a+2)*(2*a+3)*((15*a+25)*u-2*x**2))*x-(2*cora-522
c    3a+3)*(2*a-24)*f*x**2)+(3*a+6)*(((92*a+406)*a+780)*q-(2*a+1)*(a*((8cora-523
c    4*a+84)*a+360)+(2*a+3)*(a*(a+2)*((11*a+15)*u-2*x**2)-(6*a+40)*f*x-(cora-524
c    58*a+20)*((30+8*a)*f+a*(a+2)*(x+(5*a+15)/w))/w)))/w))/w            cora-525
c     c(3)=c(3)+24*x*q*(2*a+3)**2*((2*a-3)*f-(a+1)*(a+2)*(x+5*(a+2)/w))/cora-526
c    1w                                                                 cora-527
c     c(4)=c(4)+x*6*(a+1)*(18*(a-2)*(2*a-3)*q+(2*a+1)*(a*((40*a+308)*a+1cora-528
c    120)-(2*a+3)*((2*a-24)*f*x+a*(a+2)*((11*a+25)*u-2*x**2)-4*(2*a+3)*(cora-529
c    2(20+3*a)*f+a*(a+2)*(x+5*(a+2)/w))/w)))/w                          cora-530
c     go to 43                                                          cora-531
c multipole lq=5 l1=l2-4                                                cora-532
c  35 bd=10080*den*a**2*(2*a+5)*(a+2)*s**2*dsqrt(q*((a+1)**2+f**2)*((a+2cora-533
c    1)**2+f**2)*((a-1)**2+e**2))                                       cora-534
c     b1=q*(((336*q+48*((8*a+22)*a+47))*q-96*(2*a-1)*(a+2)*(2*a+5)*(3*a-cora-535
c    17))/((a-1)*(2*a-3))+(4*(((162*a+683)*a+538)*a-280)-4*(7*a-38)*q-(2cora-536
c    2*a+3)*(((163*a+497)*a-16)*a-140)*u)*u)*f                          cora-537
c     b2=3*q*(((96*((((12*a+56)*a+29)*a-70)*a-70)+(48*((4*a+28)*a+47)+33cora-538
c    16*q)*q)/(2*a-3)-4*(((((66*a+307)*a+172)*a-280)*a-280)+(a-2)*(4*a-1cora-539
c    29)*q)*u)/(2*a+3)+35*(a**2-1)*(a+2)**2*u**2)                       cora-540
c     b3=(((1008*q+144*((4*a+28)*a+47))*q+288*((((12*a+56)*a+29)*a-70)*acora-541
c    1-70))*q/(2*a-3)-12*(((((178*a+967)*a+1410)*a+428)*a-280)+(a-2)*(10cora-542
c    2*a-19)*q)*q*u+(3*a+3)*(((((458*a+2185)*a+2899)*a-352)*a-420)*q*u+(cora-543
c    34*a+2)*a**2*(8*((6*a+37)*a+70)-(((62*a+349)*a+524)*a-140)*u))*u)/(cora-544
c    42*a+3)-52.5*a**2*(a**2-1)*(a+2)**2*(2*a+1)*u**3                   cora-545
c     b4=(((336*q+48*((8*a+34)*a+47)-(4*a-8)*((14*a-41)*a+57)*u)*q/(a+1)cora-546
c    1+(2*a+1)*(4*(((162*a+863)*a+1070)*a-840)*u-96*((6*a+37)*a+70)))/(2cora-547
c    2*a+3)-(2*a+1)*(((163*a+631)*a+256)*a-420)*u**2)*f                 cora-548
c     if (x.eq.0) go to 36                                              cora-549
c     b1=b1+x*q*(8*((((((180*a+604)*a-425)*a-1813)*a-394)*a+840)+(((34*acora-550
c    1+147)*a-193)*a-450)*q+42*(a-2)*q**2)/((1-a)*(2*a-3))+96*f*q*x+16*(cora-551
c    2(((26*a+126)*a+133)*a-13)*a-70)*u+4*((41*a+115)*a+170)*q*u+4*((2*acora-552
c    3-1)*a-54)*f*x-8*(5*a+2)*q*x**2-(((152*a+892)*a+1380)*a+664)*x**2+(cora-553
c    42*a+3)*(4*((20*a+97)*a+62)*f*u*x+4*(a-2)*f*x**3+(a+1)*(a+2)*(((44*cora-554
c    5a+36)*u-4*x**2)*x**2-((87*a+67)*a-70)*u**2)))                     cora-555
c     b2=b2-12*x*q*((28*f*q+2*((18*a+83)*a+56)*f-(((34*a+217)*a+341)*a+1cora-556
c    166)*x-4*(3*a+1)*q*x)/(2*a+3)+(((9*a+58)*a+44)*u+2*a*x**2)*f+(a+1)*cora-557
c    2(a+2)*(9*(a+1)*u-x**2)*x)                                         cora-558
c     b3=b3+x*(((96*(5*a-3)*q+4*(((170*a+1101)*a+901)*a+162)-24*((10*a-5cora-559
c    1)*a-2)*f*x)*q*x-4*((((22*a+543)*a+629)*a+510)*u+168*q)*f*q+(a+1)*(cora-560
c    24*(((26*a-5)*a+18)*x**2-(((166*a+627)*a+1415)*a+558)*u)*q*x+(2*a+1cora-561
c    3)*((96*((6*a+37)*a+70)-4*((2*a-105)*a-498)*x**2-8*(((138*a+751)*a+cora-562
c    41012)*a-420)*u)*f+a*(4*((38*a+197)*a+154)*x**2-(((572*a+2362)*a+96cora-563
c    50)*a-40)*u+8*((90*a+491)*a+674))*x)))/(2*a+3)-24*(17*a+50)*f*q+(a+cora-564
c    61)*(2*a+1)*((((373*a+1411)*a+544)*a-420)*f*u**2-4*((23*a+125)*a+54cora-565
c    7)*f*u*x**2-4*(a-6)*f*x**4+a*(a+2)*(((141*a+199)*a-22)*u**2-(50*a+4cora-566
c    88)*u*x**2+4*x**4)*x))                                             cora-567
c     b4=b4+x*(((48*((4*a-4)*a-1)*f*x-8*(((34*a+225)*a-61)*a-168)-336*(acora-568
c    1-1)*q)*q/(a+1)+4*((((82*a+315)*a+902)*a+396)*u-a*(20*a-26)*x**2)*qcora-569
c    2+4*(2*a+1)*(((2*a-105)*a-498)*f*x+a*((((104*a+430)*a+171)*a-10)*u-cora-570
c    32*((90*a+491)*a+674)-((38*a+197)*a+154)*x**2)))/(2*a+3)+(2*a+1)*(4cora-571
c    4*((20*a+107)*a+54)*f*u*x+4*(a-6)*f*x**3+a*(a+2)*(4*(11*a+12)*u*x**cora-572
c    52-((87*a+145)*a-22)*u**2-4*x**4)))                                cora-573
c  36 if (lt) go to 43                                                  cora-574
c     c(1)=b1-3*q*(a+2)*(((16*((56*a+62)*a-177)+48*q)*q-32*a*(2*a-1)*(2*cora-575
c    1a+5)*(3*a-7))/(2*a-3)+(4*a*(((62*a+159)*a+29)*a+70)-4*((97*a+229)*cora-576
c    2a-6)*q+35*a*(a**2-1)*(2*a+3)*(a+2)*u)*u-4*(2*a+5)*((4*(2*a-1)*(3*acora-577
c    3-7)-92*q+(2*a+3)*((67*a-17)*a-14)*u)*f-5*(4*((59*a+59)*a-18)*q-4*acora-578
c    4*(2*a-1)*(3*a+1)*(11*a+14)-(2*a+3)*(7*a*(a**2-1)*(a+2)*u-6*(2*a-1)cora-579
c    5*(((17*a+17)*a+14)*f+7*a*(a**2-1)*(a+2)/w)/w))/w)/w)/w            cora-580
c     c(2)=b3+(((96*((12*a+56)*a+59-q)-8*(((188*a+864)*a+889)*a-18)*u)*qcora-581
c    1+a*(a+1)*(2*a+1)*(16*((6*a+37)*a+70)*u+4*(2*a+3)*((67*a+136)*a-140cora-582
c    2)*u**2))*f+3*(a+2)*(40*((19*a+46)*q-((12*a+32)*a+7)*a-14)*q-(a+1)*cora-583
c    3(20*(((132*a+292)*a-97)*a-42)*q-a**2*(2*a+1)*(20*((66*a+127)*a-98)cora-584
c    4+35*(a-1)*(2*a+3)*(a+2)*u))*u+4*(2*a+5)*(36*((54*a+37)*a-10)*q*f-(cora-585
c    5a+1)*(a*(2*a+1)*(672*(2*a-1)+6*(2*a+3)*(17*a-14)*u)*f-5*(14*(((86*cora-586
c    6a+55)*a-3)*a-18)*q-a**2*(2*a+1)*(112*(2*a-1)*(3*a+2)+(2*a+3)*(7*(acora-587
c    7-1)*(a+2)*u-6*(2*a-1)*(24*f+7*(a-1)*(a+2)/w)/w)))/w))/w)/w)/w     cora-588
c     c(3)=b2+12*q*((8*((12*a+56)*a+59)-8*q-(2*a+3)*((32*a+98)*a-4)*u)*fcora-589
c    1+5*(a+2)*((38*a+92)*q-(((24*a+64)*a+14)*a+28)-(2*a+3)*(7*(a**2-1)*cora-590
c    2(a+2)*u-6*(2*a+5)*((10*a-4)*f+7*(a**2-1)*(a+2)/w)/w))/w)/w        cora-591
c     c(4)=b4-3*(((16*(((56*a+330)*a+619)*a+354+(3*a-6)*q)*q-(a+1)*(4*((cora-592
c    1(194*a+935)*a+1292)*a-36)*q*u+a*(2*a+1)*(32*((6*a+37)*a+70)-4*(((6cora-593
c    22*a+349)*a+524)*a-140)*u-35*(a-1)*(2*a+3)*(a+2)**2*u**2))))/(2*a+3cora-594
c    3)+4*(4*((46*a+213)*a+230)*q*f-(a+1)*((2*a+1)*((24*a+148)*a+280+(2*cora-595
c    4a+3)*((67*a+136)*a-140)*u)*f-5*(a+2)*(4*((118*a+257)*a-90)*q-4*a*(cora-596
c    52*a+1)*((66*a+127)*a-98)-(2*a+1)*(2*a+3)*(7*a*(a-1)*(a+2)*u-6*(2*acora-597
c    6+5)*((17*a-14)*f+7*a*(a+2)*(a-1)/w)/w))/w))/w)/w                  cora-598
c     if (x.eq.0) go to 43                                              cora-599
c     c(1)=c(1)-q*x*(3*a+6)*(8*((38*a+167)*a+171-3*q)*f+4*(((26*a+145)*acora-600
c    1+231)*a+106)*x+(40*a+64)*q*x+(2*a+3)*((8*a+32)*f*x**2-4*((35*a+101cora-601
c    2)*a+6)*f*u+4*(a+1)*(a+2)*(x**3-(9*a+4)*u*x))-4*(2*a+5)*((((44*a+94cora-602
c    3)*a-22)*a+28)-4*(19*a+44)*q-(2*a+3)*(4*(3*a+8)*f*x+(a+1)*(a+2)*(2*cora-603
c    4x**2-(13*a-7)*u)+10*(((11*a+59)*a-6)*f+(a+1)*(a+2)*((a+3)*x+(3*a+2cora-604
c    51)*(2*a-1)/w))/w))/w)/w                                           cora-605
c     c(2)=c(2)+x*(8*(((196*a+1104)*a+1901)*a+1026+(15*a-18)*q+12*(5*a+4cora-606
c    1)*f*x)*q+(a+1)*(32*((4*a+11)*a+18)*q*x**2-8*(((212*a+966)*a+1267)*cora-607
c    2a+54)*q*u+(2*a+1)*(8*((38*a+213)*a+318)*f*x+4*a*((((106*a+599)*a+9cora-608
c    312)*a-140)*u+((26*a+107)*a+46)*x**2-8*((6*a+37)*a+70))+(2*a+3)*(8*cora-609
c    4(a+6)*f*x**3-4*((47*a+170)*a+48)*f*u*x+a*(a+2)*(((87*a+67)*a-70)*ucora-610
c    5**2-4*(11*a+9)*u*x**2+4*x**4))))+3*(a+2)*(32*((24*a+107)*a+110)*f*cora-611
c    6q+(a+1)*(96*((4*a+17)*a+20)*q*x-(8*a+4)*(2*((6*a+37)*a+70)*f+a*((2cora-612
c    72*a+125)*a+194)*x+(2*a+3)*(((61*a+143)*a-70)*f*u+a*(a+2)*((9*a+4)*cora-613
c    8u-x**2)*x-(6*a+20)*f*x**2))+(8*a+20)*(((532*a+2246)*a-180)*q-(2*a+cora-614
c    91)*(4*a*((66*a+295)*a-98)-(2*a+3)*((22*a+60)*f*x+a*(a+2)*(2*x**2-(cora-615
c    a13*a-7)*u)+10*(((17*a+93)*a-42)*f+a*(a+2)*((a+3)*x+3*(a+7)*(2*a-1)cora-616
c    b/w))/w)))/w))/w)/w                                                cora-617
c     c(3)=c(3)+12*q*x*(2*(((28*a+148)*a+221)*a+106)+(6*a-4)*q+(2*a+3)*(cora-618
c    1(2*a+12)*f*x+(a+2)*((a+1)*(2*x**2-(13*a+8)*u)+5*((10*a+28)*f+2*(a+cora-619
c    21)*(a+2)*(x+(6*a+15)/w))/w)))/w                                   cora-620
c     c(4)=c(4)+3*x*((24*(2*a-1)*(a-2)*f*q-(4*a+4)*(((20*a+46)*a+108)*q*cora-621
c    1x+(2*a+1)*(((76*a+426)*a+636)*f+a*((26*a+107)*a+46)*x)))/(2*a+3)+(cora-622
c    24*a+4)*((2*a+1)*((35*a+130)*a+48)*f*u+(2*a+1)*(a*(a+2)*(9*(a+1)*u-cora-623
c    3x**2)*x-(2*a+12)*f*x**2)-(4*((38*a+169)*a+210)*q-(2*a+1)*(a*((44*acora-624
c    4+250)*a+388)-(2*a+3)*((12*a+40)*f*x-(a+2)*(a*((13*a+8)*u-2*x**2)-1cora-625
c    50*((11*a+30)*f+a*(a+2)*(x+(6*a+15)/w))/w))))/w))/w                cora-626
c     go to 43                                                          cora-627
c multipole lq=5 l1=l2-5                                                cora-628
c  37 bd=181440*den*s**2*dsqrt(q*((a+1)**2+f**2)*((a+2)**2+f**2)*((a-1)*cora-629
c    1*2+e**2)*((a+3)**2+f**2))*a**2                                    cora-630
c     b1=q*(2304*a*(2*a-1)-6912*q+864*(9*a+1)*q*u-288*a*((22*a+3)*a+5)*ucora-631
c    1+8*a*(((530*a+611)*a+12)*a+72)*u**2-8*((602*a+683)*a-60)*q*u**2+96cora-632
c    2*a*(a**2-1)*(2*a+5)*(2*a+3)*u**3)                                 cora-633
c     b2=24*q*f*(288-(204*a+36)*u+((89*a+141)*a-20)*u**2)               cora-634
c     b3=12*f*(q*(576-24*(37*a+3)*u+((718*a+582)*a-40)*u**2)+a*(a+1)*(2*cora-635
c    1a+1)*u*(96-(148*a+12)*u-((137*a+148)*a-180)*u**2))                cora-636
c     b4=q*(864*(9*a+1)*u-6912-8*(602*a**2+613*a-60)*u**2)+a*(2*a+1)*(23cora-637
c    104-288*(11*a-1)*u+8*((265*a+174)*a-54)*u**2+48*(2*a+3)*(2*a+5)*(a-cora-638
c    21)*u**3)                                                          cora-639
c     if (x.eq.0) go to 38                                              cora-640
c     b1=b1+x*q*((1176*f*u+((2040*a+2616)*u-1200-48*x**2)*x)*q+(((2944*acora-641
c    1+4432)*a+912)*x+8*((794*a+1535)*a+222)*f)*u-(16*((94*a+385)*a+216)cora-642
c    2+((368*a+1016)*a+600)*x**2)*x+(2*a+3)*((((608*a+632)*u-600-24*x**2cora-643
c    3)*x**2-3456-((1950*a+2614)*a-140)*u**2)*f+(a+1)*((120*a+152)*u*x**cora-644
c    43-((414*a+798)*a+20)*u**2*x-8*x**5)))                             cora-645
c     b2=b2+x*q*(1200*f*x-1176*q*u-24*((33*a+120)*a+38)*u-24*(53*a+60)*fcora-646
c    1*u*x+48*f*x**3+(a+1)*(3456+((738*a+1722)*a+60)*u**2+24*(25-(13*a+1cora-647
c    29)*u+x**2)*x**2))                                                 cora-648
c     b3=b3+x*((1200*f*x-24*((597*a+720)*a+74)*u-1176*q*u-(2808*a+2616)*cora-649
c    1f*u*x+48*f*x**3)*q+(a+1)*((10368-24*(113*a+79)*u*x**2+(72*x**2+180cora-650
c    20)*x**2+((11782*a+10730)*a-420)*u**2)*q+(2*a+1)*((((3090*a+3898)*acora-651
c    3+60)*u**2+3456+600*x**2-304*(14*a+3)*u-(680*a+456)*u*x**2+24*x**4)cora-652
c    4*f*x+a*(((8*x**2+184)*x**2+752)*x**2-2304-((3*(((187*a+479)*a-6)*acora-653
c    5-240)*u+4*((1175*a+624)*a-108))*u-96*(55*a-3))*u+(((570*a+1278)*a+cora-654
c    6356)*u-60*a-440-44*(3*a+4)*x**2)*u*x**2))))                       cora-655
c     b4=b4+x*((1176*f*u-1200*x+120*(17*a+12)*u*x-48*x**3)*q+(2*a+1)*((8cora-656
c    1*(397*a+114)*u-3456-10*((195*a+289)*a+6)*u**2-600*x**2+8*(76*a+57)cora-657
c    2*u*x**2-24*x**4)*f+a*x*(440*u-752-((414*a+1050)*a+356)*u**2-184*x*cora-658
c    3*2+8*(15*a+22)*u*x**2-8*x**4)))                                   cora-659
c  38 if (lt) go to 43                                                  cora-660
c     c(1)=b1+24*q*((60*((9*a+5)*u-8)*q+96*(a-1)*(2*a-1)-4*(((74*a+15)*acora-661
c    1+28)*a+3)*u-(2*a+3)*(a+2)*((137*a-37)*a-30)*u**2)*f+4*(30*((8*a-6)cora-662
c    2*a+5-7*q)*q+(a+2)*(5*((128*a+80)*a-33)*q-a*(((676*a+544)*a-201)*a-cora-663
c    3144))*u-(6*a-6)*((2*a-1)*(4*a-6)*a+(a+1)*(2*a+3)*(2*a+5)*a*(a+2)*ucora-664
c    4**2)+5*((12*(2*a-1)*(((50*a+153)*a+136)*a+39)-84*((10*a+19)*a+3)*qcora-665
c    5)*f+(a+2)*((2*a+3)*(2*a+5)*((37*a-17)*a-6)*u*f+6*(a*(2*a-1)*(((236cora-666
c    6*a+648)*a+625)*a+66)-3*(((140*a+294)*a+196)*a-105)*q+(2*a+3)*(2*a+cora-667
c    75)*(a*(a**2-1)*(2*a+6)*u-(14*a-7)*(((7*a+5)*a+6)*f+a*(a**2-1)*(2*acora-668
c    8+6)/w)/w))/w))/w)/w)/w                                            cora-669
c     c(2)=b3+8*((1440*q-288*(4*a**2+1)+12*(((168*a+132)*a+62)*a+3)*u-30cora-670
c    1*(68*a+30)*q*u)*q+(a+1)*(8*a+12)*(((338*a-83)*a-45)*q*u-(2*a+1)*a*cora-671
c    2*2*(12+(169*a-99)*u+(a-1)*(6*a+15)*u**2))*u+3*(((840*q-120*(4*a**2cora-672
c    3+5))*q-(2*a+3)*(40*((65*a+30)*a-11)*q-5*a*(2*a+1)*(a+1)*(12*(25*a-cora-673
c    413)+(a+2)*(37*a-30)*u))*u)*f+4*((630*((10*a+15)*a+2)*q-90*((((200*cora-674
c    5a+420)*a+162)*a-63)*a-26))*q+(2*a+3)*((a+1)*(1512*(4*a**2-1)*a**2-cora-675
c    6(a+2)*(30*((44*a-18)*a-5)*q-6*a**2*(2*a+1)*(118*a-83+(a-1)*(2*a+5)cora-676
c    7*u))*u)+5*(42*(((70*a+129)*a+53)*a-30)*q*f-(a+1)*(a*(2*a+1)*(252*(cora-677
c    82*a-1)*(4*a+5)+7*(a+2)*(2*a+5)*(7*a-6)*u)*f-6*(a+2)*(14*(((56*a+36cora-678
c    9)*a+4)*a-15)*q-a**2*(2*a+1)*((4*a+3)*54*(2*a-1)+(2*a+5)*((a-1)*(2*cora-679
c    aa+6)*u-7*(2*a-1)*(9*f+(a-1)*(2*a+6)/w)/w)))/w))/w))/w)/w)/w       cora-680
c     c(3)=b2+96*q*((120-25*(4*a+3)*u)*q-24*(4*a**2+1)+((((88*a+72)*a+12cora-681
c    1)*a+3)+3*(a**2-1)*(2*a+3)*(2*a+5)*u)*u+5*((42*q-(24*a**2+30))*f-(acora-682
c    2+2)*((2*a+3)*(25*a-11)*u*f-6*(21*(4*a+1)*q-3*(((32*a+20)*a-4)*a-13cora-683
c    3)-(2*a+3)*(2*a+5)*((a**2-1)*u-7*((5*a-3)*f+(a**2-1)*(2*a+6)/w)/w))cora-684
c    4/w))/w)/w                                                         cora-685
c     c(4)=b4+24*((60*((9*a+5)*u-8)*q+(a+1)*(2*a+1)*(96-4*(37*a+3)*u-((1cora-686
c    137*a+148)*a-180)*u**2))*f+4*((30*((8*a+6)*a+5)-210*q)*q+(2*a+3)*((cora-687
c    2a+1)*(10*(32*a-11)*q*u-(2*a+1)*(a*(12+(169*a-99)*u)+3*(a-1)*(2*a+5cora-688
c    3)*a*u**2))-5*(84*(5*a+1)*q*f-(a+1)*((2*a+1)*(12*(25*a-13)+(a+2)*(3cora-689
c    47*a-30)*u)*f-6*(a+2)*(105*(2*a-1)*q-(2*a+1)*((118*a-83)*a+(2*a+5)*cora-690
c    5(a*(a-1)*u-7*((7*a-6)*f+a*(a-1)*(2*a+6)/w)/w)))/w))/w))/w)/w      cora-691
c     if (x.eq.0) go to 43                                              cora-692
c     c(1)=c(1)-q*x*(720*(((6*a+23)*a+19)+q)*f*x+(a+2)*(720*q*x**2-384*(cora-693
c    1(22*a-5)*a+3)+11520*q+24*(((430*a+255)*a+29)*a+6)*u-72*(173*a+107)cora-694
c    2*q*u+120*((2*a+17)*a+9)*x**2+(2*a+3)*(144*f*x**3-24*(95*a+71)*f*u*cora-695
c    3x+(a+1)*(6*((123*a+137)*a-120)*u**2-24*(13*a+14)*u*x**2+24*x**4)))cora-696
c    4-24*((2*a+5)*((20*((10*a-7)*a+9)-420*q)*f+(a+2)*((10*((14*a-1)*a+3cora-697
c    5)-180*q)*x+(2*a+3)*((199*a-31)*f*u-20*f*x**2+(a+1)*((21*a+13)*u-2*cora-698
c    6x**2)*x)))+5*(a+2)*(4*((((220*a+1340)*a+973)*a+123)*a-234)-84*((10cora-699
c    7*a+55)*a+21)*q+(2*a+3)*(2*a+5)*((a+1)*(a+3)*((15*a-8)*u-2*x**2)-30cora-700
c    8*(a+3)*f*x-6*(21*((2*a+13)*a-3)*f+(a+1)*(a+3)*((2*a+7)*x+(14*a-7)*cora-701
c    9(a+8)/w))/w))/w)/w)/w                                             cora-702
c     c(2)=c(2)+x*(720*((12*a+32)*a+19+q)*q*x+(2*a+3)*((7680+480*x**2-48cora-703
c    1*(222*a+107)*u)*f*q+(a+1)*((288*x**2-48*(127*a+71)*u)*q*x+(2*a+1)*cora-704
c    2(((48*x**2+720)*x**2-768+(32*(62*a+3)+16*((168*a+139)*a-90)*u-(920cora-705
c    3*a+672)*x**2)*u)*f+a*x*((8*x**2+40-(120*a+152)*u)*x**2+((414*a+798cora-706
c    4)*a+20)*u**2-1408+(2280*a+736)*u))))+6*((a+2)*((4200*q-200*((20*a+cora-707
c    58)*a+9))*q+(2*a+3)*(1200*f*q*x+(a+1)*((400*x**2-(4960*a-620)*u)*q+cora-708
c    6(2*a+1)*((40*x**2-200-(548*a+260)*u)*f*x+a*((((123*a+137)*a-120)*ucora-709
c    7+(2452*a-792))*u+96+4*x**2*(x**2-35-(13*a+14)*u))))))+(8*a+12)*(42cora-710
c    80*((10*a+45)*a+14)*f*q-(a+1)*(240*(2*a+1)*((10*a+45)*a-13)*f-(a+2)cora-711
c    9*(450*(2*a+5)*q*x+(2*a+1)*(2*a+5)*(30*f*x**2-(274*a-120)*f*u+a*x*(cora-712
c    a2*x**2-220-(21*a+13)*u))+5*(42*((42*a+231)*a-45)*q-(2*a+1)*(8*a*((cora-713
c    b118*a+649)*a-249)+(a+3)*(2*a+5)*(a*(15*a-8)*u-42*f*x-2*a*x**2))+(1cora-714
c    c2*a+6)*(2*a+5)*(28*((2*a+13)*a-6)*f+a*(a+3)*((2*a+7)*x+(14*a-7)*(acora-715
c    d+8)/w))/w)/w)))/w)/w)/w                                           cora-716
c     c(3)=c(3)+24*x*q*((30*q+10*((4*a+16)*a+9))*x+(2*a+3)*((160-(124*a+cora-717
c    1114)*u+10*x**2)*f+(a+1)*(2*x**2-(21*a+28)*u)*x)+(5*a+10)*(126*q-2*cora-718
c    2((52*a+4)*a+15)+(2*a+3)*(18*f*x+(a+1)*(2*x**2-(15*a+13)*u))+(12*a+cora-719
c    318)*(2*a+5)*(14*f+(a+1)*(x+(7*a+21)/w))/w)/w)/w                   cora-720
c     c(4)=c(4)-x*(720*f*q*x+(a+1)*((11520+720*x**2-72*(173*a+114)*u)*q-cora-721
c    1(2*a+1)*((24*(95*a+84)*u-2160-144*x**2)*f*x+a*(4224-24*(215*a+92)*cora-722
c    2u-6*((123*a+287)*a+10)*u**2-120*x**2+24*(13*a+19)*u*x**2-24*x**4))cora-723
c    3)+24*(2*a+3)*(420*f*q+(a+1)*(180*q*x-7*a*(2*a+1)*(3*a+4)*u*x-(2*a+cora-724
c    41)*((100+(199*a+130)*u-20*x**2)*f+a*x*(70-2*x**2))+5*(a+2)*(420*q+cora-725
c    5(2*a+1)*(30*f*x+a*(2*x**2-220-(15*a+13)*u)+6*(2*a+5)*(21*f+a*(x+(7cora-726
c    6*a+21)/w))/w))/w))/w)/w                                           cora-727
c     go to 43                                                          cora-728
c  39 if ((x.ne.0).or.(mod(ll,2).ne.1).or.(ll.eq.7)) go to 69           cora-729
c     go to ( 40 , 69 , 41 , 69 , 42 , 69 , 69 ) , ll                   cora-730
c multipole lq=6 l1=l2                                                  cora-731
c  40 bd=120*den*a**2*(2*a+7)*(2*a+5)*(a+2)*(a+3)*(a+4)*dsqrt(s*q*p*((a+cora-732
c    11)**2+f**2)*((a+1)**2+e**2))*s**2                                 cora-733
c     b1=p*q*((8*(((154*a-205)*a-376)*a-140+((47*a-282)*a-143-63*q)*q)+4cora-734
c    1*((((47*a+26)*a-553)*a-752)*a-280-((79*a+282)*a+143)*q)*u)/(a-1)+2cora-735
c    2*(2*a+7)*(2*a+5)*(a+1)**2*u**2)                                   cora-736
c     b2=(240*(2*a+1)**2*(a-14)+24*((20*a-336)*a-143)*q-1512*q**2-6*((((cora-737
c    136*a+836)*a+2797)*a+2374)*a+560+(((18*a+275)*a+726)*a+286)*q+(a+1)cora-738
c    2*(((26*a+146)*a+210)*a+35)*u)*u)/(2*a+3)                          cora-739
c     b3=p*f*(b2+a*(2*a+4)*u*(54*q+6*(38*a+29)+3*(a+1)*(9*a+29)*u))     cora-740
c     b2=q*f*b2                                                         cora-741
c     b4=(((((((32*a-216)*a-1692)*a-2272)*a+454)*a+1402)*a+210)*q*u**2+(cora-742
c    12*a-3)*((16*a+8)*((107*a-444)*a-140)+8*((((47*a-176)*a-924)*a-724)cora-743
c    2*a-140)*u+(8*((47*a-390)*a-143)-4*((142*a+390)*a+143)*u-504*q)*q)*cora-744
c    3q+a**2*(2*a+1)*(480*(2*a+1)*(a-14)+(4*(((214*a-849)*a-3808)*a-2100cora-745
c    4)+((((204*a+752)*a-232)*a-2550)*a-1680)*u)*u))/((a+1)*(2*a+3))+a**cora-746
c    52*(2*a+5)*(2*a+7)*(2*a+1)*(a+1)*u**3                              cora-747
c     if (lt) go to 43                                                  cora-748
c     c(1)=b1+12*p*q*(a+2)*((58+76*a+18*q+(a+1)*(9*a+29)*u)*f-(2*a+5)*((cora-749
c    128*a+32)*a+14+(4*a-6)*q+(a+1)*((a+1)*(2*a+7)*u+10*(a+3)*(2*f-(a+1)cora-750
c    2*(2*a+7)/w)/w))/w)/w                                              cora-751
c     c(2)=b3-2*p*(2*a*((((48*a+16)*a-570)*a-703)*a-210)*u+(2*a-3)*((((4cora-752
c    1*a-34)*a-172)*a-116)*u+8*((5*a-48)*a-29)-72*q)*q-a*(2*a+1)*(40*(2*cora-753
c    2a+1)*(14-a)-(2*a+7)*(2*a+5)*(a+1)**2*u**2)-6*(a+2)*(5*((14-a)*(2*acora-754
c    3+1)**2-(a-2)*(2*a-3)*q-(a+1)*(2*a+1)*((a+1)*a-7)*u)*f+(2*a+5)*((((cora-755
c    44*a+6)*a+92)*a+60)*q+(2*a+1)*((a-14)*a*(4*a+2)+(a+1)*(a*(a+1)*(2*acora-756
c    5+7)*u-10*(a+3)*(7*f+(2*a+7)*a*(a+1)/w)/w)))/w)/w)/w               cora-757
c     c(3)=b2+2*q*(a*((((16*a+600)*a+2332)*a+2298)*a+700)*u+(2*a-3)*((((cora-758
c    14*a+70)*a+212)*a+116)*u-8*((5*a-48)*a-29)+72*q)*q+40*(2*a+1)**2*a*cora-759
c    2(14-a)+3*a*(2*a+5)*(2*a+7)*(a+1)**2*u**2+6*(a+2)*(5*((14-a)*(2*a+1cora-760
c    3)**2-(a-2)*(2*a-3)*q+(a+1)*((8*a+28)*a+7)*u)*f+(2*a+5)*((((4*a+6)*cora-761
c    4a+92)*a+60)*q+2*(a-14)*a*(2*a+1)**2-5*a*(a+1)**2*(2*a+7)*u-10*(a+3cora-762
c    5)*(a+1)*(2*a+1)*(7*f+(2*a+7)*a*(a+1)/w)/w)/w)/w)/w                cora-763
c     c(4)=b4+6*(2*f*((2*a-3)*(a-2)*(((18*a+58)*a+29)*u+58*(2*a+1)+18*q)cora-764
c    1*q+a*(2*a+1)*(40*(2*a+1)*(a-14)+(((58*a-123)*a-906)*a-560)*u+(a+1)cora-765
c    2*(((9*a+43)*a+34)*a-35)*u**2))/(2*a+3)-((((((16*a**2+60)*a+820)*a+cora-766
c    3794)*a+140)*u+4*(2*a-3)*(2*a-5)*(a-2)*q)*q-(2*a+1)*(a**2*(40*(14-acora-767
c    4)*(2*a+1)-(a+1)**2*(2*a+5)*(2*a+7)*u**2)-4*(((24*a-44)*a+257)*a+70cora-768
c    5)*q-(((48*a-8)*a-566)*a-420)*a**2*u+10*(a+2)*(4*((14-a)*(2*a+1)*a-cora-769
c    6((2*a+2)*a+15)*q-a*(a+1)*((a+1)*a-7)*u)*f+(2*a+5)*(2*(a-14)*(2*a+1cora-770
c    7)*a**2+2*(((2*a+9)*a+43)*a+21)*q+a*(a+1)*(a*(a+1)*(2*a+7)*u+(4*a+2cora-771
c    8)*(a+3)*((a+7)*2*f+(2*a+7)*a*(a+1)/w)/w))/w)/w))/w)/w             cora-772
c     go to 43                                                          cora-773
c multipole lq=6 l1=l2-2                                                cora-774
c  41 bd=2520*den*a**2*(2*a+5)*(2*a+7)*(a+2)*(a+3)*(a+4)*s*dsqrt(s*q*p*(cora-775
c    1(a+1)**2+f**2)*((a+2)**2+f**2))                                   cora-776
c     b1=2*p*q*(120*((((2*a+57)*a-117)*a-306)*a-140+((11*a-129)*a-113-21cora-777
c    1*q)*q)/(a-1)-((((74*a-865)*a-5208)*a-7344)*a-3360)*u+((266*a+863)*cora-778
c    2a+312)*q*u-3*(a+1)*(a+2)*(2*a+3)*(2*a+5)*(2*a+7)*u**2)            cora-779
c     b2=6*q*f*((120*((2*a-147)*a-113-21*q)*q+60*((((4*a-56)*a-261)*a-25cora-780
c    19)*a-56)*u+(((86*a-573)*a-2171)*a-312)*q*u-16800*(a+1)*(2*a+1))/(2cora-781
c    2*a+3)+(a+2)*(((43*a+193)*a+210)*a+105)*u**2)                      cora-782
c     b3=3*p*((240*((2*a-147)*a-113-21*q)*q+40*(a+1)*(2*a+1)*(((2*a+63)*cora-783
c    1a+69)*a-168)*u+(((892*a+1374)*a-2182)*a-624)*q*u-33600*(a+1)*(2*a+cora-784
c    21))/(2*a+3)-(a+1)*(a+2)*(2*a+1)*((19*a-6)*a-210)*u**2)*f          cora-785
c     b4=(((2*a-3)*(240*((((2*a+69)*a-369)*a-534)*a-140+((11*a-165)*a-11cora-786
c    13-21*q)*q)*q+((((532*a-1326)*a-5422)*a-624)*q-((((148*a-4110)*a+41cora-787
c    230)*a+45120)*a+40512)*a-6720)*q*u)/(a+1)+240*a**2*(2*a+1)*((a+2)*(cora-788
c    3(2*a+59)*a-189)*u-840))/(2*a+3)-(2*(((((24*a-26)*a+317)*a+2298)*a+cora-789
c    42001)*a+630)*q+a**2*(2*a+1)*(((74*a-1068)*a-4812)*a-3360+3*(a+2)*(cora-790
c    52*a+3)*(2*a+5)*(2*a+7)*u))*u**2)                                  cora-791
c     if (lt) go to 43                                                  cora-792
c     c(1)=b1+6*p*q*(a+2)*((360*q+40*((2*a+53)*a+57)-(2*a+3)*((19*a+37)*cora-793
c    1a-72)*u)*f-(4*a+10)*(20*(2*a-3)*q+10*(((2*a+45)*a+75)*a+42)-(a+1)*cora-794
c    2(a+2)*(6*a+9)*(2*a+7)*u+(a+3)*(20*a+30)*((a+16)*f+(a+2)*(6*a+21)*(cora-795
c    3a+1)/w)/w)/w)/w                                                   cora-796
c     c(2)=b3+2*p*((2*a-3)*(240*(3*q-(a-21)*a+19)-(a+1)*((116*a+166)*a-4cora-797
c    132)*u)*q+a*(a+1)*(2*a+1)*(16800-(20*(((2*a+63)*a+174)*a+42)-(a+2)*cora-798
c    2(6*a+9)*(2*a+5)*(2*a+7)*u)*u)-(3*a+6)*((20*(a-2)*(2*a-3)*q-(a+1)*(cora-799
c    32*a+1)*(840-(2*a+3)*((a+30)*a+84)*u))*5*f-(4*a+10)*(a+1)*(30*((2*acora-800
c    4+7)*a+48)*q-(2*a+1)*(a*(840+(3*a+6)*(2*a+3)*(2*a+7)*u)-(a+3)*(20*acora-801
c    5+30)*((7*a+42)*f+a*(a+2)*(6*a+21)/w)/w))/w)/w)/w                  cora-802
c     c(3)=b2+6*q*((2*a-3)*(80*(3*q-(a-21)*a+19)-(((12*a-26)*a-222)*a-14cora-803
c    14)*u)*q-40*a*((((4*a-6)*a-90)*a-138)*a-63)*u+a*(a+1)*(5600*(2*a+1)cora-804
c    2-3*(a+2)*(2*a+3)*(2*a+5)*(2*a+7)*u**2)+10*(a+2)*((420*(a+1)*(2*a+1cora-805
c    3)-10*(a-2)*(2*a-3)*q-(2*a+3)*(((10*a+34)*a+21)*a+42)*u)*f+(6*a+15)cora-806
c    4*((a+1)*(((4*a+14)*a+96)*q+a*((a+2)*(2*a+3)*(2*a+7)*u-56*(2*a+1)))cora-807
c    5-14*(a+3)*(2*a+3)*((3*a-2)*f+a*(a+2)*(2*a+7)*(a+1)/w)/w)/w)/w)/w  cora-808
c     c(4)=b4+6*(((a-2)*(2*a-3)*(40*(9*q+(2*a+73)*a+57)-(((38*a-49)*a-43cora-809
c    13)*a-216)*u)*q+a*(a+1)*(2*a+1)*(40*(((2*a+63)*a+69)*a-168)*u-33600cora-810
c    2-(a+2)*(2*a+3)*((19*a-6)*a-210)*u**2))*f/(2*a+3)-(20*(((((4*a+132)cora-811
c    3*a+35)*a+1509)*a+1812)*a+420+(a-2)*(4*a-6)*(2*a-5)*q)*q-(a+1)*(4*(cora-812
c    4((((12*a+80)*a+625)*a+1710)*a+1158)*a+630)*q*u+a**2*(2*a+1)*(16800cora-813
c    5-(20*(((2*a+63)*a+174)*a+42)-(3*a+6)*(2*a+3)*(2*a+5)*(2*a+7)*u)*u)cora-814
c    6)+(10*a+20)*((((((4*a+132)*a+371)*a+1173)*a+720)*q-a*(a+1)*(2*a+1)cora-815
c    7*(840-(2*a+3)*((a+30)*a+84)*u))*2*f+(6*a+15)*(a+1)*(((((8*a+60)*a+cora-816
c    8220)*a-30)*a+252)*q+a*(2*a+1)*(280*a+(2*a+3)*(a*(a+2)*(2*a+7)*u-14cora-817
c    9*(a+3)*((2*a+12)*f+a*(a+2)*(2*a+7)/w)/w)))/w)/w)/w)/w             cora-818
c     go to 43                                                          cora-819
c multipole lq=6 l1=l2-4                                                cora-820
c  42 bd=181440*den*a**2*(a+2)*(a+3)*(a+4)*(2*a+5)*(2*a+7)*s*dsqrt(s*q*(cora-821
c    1(a+1)**2+f**2)*((a+2)**2+f**2)*((a+3)**2+f**2))                   cora-822
c     b1=-q*((4320*((7*q+(a+78)*a+103)*q+((10*a+255)*a+638)*a+420)*q+288cora-823
c    10*a*(a+2)*(a+3)*(a+4)*(2*a+5)*(2*a+7))/(a-1)-72*((5*((14*a-13)*a+3cora-824
c    20)*q+(((38*a+833)*a+243)*a+678)*a+2520)*q+a*(((((148*a+2304)*a+138cora-825
c    379)*a+31194)*a+31336)*a+13440))*u+(a+2)*(4*a+10)*(a*((((814*a+8467cora-826
c    4)*a+23265)*a+30834)*a+16632)+(((338*a+1757)*a+8199)*a+8190)*q-24*acora-827
c    5*(a+1)*(a+3)*(2*a+3)*(2*a+5)*(2*a+7)*u)*u**2)                     cora-828
c     b2=-6*q*f*(2160*((4*a+84)*a+103+7*q)*q/(2*a+3)+1440*(((2*a+33)*a+2cora-829
c    126)*a+210)-(a+2)*(12*(((62*a+623)*a+126)*a-1260)+180*(4*a-5)*q+(a+cora-830
c    23)*(2*a+5)*((41*a+591)*a+910)*u)*u)                               cora-831
c     b3=-3*f*(((30240*q+4320*((4*a+84)*a+103)-360*(4*a**2+5)*(5*a-6)*u)cora-832
c    1*q-24*(((((284*a+3480)*a+25)*a-690)*a+396)*a-7560)*u)*q/(2*a+3)+28cora-833
c    280*(((2*a+33)*a+226)*a+210)*q+(2*a+4)*((((98*a-2563)*a-7346)*a-197cora-834
c    375)*a-13650)*q*u**2+a*(a+1)*(2*a+1)*(480*(((2*a+33)*a+226)*a+840)+cora-835
c    4(a+2)*((a+3)*(2*a+5)*((233*a+1798)*a+2520)*u-4*(((262*a+3523)*a+16cora-836
c    5926)*a+17640))*u)*u)                                              cora-837
c     b4=-(4320*(2*a-3)*((7*q+(a+90)*a+103)*q+7*(((2*a+57)*a+118)*a+60))cora-838
c    1*q/((a+1)*(2*a+3))-72*(2*a-3)*((35*a-50)*q+((19*a+425)*a-66)*a-840cora-839
c    2)*q*u+(a+2)*(4*a+10)*(((338*a+1567)*a+8439)*a+8190)*q*u**2+a*(4*a+cora-840
c    32)*(1440*(((2*a+33)*a+226)*a+840)-36*((((74*a+1109)*a+6154)*a+9304cora-841
c    4)*a+3360)*u+(a+2)*(2*a+5)*(((407*a+3765)*a+6714)*a+4536-12*(a+3)*(cora-842
c    52*a+3)*(2*a+5)*(2*a+7)*u)*u**2))                                  cora-843
c     if (lt) go to 43                                                  cora-844
c     c(1)=b1+6*q*(a+2)*((240*(9*q+(8*a+98)*a+141)*q+4*(((((524*a+7460)*cora-845
c    1a+40945)*a+88825)*a+77406)*a+17640)*u-60*(((6*a-7)*a+23)*a-30)*q*ucora-846
c    2-(a+3)*(2*a+5)*(480*(a+4)*(2*a+7)+(a+2)*(2*a+3)*((233*a+1373)*a+42cora-847
c    30)*u**2))*f+4*(2*a+5)*((a+2)*(5*(((116*a+1028)*a+3015)*a+1953)*q-acora-848
c    4*((((292*a+2908)*a+9639)*a+5517)*a-756))*u-60*((((14*a+153)*a+467)cora-849
c    5*a+483)+(2*a-3)*q)*q+(a+3)*(12*(2*a+7)*a*(5*(a+4)*(2*a-3)-(a+1)*(acora-850
c    6+2)*(2*a+3)*(2*a+5)*u**2)+5*((12*(a+4)*(a-2)*(2*a-3)*(2*a+7)-12*((cora-851
c    722*a+175)*a+318)*q)*f+(a+2)*((2*a+3)*(2*a+5)*((85*a+409)*a+84)*u*fcora-852
c    8-6*(2*a+7)*(15*((20*a+92)*a+51)*q-(a+4)*a*((332*a+368)*a+141)-(2*acora-853
c    9+3)*(2*a+5)*(4*a*(a+1)*(a+3)*u-7*(a+4)*((19*a+3)*f+8*a*(a+1)*(a+3)cora-854
c    a/w)/w))/w))/w))/w)/w                                              cora-855
c     c(2)=b3+2*(1440*(((((8*a+132)*a+906)*a+2133)*a+2116)*a+840+(2*a-3)cora-856
c    1*((a+36)*a+47+3*q)*q)*q-24*((((((504*a+7644)*a+39370)*a+119625)*a+cora-857
c    2174926)*a+106596)*a+17640+(10*a-15)*(((8*a-6)*a+13)*a-30)*q)*q*u+(cora-858
c    3a+1)*(8*a+12)*((a+2)*(2*a+5)*(((362*a+3013)*a+8436)*a+1890)*q*u+a*cora-859
c    4*2*(2*a+1)*(60*(((2*a+33)*a+226)*a+840)-(a+2)*(2*a+5)*((73*a+822)*cora-860
c    5a+3024+(a+3)*(12*a+30)*(2*a+7)*u)*u))*u+((3*a+6)*(5*f*(120*((((8*acora-861
c    6+116)*a+682)*a+1405)*a+966-(a-2)*(2*a-3)*q)*q-(2*a+3)*(4*((((140*acora-862
c    7+1808)*a+7627)*a+13909)*a+6510)*q-a*(a+1)*(2*a+1)*(12*(((2*a+33)*acora-863
c    8+226)*a+840)+(a+2)*(a+3)*(10*a+25)*(17*a+84)*u))*u)+(4*a+10)*(12*(cora-864
c    9a+2)*(30*(((8*a+62)*a+159)*q-((((4*a+40)*a+151)*a+94)*a+84))*q-(a+cora-865
c    a1)*(2*a+3)*(5*(((68*a+564)*a+1285)*a+210)*q-a**2*(2*a+1)*(((166*a+cora-866
c    b1399)*a+3108)+(a+3)*(4*a+10)*(2*a+7)*u))*u)+10*(a+3)*(42*(2*a+3)*(cora-867
c    c((70*a+561)*a+1241)*a+510)*q*f-(2*a+3)*(a+1)*(7*a*(a+2)*(2*a+1)*(2cora-868
c    d*a+5)*(19*a+84)*u*f+(2*a+7)*(1008*a*(a+4)*(2*a+1)*f-(6*a+12)*(4*((cora-869
c    e194*a+797)*a+105)*q-a*(2*a+1)*(432*a*(a+4)+(2*a+5)*(4*a*(a+3)*u-7*cora-870
c    f(a+4)*(27*f+8*a*(a+3)/w)/w)))/w)))/w)/w))/w)/w                    cora-871
c     c(3)=b2+24*q*(2*(60*(((((8*a+132)*a+906)*a+2133)*a+2116)*a+840+(2*cora-872
c    1a-3)*(3*q+(a+36)*a+47)*q)-(a+2)*(2*a+5)*((((112*a+1218)*a+3459)*a+cora-873
c    24242)*a+1764+5*(2*a-3)**2*q-3*(a+1)*(a+3)*(2*a+3)*(2*a+5)*(2*a+7)*cora-874
c    3u)*u)+5*(a+2)*(30*(((((8*a+116)*a+682)*a+1405)*a+966)-(a-2)*(2*a-3cora-875
c    4)*q)*f-(a+2)*(2*a+5)*((a+3)*(2*a+3)*(37*a+217)*u*f+6*(6*((((4*a+40cora-876
c    5)*a+151)*a+94)*a+84)-2*((24*a+186)*a+477)*q+(2*a+3)*(2*a+5)*(2*(a+cora-877
c    61)*(a+3)*(2*a+7)*u-7*(a+3)*((11*a+51)*f+4*(2*a+7)*(a+1)*(a+3)/w)/wcora-878
c    7))/w))/w)/w                                                       cora-879
c     c(4)=b4+6*((240*(a-2)*(2*a-3)*(9*q+(8*a+118)*a+141)*q/(2*a+3)-60*(cora-880
c    1a**2-4)*(2*a-3)*(3*a-5)*q*u-(a+1)*(2*a+1)*(480*(((2*a+33)*a+226)*acora-881
c    2+840)+(a+2)*((a+3)*(2*a+5)*((233*a+1798)*a+2520)*u**2-4*(((262*a+3cora-882
c    3523)*a+16926)*a+17640)*u)))*f-4*(60*(7*(((((4*a+60)*a+291)*a+969)*cora-883
c    4a+1409)*a+690)+(a-2)*(2*a-3)*(2*a-5)*q)*q-(a+1)*(2*a+3)*(60*a*(2*acora-884
c    5+1)*(((2*a+33)*a+226)*a+840)+(a+2)*(2*a+5)*(5*((58*a+473)*a+1302)*cora-885
c    6q-a*(2*a+1)*((73*a+822)*a+3024+6*(a+3)*(2*a+5)*(2*a+7)*u))*u)+5*(acora-886
c    7+2)*(2*a+3)*(12*(((22*a+273)*a+1001)*a+1590)*q*f-(a+1)*(12*(2*a+1)cora-887
c    8*(((2*a+33)*a+226)*a+840)*f+(a+2)*(2*a+5)*(5*(a+3)*(2*a+1)*(17*a+8cora-888
c    94)*u*f-6*(15*((20*a+164)*a+357)*q-(2*a+1)*(a*((166*a+1399)*a+3108)cora-889
c    a+(a+3)*(2*a+5)*(a*(4*a+14)*u-7*((19*a+84)*f+4*a*(2*a+7)*(a+3)/w)/wcora-890
c    b)))/w)))/w)/w)/w                                                  cora-891
   43 a1=-2.d0*a**2*y*b1*z                                              cora-892
      a2=y*((2.d0*a+1.d0)*((2.d0*(a**2-a)**2*(1.d0+s**2)+y**2*(a**2-a-.5cora-893
     1d0))*b1-y*(p*b2+q*b3))+(4.d0*a-2.d0)*(a+1.d0)**2*p*q*b4)*z        cora-894
      a3=-y*((2.d0*a-1.d0)*((2.d0*(a**2+a)**2*(1.d0+s**2)+y**2*(a**2+a-.cora-895
     15d0))*b4-y*(b2+b3))+(4.d0*a+2.d0)*(a-1.d0)**2*b1)*z               cora-896
      a4=2.d0*a**2*y*b4*z                                               cora-897
      if (x.eq.0.d0) go to 46                                           cora-898
      a1=a1+x*2.d0*p*((a*x-2.d0*f)*b2-2.d0*q*(a+1.d0)*b4)               cora-899
      a2=a2+x*p*((2.d0*q*((2.d0*a+3.d0)*(a+1.d0)*f+((2.d0*a+3.d0)*a-4.d0cora-900
     1)*e*s)-2.d0*p*(2.d0*a-3.d0)*(2.d0*a+1.d0)*f+(2.d0*a+1.d0)*((((2.d0cora-901
     2*a-1.d0)*a-8.d0)*a+5.d0)*f-s*((a+1.d0)*((6.d0*a-9.d0)*a+1.d0)*e-s*cora-902
     3((6.d0*a-7.d0)*(a**2-1.d0)*f-s*((((2.d0*a-5.d0)*a+2.d0)*a-1.d0)*e)cora-903
     4))))*b2+2.d0*q*(a+1.d0)*((2.d0*a+3.d0)*(q+p)+(2.d0*a-1.d0)*(4.d0*ecora-904
     5*f*s+(1.d0+s**2)*((2.d0*a-4.d0)*a-3.d0)))*b4)                     cora-905
      a3=a3+x*((2.d0*p*((2.d0*a-3.d0)*(a-1.d0)*e*s+f*((2.d0*a-3.d0)*a-4.cora-906
     1d0))-2.d0*q*e*s*(2.d0*a+3.d0)*(2.d0*a-1.d0)-(2.d0*a-1.d0)*((((2.d0cora-907
     2*a+5.d0)*a+2.d0)*a+1.d0)*f-s*((6.d0*a+7.d0)*(a**2-1.d0)*e-s*((a-1.cora-908
     3d0)*((6.d0*a+9.d0)*a+1.d0)*f-s*((((2.d0*a+1.d0)*a-8.d0)*a-5.d0)*e)cora-909
     4))))*b2+(-4.d0*p*q*((2.d0*a+1.d0)*a+2.d0)-(2.d0*a-1.d0)*(2.d0*s*e*cora-910
     5f*(2.d0*a+3.d0)*(q+p+s**2+1.d0)-a**2*(((a+3.d0)*a+2.5d0)*(1.d0+s**cora-911
     64)-s**2*((2.d0*a-2.d0)*a-7.d0))+a*(a-1.d0)*(2.d0*a+3.d0)*(1.d0+s**cora-912
     72)*(p+q)-(s**2-1.d0)*((2.d0*a+4.d0)*a+.5d0)*(q-p)))*b4)           cora-913
      a4=a4+x*2.d0*(((a-1.d0)*(p+q)+y**2)*b4+(2.d0*e*s-a*x)*b2)         cora-914
   44 a4=a4+x*2.d0*((2.d0*f+a*x)*b3-2.d0*(a-1.d0)*b1)                   cora-915
   45 a1=a1+x*2.d0*(((a+1.d0)*(q+p)-y**2)*b1-q*(a*x+2.d0*e*s)*b3)       cora-916
      a2=a2+x*((-4.d0*p*q*(2.d0*a**2-a+2.d0)-(2.d0*a+1.d0)*(2.d0*s*e*f*(cora-917
     12.d0*a-3.d0)*(q+p+s**2+1.d0)+a**2*(((a-3.d0)*a+2.5d0)*(1.d0+s**4)-cora-918
     2s**2*((2.d0*a+2.d0)*a-7.d0))+a*(a+1.d0)*(2.d0*a-3.d0)*(1.d0+s**2)*cora-919
     3(p+q)+(s**2-1.d0)*((2.d0*a-4.d0)*a+.5d0)*(q-p)))*b1+q*(2.d0*p*((2.cora-920
     4d0*a+3.d0)*(a+1.d0)*e*s+f*((2.d0*a+3.d0)*a-4.d0))-2.d0*q*e*s*(2.d0cora-921
     5*a-3.d0)*(2.d0*a+1.d0)-(2.d0*a+1.d0)*((((2.d0*a-5.d0)*a+2.d0)*a-1.cora-922
     6d0)*f-s*((6.d0*a-7.d0)*(a**2-1.d0)*e-s*((a+1.d0)*((6.d0*a-9.d0)*a+cora-923
     71.d0)*f-s*((((2.d0*a-1.d0)*a-8.d0)*a+5.d0)*e)))))*b3)             cora-924
      a3=a3+x*(2.d0*(a-1.d0)*((2.d0*a-3.d0)*(q+p)+(2.d0*a+1.d0)*(4.d0*e*cora-925
     1f*s+(1.d0+s**2)*((2.d0*a+4.d0)*a-3.d0)))*b1+(2.d0*q*((2.d0*a-3.d0)cora-926
     2*(a-1.d0)*f+((2.d0*a-3.d0)*a-4.d0)*e*s)-2.d0*p*(2.d0*a+3.d0)*(2.d0cora-927
     3*a-1.d0)*f+(2.d0*a-1.d0)*((((2.d0*a+1.d0)*a-8.d0)*a-5.d0)*f-s*((a-cora-928
     41.d0)*((6.d0*a+9.d0)*a+1.d0)*e-s*((6.d0*a+7.d0)*(a**2-1.d0)*f-s*((cora-929
     5((2.d0*a+5.d0)*a+2.d0)*a+1.d0)*e)))))*b3)                         cora-930
   46 b(1)=a1*dsqrt(((a-1.d0)**2+e**2)*((a-1.d0)**2+f**2))*(2.d0*a-3.d0)cora-931
     1/(bd*a*(2.d0*a-1.d0))                                             cora-932
      b(2)=a2/(a*s*bd*(2.d0*a+1.d0))                                    cora-933
      b(3)=a3/(a*s*bd*(2.d0*a-1.d0))*dsqrt(p*q)                         cora-934
      b(4)=a4*dsqrt(p*q*((a+1.d0)**2+e**2)*((a+1.d0)**2+f**2))*(2.d0*a+3cora-935
     1.d0)/(bd*a*(2.d0*a+1.d0))                                         cora-936
      if (lt) return                                                    cora-937
      z=-2.d0*bd*v*w*dsqrt(s)/den                                       cora-938
      bd=a**2*bd*dsqrt(v*w)**3                                          cora-939
      a1=a1*(a-1.d0)**2                                                 cora-940
      a4=a4*(a+1.d0)**2                                                 cora-941
      c(1)=c(1)/z-(a+y*w*(.5d0*a-1.d0)/(a-1.d0)**2)*(2.d0*a-1.d0)*a1/bd cora-942
      c(2)=(c(2)/z+w*(a1-p*a4)/bd)*dsqrt(q)                             cora-943
      c(3)=(c(3)/z+w*(a1-q*a4)/bd)*dsqrt(p)                             cora-944
      c(4)=(c(4)/z+(a+y*w*(.5d0*a+1.d0)/(a+1.d0)**2)*(2.d0*a+1.d0)*a4/bdcora-945
     1)*dsqrt(p*q)                                                      cora-946
      return                                                            cora-947
c for neutrons ( coulomb parameter 0.)                                  cora-948
   47 x=w**2                                                            cora-949
c     go to ( 48 , 49 , 52 , 55 , 59 , 63 ) , lq                        cora-950
      go to ( 48 , 49 , 52 , 55 , 69 , 69 ) , lq                        cora-951
   48 if ((ll.eq.1).or.(u.eq.0)) go to 70                               cora-952
c multipole lq=1 l1=l2-1 (useless)                                      cora-953
      b(2)=(u+2.d0-2.d0*a)/(dsqrt(s)*u)                                 cora-954
      b(3)=dsqrt(s)*(2.d0*a+2.d0)/u                                     cora-955
      if (lt) return                                                    cora-956
      c(1)=dsqrt(s)/(u*x)                                               cora-957
      c(4)=c(1)/s                                                       cora-958
      return                                                            cora-959
   49 go to ( 50 , 70 , 51 ) , ll                                       cora-960
c multipole lq=2 l1=l2                                                  cora-961
   50 b(2)=1                                                            cora-962
      return                                                            cora-963
c multipole lq=2 l1=l2-2                                                cora-964
   51 b(2)=(2.d0*a-1.d0)/(3.d0*s)                                       cora-965
      b(3)=-(a+1)/1.5d0                                                 cora-966
      if (.not.lt) c(2)=-b(2)/(x*v)                                     cora-967
      return                                                            cora-968
   52 go to ( 70 , 53 , 70 , 54 ) , ll                                  cora-969
c multipole lq=3 l1=l2-1                                                cora-970
   53 b(2)=1.d0/(3.d0*dsqrt(s))                                         cora-971
      b(3)=-s*b(2)                                                      cora-972
      if (.not.lt) c(2)=-b(2)/(x*v)                                     cora-973
      return                                                            cora-974
c multipole lq=3 l1=l2-3                                                cora-975
   54 y=15.d0*s*dsqrt(s)                                                cora-976
      b(2)=(1.d0-2.d0*u*(a-1.d0))/y                                     cora-977
      b(3)=((2.d0*a+1.d0)*u-1.d0)*s/y                                   cora-978
      if (lt) return                                                    cora-979
      c(1)=(6.d0*a-3.d0)/(y*x**2*s)                                     cora-980
      c(2)=(2.d0+u*(2.d0*a+1.d0)-(12.d0*a**2-3.d0)/x)/(y*x*v)           cora-981
      c(3)=-3.d0/(y*x*w)                                                cora-982
      c(4)=(6.d0*a+3.d0)/(y*x**2)                                       cora-983
      return                                                            cora-984
   55 go to ( 56 , 70 , 57 , 70 , 58 ) , ll                             cora-985
c multipole lq=4 l1=l2                                                  cora-986
   56 b(2)=1.d0/(3.d0*a+6.d0)                                           cora-987
      b(3)=-(u+2.d0)*b(2)/(2.d0*s)                                      cora-988
      if (lt) return                                                    cora-989
      c(2)=-b(2)/(2.d0*x*v)                                             cora-990
      c(3)=c(2)/s                                                       cora-991
      c(4)=3.d0*c(3)/w                                                  cora-992
      return                                                            cora-993
c multipole lq=4 l1=l2-2                                                cora-994
   57 y=15.d0*s*(a+2.d0)                                                cora-995
      b(2)=-(u*(a-1.d0)-3.d0)/y                                         cora-996
      b(3)=((a+.5d0)*u-3.d0)*s/y                                        cora-997
      if (lt) return                                                    cora-998
      c(1)=(3.d0*a+6.d0)/(y*x**2*s)                                     cora-999
      c(2)=-(3.d0-(2.d0*a+1.d0)*(u-(6.d0*a+12.d0)/x))/(2.d0*y*x*v)      cora1000
      c(3)=-1.5d0/(y*x*w)                                               cora1001
      c(4)=-(2.d0*a+1.d0)*c(3)/w                                        cora1002
      return                                                            cora1003
c multipole lq=4 l1=l2-4                                                cora1004
   58 y=210.d0*(a+2.d0)*s                                               cora1005
      b(2)=(6.d0-2.d0*(a-1.d0)*u*(2.d0-(2.d0*a+3.d0)*u))/(y*s)          cora1006
      b(3)=-(6.d0-u*(4.d0*a-1.d0-u*(2.d0*a+3.d0)*(2.d0*a+1.d0)))/y      cora1007
      if (lt) return                                                    cora1008
      c1=u-(10.d0*a-5.d0)/x                                             cora1009
      c(1)=-(6.d0*a+12.d0)*(4.d0+(2.d0*a+3.d0)*c1)/(y*x**2*s**2)        cora1010
      c(2)=-(3.d0+(2.d0*a+10.d0)*u-(a+2.d0)*(108.d0*a-6.d0)/x+(2.d0*a+3.cora1011
     1d0)*(2.d0*a+1.d0)*(u**2-(6.d0*a+12.d0)*c1/x))/(y*x*v*s)           cora1012
      c(3)=-(3.d0-(6.d0*a+9.d0)*(u-(10.d0*a+20.d0)/x))/(y*x*v)          cora1013
      c(4)=-(2.d0*a+1.d0)*c(3)/w-(30.d0*a+60.d0)/(y*x**2*s)             cora1014
      return                                                            cora1015
c  59 go to ( 70 , 60 , 70 , 61 , 70 , 62 ) , ll                        cora1016
c multipole lq=5 l1=l2-1                                                cora1017
c  60 y=60*(a+2)*(a+3)*dsqrt(s)                                         cora1018
c     b(2)=(16-u*(2*a-2))/y                                             cora1019
c     b(3)=-(16-u*(2*a-10+u*(2*a+1)))/(y*s)                             cora1020
c     if (lt) return                                                    cora1021
c     c(1)=6*(a+2)/(s*y*x**2)                                           cora1022
c     c(2)=-(8-(2*a+1)*(u-6*(a+2)/x))/(y*x*v)                           cora1023
c     c(3)=-(8+3*u-30*(a+2)/x)/(y*x*v*s)                                cora1024
c     c(4)=(6*a-12+(15*u-(60*a+30)*(a+2)/x)/s**2)/(y*x**2)              cora1025
c     return                                                            cora1026
c multipole lq=5 l1=l2-3                                                cora1027
c  61 y=420*(a+2)*(a+3)*dsqrt(s)                                        cora1028
c     b(2)=(48-u*(2*a-2)*(9-u*(2*a+3)))/(y*s)                           cora1029
c     b(3)=-(48-u*(18*a+6-u*(2*a+1)*(2*a+3)))/y                         cora1030
c     if (lt) return                                                    cora1031
c     c1=u-(10*a+30)/x                                                  cora1032
c     c(1)=(6*a+12)*(3-(2*a+3)*c1)/(y*x**2*s**2)                        cora1033
c     c(2)=((24*a+162)*(a+2)/x-24+(12*a-3)*u-(2*a+1)*(2*a+3)*(u**2-(6*a+cora1034
c    112)*c1/x))/(y*x*s*v)                                              cora1035
c     c(3)=-(24-(6*a+9)*(u-(10*a+20)/x))/(y*x*v)                        cora1036
c     c(4)=-(2*a+1)*c(3)/w-(30*a+60)/(y*x**2*s)                         cora1037
c     return                                                            cora1038
c multipole lq=5 l1=l2-5                                                cora1039
c  62 y=3780*(a+2)*(a+3)*s*dsqrt(s)                                     cora1040
c     b(2)=(48-u*(2*a-2)*(15-u*(6*a+6-u*(2*a+3)*(2*a+5))))/(y*s)        cora1041
c     b(3)=-(48-u*(30*a-6-u*(12*a**2+12*a-9-u*(8*a**3+36*a**2+46*a+15)))cora1042
c    1)/y                                                               cora1043
c     if (lt) return                                                    cora1044
c     c1=u**2-(10*a+30)*(u-(14*a-7)/x)/x                                cora1045
c     c(1)=(6*a+12)*(3+(6*a+24)*u-(a+3)*(260*a+110)/x+(2*a+5)*(2*a+3)*c1cora1046
c    1)/(y*x**2*s**2)                                                   cora1047
c     c(2)=-(24-(18*a-9)*u+(6*a+12)*(66*a+183)/x-(2*a+3)*(18*u**2-(12*a+cora1048
c    124)*((8*a+29)*u-(a+3)*(200*a-40)/x)/x+(2*a+5)*(2*a+1)*(u**3-(6*a+1cora1049
c    22)*c1/x)))/(y*x*v*s)                                              cora1050
c     c1=u**2-(10*a+20)*(u-(14*a+42)/x)/x                               cora1051
c     c(3)=-(24-(12*a+3)*u+(6*a+9)*(2*a+5)*c1-(a+2)*(360*a+1170)/x)/(y*xcora1052
c    1*v)                                                               cora1053
c     c(4)=(18*a-36+(6*a+9)*((6*a+33)*u+(2*a+1)*(2*a+5)*c1-(a+2)*(260*a+cora1054
c    1830)/x))/(y*x**2*s)                                               cora1055
c     return                                                            cora1056
c  63 go to ( 64 , 70 , 65 , 70 , 66 , 70 , 67 ) , ll                   cora1057
c multipole lq=6 l1=l2                                                  cora1058
c  64 y=120*(a+2)*(a+3)*(a+4)*s**2                                      cora1059
c     b(2)=(32+u*(32-u*(2*a-2)))/y                                      cora1060
c     b(3)=-(32+u*(48-u*(4*a-14+u*(2*a+1))))/(y*s)                      cora1061
c     if (lt) return                                                    cora1062
c     c(1)=(a+2)*(12+6*u-(60*a+180)/x)/(y*x**2*s)                       cora1063
c     c(2)=-(16-u*(2*a-12+u*(2*a+1))+(6*a+12)*(2*a-4+(2*a+1)*(u-(10*a+30cora1064
c    1)/x))/x)/(y*x*v)                                                  cora1065
c     c(3)=-(16+u*(2*a+20+3*u)-(6*a+12)*(4-2*a+5*u+(20*a+10)*(a+3)/x)/x)cora1066
c    1/(y*x*s*v)                                                        cora1067
c     c(4)=((12*a-24)*s**2+(6*a+3)*(u**2-(10*a+20)*(2+u+(4*a+2)*(a+3)/x)cora1068
c    1/x))/(y*x**2*s**2)                                                cora1069
c     return                                                            cora1070
c multipole lq=6 l1=l2-2                                                cora1071
c  65 y=840*(a+2)*(a+3)*(a+4)*s                                         cora1072
c     b(2)=(160-u*(2*a-2)*(16-u*(2*a+3)))/y                             cora1073
c     b(3)=-(160-u*(32*a-112-u*((4*a-24)*a-10+u*(2*a+3)*(2*a+1))))/(y*s)cora1074
c     if (lt) return                                                    cora1075
c     c1=u-(10*a+30)/x                                                  cora1076
c     c(1)=(60-(12*a+18)*c1)*(a+2)/(y*x**2*s)                           cora1077
c     c(2)=-(80-(26*a+4)*u+(60*a**2-240)/x+(2*a+1)*(2*a+3)*(u**2-(6*a+12cora1078
c    1)*c1/x))/(y*x*v)                                                  cora1079
c     c(3)=-(80-u*(6*a-36)+60*(a**2-4)/x-(6*a+9)*(u**2-(10*a+20)*(u-(14*cora1080
c    1a+42)/x)/x))/(y*x*v*s)                                            cora1081
c     c(4)=-(105*(1-(10*a+20)/x)-(60*a-15)*s**2+(6*a+3)*(2*a+3)*(u*s**2-cora1082
c    1(10*a+20)*(1+u-(14*a+42)/x)/x))/(y*x**2*s**2)                     cora1083
c     return                                                            cora1084
c multipole lq=6 l1=l2-4                                                cora1085
c  66 y=7560*(a+2)*(a+3)*(a+4)*s                                        cora1086
c     b(2)=(480-u*(2*a-2)*(96-u*(24*a+33-u*(2*a+3)*(2*a+5))))/(y*s)     cora1087
c     b(3)=-(480-u*(192*a+48-u*(2*a+3)*(24*a+6-u*(2*a+1)*(2*a+5))))/y   cora1088
c     if (lt) return                                                    cora1089
c     c1=(u**2-(10*a+30)*(u-(14*a+56)/x)/x)                             cora1090
c     c(1)=(6*a+12)*(30-(12*a+3)*u-(a+3)*(80*a+470)/x+(2*a+3)*(2*a+5)*c1cora1091
c    1)/(y*x**2*s**2)                                                   cora1092
c     c(2)=-(240-u*(126*a-36)+180*(a**2-4)/x+(2*a+3)*((18*a-9)*u**2-(6*acora1093
c    1+12)*((2*a-49)*u+(10*a+30)*(22*a+109)/x)/x-(2*a+1)*(2*a+5)*(u**3-(cora1094
c    26*a+12)*c1/x)))/(y*x*w*s**2)                                      cora1095
c     c1=(2*a+5)*(u**2-(10*a+20)*(u-(14*a+42)/x)/x)                     cora1096
c     c(3)=-(240-(66*a+84)*u+180*(a**2-4)/x+(6*a+9)*c1)/(y*x*v)         cora1097
c     c(4)=((a-2)*(180-(72*a+108)*u)+(6*a+9)*((2*a+1)*c1-(a+2)*(80*a+740cora1098
c    1)/x))/(y*x**2*s)                                                  cora1099
c     return                                                            cora1100
c multipole lq=6 l1=l2-6                                                cora1101
c  67 y=83160*(a+2)*(a+3)*(a+4)*s**2                                    cora1102
c     b(2)=(480-u*(2*a-2)*(144-u*(54*a+57-u*(2*a+5)*(8*a+6-u*(2*a+7)*(2*cora1103
c    1a+3)))))/(y*s)                                                    cora1104
c     b(3)=-(480-u*(288*a-48-u*(108*a**2+120*a-78-u*(2*a+3)*(2*a+5)*(8*acora1105
c    1-5-u*(2*a+1)*(2*a+7)))))/y                                        cora1106
c     if (lt) return                                                    cora1107
c     c1=u**3-(10*a+30)*(u**2-(14*a+56)*(u-(18*a-9)/x)/x)/x             cora1108
c     c(1)=(6*a+12)*(30-(18*a-3)*u+(10*a+30)*(118*a+457)/x-(2*a+5)*((4*acora1109
c    1+36)*u**2-(10*a+30)*((24*a+106)*u-(14*a+56)*(52*a+6)/x)/x+(2*a+7)*cora1110
c    2(2*a+3)*c1))/(y*x**2*s**2)                                        cora1111
c     c(2)=-(240-(174*a-84)*u+((72*a+36)*a-63)*u**2+(180*(a**2-4)-(6*a+1cora1112
c    12)*(((136*a+772)*a+1377)*u-(10*a+30)*((712*a+3370)*a+2193)/x))/x-(cora1113
c    22*a+5)*(2*a+3)*((2*a-26)*u**3+(6*a+12)*((14*a+82)*u**2-(10*a+30)*(cora1114
c    3(38*a+166)*u-(14*a+56)*(70*a-19)/x)/x)/x-(2*a+7)*(2*a+1)*(u**4-6*(cora1115
c    4a+2)*c1/x)))/(y*x*v*s)                                            cora1116
c     c1=u**3-(10*a+20)*(u**2-(14*a+42)*(u-(18*a+72)/x)/x)/x            cora1117
c     c(3)=-(240-(114*a+36)*u+180*(a**2-4)/x+(6*a+15)*((6*a-1)*u**2+(10*cora1118
c    1a+20)*((10*a+57)*u-(14*a+42)*(34*a+141)/x)/x-(2*a+7)*(2*a+3)*c1))/cora1119
c    2(y*x*v)                                                           cora1120
c     c(4)=(180*a-360-(108*a+72)*(a-2)*u+(60*a+120)*((118*a+796)*a+1401)cora1121
c    1/x-(2*a+5)*(6*a+9)*((4*a+47)*u**2-(10*a+20)*((24*a+117)*u-(14*a+42cora1122
c    2)*(52*a+215)/x)/x+(2*a+7)*(2*a+1)*c1))/(y*x**2*s)                 cora1123
c     return                                                            cora1124
   68 write (2,1000) lq,ll                                              cora1125
      return                                                            cora1126
   69 write (2,1001) lq,ll                                              cora1127
      return                                                            cora1128
   70 write (2,1002) lq,ll                                              cora1129
      return                                                            cora1130
 1000 format (14h in cora: lq =,i3,22h too large or l1-l2+1=,i3,14h out cora1131
     1of bounds)                                                        cora1132
 1001 format (42h in cora: coefficients suppressed for lq =,i3,13h and lcora1133
     11-l2+1=,i3)                                                       cora1134
 1002 format (55h in cora: coefficients not given by the method for lq =cora1135
     1,i3,13h and l1-l2+1=,i3)                                          cora1136
      end                                                               cora1137
c 22/02/97  ibm version                                         ecis96  inti-000
      subroutine inti(fam,x,fr,gr,wre,pad,ipe,ism,kab,w,iterm,nc,v,vi,nvinti-001
     1i,mc,cc,nat,at,ag,npx,h,acnv,eiter,ncin,nni,iterr,lo)             inti-002
c  e. c. i. s. method: schroedinger equation driving routine.           inti-003
c  inti calls insh  to solve the single homogeneous equations           inti-004
c             insi  to solve the single inhomogeneous equations         inti-005
c  pade approximants of type i may be used to accelerate the convergenceinti-006
c input variables: fam(ic,i): matching values for i=1,6                 inti-007
c                             constants of each equation for i=7,10     inti-008
c                  ism:   number of radial points                       inti-009
c                  kab:   maximum number of coupled channels            inti-010
c                  iterm: maximum number of iterations and dim. of pad  inti-011
c                  nc:    number of coupled equations                   inti-012
c                  v,vi:  real, imaginary potentials and couplings      inti-013
c                  nvi:   addresses of couplings                        inti-014
c                  mc,cc: nuclear state number, angular momenta....     inti-015
c                  nat,at:table of coupling coefficients                inti-016
c                  ag:    coulomb integrals for coulomb corrections     inti-017
c                  npx:   number of central potentials                  inti-018
c                  h:     step length                                   inti-019
c                  acnv:  epsilon for negligible function values        inti-020
c                  eiter: convergence epsilon for the scattering coef.  inti-021
c                  ncin:  number of solutions                           inti-022
c                  lo(i): logical controls                              inti-023
c output variables:fam(ic,i+7): scattering coefficients                 inti-024
c working fields:  x:     used in insh and insi                         inti-025
c                  fr:    solutions of homogeneous equations            inti-026
c                  gr:    solutions of coupled equations                inti-027
c                  wre:   real/imaginary inhomogeneous term             inti-028
c                  pad(iterm,kab+2): pade approximants                  inti-029
c               ipe(i,1): first non negligible point of uncoupled func. inti-030
c               ipe(i,2): first non negligible point of coupled funct.  inti-031
c                  w:     free part of the storage for couplings        inti-032
c output variables:nni:   number of eq. with negligible inhomog. term   inti-033
c                  iterr: largest number of iterations done for this j  inti-034
c***********************************************************************inti-035
      logical lo(250)                                                   inti-036
      double precision fam(kab,8),x(1),pad(2,iterm,1),ag(kab,kab,4),z(4)inti-037
     1,amax,y(2)                                                        inti-038
      dimension fr(ism,4,1),gr(2,ism,1),wre(2,1),ipe(nc,2),v(ism,1),vi(iinti-039
     1sm,1),w(ism,1),nvi(kab,kab,4),mc(kab,4),nat(2,1),at(2,1),cc(kab,6)inti-040
c compute all coupling potentials and solve all homogeneous equations   inti-041
      i2=4*ism                                                          inti-042
      do 4 i=1,nc                                                       inti-043
      i1=mc(i,4)                                                        inti-044
      if (i1.lt.0) go to 1                                              inti-045
      call insh(fr(1,1,i),i,i1,kt,acnv,fam,x,kab,ism,v,vi,npx,nat,at,nviinti-046
     1,cc,lo)                                                           inti-047
      ipe(i,1)=kt                                                       inti-048
      go to 3                                                           inti-049
    1 i1=-i1                                                            inti-050
      if (i.eq.i1) go to 3                                              inti-051
      do 2 is=1,i2                                                      inti-052
    2 fr(is,1,i)=fr(is,1,i1)                                            inti-053
      ipe(i,1)=ipe(i1,1)                                                inti-054
    3 if (lo(57)) write (2,1000) fam(i,7),fam(i,8),i,ipe(i,1)           inti-055
    4 continue                                                          inti-056
      if ((.not.lo(207)).or.lo(221)) go to 32                           inti-057
      ivv=0                                                             inti-058
c calculation of the non diagonal coupling potentials                   inti-059
      do 31 ic=1,nc                                                     inti-060
      do 27 ip=1,nc                                                     inti-061
      k1=nvi(ip,ic,1)                                                   inti-062
      k2=nvi(ip,ic,2)                                                   inti-063
      k3=nvi(ip,ic,3)                                                   inti-064
      if (k2.eq.k3.and.ip.lt.ic) go to 25                               inti-065
      do 5 j=1,4                                                        inti-066
    5 nvi(ip,ic,j)=0                                                    inti-067
c non derivative coupling potentials                                    inti-068
      if (k1.gt.k2) go to 15                                            inti-069
      if (lo(29).and.(ic.eq.ip)) go to 15                               inti-070
      ivv=ivv+1                                                         inti-071
      nvi(ip,ic,1)=ivv                                                  inti-072
      kt=iabs(nat(1,k1))                                                inti-073
      nima=k2+1-k1                                                      inti-074
      if (kt.eq.nat(1,k1)) nima=nima-1                                  inti-075
      do 6 is=1,ism                                                     inti-076
    6 w(is,ivv)=at(2,k1)*v(is,kt)                                       inti-077
      if (k1.eq.k2) go to 9                                             inti-078
      k4=k1+1                                                           inti-079
      do 8 k=k4,k2                                                      inti-080
      kt=iabs(nat(1,k))                                                 inti-081
      if (kt.eq.nat(1,k)) nima=nima-1                                   inti-082
      do 7 is=1,ism                                                     inti-083
    7 w(is,ivv)=w(is,ivv)+at(2,k)*v(is,kt)                              inti-084
    8 continue                                                          inti-085
    9 if (nima.eq.0) go to 15                                           inti-086
      ivv=ivv+1                                                         inti-087
      nvi(ip,ic,2)=ivv                                                  inti-088
      do 11 k=k1,k2                                                     inti-089
      if (nat(1,k).gt.0) go to 11                                       inti-090
      kt=-nat(1,k)                                                      inti-091
      do 10 is=1,ism                                                    inti-092
   10 w(is,ivv)=at(2,k)*vi(is,kt)                                       inti-093
      go to 12                                                          inti-094
   11 continue                                                          inti-095
   12 k1=k+1                                                            inti-096
      if (k1.gt.k2) go to 15                                            inti-097
      do 14 k=k1,k2                                                     inti-098
      if (nat(1,k).gt.0) go to 14                                       inti-099
      kt=-nat(1,k)                                                      inti-100
      do 13 is=1,ism                                                    inti-101
   13 w(is,ivv)=w(is,ivv)+at(2,k)*vi(is,kt)                             inti-102
   14 continue                                                          inti-103
c derivative coupling potentials                                        inti-104
   15 k2=k2+1                                                           inti-105
      if (k2.gt.k3) go to 27                                            inti-106
      ivv=ivv+1                                                         inti-107
      nvi(ip,ic,3)=ivv                                                  inti-108
      kt=iabs(nat(1,k2))                                                inti-109
      nima=k3+1-k2                                                      inti-110
      if (kt.eq.nat(1,k2)) nima=nima-1                                  inti-111
      do 16 is=1,ism                                                    inti-112
   16 w(is,ivv)=at(2,k2)*v(is,kt)                                       inti-113
      if (k2.eq.k3) go to 19                                            inti-114
      k4=k2+1                                                           inti-115
      do 18 k=k4,k3                                                     inti-116
      kt=iabs(nat(1,k))                                                 inti-117
      if (kt.eq.nat(1,k)) nima=nima-1                                   inti-118
      do 17 is=1,ism                                                    inti-119
   17 w(is,ivv)=w(is,ivv)+at(2,k)*v(is,kt)                              inti-120
   18 continue                                                          inti-121
   19 if (nima.eq.0) go to 27                                           inti-122
      ivv=ivv+1                                                         inti-123
      nvi(ip,ic,4)=ivv                                                  inti-124
      do 21 k=k2,k3                                                     inti-125
      kt=-nat(1,k)                                                      inti-126
      if (kt.eq.nat(1,k)) go to 21                                      inti-127
      do 20 is=1,ism                                                    inti-128
   20 w(is,ivv)=at(2,k)*vi(is,kt)                                       inti-129
      go to 22                                                          inti-130
   21 continue                                                          inti-131
   22 k2=k+1                                                            inti-132
      if (k2.gt.k3) go to 27                                            inti-133
      do 24 k=k2,k3                                                     inti-134
      kt=-nat(1,k)                                                      inti-135
      if (kt.eq.nat(1,k)) go to 24                                      inti-136
      do 23 is=1,ism                                                    inti-137
   23 w(is,ivv)=w(is,ivv)+at(2,k)*vi(is,kt)                             inti-138
   24 continue                                                          inti-139
      go to 27                                                          inti-140
c symmetrisation of the table                                           inti-141
   25 do 26 k=1,4                                                       inti-142
   26 nvi(ip,ic,k)=nvi(ic,ip,k)                                         inti-143
   27 continue                                                          inti-144
c correction to an increase of the imaginary potential                  inti-145
      if (cc(ic,6).eq.0.) go to 31                                      inti-146
      i1=mc(ic,4)                                                       inti-147
      if (nvi(ic,ic,2).eq.0) go to 29                                   inti-148
      k=nvi(ic,ic,2)                                                    inti-149
      do 28 is=1,ism                                                    inti-150
   28 w(is,k)=w(is,k)-cc(ic,6)*vi(is,i1)                                inti-151
      go to 31                                                          inti-152
   29 ivv=ivv+1                                                         inti-153
      nvi(ic,ic,2)=ivv                                                  inti-154
      do 30 is=1,ism                                                    inti-155
   30 w(is,ivv)=-cc(ic,6)*vi(is,i1)                                     inti-156
   31 continue                                                          inti-157
   32 if (lo(59)) call hora                                             inti-158
      conv=acnv*h*h                                                     inti-159
      nni=0                                                             inti-160
c loop on solutions                                                     inti-161
      do 46 nci=1,ncin                                                  inti-162
      nci1=nci+8                                                        inti-163
      nci2=nci1+ncin                                                    inti-164
c set the zero's order solution                                         inti-165
      do 33 ic=1,nc                                                     inti-166
      ipe(ic,2)=ism+1                                                   inti-167
      fam(ic,nci1)=0.d0                                                 inti-168
   33 fam(ic,nci2)=0.d0                                                 inti-169
      fam(nci,nci1)=fam(nci,7)                                          inti-170
      fam(nci,nci2)=fam(nci,8)                                          inti-171
      if ((ipe(nci,1).gt.ism-3).or.lo(221)) go to 46                    inti-172
      do 34 is=1,ism                                                    inti-173
      gr(1,is,nci)=fr(is,1,nci)                                         inti-174
   34 gr(2,is,nci)=fr(is,2,nci)                                         inti-175
      ipe(nci,2)=ipe(nci,1)                                             inti-176
c derive the zero's order equation                                      inti-177
      if (lo(210)) call insi(wre,gr,gr(1,1,nc+1),fr,fam,x,pad,pad,1,eiteinti-178
     1r,acnv,kab,ism,ipe,nci,v,vi,w,conv,nat,at,nvi,nc,y,y,mc,cc,lo,.truinti-179
     2e.,h,z)                                                           inti-180
      amax=0.d0                                                         inti-181
c e. c. i. s. loop                                                      inti-182
      do 44 kiter=1,iterm                                               inti-183
      iterr=max0(iterr,kiter)                                           inti-184
      lo(204)=.true.                                                    inti-185
      lo(206)=((kiter.ne.iterm).and.(amax.lt.1.d10)).or.lo(23)          inti-186
      if (amax.gt.1.d10) write (2,1001) amax,kiter                      inti-187
      do 43 ic=1,nc                                                     inti-188
      i=mod(ic+nci-1,nc)+1                                              inti-189
c compute second members and solve the inhomogeneous equations          inti-190
      do 35 j=1,4                                                       inti-191
   35 z(j)=0.d0                                                         inti-192
      if (lo(144)) go to 40                                             inti-193
      do 38 j=1,nc                                                      inti-194
      if ((lo(29).and.(i.eq.j)).or.(ipe(j,2).ge.ism)) go to 38          inti-195
c order in fg   f(ei)*f(ef),g(ei)*f(ef),f(ei)*g(ef),g(ei)*g(ef)         inti-196
      if (lo(22)) go to 36                                              inti-197
      ij=kiter                                                          inti-198
      if (1+mod(j+nc-nci-1,nc).ge.ic) ij=ij-1                           inti-199
      if (ij.eq.0) go to 36                                             inti-200
      y(1)=pad(1,ij,j)                                                  inti-201
      y(2)=pad(2,ij,j)                                                  inti-202
      go to 37                                                          inti-203
   36 y(1)=fam(j,nci1)                                                  inti-204
      y(2)=fam(j,nci2)                                                  inti-205
   37 z(1)=z(1)+y(1)*ag(i,j,3)-y(2)*ag(i,j,1)                           inti-206
      z(2)=z(2)+y(1)*ag(i,j,1)+y(2)*ag(i,j,3)                           inti-207
      z(3)=z(3)+y(1)*ag(i,j,4)-y(2)*ag(i,j,2)                           inti-208
      z(4)=z(4)+y(1)*ag(i,j,2)+y(2)*ag(i,j,4)                           inti-209
   38 continue                                                          inti-210
      if (i.eq.nci) go to 39                                            inti-211
      z(1)=z(1)+ag(i,nci,1)                                             inti-212
      z(3)=z(3)+ag(i,nci,2)                                             inti-213
   39 z(3)=z(3)-z(2)                                                    inti-214
      z(4)=z(4)+z(1)                                                    inti-215
      z(1)=z(1)+fam(i,7)*z(3)-fam(i,8)*z(4)                             inti-216
      z(2)=z(2)+z(3)*fam(i,8)+z(4)*fam(i,7)                             inti-217
   40 if (i.ne.nci) go to 41                                            inti-218
      z(1)=z(1)-fam(i,7)                                                inti-219
      z(2)=z(2)-fam(i,8)                                                inti-220
      z(3)=z(3)-1.d0                                                    inti-221
   41 if (lo(23).and.(.not.lo(206))) lo(204)=.true.                     inti-222
      call insi(wre,gr,gr(1,1,nc+1),fr,fam(i,5),x,pad(1,1,i),pad(1,1,nc+inti-223
     11),kiter,eiter,acnv,kab,ism,ipe(1,2),i,v,vi,w,conv,nat,at,nvi,nc,finti-224
     2am(i,nci1),fam(i,nci2),mc,cc,lo,.false.,h,z)                      inti-225
      if (ipe(i,2).ge.ism) go to 42                                     inti-226
      amax=dmax1(amax,dabs(fam(i,nci1))+dabs(fam(i,nci2)))              inti-227
      if (i.ne.nci.and.lo(92)) ipe(i,2)=ism+1                           inti-228
      go to 43                                                          inti-229
   42 fam(i,nci1)=-z(1)                                                 inti-230
      fam(i,nci2)=-z(2)                                                 inti-231
      if (lo(57)) write (2,1002)                                        inti-232
      if (kiter.eq.1.and.lo(144)) nni=nni+1                             inti-233
      if (i.eq.nci) ipe(nci,2)=ipe(nci,1)                               inti-234
   43 continue                                                          inti-235
      if (lo(59)) call hora                                             inti-236
      if (lo(204).or.(amax.gt.1.d10.and.lo(23))) go to 45               inti-237
   44 continue                                                          inti-238
      kiter=min0(kiter,iterm)                                           inti-239
   45 if (lo(53)) write (2,1003) kiter                                  inti-240
   46 continue                                                          inti-241
      nni=nni/ncin                                                      inti-242
      return                                                            inti-243
 1000 format (2d30.15,5x,2i5)                                           inti-244
 1001 format (8h maximum,d15.6,44h obtained in previous iteration. last inti-245
     1one is,i3)                                                        inti-246
 1002 format (5x,35hthe inhomogeneous term is neglected)                inti-247
 1003 format (5x,i5,11h iterations)                                     inti-248
      end                                                               inti-249
c 22/02/97  ibm version                                         ecis96  insh-000
      subroutine insh(p,ic,i1,kt,aconv,fam,x,kab,ism,v,vi,npx,nat,at,nviinsh-001
     1,cc,lo)                                                           insh-002
c  e. c. i. s. method: integration of a single homogeneous equation by  insh-003
c  the numerov method       - schroedinger equation -                   insh-004
c input variables: ic:    channel number of the equation                insh-005
c                  aconv: limit for negligible function values          insh-006
c                  fam(ic,i): matching values for i=1,4                 insh-007
c                             wave number for i=6                       insh-008
c                             constants of this equation for i=7,10     insh-009
c                  kab:   maximum number of coupled channels            insh-010
c                  v,vi:  real, imaginary potentials and couplings      insh-011
c                  npx:   number of central potentials                  insh-012
c                  ism:   number of radial points                       insh-013
c                  nat,at:coupling coefficients                         insh-014
c                  nvi:   table of addresses in nat,at                  insh-015
c                  cc(,6):coefficient of increase of imaginary potentialinsh-016
c                  lo(i): logical controls                              insh-017
c output variables:p(ism,i): real/imaginary regular solution for i=1,2  insh-018
c                            real/imaginary irregular solution for i=3,4insh-019
c                  fam(ic,7/8): real/imaginary part of zero's order     insh-020
c                            scattering coefficients                    insh-021
c                  kt:    the solution is negligible for is < kt        insh-022
c working space:   x:     for the integration                           insh-023
c***********************************************************************insh-024
      logical lo(250)                                                   insh-025
      double precision fam(kab,10),x(2,2),bre,bim,hx,hy,a,b             insh-026
      dimension p(ism,4),v(ism,1),vi(ism,1),nvi(kab,kab,2),nat(2,1),at(2insh-027
     1,1),cc(kab,6)                                                     insh-028
      bconv=aconv                                                       insh-029
c for closed channels when green's function is used                     insh-030
      if (fam(ic,9).lt.0.) bconv=1.e-15                                 insh-031
c computation of the regular solution                                   insh-032
      i2=i1+npx                                                         insh-033
      do 1 is=1,ism                                                     insh-034
      a=is*is                                                           insh-035
      x(1,is+2)=fam(ic,9)-fam(ic,10)/a+fam(ic,7)*v(is,i1)               insh-036
      x(2,is+2)=fam(ic,7)*vi(is,i1)                                     insh-037
      if (lo(229)) x(1,is+2)=x(1,is+2)+fam(ic,8)*v(is,i2)               insh-038
      if (lo(230)) x(2,is+2)=x(2,is+2)+fam(ic,8)*vi(is,i2)              insh-039
    1 continue                                                          insh-040
      if (lo(129)) go to 5                                              insh-041
      k1=nvi(ic,ic,1)                                                   insh-042
      k2=nvi(ic,ic,2)                                                   insh-043
      if (k1.gt.k2) go to 5                                             insh-044
      do 4 k=k1,k2                                                      insh-045
      kt=iabs(nat(1,k))                                                 insh-046
      do 2 is=1,ism                                                     insh-047
    2 x(1,is+2)=x(1,is+2)+at(2,k)*v(is,kt)                              insh-048
      if (nat(1,k).gt.0) go to 4                                        insh-049
      do 3 is=1,ism                                                     insh-050
    3 x(2,is+2)=x(2,is+2)+at(2,k)*vi(is,kt)                             insh-051
    4 continue                                                          insh-052
    5 if (cc(ic,6).eq.0.) go to 7                                       insh-053
      do 6 is=1,ism                                                     insh-054
    6 x(2,is+2)=x(2,is+2)+vi(is,i1)*cc(ic,6)                            insh-055
    7 if (lo(27)) go to 9                                               insh-056
c modified numerov method                                               insh-057
      do 8 is=1,ism                                                     insh-058
      a=x(1,is+2)**2-x(2,is+2)**2                                       insh-059
      if (lo(26)) a=a*(1.d0-x(1,is+2)*.033333333333333d0)               insh-060
      x(2,is+2)=x(2,is+2)*(1.d0-x(1,is+2)*.166666666666667d0)           insh-061
    8 x(1,is+2)=x(1,is+2)-a*.083333333333333d0                          insh-062
      go to 11                                                          insh-063
c numerov method                                                        insh-064
    9 do 10 is=1,ism                                                    insh-065
      b=(12.d0+x(1,is+2))**2+x(2,is+2)**2                               insh-066
      a=12.d0*(x(1,is+2)*(12.d0+x(1,is+2))+x(2,is+2)**2)/b              insh-067
      if (lo(26)) a=a*(1.d0+x(1,is+2)**2*.416666666666667d-2)           insh-068
      x(1,is+2)=a                                                       insh-069
   10 x(2,is+2)=144.d0*x(2,is+2)/b                                      insh-070
   11 x(1,1)=0.d0                                                       insh-071
      x(2,1)=0.d0                                                       insh-072
      x(1,2)=1.d-15                                                     insh-073
      x(2,2)=0.d0                                                       insh-074
      do 13 is=1,ism                                                    insh-075
      p(is,3)=x(1,is+2)                                                 insh-076
      p(is,4)=x(2,is+2)                                                 insh-077
      hx=x(1,is+1)*x(1,is+2)-x(2,is+1)*x(2,is+2)                        insh-078
      hy=x(2,is+1)*x(1,is+2)+x(1,is+1)*x(2,is+2)                        insh-079
      x(1,is+2)=x(1,is+1)+x(1,is+1)-x(1,is)-hx                          insh-080
      x(2,is+2)=x(2,is+1)+x(2,is+1)-x(2,is)-hy                          insh-081
      if (dabs(x(1,is+2)).lt.1.d15) go to 13                            insh-082
c  renormalisation of large function values                             insh-083
      j=2*is+4                                                          insh-084
      do 12 i=3,j                                                       insh-085
   12 x(i,1)=x(i,1)*1.d-30                                              insh-086
   13 continue                                                          insh-087
c end of integration                                                    insh-088
c matching                                                              insh-089
      bre=x(1,ism)*fam(ic,4)-fam(ic,3)*x(1,ism+2)                       insh-090
      bim=x(2,ism)*fam(ic,4)-fam(ic,3)*x(2,ism+2)                       insh-091
      hx=x(1,ism)*fam(ic,2)-fam(ic,1)*x(1,ism+2)                        insh-092
      hy=x(2,ism)*fam(ic,2)-fam(ic,1)*x(2,ism+2)                        insh-093
      if (fam(ic,9).lt.0.) go to 14                                     insh-094
      bim=bim+hx                                                        insh-095
      bre=bre-hy                                                        insh-096
   14 a=bre*bre+bim*bim                                                 insh-097
      bre=-bre/a                                                        insh-098
      bim=bim/a                                                         insh-099
      fam(ic,7)=bre*hx-bim*hy                                           insh-100
      fam(ic,8)=hx*bim+hy*bre                                           insh-101
      if (lo(221)) return                                               insh-102
      bre=bre/12.d0                                                     insh-103
      bim=bim/12.d0                                                     insh-104
c normalisation of the regular solution                                 insh-105
      do 15 is=1,ism                                                    insh-106
      hx=x(1,is)+10.d0*x(1,is+1)+x(1,is+2)                              insh-107
      hy=x(2,is)+10.d0*x(2,is+1)+x(2,is+2)                              insh-108
      p(is,1)=hx*bre-hy*bim                                             insh-109
   15 p(is,2)=hx*bim+hy*bre                                             insh-110
c search of the first non negligible value                              insh-111
      do 16 kt=1,ism                                                    insh-112
      if ((abs(p(kt,1))+abs(p(kt,2))).gt.bconv) go to 17                insh-113
   16 continue                                                          insh-114
   17 if (lo(92)) return                                                insh-115
      hx=0.d0                                                           insh-116
      hy=0.d0                                                           insh-117
      if (fam(ic,9).lt.0.) go to 18                                     insh-118
      hx=fam(ic,1)                                                      insh-119
      hy=fam(ic,2)                                                      insh-120
c computation of the irregular solution - starting values               insh-121
c  the two last points of imaginary potential are zero                  insh-122
   18 x(2,ism)=hx/fam(ic,6)                                             insh-123
      x(2,ism+2)=hy/fam(ic,6)                                           insh-124
      x(1,ism)=fam(ic,3)/fam(ic,6)                                      insh-125
      x(1,ism+2)=fam(ic,4)/fam(ic,6)                                    insh-126
      bre=2.d0-dble(p(ism,3))                                           insh-127
      x(1,ism+1)=(x(1,ism)+x(1,ism+2))/bre                              insh-128
      x(2,ism+1)=(x(2,ism)+x(2,ism+2))/bre                              insh-129
      j1=ism-kt                                                         insh-130
      if (j1.le.0) go to 20                                             insh-131
c integration                                                           insh-132
      do 19 js=1,j1                                                     insh-133
      is=ism-js                                                         insh-134
      hx=x(1,is+1)*dble(p(is,3))-x(2,is+1)*dble(p(is,4))                insh-135
      hy=x(2,is+1)*dble(p(is,3))+x(1,is+1)*dble(p(is,4))                insh-136
      x(1,is)=x(1,is+1)+x(1,is+1)-x(1,is+2)-hx                          insh-137
   19 x(2,is)=x(2,is+1)+x(2,is+1)-x(2,is+2)-hy                          insh-138
c computation of irregular solution                                     insh-139
   20 do 21 is=kt,ism                                                   insh-140
      p(is,3)=(x(1,is)+10.d0*x(1,is+1)+x(1,is+2))/12.d0                 insh-141
   21 p(is,4)=(x(2,is)+10.d0*x(2,is+1)+x(2,is+2))/12.d0                 insh-142
      return                                                            insh-143
      end                                                               insh-144
c 22/02/97  ibm version                                         ecis96  insi-000
      subroutine insi(w,p,pd,ph,fam,x,pad1,pad2,kiter,eiter,aconv,kab,isinsi-001
     1m,ipd,i,v,vi,www,conv,nat,at,nvi,nc,far,fai,mc,cc,lo,lt,h,z)      insi-002
c  e. c. i. s. method: integration of a single inhomogeneous equation   insi-003
c  by the numerov method       - schroedinger equation -                insi-004
c input variables: p:     coupled solution                              insi-005
c                  ph:    homogeneous solutions                         insi-006
c                  pd:    derivative of the coupled solution            insi-007
c                  fam:   wave number                                   insi-008
c                  kiter: current iteration number                      insi-009
c                  eiter: convergence epsilon for the scattering coeff. insi-010
c                  aconv: epsilon for negligible function values        insi-011
c                  kab:   maximum number of equations                   insi-012
c                  ism:   number of radial points                       insi-013
c                  ipd(ic): the function ic is negligible for r < ipd*h insi-014
c                  i:     channel number of the equation                insi-015
c                  v,vi:  real, imaginary potentials and couplings      insi-016
c                  www:   coupling between equations computed in inti   insi-017
c                  conv:  epsilon for negligible second member          insi-018
c                  nat,at:table of coupling coefficients                insi-019
c                  nvi:   addresses of coupling coefficients            insi-020
c                  nc:    number of coupled channels                    insi-021
c                  far,fai: phase-shifts to update                      insi-022
c                  lo(i): logical controls                              insi-023
c                  lt:    .true. to compute only the derivative         insi-024
c                  h:     integration step                              insi-025
c                  z:     coulomb integral for corrections              insi-026
c output variables:p:     solution for equation i                       insi-027
c                  pd:    derivative of the solution for equation i     insi-028
c                  far,fai:  scattering coefficient                     insi-029
c working field:   w(2,ism): real/imaginary second member               insi-030
c                  pad1: iteration results for the channel i            insi-031
c                  pad2: working field of pade,twice longer than pad1   insi-032
c                  x:    integral of regular solution with second memberinsi-033
c***********************************************************************insi-034
      logical lo(250),lt                                                insi-035
      double precision fam(1),x(2,1),pad1(2,1),pad2(2,1),z(4),bre,bim,hxinsi-036
     1,hy,far(1),fai(1)                                                 insi-037
      dimension ph(ism,4,1),p(2,ism,1),pd(2,ism,1),w(2,1),ipd(1),v(ism,1insi-038
     1),vi(ism,1),www(ism,1),nat(2,1),at(2,1),nvi(kab,kab,4),mc(kab,4),cinsi-039
     2c(kab,6)                                                          insi-040
      if (lt) go to 35                                                  insi-041
      ism1=ism+1                                                        insi-042
c put zero in the inhomogeneous terms                                   insi-043
      do 1 is=1,ism                                                     insi-044
      w(1,is)=0.                                                        insi-045
    1 w(2,is)=0.                                                        insi-046
      idp=ism1                                                          insi-047
c non derivative term of coupling potentials                            insi-048
      do 23 ic=1,nc                                                     insi-049
      if (ipd(ic).gt.ism) go to 23                                      insi-050
      if (lo(207)) go to 7                                              insi-051
c no previous calculation of coupling potentials                        insi-052
      if (ic.ne.i) go to 3                                              insi-053
      if (cc(ic,6).eq.0.) go to 3                                       insi-054
      kt=mc(ic,4)                                                       insi-055
      do 2 is=1,ism                                                     insi-056
      w(1,is)=w(1,is)+cc(ic,6)*vi(is,kt)*p(2,is,ic)                     insi-057
    2 w(2,is)=w(2,is)-cc(ic,6)*vi(is,kt)*p(1,is,ic)                     insi-058
    3 if (lo(29).and.(ic.eq.i)) go to 23                                insi-059
      k1=nvi(ic,i,1)                                                    insi-060
      k2=nvi(ic,i,2)                                                    insi-061
      if (k1.gt.k2) go to 13                                            insi-062
      k3=ipd(ic)                                                        insi-063
      idp=min0(idp,k3)                                                  insi-064
      do 6 k=k1,k2                                                      insi-065
      kt=iabs(nat(1,k))                                                 insi-066
      do 4 is=k3,ism                                                    insi-067
      w(1,is)=w(1,is)+at(2,k)*v(is,kt)*p(1,is,ic)                       insi-068
    4 w(2,is)=w(2,is)+at(2,k)*v(is,kt)*p(2,is,ic)                       insi-069
      if (kt.eq.nat(1,k)) go to 6                                       insi-070
      do 5 is=k3,ism                                                    insi-071
      w(1,is)=w(1,is)-at(2,k)*vi(is,kt)*p(2,is,ic)                      insi-072
    5 w(2,is)=w(2,is)+at(2,k)*vi(is,kt)*p(1,is,ic)                      insi-073
    6 continue                                                          insi-074
      go to 13                                                          insi-075
c coupling potentials already calculated                                insi-076
    7 l1=nvi(ic,i,1)                                                    insi-077
      l2=nvi(ic,i,2)                                                    insi-078
      k3=ipd(ic)                                                        insi-079
      idp=min0(idp,k3)                                                  insi-080
      if (l1.eq.0) go to 11                                             insi-081
      if (l2.gt.0) go to 9                                              insi-082
      do 8 is=k3,ism                                                    insi-083
      w(1,is)=w(1,is)+www(is,l1)*p(1,is,ic)                             insi-084
    8 w(2,is)=w(2,is)+www(is,l1)*p(2,is,ic)                             insi-085
      go to 13                                                          insi-086
    9 do 10 is=k3,ism                                                   insi-087
      w(1,is)=w(1,is)+www(is,l1)*p(1,is,ic)-www(is,l2)*p(2,is,ic)       insi-088
   10 w(2,is)=w(2,is)+www(is,l1)*p(2,is,ic)+www(is,l2)*p(1,is,ic)       insi-089
      go to 13                                                          insi-090
   11 if (l2.eq.0) go to 13                                             insi-091
      do 12 is=k3,ism                                                   insi-092
      w(1,is)=w(1,is)-www(is,l2)*p(2,is,ic)                             insi-093
   12 w(2,is)=w(2,is)+www(is,l2)*p(1,is,ic)                             insi-094
   13 if (.not.lo(210)) go to 23                                        insi-095
c derivative term of coupling potentials                                insi-096
      if (lo(207)) go to 17                                             insi-097
c no previous calculation of coupling potentials                        insi-098
      k1=k2+1                                                           insi-099
      k2=nvi(ic,i,3)                                                    insi-100
      if (k1.gt.k2) go to 23                                            insi-101
      do 16 k=k1,k2                                                     insi-102
      kt=iabs(nat(1,k))                                                 insi-103
      do 14 is=k3,ism                                                   insi-104
      w(1,is)=w(1,is)+at(2,k)*v(is,kt)*pd(1,is,ic)                      insi-105
   14 w(2,is)=w(2,is)+at(2,k)*v(is,kt)*pd(2,is,ic)                      insi-106
      if (kt.eq.nat(1,k)) go to 16                                      insi-107
      do 15 is=k3,ism                                                   insi-108
      w(1,is)=w(1,is)-at(2,k)*vi(is,kt)*pd(2,is,ic)                     insi-109
   15 w(2,is)=w(2,is)+at(2,k)*vi(is,kt)*pd(1,is,ic)                     insi-110
   16 continue                                                          insi-111
      go to 23                                                          insi-112
c coupling potentials already calculated                                insi-113
   17 l1=nvi(ic,i,3)                                                    insi-114
      l2=nvi(ic,i,4)                                                    insi-115
      if (l1.le.0) go to 21                                             insi-116
      if (l2.gt.0) go to 19                                             insi-117
      do 18 is=k3,ism                                                   insi-118
      w(1,is)=w(1,is)+www(is,l1)*pd(1,is,ic)                            insi-119
   18 w(2,is)=w(2,is)+www(is,l1)*pd(2,is,ic)                            insi-120
      go to 23                                                          insi-121
   19 do 20 is=k3,ism                                                   insi-122
      w(1,is)=w(1,is)+www(is,l1)*pd(1,is,ic)-www(is,l2)*pd(2,is,ic)     insi-123
   20 w(2,is)=w(2,is)+www(is,l1)*pd(2,is,ic)+www(is,l2)*pd(1,is,ic)     insi-124
      go to 23                                                          insi-125
   21 if (l2.eq.0) go to 23                                             insi-126
      do 22 is=k3,ism                                                   insi-127
      w(1,is)=w(1,is)-www(is,l2)*pd(2,is,ic)                            insi-128
   22 w(2,is)=w(2,is)+www(is,l2)*pd(1,is,ic)                            insi-129
   23 continue                                                          insi-130
      ipd(i)=idp                                                        insi-131
c search for the first non negligible value                             insi-132
      if (idp.gt.ism) return                                            insi-133
      do 24 is=idp,ism                                                  insi-134
      if ((abs(w(1,is))+abs(w(2,is))).gt.conv) go to 25                 insi-135
   24 continue                                                          insi-136
   25 ipd(i)=is                                                         insi-137
      kt=max0(ipd(i),1)                                                 insi-138
      if (ipd(i).ge.ism) return                                         insi-139
      if (lo(144)) go to 26                                             insi-140
      w(1,ism)=0.                                                       insi-141
      w(2,ism)=0.                                                       insi-142
c integral of the regular function with the second member               insi-143
   26 x(1,kt)=-ph(kt,2,i)*w(2,kt)+ph(kt,1,i)*w(1,kt)                    insi-144
      x(2,kt)=ph(kt,1,i)*w(2,kt)+ph(kt,2,i)*w(1,kt)                     insi-145
      kkt=kt+1                                                          insi-146
      if (kt.gt.ism) go to 28                                           insi-147
      do 27 is=kkt,ism                                                  insi-148
      x(1,is)=x(1,is-1)+ph(is,1,i)*w(1,is)-ph(is,2,i)*w(2,is)           insi-149
   27 x(2,is)=x(2,is-1)+ph(is,1,i)*w(2,is)+ph(is,2,i)*w(1,is)           insi-150
c scattering coefficients                                               insi-151
   28 bre=x(1,ism)/(h*fam(1))-z(1)                                      insi-152
      bim=x(2,ism)/(h*fam(1))-z(2)                                      insi-153
      if (lo(92)) go to 34                                              insi-154
      hx=z(3)*h                                                         insi-155
      hy=z(4)*h                                                         insi-156
      ist=ism+kt                                                        insi-157
c integral of the irregular function with the second member in hx/hy    insi-158
c and computation of the solution with the correction term w/12         insi-159
      do 29 is=kt,ism                                                   insi-160
      js=ist-is                                                         insi-161
      p(1,js,i)=(x(1,js)*ph(js,3,i)-x(2,js)*ph(js,4,i)-hx*ph(js,1,i)+hy*insi-162
     1ph(js,2,i))/h-w(1,js)/12.                                         insi-163
      p(2,js,i)=(x(1,js)*ph(js,4,i)+x(2,js)*ph(js,3,i)-hy*ph(js,1,i)-hx*insi-164
     1ph(js,2,i))/h-w(2,js)/12.                                         insi-165
      hx=hx-ph(js,3,i)*w(1,js)+ph(js,4,i)*w(2,js)                       insi-166
   29 hy=hy-ph(js,3,i)*w(2,js)-ph(js,4,i)*w(1,js)                       insi-167
      if (kt.eq.1) go to 31                                             insi-168
      k=kt-1                                                            insi-169
      do 30 is=1,k                                                      insi-170
      p(1,is,i)=-(hx*ph(is,1,i)-hy*ph(is,2,i))/h                        insi-171
   30 p(2,is,i)=-(hy*ph(is,1,i)+hx*ph(is,2,i))/h                        insi-172
   31 do 32 kt=1,ism                                                    insi-173
      if ((abs(p(1,kt,i))+abs(p(2,kt,i))).gt.aconv) go to 33            insi-174
   32 continue                                                          insi-175
   33 ipd(i)=kt                                                         insi-176
      if (lo(22)) go to 34                                              insi-177
      pad1(1,kiter)=bre                                                 insi-178
      pad1(2,kiter)=bim                                                 insi-179
c  test of convergence                                                  insi-180
   34 lo(205)=(dabs(bim-fai(1)).le.eiter.and.(dabs(bre-far(1)).le.eiter)insi-181
     1)                                                                 insi-182
      if (lo(122).and.lo(204).and.kiter.gt.3.and.(.not.lo(205))) call painsi-183
     1de(pad1,pad2,kiter,bre,bim,eiter,1.d0,0.d0,lo)                    insi-184
      lo(204)=lo(204).and.lo(205)                                       insi-185
      far(1)=bre                                                        insi-186
      fai(1)=bim                                                        insi-187
      if (lo(57)) write (2,1000) i,far(1),fai(1),kiter,kt               insi-188
      if (.not.lo(210).or.lo(92)) return                                insi-189
c computation of r*(d/dr) of the solutions                              insi-190
   35 ist=ism-3                                                         insi-191
      do 37 j=1,2                                                       insi-192
      pd(j,1,i)=2.5*p(j,2,i)-.25*p(j,5,i)+(5.*p(j,4,i)-7.7*p(j,1,i)-10.*insi-193
     1p(j,3,i)+.2*p(j,6,i))/6.                                          insi-194
      pd(j,2,i)=-.8*p(j,1,i)-p(j,4,i)+(8.*p(j,3,i)-3.5*p(j,2,i)+.8*p(j,5insi-195
     1,i)-.1*p(j,6,i))/3.                                               insi-196
      pd(j,3,i)=2.25*(p(j,4,i)-p(j,2,i))-.45*(p(j,5,i)-p(j,1,i))+.05*p(jinsi-197
     1,6,i)                                                             insi-198
      fp=3.                                                             insi-199
      do 36 is=4,ist                                                    insi-200
      fp=fp+1.                                                          insi-201
   36 pd(j,is,i)=fp*(.75*(p(j,is+1,i)-p(j,is-1,i))-.15*(p(j,is+2,i)-p(j,insi-202
     1is-2,i))+(p(j,is+3,i)-p(j,is-3,i))/60.)                           insi-203
      fp=fp+1.                                                          insi-204
      pd(j,ism-2,i)=fp*(p(j,ism-6,i)-8.*p(j,ism-5,i)+30.*p(j,ism-4,i)-80insi-205
     1.*p(j,ist,i)+35.*p(j,ism-2,i)+24.*p(j,ism-1,i)-2.*p(j,ism,i))/60. insi-206
      fp=fp+1.                                                          insi-207
      pd(j,ism-1,i)=fp*(15.*p(j,ism-5,i)-2.*p(j,ism-6,i)-50.*p(j,ism-4,iinsi-208
     1)+100.*p(j,ist,i)-150.*p(j,ism-2,i)+77.*p(j,ism-1,i)+10.*p(j,ism,iinsi-209
     2))/60.                                                            insi-210
      fp=fp+1.                                                          insi-211
      pd(j,ism,i)=fp*(10.*p(j,ism-6,i)-72.*p(j,ism-5,i)+225.*p(j,ism-4,iinsi-212
     1)-400.*p(j,ist,i)+450.*p(j,ism-2,i)-360.*p(j,ism-1,i)+147*p(j,ism,insi-213
     2i))/60.                                                           insi-214
   37 continue                                                          insi-215
      return                                                            insi-216
 1000 format (5x,i5,2d30.15,i10,10x,i5)                                 insi-217
      end                                                               insi-218
c 22/02/97  ibm version                                         ecis96  intr-000
      subroutine intr(fam,x,fr,gr,wre,pad,ipe,ism,kab,w,iterm,nc,v,vr,nvintr-001
     1i,cc,mc,nat,at,ag,h,aconv,eiter,ncin,nni,iterr,lo)                intr-002
c  e. c. i. s. method: dirac equation driving routine.                  intr-003
c             inrh  to solve the single homogeneous equations           intr-004
c             inri  to solve the single inhomogeneous equations         intr-005
c  pade approximants of type i may be used to accelerate the convergenceintr-006
c input variables: fam(ic,i): matching values for i=1,6                 intr-007
c                             constants of each equation for i=7,10     intr-008
c                  ism:   number of radial points                       intr-009
c                  kab:   maximum number of coupled channels            intr-010
c                  iterm: maximum number of iterations and dim. of pad  intr-011
c                  nc:    number of coupled equations                   intr-012
c                  v,vr:  potentials                                    intr-013
c                  nvi:   addresses of couplings                        intr-014
c                  cc,mc: nuclear state number, angular momenta....     intr-015
c                  nat,at:table of coupling coefficients                intr-016
c                  ag:    coulomb integrals for coulomb corrections     intr-017
c                  h:     step length                                   intr-018
c                  aconv: epsilon for negligible function values        intr-019
c                  eiter: convergence epsilon for the scattering coef.  intr-020
c                  ncin:  number of solutions                           intr-021
c                  lo(i): logical controls                              intr-022
c output variables:fam(ic,i+7): scattering coefficients                 intr-023
c working fields:  x:     used in inrh and inri                         intr-024
c                  fr:    solutions of homogeneous equations            intr-025
c                  gr:    solutions of coupled equations                intr-026
c                  wre:   real/imaginary inhomogeneous term             intr-027
c                  pad(iterm,kab+2): pade approximants                  intr-028
c               ipe(i,1): first non negligible point of uncoupled func. intr-029
c               ipe(i,2): first non negligible point of coupled funct.  intr-030
c                  w:     free part of the storage for couplings        intr-031
c output variables:nni:   number of eq. with negligible inhomog. term   intr-032
c                  iterr: largest number of iterations done for this j  intr-033
c***********************************************************************intr-034
      implicit real*8 (a-h,o-z)                                         intr-035
      logical lo(250)                                                   intr-036
      real*4 aconv,cc(kab,6),h,eiter,v(ism,14,1),vr(ism,4,1),fr(ism,8,1)intr-037
     1,gr(ism,4,1),wre(ism,1),w(ism,4,1),conv,at(3,1)                   intr-038
      dimension ipe(nc,2),nvi(kab,kab,4),fam(kab,8),x(1),nat(3,1),pad(2,intr-039
     1iterm,1),ag(kab,kab,4),y(2),mc(kab,4),z(4)                        intr-040
      conv=aconv*h*h                                                    intr-041
      nni=0                                                             intr-042
      i2=8*ism                                                          intr-043
c compute all coupling potentials and solve all homogeneous equations   intr-044
      do 4 i=1,nc                                                       intr-045
      i1=mc(i,4)                                                        intr-046
      if (i1.lt.0) go to 1                                              intr-047
      call inrh(fr(1,1,i),i,k,aconv,fam,x,kab,ism,lo,dble(cc(i,6)+1.),h,intr-048
     1v(1,1,i1),lo(221))                                                intr-049
      ipe(i,1)=k                                                        intr-050
      go to 3                                                           intr-051
    1 i1=-i1                                                            intr-052
      if (i1.eq.i) go to 3                                              intr-053
      do 2 is=1,i2                                                      intr-054
    2 fr(is,1,i)=fr(is,1,i1)                                            intr-055
      ipe(i,1)=ipe(i1,1)                                                intr-056
    3 if (lo(57)) write (2,1000) fam(i,7),fam(i,8),i,ipe(i,1)           intr-057
    4 continue                                                          intr-058
      i2=2*ism                                                          intr-059
      if (.not.lo(207).or.lo(221)) go to 15                             intr-060
      iw=0                                                              intr-061
c calculation of the non diagonal coupling potentials                   intr-062
      do 14 ic=1,nc                                                     intr-063
      do 13 ip=1,ic                                                     intr-064
      k1=nvi(ip,ic,1)                                                   intr-065
      k2=nvi(ip,ic,2)                                                   intr-066
      k3=nvi(ip,ic,3)                                                   intr-067
      nvi(ip,ic,3)=0                                                    intr-068
      nvi(ip,ic,4)=0                                                    intr-069
      if (k1.gt.k2) go to 8                                             intr-070
      iw=iw+1                                                           intr-071
      nvi(ip,ic,3)=iw                                                   intr-072
      k=nat(1,k1)                                                       intr-073
      do 5 is=1,i2                                                      intr-074
      w(is,1,iw)=at(2,k1)*vr(is,1,k)                                    intr-075
    5 w(is,3,iw)=at(3,k1)*vr(is,3,k)                                    intr-076
      k4=k1+1                                                           intr-077
      if (k4.gt.k2) go to 8                                             intr-078
      do 7 k1=k4,k2                                                     intr-079
      k=nat(1,k1)                                                       intr-080
      do 6 is=1,i2                                                      intr-081
      w(is,1,iw)=w(is,1,iw)+at(2,k1)*vr(is,1,k)                         intr-082
    6 w(is,3,iw)=w(is,3,iw)+at(3,k1)*vr(is,3,k)                         intr-083
    7 continue                                                          intr-084
    8 if (k2.ge.k3) go to 12                                            intr-085
      iw=iw+1                                                           intr-086
      nvi(ip,ic,4)=iw                                                   intr-087
      k1=k2+1                                                           intr-088
      k=nat(1,k1)                                                       intr-089
      do 9 is=1,i2                                                      intr-090
      w(is,1,iw)=at(2,k1)*vr(is,1,k)+at(3,k1)*vr(is,3,k)                intr-091
    9 w(is,3,iw)=at(2,k1)*vr(is,1,k)-at(3,k1)*vr(is,3,k)                intr-092
      k4=k1+1                                                           intr-093
      if (k4.gt.k3) go to 12                                            intr-094
      do 11 k1=k4,k3                                                    intr-095
      k=nat(1,k1)                                                       intr-096
      do 10 is=1,i2                                                     intr-097
      w(is,1,iw)=w(is,1,iw)+at(2,k1)*vr(is,1,k)+at(3,k1)*vr(is,3,k)     intr-098
   10 w(is,3,iw)=w(is,3,iw)+at(2,k1)*vr(is,1,k)-at(3,k1)*vr(is,3,k)     intr-099
   11 continue                                                          intr-100
   12 nvi(ic,ip,3)=nvi(ip,ic,3)                                         intr-101
      nvi(ic,ip,4)=nvi(ip,ic,4)                                         intr-102
      if (iw.gt.iw) iw=iw                                               intr-103
   13 continue                                                          intr-104
   14 continue                                                          intr-105
   15 if (lo(59)) call hora                                             intr-106
c loop on solutions                                                     intr-107
      do 29 nci=1,ncin                                                  intr-108
      nci1=nci+8                                                        intr-109
      nci2=nci1+ncin                                                    intr-110
c set the zero's order solution                                         intr-111
      do 16 ic=1,nc                                                     intr-112
      ipe(ic,2)=ism+1                                                   intr-113
      fam(ic,nci1)=0.d0                                                 intr-114
   16 fam(ic,nci2)=0.d0                                                 intr-115
      fam(nci,nci1)=fam(nci,7)                                          intr-116
      fam(nci,nci2)=fam(nci,8)                                          intr-117
      if ((ipe(nci,1).gt.ism-3).or.lo(221)) go to 29                    intr-118
      do 17 is=1,i2                                                     intr-119
      gr(is,1,nci)=fr(is,1,nci)                                         intr-120
   17 gr(is,3,nci)=fr(is,5,nci)                                         intr-121
      ipe(nci,2)=ipe(nci,1)                                             intr-122
      amax=0.d0                                                         intr-123
c e. c. i. s. loop                                                      intr-124
      do 27 kiter=1,iterm                                               intr-125
      iterr=max0(iterr,kiter)                                           intr-126
      lo(204)=.true.                                                    intr-127
      lo(206)=((kiter.ne.iterm).and.(amax.lt.1.d10)).or.lo(23)          intr-128
      if (amax.gt.1.d10) write (2,1001) amax,kiter                      intr-129
      do 26 ic=1,nc                                                     intr-130
      i=mod(ic+nci-1,nc)+1                                              intr-131
      i1=mc(i,1)                                                        intr-132
      do 18 j=1,4                                                       intr-133
   18 z(j)=0.d0                                                         intr-134
      if (lo(144)) go to 23                                             intr-135
      do 21 j=1,nc                                                      intr-136
      if (ipe(j,2).ge.ism) go to 21                                     intr-137
c order in fg   f(ei)*f(ef),g(ei)*f(ef),f(ei)*g(ef),g(ei)*g(ef)         intr-138
      if (lo(22)) go to 19                                              intr-139
      ij=kiter                                                          intr-140
      if (1+mod(j+nc-nci-1,nc).ge.ic) ij=ij-1                           intr-141
      if (ij.eq.0) go to 19                                             intr-142
      y(1)=pad(1,ij,j)                                                  intr-143
      y(2)=pad(2,ij,j)                                                  intr-144
      go to 20                                                          intr-145
   19 y(1)=fam(j,nci1)                                                  intr-146
      y(2)=fam(j,nci2)                                                  intr-147
   20 z(1)=z(1)+y(1)*ag(i,j,3)-y(2)*ag(i,j,1)                           intr-148
      z(2)=z(2)+y(1)*ag(i,j,1)+y(2)*ag(i,j,3)                           intr-149
      z(3)=z(3)+y(1)*ag(i,j,4)-y(2)*ag(i,j,2)                           intr-150
      z(4)=z(4)+y(1)*ag(i,j,2)+y(2)*ag(i,j,4)                           intr-151
   21 continue                                                          intr-152
      if (i.eq.nci) go to 22                                            intr-153
      z(1)=z(1)+ag(i,nci,1)                                             intr-154
      z(3)=z(3)+ag(i,nci,2)                                             intr-155
   22 z(3)=z(3)-z(2)                                                    intr-156
      z(4)=z(4)+z(1)                                                    intr-157
      z(1)=z(1)+fam(i,7)*z(3)-fam(i,8)*z(4)                             intr-158
      z(2)=z(2)+z(3)*fam(i,8)+z(4)*fam(i,7)                             intr-159
   23 if (i.ne.nci) go to 24                                            intr-160
      z(1)=z(1)-fam(i,7)                                                intr-161
      z(2)=z(2)-fam(i,8)                                                intr-162
      z(3)=z(3)-1.d0                                                    intr-163
   24 if (lo(23).and.(.not.lo(206))) lo(204)=.true.                     intr-164
c compute second members and solve the inhomogeneous equations          intr-165
      call inri(wre,fr(1,1,i),gr,w,nvi,fam(i,5),x,pad(1,1,i),pad(1,1,nc+intr-166
     11),kiter,eiter,conv,aconv,kab,nc,ism,ipe(1,2),i,nat,at,vr,fam(i,ncintr-167
     2i1),fam(i,nci2),cc(i,6)+1.,v(1,1,i1),lo,h,z)                      intr-168
      if (ipe(i,2).ge.ism) go to 25                                     intr-169
      if (i.ne.nci.and.lo(92)) ipe(i,2)=ism+1                           intr-170
      amax=dmax1(amax,dabs(fam(i,nci1))+dabs(fam(i,nci2)))              intr-171
      go to 26                                                          intr-172
   25 fam(i,nci1)=-z(1)                                                 intr-173
      fam(i,nci2)=-z(2)                                                 intr-174
      if (lo(57)) write (2,1002)                                        intr-175
      if (kiter.eq.1.and.lo(144)) nni=nni+1                             intr-176
      if (i.eq.nci) ipe(nci,2)=ipe(nci,1)                               intr-177
   26 continue                                                          intr-178
      if (lo(59)) call hora                                             intr-179
      if (lo(204).or.(amax.gt.1.d10.and.lo(23))) go to 28               intr-180
   27 continue                                                          intr-181
      kiter=min0(kiter,iterm)                                           intr-182
   28 if (lo(53)) write (2,1003) kiter                                  intr-183
   29 continue                                                          intr-184
      nni=nni/ncin                                                      intr-185
      return                                                            intr-186
 1000 format (2d30.15,5x,2i5)                                           intr-187
 1001 format (8h maximum,d15.6,44h obtained in previous iteration. last intr-188
     1one is,i3)                                                        intr-189
 1002 format (5x,35hthe inhomogeneous term is neglected)                intr-190
 1003 format (5x,i5,11h iterations)                                     intr-191
      end                                                               intr-192
c 27/04/98  ibm version                                         ecis97  inrh-000
      subroutine inrh(p,ic,kt,aconv,fam,x,nc,ism,lo,cc,h,vv,lt)         inrh-001
c  e. c. i. s. method: integration of a single homogeneous equation by  inrh-002
c  the numerov method   - dirac equation -                              inrh-003
c input variables: ic:    channel number of the equation                inrh-004
c                  aconv: limit for negligible function values          inrh-005
c                  fam(ic,i): matching values for i=1,4                 inrh-006
c                             constants of the equation for i=6,10      inrh-007
c                  nc:    number of coupled channels                    inrh-008
c                  ism:   number of radial points                       inrh-009
c                  lo(i): logical controls                              inrh-010
c                  cc:    eigenvalue of l.s+1                           inrh-011
c                  h:     step size                                     inrh-012
c                  vv:    potentials, d(r), ....                        inrh-013
c                  lt:    logical to return only with phase shift       inrh-014
c output variables:p(ism,i): regular solution for i=1,2 and 5,6         inrh-015
c                            irregular solution for i=3,4 and 7,8       inrh-016
c                            large components for i=1,4                 inrh-017
c                            small component for i=5,8                  inrh-018
c                  fam(ic,7/8): real/imaginary part of zero's order     inrh-019
c                         scattering coefficients                       inrh-020
c                  kt: the solution is negligible for is < kt           inrh-021
c working space:   x:    for the integration                            inrh-022
c***********************************************************************inrh-023
      implicit real*8 (a-h,o-z)                                         inrh-024
      logical lo(250),lt                                                inrh-025
      dimension fam(nc,10),x(2,2)                                       inrh-026
      real*4 p(ism,8),vv(ism,14),aconv,h,hh                             inrh-027
c computation of the regular solution                                   inrh-028
      do 1 is=1,ism                                                     inrh-029
      a=is*is                                                           inrh-030
      x(1,is+2)=fam(ic,10)/a-fam(ic,9)-fam(ic,7)*vv(is,1)-fam(ic,8)*vv(iinrh-031
     1s,3)                                                              inrh-032
    1 x(2,is+2)=-fam(ic,7)*vv(is,2)-fam(ic,8)*vv(is,4)                  inrh-033
      if (lo(27)) go to 3                                               inrh-034
c modified numerov method                                               inrh-035
      do 2 is=1,ism                                                     inrh-036
      a=x(1,is+2)**2-x(2,is+2)**2                                       inrh-037
      if (lo(26)) a=a*(1.d0+x(1,is+2)*.033333333333333d0)               inrh-038
      x(2,is+2)=x(2,is+2)*(1.d0+x(1,is+2)*.166666666666667d0)           inrh-039
    2 x(1,is+2)=x(1,is+2)+a*.083333333333333d0                          inrh-040
      go to 5                                                           inrh-041
c numerov method                                                        inrh-042
    3 do 4 is=1,ism                                                     inrh-043
      b=(12.d0-x(1,is+2))**2+x(2,is+2)**2                               inrh-044
      a=12.d0*(x(1,is+2)*(12.d0-x(1,is+2))-x(2,is+2)**2)/b              inrh-045
      if (lo(26)) a=a*(1.d0-x(1,is+2)**2*.416666666666667d-2)           inrh-046
      x(1,is+2)=a                                                       inrh-047
    4 x(2,is+2)=144.d0*x(2,is+2)/b                                      inrh-048
    5 x(1,1)=0.d0                                                       inrh-049
      x(2,1)=0.d0                                                       inrh-050
      x(1,2)=1.d-15                                                     inrh-051
      x(2,2)=0.d0                                                       inrh-052
      do 7 is=1,ism                                                     inrh-053
      p(is,3)=x(1,is+2)                                                 inrh-054
      p(is,4)=x(2,is+2)                                                 inrh-055
      hx=x(1,is+1)*x(1,is+2)-x(2,is+1)*x(2,is+2)                        inrh-056
      hy=x(2,is+1)*x(1,is+2)+x(1,is+1)*x(2,is+2)                        inrh-057
      x(1,is+2)=x(1,is+1)+x(1,is+1)-x(1,is)+hx                          inrh-058
      x(2,is+2)=x(2,is+1)+x(2,is+1)-x(2,is)+hy                          inrh-059
      if (dabs(x(1,is+2)).lt.1.d15) go to 7                             inrh-060
c renormalisation of large function values                              inrh-061
      j=2*is+4                                                          inrh-062
      do 6 i=3,j                                                        inrh-063
    6 x(i,1)=x(i,1)*1.d-30                                              inrh-064
    7 continue                                                          inrh-065
c end of integration                                                    inrh-066
c matching with two values                                              inrh-067
      bre=x(1,ism)*fam(ic,4)-fam(ic,3)*x(1,ism+2)                       inrh-068
      bim=x(2,ism)*fam(ic,4)-fam(ic,3)*x(2,ism+2)                       inrh-069
      hx=x(1,ism)*fam(ic,2)-fam(ic,1)*x(1,ism+2)                        inrh-070
      hy=x(2,ism)*fam(ic,2)-fam(ic,1)*x(2,ism+2)                        inrh-071
      bim=bim+hx                                                        inrh-072
      bre=bre-hy                                                        inrh-073
      brr=bre*bre+bim*bim                                               inrh-074
      bre=-bre/brr                                                      inrh-075
      bim=bim/brr                                                       inrh-076
      fam(ic,7)=bre*hx-bim*hy                                           inrh-077
      fam(ic,8)=hx*bim+hy*bre                                           inrh-078
      if (lt) return                                                    inrh-079
      bre=bre/12.d0                                                     inrh-080
      bim=bim/12.d0                                                     inrh-081
c normalisation of the regular solution                                 inrh-082
c and search of the first non negligible value                          inrh-083
      do 8 is=1,ism                                                     inrh-084
      brr=x(1,is)+10.d0*x(1,is+1)+x(1,is+2)                             inrh-085
      hy=x(2,is)+10.d0*x(2,is+1)+x(2,is+2)                              inrh-086
      hx=brr*bre-hy*bim                                                 inrh-087
      hy=hy*bre+brr*bim                                                 inrh-088
      p(is,1)=hx*vv(is,9)-hy*vv(is,10)                                  inrh-089
    8 p(is,2)=hx*vv(is,10)+hy*vv(is,9)                                  inrh-090
      do 9 kt=1,ism                                                     inrh-091
      if ((abs(p(kt,1))+abs(p(kt,2))).gt.aconv) go to 10                inrh-092
    9 continue                                                          inrh-093
   10 hx=fam(ic,1)                                                      inrh-094
      hy=fam(ic,2)                                                      inrh-095
c computation of the irregular solution - starting values               inrh-096
c the last point of imaginary potential is neglected                    inrh-097
      x(2,ism)=hx/fam(ic,6)                                             inrh-098
      x(2,ism+2)=hy/fam(ic,6)                                           inrh-099
      x(1,ism)=fam(ic,3)/fam(ic,6)                                      inrh-100
      x(1,ism+2)=fam(ic,4)/fam(ic,6)                                    inrh-101
      bre=2.d0+p(ism,3)                                                 inrh-102
      x(1,ism+1)=(x(1,ism)+x(1,ism+2))/bre                              inrh-103
      x(2,ism+1)=(x(2,ism)+x(2,ism+2))/bre                              inrh-104
      kr=min0(kt,ism-6)                                                 inrh-105
      i1=ism-kr                                                         inrh-106
c integration                                                           inrh-107
      do 11 js=1,i1                                                     inrh-108
      is=ism-js                                                         inrh-109
      hx=x(1,is+1)*p(is,3)-x(2,is+1)*p(is,4)                            inrh-110
      hy=x(2,is+1)*p(is,3)+x(1,is+1)*p(is,4)                            inrh-111
      x(1,is)=x(1,is+1)+x(1,is+1)-x(1,is+2)+hx                          inrh-112
   11 x(2,is)=x(2,is+1)+x(2,is+1)-x(2,is+2)+hy                          inrh-113
c computation of irregular solution                                     inrh-114
      do 12 is=kr,ism                                                   inrh-115
      bre=(x(1,is)+10.d0*x(1,is+1)+x(1,is+2))/12.d0                     inrh-116
      bim=(x(2,is)+10.d0*x(2,is+1)+x(2,is+2))/12.d0                     inrh-117
      p(is,3)=bre*vv(is,9)-bim*vv(is,10)                                inrh-118
   12 p(is,4)=bre*vv(is,10)+bim*vv(is,9)                                inrh-119
      ism3=ism-3                                                        inrh-120
      hh=h*60.                                                          inrh-121
      do 22 l=1,4                                                       inrh-122
      do 21 is=kt,ism                                                   inrh-123
      if (is-kr.gt.2) go to 16                                          inrh-124
      if (is-kr-1)  13 , 14 , 15                                        inrh-125
   13 p(is,l+4)=(-147.*p(is,l)+360.*p(is+1,l)-450.*p(is+2,l)+400.*p(is+3inrh-126
     1,l)-225.*p(is+4,l)+72.*p(is+5,l)-10.*p(is+6,l))/hh                inrh-127
      go to 21                                                          inrh-128
   14 p(is,l+4)=(-10.*p(kr,l)-77.*p(is,l)+150.*p(is+1,l)-100.*p(is+2,l)+inrh-129
     150.*p(is+3,l)-15.*p(is+4,l)+2.*p(is+5,l))/hh                      inrh-130
      go to 21                                                          inrh-131
   15 p(is,l+4)=(2.*p(kr,l)-24.*p(is-1,l)-35.*p(is,l)+80.*p(is+1,l)-30.*inrh-132
     1p(is+2,l)+8.*p(is+3,l)-p(is+4,l))/hh                              inrh-133
      go to 21                                                          inrh-134
   16 if (is.gt.ism3) go to 17                                          inrh-135
      p(is,l+4)=(45.*(p(is+1,l)-p(is-1,l))-9.*(p(is+2,l)-p(is-2,l))+p(isinrh-136
     1+3,l)-p(is-3,l))/hh                                               inrh-137
      go to 21                                                          inrh-138
   17 if (is-ism+1) 18 , 19 , 20                                        inrh-139
   18 p(ism-2,l+4)=(p(ism-6,l)-8.*p(ism-5,l)+30.*p(ism-4,l)-80.*p(ism3,linrh-140
     1)+35*p(ism-2,l)+24.*p(ism-1,l)-2.*p(ism,l))/hh                    inrh-141
      go to 21                                                          inrh-142
   19 p(ism-1,l+4)=(-2.*p(ism-6,l)+15.*p(ism-5,l)-50.*p(ism-4,l)+100.*p(inrh-143
     1ism3,l)-150.*p(ism-2,l)+77.*p(ism-1,l)+10.*p(ism,l))/hh           inrh-144
      go to 21                                                          inrh-145
   20 p(ism,l+4)=(10.*p(ism-6,l)-72.*p(ism-5,l)+225.*p(ism-4,l)-400.*p(iinrh-146
     1sm3,l)+450.*p(ism-2,l)-360.*p(ism-1,l)+147.*p(ism,l))/hh          inrh-147
   21 continue                                                          inrh-148
   22 continue                                                          inrh-149
      r=h*(kt-1)                                                        inrh-150
      do 23 is=kt,ism                                                   inrh-151
      r=r+h                                                             inrh-152
      br=p(is,1)*(cc/r+vv(is,13))-p(is,5)-p(is,2)*vv(is,14)             inrh-153
      bi=p(is,2)*(cc/r+vv(is,13))-p(is,6)+p(is,1)*vv(is,14)             inrh-154
      cr=p(is,3)*(cc/r+vv(is,13))-p(is,7)-p(is,4)*vv(is,14)             inrh-155
      ci=p(is,4)*(cc/r+vv(is,13))-p(is,8)+p(is,3)*vv(is,14)             inrh-156
      p(is,5)=br*vv(is,11)-bi*vv(is,12)                                 inrh-157
      p(is,6)=bi*vv(is,11)+br*vv(is,12)                                 inrh-158
      p(is,7)=cr*vv(is,11)-ci*vv(is,12)                                 inrh-159
   23 p(is,8)=ci*vv(is,11)+cr*vv(is,12)                                 inrh-160
      if (kt.eq.1) return                                               inrh-161
      kr=kt-1                                                           inrh-162
      do 25 is=1,kr                                                     inrh-163
      do 24 l=1,8                                                       inrh-164
   24 p(is,l)=0.                                                        inrh-165
   25 continue                                                          inrh-166
      return                                                            inrh-167
      end                                                               inrh-168
c 22/02/97  ibm version                                         ecis96  inri-000
      subroutine inri(w,p,q,ww,nvi,fam,x,pad1,pad2,kiter,eiter,conv,aconinri-001
     1v,kab,nc,ism,ipi,j,nat,at,vr,far,fai,xz,v,lo,h,z)                 inri-002
c  e. c. i. s. method: integration of a single inhomogeneous equation   inri-003
c  by the numerov method      - dirac equation -                        inri-004
c input variables: p:     uncoupled solutions                           inri-005
c                  q:     coupled solution                              inri-006
c                  ww:    coupling between equations                    inri-007
c                  nvi:   table of addresses of couplings               inri-008
c                  fam:   wave number                                   inri-009
c                  kiter: current iteration number                      inri-010
c                  eiter: convergence epsilon for the scattering coeff. inri-011
c                  conv:  epsilon for negligible second members         inri-012
c                  aconv: epsilon for negligible function values        inri-013
c                  kab:   dimension of table nvi                        inri-014
c                  nc:    number of coupled channels                    inri-015
c                  ism:   number of radial points                       inri-016
c                  ipi:   the function is negligible for r < ipi*h      inri-017
c                  j:     channel number of the equation                inri-018
c                  nat,at:coefficients and addresses of couplings       inri-019
c                  vr:    coupling potentials                           inri-020
c                  xz:    eigenvalue of l.s + 1                         inri-021
c                  v:     d(r) and tensor potentials for h**4 correctioninri-022
c                  lo(i): logical controls                              inri-023
c                  h:     integration step                              inri-024
c                  z:     coulomb integral for corrections              inri-025
c output variables:far,fai: real and imaginary part of scat. coeff.     inri-026
c working field:   w(ism,4):second members                              inri-027
c                  x:    integral of regular function with second memberinri-028
c                  pad1(2,j): iteration results for the channel j       inri-029
c                  pad2: working field of pade,twice longer than pad1   inri-030
c***********************************************************************inri-031
      logical lo(250)                                                   inri-032
      double precision fam(1),x(2,1),pad1(2,1),pad2(1),hx,hy,a,b,z(4),fainri-033
     1r(1),fai(1)                                                       inri-034
      dimension p(ism,8),w(ism,4),ipi(1),v(ism,14),q(ism,4,1),ww(ism,4,1inri-035
     1),nvi(kab,kab,4),wx(4),nat(3,1),at(3,1),vr(ism,4,1)               inri-036
      ism1=ism+1                                                        inri-037
c put zero in the inhomogeneous terms                                   inri-038
      i2=4*ism                                                          inri-039
      do 1 is=1,i2                                                      inri-040
    1 w(is,1)=0.                                                        inri-041
      idp=ism1                                                          inri-042
      do 14 ic=1,nc                                                     inri-043
      if (ipi(ic).gt.ism) go to 14                                      inri-044
      k3=ipi(ic)                                                        inri-045
      idp=min0(idp,k3)                                                  inri-046
      if (lo(207)) go to 10                                             inri-047
c no previous calculation of coupling potentials                        inri-048
      l1=nvi(j,ic,1)                                                    inri-049
      l2=nvi(j,ic,2)                                                    inri-050
      l3=nvi(j,ic,3)                                                    inri-051
      if (l1.gt.l2) go to 5                                             inri-052
c scalar and vector terms of coupling potentials                        inri-053
      do 4 is=k3,ism                                                    inri-054
      do 2 i=1,4                                                        inri-055
    2 wx(i)=0.                                                          inri-056
      do 3 k1=l1,l2                                                     inri-057
      k=nat(1,k1)                                                       inri-058
      wx(1)=wx(1)+at(2,k1)*vr(is,1,k)                                   inri-059
      wx(2)=wx(2)+at(2,k1)*vr(is,2,k)                                   inri-060
      wx(3)=wx(3)+at(3,k1)*vr(is,3,k)                                   inri-061
    3 wx(4)=wx(4)+at(3,k1)*vr(is,4,k)                                   inri-062
      w(is,1)=w(is,1)+wx(1)*q(is,1,ic)-wx(2)*q(is,2,ic)                 inri-063
      w(is,2)=w(is,2)+wx(1)*q(is,2,ic)+wx(2)*q(is,1,ic)                 inri-064
      w(is,3)=w(is,3)+wx(3)*q(is,3,ic)-wx(4)*q(is,4,ic)                 inri-065
    4 w(is,4)=w(is,4)+wx(3)*q(is,4,ic)+wx(4)*q(is,3,ic)                 inri-066
    5 if (l2.ge.l3) go to 12                                            inri-067
c tensor terms of coupling potentials                                   inri-068
      l2=l2+1                                                           inri-069
      do 9 is=k3,ism                                                    inri-070
      do 6 i=1,4                                                        inri-071
    6 wx(i)=0.                                                          inri-072
      do 7 k1=l2,l3                                                     inri-073
      k=nat(1,k1)                                                       inri-074
      wx(1)=wx(1)+at(2,k1)*vr(is,1,k)                                   inri-075
      wx(2)=wx(2)+at(2,k1)*vr(is,2,k)                                   inri-076
      wx(3)=wx(3)+at(3,k1)*vr(is,3,k)                                   inri-077
    7 wx(4)=wx(4)+at(3,k1)*vr(is,4,k)                                   inri-078
      if (j.gt.ic) go to 8                                              inri-079
      wx(3)=-wx(3)                                                      inri-080
      wx(4)=-wx(4)                                                      inri-081
    8 w(is,1)=w(is,1)+(wx(1)+wx(3))*q(is,3,ic)-(wx(2)+wx(4))*q(is,4,ic) inri-082
      w(is,2)=w(is,2)+(wx(1)+wx(3))*q(is,4,ic)+(wx(2)+wx(4))*q(is,3,ic) inri-083
      w(is,3)=w(is,3)+(wx(1)-wx(3))*q(is,1,ic)-(wx(2)-wx(4))*q(is,2,ic) inri-084
    9 w(is,4)=w(is,4)+(wx(1)-wx(3))*q(is,2,ic)+(wx(2)-wx(4))*q(is,1,ic) inri-085
      go to 14                                                          inri-086
c coupling potentials computed in intr                                  inri-087
   10 k1=nvi(ic,j,3)                                                    inri-088
      if (k1.eq.0) go to 12                                             inri-089
c scalar and vector terms of coupling potentials                        inri-090
      do 11 is=k3,ism                                                   inri-091
      w(is,1)=w(is,1)+ww(is,1,k1)*q(is,1,ic)-ww(is,2,k1)*q(is,2,ic)     inri-092
      w(is,2)=w(is,2)+ww(is,1,k1)*q(is,2,ic)+ww(is,2,k1)*q(is,1,ic)     inri-093
      w(is,3)=w(is,3)+ww(is,3,k1)*q(is,3,ic)-ww(is,4,k1)*q(is,4,ic)     inri-094
   11 w(is,4)=w(is,4)+ww(is,3,k1)*q(is,4,ic)+ww(is,4,k1)*q(is,3,ic)     inri-095
   12 k1=nvi(ic,j,4)                                                    inri-096
c tensor terms of coupling potentials                                   inri-097
      if (k1.eq.0) go to 14                                             inri-098
      l1=1                                                              inri-099
      if (j.lt.ic) l1=3                                                 inri-100
      l2=4-l1                                                           inri-101
      do 13 is=k3,ism                                                   inri-102
      w(is,1)=w(is,1)+ww(is,l1,k1)*q(is,3,ic)-ww(is,l1+1,k1)*q(is,4,ic) inri-103
      w(is,2)=w(is,2)+ww(is,l1,k1)*q(is,4,ic)+ww(is,l1+1,k1)*q(is,3,ic) inri-104
      w(is,3)=w(is,3)+ww(is,l2,k1)*q(is,1,ic)-ww(is,l2+1,k1)*q(is,2,ic) inri-105
   13 w(is,4)=w(is,4)+ww(is,l2,k1)*q(is,2,ic)+ww(is,l2+1,k1)*q(is,1,ic) inri-106
   14 continue                                                          inri-107
      ipi(j)=idp                                                        inri-108
c search for the first non negligible value                             inri-109
      if (idp.gt.ism) return                                            inri-110
      do 15 is=idp,ism                                                  inri-111
      if ((abs(w(is,1))+abs(w(is,2))+abs(w(is,3))+abs(w(is,4))).gt.conv)inri-112
     1 go to 16                                                         inri-113
   15 continue                                                          inri-114
   16 ipi(j)=is                                                         inri-115
      if (ipi(j).ge.ism) return                                         inri-116
      kt=max0(ipi(j),1)                                                 inri-117
c integral of the regular function with the second member               inri-118
      x(1,kt)=p(kt,2)*w(kt,2)-p(kt,1)*w(kt,1)+p(kt,6)*w(kt,4)-p(kt,5)*w(inri-119
     1kt,3)                                                             inri-120
      x(2,kt)=-p(kt,1)*w(kt,2)-p(kt,2)*w(kt,1)-p(kt,5)*w(kt,4)-p(kt,6)*winri-121
     1(kt,3)                                                            inri-122
      kkt=kt+1                                                          inri-123
      if (kt.gt.ism) go to 18                                           inri-124
      do 17 is=kkt,ism                                                  inri-125
      x(1,is)=x(1,is-1)-p(is,1)*w(is,1)+p(is,2)*w(is,2)-p(is,5)*w(is,3)+inri-126
     1p(is,6)*w(is,4)                                                   inri-127
   17 x(2,is)=x(2,is-1)-p(is,1)*w(is,2)-p(is,2)*w(is,1)-p(is,5)*w(is,4)-inri-128
     1p(is,6)*w(is,3)                                                   inri-129
c scattering coefficients                                               inri-130
   18 hx=z(3)*h                                                         inri-131
      hy=z(4)*h                                                         inri-132
      a=x(1,ism)/fam(1)-z(1)                                            inri-133
      b=x(2,ism)/fam(1)-z(2)                                            inri-134
      if (lo(92)) go to 26                                              inri-135
      ist=ism+kt                                                        inri-136
      r=h*ism                                                           inri-137
      do 19 is=kt,ism                                                   inri-138
      js=ist-is                                                         inri-139
      q(js,1,j)=(x(1,js)*p(js,3)-x(2,js)*p(js,4)-hx*p(js,1)+hy*p(js,2)-.inri-140
     15*w(js,3))/h+(v(js,5)*w(js,1)-v(js,6)*w(js,2)+w(js,3)*(xz/r+v(js,1inri-141
     23))-w(js,4)*v(js,14))/12.                                         inri-142
      q(js,2,j)=(x(1,js)*p(js,4)+x(2,js)*p(js,3)-hy*p(js,1)-hx*p(js,2)-.inri-143
     15*w(js,4))/h+(v(js,5)*w(js,2)+v(js,6)*w(js,1)+w(js,4)*(xz/r+v(js,1inri-144
     23))+w(js,3)*v(js,14))/12.                                         inri-145
      q(js,3,j)=(x(1,js)*p(js,7)-x(2,js)*p(js,8)-hx*p(js,5)+hy*p(js,6)+.inri-146
     15*w(js,1))/h+(v(js,7)*w(js,3)-v(js,8)*w(js,4)+w(js,1)*(xz/r+v(js,1inri-147
     23))-w(js,2)*v(js,14))/12.                                         inri-148
      q(js,4,j)=(x(1,js)*p(js,8)+x(2,js)*p(js,7)-hy*p(js,5)-hx*p(js,6)+.inri-149
     15*w(js,2))/h+(v(js,7)*w(js,4)+v(js,8)*w(js,3)+w(js,2)*(xz/r+v(js,1inri-150
     23))+w(js,1)*v(js,14))/12.                                         inri-151
      hx=hx+p(js,3)*w(js,1)-p(js,4)*w(js,2)+p(js,7)*w(js,3)-p(js,8)*w(jsinri-152
     1,4)                                                               inri-153
      hy=hy+p(js,3)*w(js,2)+p(js,4)*w(js,1)+p(js,7)*w(js,4)+p(js,8)*w(jsinri-154
     1,3)                                                               inri-155
   19 r=r-h                                                             inri-156
c corrections of order h**4                                             inri-157
      kt1=kt+3                                                          inri-158
      ism3=ism-3                                                        inri-159
      if (kt1.gt.ism3) go to 21                                         inri-160
      hz=h*720.                                                         inri-161
      do 20 is=kt1,ism3                                                 inri-162
      q(is,1,j)=q(is,1,j)-(45.*(w(is+1,3)-w(is-1,3))-9.*(w(is+2,3)-w(is-inri-163
     12,3))+w(is+3,3)-w(is-3,3))/hz                                     inri-164
      q(is,2,j)=q(is,2,j)-(45.*(w(is+1,4)-w(is-1,4))-9.*(w(is+2,4)-w(is-inri-165
     12,4))+w(is+3,4)-w(is-3,4))/hz                                     inri-166
      q(is,3,j)=q(is,3,j)+(45.*(w(is+1,1)-w(is-1,1))-9.*(w(is+2,1)-w(is-inri-167
     12,1))+w(is+3,1)-w(is-3,1))/hz                                     inri-168
   20 q(is,4,j)=q(is,4,j)+(45.*(w(is+1,2)-w(is-1,2))-9.*(w(is+2,2)-w(is-inri-169
     12,2))+w(is+3,2)-w(is-3,2))/hz                                     inri-170
   21 if (kt.eq.1) go to 23                                             inri-171
      k=kt-1                                                            inri-172
      do 22 is=1,k                                                      inri-173
      q(is,1,j)=-(hx*p(is,1)-hy*p(is,2))/h                              inri-174
      q(is,2,j)=-(hy*p(is,1)+hx*p(is,2))/h                              inri-175
      q(is,3,j)=-(hx*p(is,5)-hy*p(is,6))/h                              inri-176
   22 q(is,4,j)=-(hy*p(is,5)+hx*p(is,6))/h                              inri-177
   23 do 24 kt=1,ism                                                    inri-178
      if ((abs(q(kt,1,j))+abs(q(kt,2,j))+abs(q(kt,3,j))+abs(q(kt,4,j))).inri-179
     1gt.aconv) go to 25                                                inri-180
   24 continue                                                          inri-181
   25 ipi(j)=kt                                                         inri-182
      if (lo(22)) go to 26                                              inri-183
      pad1(1,kiter)=a                                                   inri-184
      pad1(2,kiter)=b                                                   inri-185
c  test of convergence                                                  inri-186
   26 lo(205)=(dabs(b-fai(1)).le.eiter.and.(dabs(a-far(1)).le.eiter))   inri-187
      if (lo(122).and.lo(204).and.kiter.gt.3.and.(.not.lo(205))) call painri-188
     1de(pad1,pad2,kiter,a,b,eiter,1.d0,0.d0,lo)                        inri-189
      lo(204)=lo(204).and.lo(205)                                       inri-190
      far(1)=a                                                          inri-191
      fai(1)=b                                                          inri-192
      if (lo(57)) write (2,1000) j,far(1),fai(1),kiter,kt               inri-193
      return                                                            inri-194
 1000 format (5x,i5,2d30.15,i10,10x,i5)                                 inri-195
      end                                                               inri-196
c 29/10/85  ibm version                                         ecis88  pade-000
      subroutine pade(r,p,mm,bre,bim,eiter,valr,vali,lo)                pade-001
c  pade approximant of type i, continued fraction                       pade-002
c input variables: r: partial taylor sums                               pade-003
c                  mm: number of components of p                        pade-004
c                  eiter: convergence criterion                         pade-005
c                  val: variable   here taken as (1.d0,0.d0)            pade-006
c                  lo: logical controls                                 pade-007
c output variables: bre,bim if convergence is obtained                  pade-008
c working field: p: at least twice as long as r                         pade-009
c***********************************************************************pade-010
      double precision r(2,1),p(2,2,1),ai,ar,zi,zr,ai1,ar1,bim,bre,vali,pade-011
     1valr,zx                                                           pade-012
      logical lo(250)                                                   pade-013
      lo(205)=.true.                                                    pade-014
      if (mm.gt.3) go to 1                                              pade-015
      lo(205)=.false.                                                   pade-016
      return                                                            pade-017
c  taylor coefficients                                                  pade-018
    1 mt=mm+1                                                           pade-019
      p(1,1,1)=r(1,1)                                                   pade-020
      p(1,2,1)=0.d0                                                     pade-021
      p(2,1,1)=r(2,1)                                                   pade-022
      p(2,2,1)=0.d0                                                     pade-023
      do 2 i=2,mm                                                       pade-024
      p(1,1,i)=r(1,i)-r(1,i-1)                                          pade-025
      p(1,2,i)=0.d0                                                     pade-026
      p(2,1,i)=r(2,i)-r(2,i-1)                                          pade-027
    2 p(2,2,i)=0.d0                                                     pade-028
c  decomposition loop                                                   pade-029
      nm=mm-1                                                           pade-030
      do 6 na=1,nm                                                      pade-031
      ml=mm-na                                                          pade-032
      zr=p(1,1,na)                                                      pade-033
      zi=p(2,1,na)                                                      pade-034
      if (dabs(zr)+dabs(zi).ge.1.d-8) go to 4                           pade-035
      p(1,2,mt-na)=0.d0                                                 pade-036
      p(2,2,mt-na)=0.d0                                                 pade-037
      do 3 j=1,ml                                                       pade-038
      p(1,1,na+j)=p(1,1,na+j)-p(1,1,na)*p(1,2,j)+p(2,1,na)*p(2,2,j)     pade-039
    3 p(2,1,na+j)=p(2,1,na+j)-p(2,1,na)*p(1,2,j)-p(1,1,na)*p(2,2,j)     pade-040
      go to 6                                                           pade-041
    4 p(1,2,mt-na)=1.d0                                                 pade-042
      do 5 j=1,ml                                                       pade-043
      zx=p(1,1,na)**2+p(2,1,na)**2                                      pade-044
      zr=(p(1,1,na+j)*p(1,1,na)+p(2,1,na+j)*p(2,1,na))/zx               pade-045
      zi=(p(2,1,na+j)*p(1,1,na)-p(1,1,na+j)*p(2,1,na))/zx               pade-046
      p(1,1,na+j)=p(1,2,j)-zr                                           pade-047
      p(2,1,na+j)=p(2,2,j)-zi                                           pade-048
      p(1,2,j)=zr                                                       pade-049
    5 p(2,2,j)=zi                                                       pade-050
    6 continue                                                          pade-051
      ar1=1.d30                                                         pade-052
c  truncated continued fractions                                        pade-053
      do 9  n=1,nm                                                      pade-054
      ip=mm+1-n                                                         pade-055
      p(1,2,n)=p(1,1,ip)                                                pade-056
      p(2,2,n)=p(2,1,ip)                                                pade-057
      do 8  i=2,ip                                                      pade-058
      id=ip+1-i                                                         pade-059
      if (p(1,2,mt-id).gt.0.d0) go to 7                                 pade-060
      ar=valr*p(1,2,n)-vali*p(2,2,n)+p(1,1,id)                          pade-061
      ai=valr*p(2,2,n)+vali*p(1,2,n)+p(2,1,id)                          pade-062
      p(1,2,n)=ar                                                       pade-063
      p(2,2,n)=ai                                                       pade-064
      go to 8                                                           pade-065
    7 ar=1.d0+valr*p(1,2,n)-vali*p(2,2,n)                               pade-066
      ai=valr*p(2,2,n)+vali*p(1,2,n)                                    pade-067
      zx=ar*ar+ai*ai                                                    pade-068
      p(1,2,n)=(p(1,1,id)*ar+p(2,1,id)*ai)/zx                           pade-069
      p(2,2,n)=(p(2,1,id)*ar-p(1,1,id)*ai)/zx                           pade-070
    8 continue                                                          pade-071
      if (n.eq.1) go to 9                                               pade-072
c search for smallest difference                                        pade-073
      zr=p(1,2,n)-p(1,2,n-1)                                            pade-074
      zi=p(2,2,n)-p(2,2,n-1)                                            pade-075
      ai1=dmax1(dabs(zr),dabs(zi))                                      pade-076
      if (ai1.ge.ar1) go to 9                                           pade-077
      nn=n                                                              pade-078
      ar1=ai1                                                           pade-079
    9 continue                                                          pade-080
      lo(205)=ar1.le.eiter                                              pade-081
      if (lo(57)) write (2,1000) lo(205),mm,nn,p(1,2,nn),p(2,2,nn),p(1,2pade-082
     1,nn-1),p(2,2,nn-1)                                                pade-083
      if ((.not.lo(205)).and.(lo(206).or.lo(23))) return                pade-084
      lo(205)=.true.                                                    pade-085
      bre=p(1,2,nn-1)                                                   pade-086
      bim=p(2,2,nn-1)                                                   pade-087
      if (nn.eq.2) return                                               pade-088
      bre=0.5d0*(bre+p(1,2,nn))                                         pade-089
      bim=0.5d0*(bim+p(2,2,nn))                                         pade-090
      return                                                            pade-091
 1000 format (5h pade,5x,l3,5x,6hiter =,i3,5x,3hn =,i3,5x,4d15.8)       pade-092
      end                                                               pade-093
c 27/04/98  ibm version                                         ecis97  inch-000
      subroutine inch(v,vi,mc,nat,at,nvi,fam,y,x,wr,wi,ism,kab,nc,ncin,ninch-001
     1ml,jsx,npp,kr,lo)                                                 inch-002
c  standard integration of the coupled  equations by the numerov method inch-003
c input variables: v,vi:    real and imaginary potentials and couplings inch-004
c                  mc(4,*): address of central potentials               inch-005
c                  nat,at:  geometrical coefficients                    inch-006
c                  nvi:     addresses in the table nat,at               inch-007
c                  fam:     matching values and constants of equations  inch-008
c                  y:       coulomb corrections                         inch-009
c                  ism:     number of radial points                     inch-010
c                  kab:     maximum number of coupled channels          inch-011
c                  nc:      number of coupled channels                  inch-012
c                  ncin:    number of solutions                         inch-013
c                  nml:     maximum number of points where the coupling inch-014
c                           potentials can be calculated at a time      inch-015
c                  jsx:     periodicity of the schmidt's orthogonalisa- inch-016
c                           tion if lo(42) is .true.                    inch-017
c                  npp:     number of optical potentials                inch-018
c                  lo(i):   logical controls                            inch-019
c output variables: scattering coefficients multiplied kf/ki            inch-020
c                  real part in x(ic,ic',5), imaginary part in          inch-021
c                  x(ic,ic',2) for incoming channel ic'                 inch-022
c working fields:  wr/i(ic,ic',is): real/imaginary coupling potentials  inch-023
c                  x(ic,ic',i): numerov recurrence                      inch-024
c                  kr:      working field for lins                      inch-025
c***********************************************************************inch-026
      double precision x(kab,kab,6),fam(kab,10),bre,bim,y(kab,kab,4)    inch-027
      dimension wr(nc,nc,1),wi(nc,nc,1),v(ism,1),vi(ism,1),mc(kab,4),nviinch-028
     1(kab,kab,2),kr(1),nat(2,1),at(2,1)                                inch-029
      logical lo(250),lt                                                inch-030
      if (lo(59)) call hora                                             inch-031
      jr=0                                                              inch-032
      n2=nc*nc                                                          inch-033
      do 3 i=1,nc                                                       inch-034
      do 2 j=1,nc                                                       inch-035
      do 1 k=1,6                                                        inch-036
    1 x(j,i,k)=0.d0                                                     inch-037
    2 continue                                                          inch-038
    3 x(i,i,3)=1.d-15                                                   inch-039
c  radial integration loop                                              inch-040
      do 31 js=1,ism                                                    inch-041
      is=mod(js-1,nml)+1                                                inch-042
      if (js.le.jr) go to 17                                            inch-043
      ji=jr+1                                                           inch-044
      jr=min0(ism,jr+nml)                                               inch-045
c the potentials are first calculated in wr(ic,ic',i) and               inch-046
c wi(ic,ic',i) starting with i=2   for ic larger or equal to ic'        inch-047
      do 10 l=1,nc                                                      inch-048
      do 9 j=l,nc                                                       inch-049
      m=j+(l-1)*nc                                                      inch-050
      n=m                                                               inch-051
      do 4 i=ji,jr                                                      inch-052
      n=n+n2                                                            inch-053
      wr(n,1,1)=0.                                                      inch-054
    4 wi(n,1,1)=0.                                                      inch-055
      if (l.ne.j) go to 6                                               inch-056
c optical model contribution                                            inch-057
      n=m                                                               inch-058
      i1=mc(l,4)                                                        inch-059
      i2=i1+npp                                                         inch-060
      do 5 i=ji,jr                                                      inch-061
      n=n+n2                                                            inch-062
      bre=i*i                                                           inch-063
      wr(n,1,1)=fam(l,9)-fam(l,10)/bre+fam(l,7)*v(i,i1)                 inch-064
      wi(n,1,1)=fam(l,7)*vi(i,i1)                                       inch-065
      if (lo(229)) wr(n,1,1)=wr(n,1,1)+fam(l,8)*v(i,i2)                 inch-066
      if (lo(230)) wi(n,1,1)=wi(n,1,1)+fam(l,8)*vi(i,i2)                inch-067
    5 continue                                                          inch-068
c coupled channel contribution                                          inch-069
    6 k1=nvi(j,l,1)                                                     inch-070
      k2=nvi(j,l,2)                                                     inch-071
      if (k1.gt.k2) go to 9                                             inch-072
      do 8 k=k1,k2                                                      inch-073
      kt=iabs(nat(1,k))                                                 inch-074
      lt=kt.ne.nat(1,k)                                                 inch-075
      n=m                                                               inch-076
      do 7 i=ji,jr                                                      inch-077
      n=n+n2                                                            inch-078
      wr(n,1,1)=wr(n,1,1)+at(2,k)*v(i,kt)                               inch-079
      if (lt) wi(n,1,1)=wi(n,1,1)+at(2,k)*vi(i,kt)                      inch-080
    7 continue                                                          inch-081
    8 continue                                                          inch-082
    9 continue                                                          inch-083
   10 continue                                                          inch-084
      jj=jr-ji+1                                                        inch-085
      do 16 i=1,jj                                                      inch-086
      j=i+1                                                             inch-087
c symmetrisation of old values                                          inch-088
      do 12 k=1,nc                                                      inch-089
      do 11 l=k,nc                                                      inch-090
      wr(k,l,j)=wr(l,k,j)                                               inch-091
   11 wi(k,l,j)=wi(l,k,j)                                               inch-092
   12 continue                                                          inch-093
c computation of v +v*v/12. for l larger or equal to k                  inch-094
      do 15 k=1,nc                                                      inch-095
      do 14 l=k,nc                                                      inch-096
      bre=0.d0                                                          inch-097
      bim=0.d0                                                          inch-098
      do 13 n=1,nc                                                      inch-099
      bre=bre-wr(n,k,j)*wr(n,l,j)+wi(n,k,j)*wi(n,l,j)                   inch-100
   13 bim=bim-wi(n,k,j)*wr(n,l,j)-wr(n,k,j)*wi(n,l,j)                   inch-101
c symmetrisation                                                        inch-102
      wr(l,k,i)=wr(l,k,j)+bre/12.d0                                     inch-103
      wi(l,k,i)=wi(l,k,j)+bim/12.d0                                     inch-104
      wr(k,l,i)=wr(l,k,i)                                               inch-105
   14 wi(k,l,i)=wi(l,k,i)                                               inch-106
      if (lo(30)) wr(k,k,i)=wr(k,k,i)+wr(k,k,j)**3/360.                 inch-107
   15 continue                                                          inch-108
   16 continue                                                          inch-109
   17 do 24 i=1,nc                                                      inch-110
      do 18 j=1,nc                                                      inch-111
      x(i,j,1)=x(i,j,2)                                                 inch-112
      x(i,j,2)=x(i,j,3)                                                 inch-113
      x(i,j,4)=x(i,j,5)                                                 inch-114
   18 x(i,j,5)=x(i,j,6)                                                 inch-115
   19 do 21 j=1,nc                                                      inch-116
      hx=0.                                                             inch-117
      hy=0.                                                             inch-118
      do 20 k=1,nc                                                      inch-119
      hx=hx+wr(k,j,is)*sngl(x(i,k,2))-wi(k,j,is)*sngl(x(i,k,5))         inch-120
   20 hy=hy+wi(k,j,is)*sngl(x(i,k,2))+wr(k,j,is)*sngl(x(i,k,5))         inch-121
      x(i,j,3)=x(i,j,2)+x(i,j,2)-x(i,j,1)-dble(hx)                      inch-122
   21 x(i,j,6)=x(i,j,5)+x(i,j,5)-x(i,j,4)-dble(hy)                      inch-123
      if (dabs(x(i,i,3)).lt.1.d15) go to 24                             inch-124
      do 23 ji=1,6                                                      inch-125
      do 22 ij=1,nc                                                     inch-126
   22 x(i,ij,ji)=x(i,ij,ji)*1.d-30                                      inch-127
   23 continue                                                          inch-128
      go to 19                                                          inch-129
   24 continue                                                          inch-130
      if (lo(142).or.mod(js,jsx).ne.0.or.js.eq.ism) go to 31            inch-131
c  schmidt orthogonalisation procedure every jsx steps                  inch-132
      do 30 i=1,nc                                                      inch-133
      if (i.eq.1) go to 28                                              inch-134
      in=i-1                                                            inch-135
      do 27 k=1,in                                                      inch-136
      x(i,k,1)=0.d0                                                     inch-137
      x(i,k,4)=0.d0                                                     inch-138
      do 25 j=1,nc                                                      inch-139
      x(i,k,1)=x(i,k,1)+x(k,j,2)*x(i,j,2)-x(k,j,5)*x(i,j,5)             inch-140
   25 x(i,k,4)=x(i,k,4)+x(k,j,5)*x(i,j,2)+x(k,j,2)*x(i,j,5)             inch-141
      bre=x(i,k,1)*x(k,k,1)-x(i,k,4)*x(k,k,4)                           inch-142
      bim=x(i,k,1)*x(k,k,4)+x(i,k,4)*x(k,k,1)                           inch-143
      do 26 j=1,nc                                                      inch-144
      x(i,j,2)=x(i,j,2)-bre*x(k,j,2)+bim*x(k,j,5)                       inch-145
      x(i,j,5)=x(i,j,5)-bre*x(k,j,5)-bim*x(k,j,2)                       inch-146
      x(i,j,3)=x(i,j,3)-bre*x(k,j,3)+bim*x(k,j,6)                       inch-147
   26 x(i,j,6)=x(i,j,6)-bre*x(k,j,6)-bim*x(k,j,3)                       inch-148
   27 continue                                                          inch-149
   28 bre=0.d0                                                          inch-150
      bim=0.d0                                                          inch-151
      do 29 j=1,nc                                                      inch-152
      bre=bre+x(i,j,2)**2-x(i,j,5)**2                                   inch-153
   29 bim=bim+2.d0*x(i,j,2)*x(i,j,5)                                    inch-154
      bim=bim/bre                                                       inch-155
      x(i,i,1)=1.d0/(bre*(1.d0+bim**2))                                 inch-156
   30 x(i,i,4)=-x(i,i,1)*bim                                            inch-157
   31 continue                                                          inch-158
      if (lo(59)) call hora                                             inch-159
c  matrices of pseudo-wronskians for the matching condition             inch-160
      do 33 i=1,nc                                                      inch-161
      do 32 j=1,nc                                                      inch-162
      j1=nc+j                                                           inch-163
      x(i,j1,1)=(x(i,j,1)*fam(j,2)-fam(j,1)*x(i,j,3))                   inch-164
      x(i,j1,4)=(x(i,j,6)*fam(j,1)-fam(j,2)*x(i,j,4))                   inch-165
      x(i,j,1)=(x(i,j,3)*fam(j,3)-fam(j,4)*x(i,j,1))                    inch-166
      x(i,j,4)=(x(i,j,4)*fam(j,4)-fam(j,3)*x(i,j,6))                    inch-167
      if (fam(j,9).lt.0.d0) go to 32                                    inch-168
      x(i,j,1)=x(i,j,1)-x(i,j1,4)                                       inch-169
      x(i,j,4)=x(i,j,4)+x(i,j1,1)                                       inch-170
   32 continue                                                          inch-171
   33 continue                                                          inch-172
c  complex linear system of equations                                   inch-173
      ncx=ncin                                                          inch-174
      if (lo(44)) ncx=nc                                                inch-175
      call lins(x(1,1,4),kab,x,kab,nc,ncx,kr,ier)                       inch-176
      if (ier.ne.0) go to 39                                            inch-177
      if (lo(144)) return                                               inch-178
c building the linear system for s-matrix with coulomb corrections      inch-179
      do 36 i=1,nc                                                      inch-180
      do 35 j=1,nc                                                      inch-181
      j1=nc+j                                                           inch-182
      x(i,j,1)=y(j,i,1)                                                 inch-183
      x(i,j,3)=x(i,j1,1)                                                inch-184
      x(i,j,4)=y(j,i,2)                                                 inch-185
      x(i,j,6)=-y(j,i,1)+x(i,j1,4)                                      inch-186
      do 34 k=1,nc                                                      inch-187
      k1=k+nc                                                           inch-188
      x(i,j,1)=x(i,j,1)-(y(j,k,1)-y(j,k,4))*x(i,k1,1)+(y(j,k,3)+y(j,k,2)inch-189
     1)*x(i,k1,4)                                                       inch-190
      x(i,j,3)=x(i,j,3)-y(j,k,3)*x(i,k1,1)-y(j,k,1)*x(i,k1,4)           inch-191
      x(i,j,4)=x(i,j,4)-(y(j,k,1)-y(j,k,4))*x(i,k1,4)-(y(j,k,2)+y(j,k,3)inch-192
     1)*x(i,k1,1)                                                       inch-193
   34 x(i,j,6)=x(i,j,6)-y(j,k,3)*x(i,k1,4)+y(j,k,1)*x(i,k1,1)           inch-194
   35 continue                                                          inch-195
   36 x(i,i,4)=x(i,i,4)+1.d0                                            inch-196
c transfer of the second members in x(1,1,5) and x(1,1,2)               inch-197
      do 38 i=1,nc                                                      inch-198
      do 37 j=1,nc                                                      inch-199
      j1=nc+j                                                           inch-200
      y(i,j,2)=x(i,j1,1)                                                inch-201
      x(i,j1,1)=x(i,j,3)                                                inch-202
      y(i,j,1)=x(i,j1,4)                                                inch-203
   37 x(i,j1,4)=x(i,j,6)                                                inch-204
   38 continue                                                          inch-205
      call lins(x(1,1,4),kab,x,kab,nc,ncin,kr,ier)                      inch-206
      if (ier.ne.0) go to 39                                            inch-207
      if (lo(57)) write (2,1000) ((i,j,y(i,j,1),y(i,j,2),x(i,nc+j,4),x(iinch-208
     1,nc+j,1),j=1,ncin),i=1,nc)                                        inch-209
      return                                                            inch-210
   39 write (2,1001) ier                                                inch-211
      stop                                                              inch-212
 1000 format (/25x,18huncorrected values,30x,16hcorrected values/(2x,2i3inch-213
     1,4d25.15))                                                        inch-214
 1001 format (28h return from lins with ier =,i2,23h in inch   ... stop inch-215
     1...)                                                              inch-216
      end                                                               inch-217
c 29/10/85  ibm version                                         ecis88  lins-000
      subroutine lins(a,ia,b,ib,na,m,k,ier)                             lins-001
c lins: jlsb2 version 01 18/12/68 math l003 de saclay                   lins-002
c solution of double precision complex linear systems with real and     lins-003
c imaginary parts in different arrays                                   lins-004
c     a real component of matrix and second members                     lins-005
c     b imaginary component of matrix and second members                lins-006
c second members are replaced by solutions                              lins-007
c     ia first dimension of array a                                     lins-008
c     ib first dimension of array b                                     lins-009
c     na order of the system                                            lins-010
c     m  number of second members                                       lins-011
c     k  working field of dimension >/= na                              lins-012
c     ier returns diagnostic 0 non singular matrix                      lins-013
c                            1 singular matrix                          lins-014
c                            2 quasi singular matrix                    lins-015
c***********************************************************************lins-016
      implicit real*8 (a-h,o-z)                                         lins-017
      dimension a(ia,1),k(1),b(ib,1)                                    lins-018
      ier=0                                                             lins-019
      n=na                                                              lins-020
      ndeb=n+1                                                          lins-021
      nm=n+m                                                            lins-022
      do 1 i=1,n                                                        lins-023
    1 k(i)=i                                                            lins-024
      do 11 i=1,n                                                       lins-025
      amax=dabs(a(i,i))+dabs(b(i,i))                                    lins-026
      jmax=i                                                            lins-027
      i1=i+1                                                            lins-028
      if (i.eq.n) go to 3                                               lins-029
      do 2 j=i1,n                                                       lins-030
      amay=dabs(a(i,j))+dabs(b(i,j))                                    lins-031
      if (amax.ge.amay) go to 2                                         lins-032
      amax=amay                                                         lins-033
      jmax=j                                                            lins-034
    2 continue                                                          lins-035
    3 if (amax.eq.0.) go to 18                                          lins-036
      if (jmax.eq.i) go to 5                                            lins-037
      do 4 i2=1,n                                                       lins-038
      aux=b(i2,i)                                                       lins-039
      b(i2,i)=b(i2,jmax)                                                lins-040
      b(i2,jmax)=aux                                                    lins-041
      aux=a(i2,i)                                                       lins-042
      a(i2,i)=a(i2,jmax)                                                lins-043
    4 a(i2,jmax)=aux                                                    lins-044
      nab=k(jmax)                                                       lins-045
      k(jmax)=k(i)                                                      lins-046
      k(i)=nab                                                          lins-047
    5 if (i.eq.1) go to 7                                               lins-048
      sr=0.d0                                                           lins-049
      si=0.d0                                                           lins-050
      t=0.d0                                                            lins-051
      in=i-1                                                            lins-052
      do 6 it=1,in                                                      lins-053
      pr=a(it,i)*a(i,it)-b(it,i)*b(i,it)                                lins-054
      pi=a(it,i)*b(i,it)+a(i,it)*b(it,i)                                lins-055
      sr=sr+pr                                                          lins-056
      si=si+pi                                                          lins-057
    6 t=t+dabs(pr)+dabs(pi)                                             lins-058
      era=1.d-16*(t+dabs(a(i,i)-sr)+dabs(b(i,i)-si))                    lins-059
      if (amax.gt.era) go to 7                                          lins-060
      ier=2                                                             lins-061
      write (2,1000)                                                    lins-062
      go to 19                                                          lins-063
    7 do 8 j=i1,nm                                                      lins-064
      aa=a(i,j)                                                         lins-065
      bb=b(i,j)                                                         lins-066
      ai=a(i,i)                                                         lins-067
      bi=b(i,i)                                                         lins-068
      d=ai*ai+bi*bi                                                     lins-069
      a(i,j)=(aa*ai+bb*bi)/d                                            lins-070
    8 b(i,j)=(bb*ai-aa*bi)/d                                            lins-071
      if (i.eq.n) go to 11                                              lins-072
      do 10 i3 =i1,n                                                    lins-073
      do 9 j3 =i1,nm                                                    lins-074
      b(i3,j3)=b(i3,j3)-a(i3,i)*b(i,j3)-b(i3,i)*a(i,j3)                 lins-075
    9 a(i3,j3)=a(i3,j3)-a(i3,i)*a(i,j3)+b(i3,i)*b(i,j3)                 lins-076
   10 continue                                                          lins-077
   11 continue                                                          lins-078
      if (n.eq.1) go to 19                                              lins-079
      do 14 kc=ndeb,nm                                                  lins-080
      j=n                                                               lins-081
   12 i=j-1                                                             lins-082
   13 a(i,kc)=a(i,kc)-a(j,kc)*a(i,j)+b(j,kc)*b(i,j)                     lins-083
      b(i,kc)=b(i,kc)-a(j,kc)*b(i,j)-b(j,kc)*a(i,j)                     lins-084
      i=i-1                                                             lins-085
      if (i.ne.0) go to 13                                              lins-086
      j=j-1                                                             lins-087
      if (j.ne.1) go to 12                                              lins-088
   14 continue                                                          lins-089
      do 17 i=1,n                                                       lins-090
   15 j=k(i)                                                            lins-091
      if (j.le.i) go to 17                                              lins-092
      k(i)=k(j)                                                         lins-093
      k(j)=j                                                            lins-094
      do 16 mp=ndeb,nm                                                  lins-095
      aux=b(j,mp)                                                       lins-096
      b(j,mp)=b(i,mp)                                                   lins-097
      b(i,mp)=aux                                                       lins-098
      aux=a(j,mp)                                                       lins-099
      a(j,mp)=a(i,mp)                                                   lins-100
   16 a(i,mp)=aux                                                       lins-101
      go to 15                                                          lins-102
   17 continue                                                          lins-103
      go to 19                                                          lins-104
   18 ier=1                                                             lins-105
      write(6,1001)                                                     lins-106
   19 return                                                            lins-107
 1000 format (41h *****  lins  ***** quasi singular matrix)             lins-108
 1001 format (41h *****  lins  *****       singular matrix)             lins-109
      end                                                               lins-110
c 14/04/99  ibm version                                         ecis97  scam-000
      subroutine scam(f,fcn,tx,gcn,jmax,kmax,mc,cc,md,cd,far,fai,wv,ncolscam-001
     1l,ncols,kab,kba,ipi,ipim,gam,fiss,tl,ncj,xd,p,q,v,nct,iq,aa,kbc,idscam-002
     2t,lo)                                                             scam-003
c storage of scattering coefficients                                    scam-004
c  input variables:jmax: maximum number of channel spins, dim. for f    scam-005
c                  kmax: max. num. of l of comp. nuc., dim. for fcn, gcnscam-006
c                  mc,cc:equivalent by call: nuclear state numbers      scam-007
c                        angular momenta, etc... see quan               scam-008
c                  md,cd:extended mc/cc for ident. part. with spin      scam-009
c                  far/fai: real/imaginary part of scattering coeff.    scam-010
c                  wv:   wave number and coulomb parameter.  see colf   scam-011
c                  ncoll:number of coupled levels                       scam-012
c                  ncols:number of levels with angular distribution     scam-013
c                  kab:  dimension for mc,cc                            scam-014
c                  kba:  number of independent amplitudes               scam-015
c                  ipi,ipim: parity, multipl., addresses in f (see calx)scam-016
c                  gam:  gamma transmission coefficients read           scam-017
c                  fiss: fission coefficients for compound nucleus      scam-018
c                  tl:   transmission coefficients of uncoupled levels  scam-019
c                  ncj:  starting and final addresses for continua      scam-020
c                  xd:   energy and spin dependence of level densities  scam-021
c                  nct:  number of equa. and solutions for each parity  scam-022
c                  iq:   dimension for v                                scam-023
c                  aa:   coefficients of symmetrisation                 scam-024
c                  kbc:  dimension for aa                               scam-025
c                  idt:  size available for the q in double precision   scam-026
c                  lo:   logical controls                               scam-027
c by common /ncomp/ncont:number of continua for compound nucleus        scam-028
c                  bz1,bz2,bz3: parameter for compound nucleus (see des-scam-029
c                    cription of input. for the others see conu         scam-030
c by common /noequ/nic:  number of coupled channels                     scam-031
c                  nci:  number of solutions                            scam-032
c                  nc:   number of equations without antisymmetrisation scam-033
c                  ncin: number of solutions without antisymmetrisation scam-034
c                  jpi:  channel parity (0/1)                           scam-035
c                  ipj:  number of the channel spin                     scam-036
c                  aj:   channel spin                                   scam-037
c by common /dblpr/xz:   conversion factor to millibarns                scam-038
c output variables:f:    scattering coefficients                        scam-039
c                  fcn:  compound nucleus contributions                 scam-040
c                  tx:   total reaction cross section in mb followed by scam-041
c                        the total direct cross sections of coupled     scam-042
c                        levels, the total compound cross sections of   scam-043
c                        levels, the fission and gamma cross sections   scam-044
c                  gcn:  compound nucleus coefficients of legendre poly.scam-045
c in common /noequ/r1:   maximum of scattering and compound coefficient scam-046
c working space:   p:    for diagonalisation of the s matrix            scam-047
c                  q:    for angular distribution of compound nucleus   scam-048
c                  v(1,*):   level and quantum numbers                  scam-049
c                  v(2,*):   weigh for continua                         scam-050
c                  v(3,*):   transmission coefficients                  scam-051
c                  v(4,*):   width fluctuation parameter                scam-052
c                  v(5...*): contribution to compound nucleus           scam-053
c***********************************************************************scam-054
      implicit real*8 (a-h,o-z)                                         scam-055
      logical lo(250),lg(2)                                             scam-056
      real*4 cc,cd,r1,gam,fiss,acn1,acn2,az,bz1,bz2,bz3,tg0,bn,fnug,egd,scam-057
     1ggd,tg1,sgsq,aj                                                   scam-058
      dimension f(2,jmax,1),fcn(kmax,1),mc(kab,2),cc(kab,3),md(kab,2),cdscam-059
     1(kab,3),far(kab,1),fai(kab,1),wv(15,1),ipi(10,1),ipim(10,1),gam(1)scam-060
     2,fiss(2,1),tl(1),ncj(2,1),xd(3,1),p(nc,nc,4),q(1),v(iq,1),nct(6),ascam-061
     3a(kbc,1),gcn(kmax,1),tx(1),ip(2),x(20),w(20),tp(20),sgf(2),tg(2),fscam-062
     4nu(2),al(2)                                                       scam-063
      common /ncomp/ nsp(3),nfiss,nrd,ncont,ncoj,acn1,acn2,ncons,nie,ncoscam-064
     1lx,ndp,ndq,az(6),bz1,bz2,bz3,tg0,bn,fnug,egd,ggd,tg1,sgsq         scam-065
      common /noequ/ ncxn,nic,nci,nc,ncin,nin,jpi,ipj,aj,r1(2)          scam-066
      common /dblpr/ chi2,chi2m,cm,ck,chb,cmb,ccz,xe,xm,xn,xz           scam-067
      data ip,al,pi,nsy /1h+,1h-,8h fission,8h   gamma,3.1415926535d0,0/scam-068
      data x /7.0539889691988753d-02,3.7212681800161144d-01,9.1658210248scam-069
     1327356d-01,1.7073065310283439d+00,2.7491992553094321d+00,4.0489253scam-070
     2138508869d+00,5.6151749708616165d+00,7.4590174536710633d+00,9.5943scam-071
     3928695810968d+00,1.2038802546964316d+01,1.4814293442630740d+01,1.7scam-072
     4948895520519376d+01,2.1478788240285011d+01,2.5451702793186906d+01,scam-073
     52.9932554631700612d+01,3.5013434240479000d+01,4.0833057056728571d+scam-074
     601,4.7619994047346502d+01,5.5810795750063899d+01,6.652441652561575scam-075
     74d+01/                                                            scam-076
      data w /1.8108006241898926d-01,4.2255676787856397d-01,6.6690954670scam-077
     1184815d-01,9.1535237278307367d-01,1.1695397071955460d+00,1.4313549scam-078
     2859282060d+00,1.7029811379850227d+00,1.9870158907927472d+00,2.2866scam-079
     3357812534308d+00,2.6058347275538333d+00,2.9497837342139509d+00,3.3scam-080
     4253957820093196d+00,3.7422554705898109d+00,4.2142367102518804d+00,scam-081
     54.7625184614902093d+00,5.4217260442455743d+00,6.2540123569324213d+scam-082
     600,7.3873143890544346d+00,9.1513287309874796d+00,1.289338864593999scam-083
     77d+01/                                                            scam-084
      ik(i,l,j)=((j-iaj+ipi(3,i)-1)/2*ipi(2,i)+(l-j+ipi(2,i)-1)/2)/2    scam-085
      nz=mod(ipj+jpi+1,2)                                               scam-086
      ns=0                                                              scam-087
      if (nz.ne.0) ns=nct(1)*nct(3)                                     scam-088
      r1(1)=0.                                                          scam-089
      r1(2)=0.                                                          scam-090
      jc=nc                                                             scam-091
      iaj=2*aj+.1                                                       scam-092
      bz=1.d0                                                           scam-093
      if (lo(18)) bz=2.d0                                               scam-094
      rz=pi*bz*xz*(iaj+1)                                               scam-095
      if (lo(55)) write (2,1000) aj,ip(jpi+1),nc,ncin                   scam-096
c computation of transmission coefficients                              scam-097
      nxx=ncin                                                          scam-098
      if (lo(224)) nxx=nc                                               scam-099
      do 5 ic=1,nxx                                                     scam-100
      iv=mc(ic,1)                                                       scam-101
      if (.not.lo(224)) go to 2                                         scam-102
      v(1,ic)=1.d3*dfloat(1000*iv+mc(ic,2))+cc(ic,3)                    scam-103
      v(2,ic)=1.d0                                                      scam-104
      do 1 n=3,iq                                                       scam-105
    1 v(n,ic)=0.d0                                                      scam-106
      if (wv(3,iv).lt.0.d0) go to 5                                     scam-107
      v(3,ic)=4.d0*fai(ic,ic)                                           scam-108
    2 do 4 icp=1,nc                                                     scam-109
      ivq=mc(icp,1)                                                     scam-110
      a1=wv(6,ivq)/wv(6,iv)                                             scam-111
      if (lo(225)) a1=1.d0/a1                                           scam-112
      far(icp,ic)=far(icp,ic)*a1                                        scam-113
      fai(icp,ic)=fai(icp,ic)*a1                                        scam-114
      if (ic.gt.ncin) go to 3                                           scam-115
c test of convergence                                                   scam-116
      r1(1)=amax1(r1(1),sngl(dabs(far(icp,ic))+dabs(fai(icp,ic))))      scam-117
      a1=far(icp,ic)*far(icp,ic)+fai(icp,ic)*fai(icp,ic)                scam-118
      if (a1.gt.1.d0) write (2,1001) aj,ip(jpi+1),nc,ncin,ic,icp,far(icpscam-119
     1,ic),fai(icp,ic)                                                  scam-120
      tx(ivq+1)=tx(ivq+1)+4.d0*a1*rz*bz                                 scam-121
      if (lo(155)) go to 3                                              scam-122
c print out of the amplitudes                                           scam-123
      a1=sqrt(a1)                                                       scam-124
      b1=0.d0                                                           scam-125
      if (a1.ne.0.) b1=atan2(fai(icp,ic),far(icp,ic))                   scam-126
      write (2,1002) icp,ic,ivq,mc(icp,2),cc(icp,3),far(icp,ic),fai(icp,scam-127
     1ic),a1,b1                                                         scam-128
    3 if (wv(3,ivq).lt.0.d0) go to 4                                    scam-129
      if (lo(224)) v(3,ic)=v(3,ic)-4.d0*(far(icp,ic)**2+fai(icp,ic)**2) scam-130
    4 continue                                                          scam-131
      if (ic.le.ncin) tx(1)=tx(1)+4.d0*fai(ic,ic)*rz*bz                 scam-132
    5 continue                                                          scam-133
      if (lo(163)) go to 7                                              scam-134
      if (lo(55)) write (2,1003) aj,ip(jpi+1)                           scam-135
      ic=1+(nc-1)/4                                                     scam-136
      do 6 i=1,ic                                                       scam-137
      j1=1+4*(i-1)                                                      scam-138
      j2=min0(nc,j1+3)                                                  scam-139
      write (2,1004) (mc(j,1),mc(j,2),cc(j,3),v(3,j),j=j1,j2)           scam-140
    6 write (7,1004) (mc(j,1),mc(j,2),cc(j,3),v(3,j),j=j1,j2)           ak000000
c   6 write (7,1005) aj,ip(jpi+1),i,(v(3,j),j=j1,j2)                    scam-141
    7 if (lo(232)) go to 70                                             scam-142
      nss=ns                                                            scam-143
      if (nz.ne.0) nss=nct(5)*nct(3)                                    scam-144
      tg(1)=0.d0                                                        scam-145
      fnu(1)=.5d0                                                       scam-146
      if (lo(186)) go to 8                                              scam-147
      kn=2*ipj+jpi-1                                                    scam-148
      if (kn.ge.nfiss) go to 8                                          scam-149
      tg(1)=fiss(1,kn)                                                  scam-150
      fnu(1)=.5*fiss(2,kn)                                              scam-151
    8 lg(1)=lo(185).or.tg(1).eq.0.                                      scam-152
      tg(2)=0.d0                                                        scam-153
      fnu(2)=.5*fnug                                                    scam-154
      if (lo(186)) go to 11                                             scam-155
      if (nrd.ne.0) go to 10                                            scam-156
      a1=0.d0                                                           scam-157
      n1=iaj-2                                                          scam-158
      n1=iabs(n1)                                                       scam-159
      n2=iaj+2                                                          scam-160
      do 9 j=n1,n2,2                                                    scam-161
      a2=-dfloat((j+1)*(j+1))/(4.d0*sgsq)                               scam-162
    9 a1=a1+dexp(a2)*dfloat(j+1)/sgsq                                   scam-163
      tg(2)=6.283185307d0*tg1*a1                                        scam-164
      go to 11                                                          scam-165
   10 if (ipj.le.nrd) tg(2)=gam(ipj)                                    scam-166
   11 lg(2)=lo(186).or.tg(2).eq.0.                                      scam-167
      nc1=jc                                                            scam-168
      if (ncoll.eq.ncolx) go to 23                                      scam-169
      nsp1=ncolx-ncoll-ncont                                            scam-170
      if (nsp1.lt.1) go to 16                                           scam-171
      do 15 i=1,nsp1                                                    scam-172
      ii=i+ncoll                                                        scam-173
      if (wv(3,ii).lt.0.d0) go to 15                                    scam-174
      nm=ipi(3,ii)                                                      scam-175
      mn=ipi(2,ii)                                                      scam-176
      do 14 j=1,nm                                                      scam-177
      nn=iaj-nm-1+2*j                                                   scam-178
      if (nn.lt.iabs(nm-1-iaj)) go to 14                                scam-179
      do 13 k=1,mn                                                      scam-180
      mm=nn+mn+1-2*k                                                    scam-181
      if (mm.lt.iabs(mn-1-nn).or.mm.ge.2*ipi(9,ii)+2) go to 13          scam-182
      l=mm/2                                                            scam-183
      if (mod(l+jpi+ipi(1,ii),2).ne.0) go to 13                         scam-184
      m=mn*l+k+ipi(7,ii)                                                scam-185
      fj=nn                                                             scam-186
      jc=jc+1                                                           scam-187
      v(1,jc)=1.d3*dfloat(1000*ii+l)+0.5d0*fj                           scam-188
      v(2,jc)=1.d0                                                      scam-189
      v(3,jc)=tl(m)                                                     scam-190
      do 12 n=4,iq                                                      scam-191
   12 v(n,jc)=0.d0                                                      scam-192
   13 continue                                                          scam-193
   14 continue                                                          scam-194
      if (ii.le.ncols) nc1=jc                                           scam-195
   15 continue                                                          scam-196
   16 if (ncont.eq.0) go to 23                                          scam-197
      do 22 i=1,ncont                                                   scam-198
      ij=ncj(1,i)                                                       scam-199
      ji=ncj(2,i)                                                       scam-200
      if (ij.gt.ji) go to 22                                            scam-201
      mn=ipim(2,ij)                                                     scam-202
      it=mod(ipim(3,ij)+1,2)                                            scam-203
      do 21 ii=ij,ji                                                    scam-204
      l=ipim(9,ii)+1                                                    scam-205
      if (l.eq.0) go to 21                                              scam-206
      m=ipim(7,ii)                                                      scam-207
      ii1=ii+ncoll+nsp1                                                 scam-208
      do 20 lj=1,l                                                      scam-209
      do 19 jl=1,mn                                                     scam-210
      m=m+1                                                             scam-211
      if (tl(m).eq.0.d0) go to 19                                       scam-212
      jj=2*(lj+jl)-mn-3                                                 scam-213
      if (jj.lt.0) go to 19                                             scam-214
      ikm=iabs(jj-iaj)/2+1                                              scam-215
      ikp=min0((jj+iaj)/2+1,ncoj)                                       scam-216
      if (ikm.gt.ikp) go to 19                                          scam-217
      ai=0.d0                                                           scam-218
      do 17 kk=ikm,ikp                                                  scam-219
      ar=.5d0*dfloat(it+2*kk-1)                                         scam-220
   17 ai=ai+ar*dexp(-ar*ar/xd(3,ii))/xd(3,ii)                           scam-221
      fj=jj                                                             scam-222
      jc=jc+1                                                           scam-223
      v(1,jc)=1.d3*dfloat(1000*ii1+(lj-1))+0.5d0*fj                     scam-224
      v(2,jc)=ai*xd(1,ii)                                               scam-225
      v(3,jc)=tl(m)                                                     scam-226
      do 18 n=4,iq                                                      scam-227
   18 v(n,jc)=0.d0                                                      scam-228
   19 continue                                                          scam-229
   20 continue                                                          scam-230
   21 continue                                                          scam-231
   22 continue                                                          scam-232
c compound nucleus                                                      scam-233
   23 sgf(1)=0.d0                                                       scam-234
      sgf(2)=0.d0                                                       scam-235
      if (lo(82)) go to 63                                              scam-236
      if (lo(83)) go to 27                                              scam-237
c computation of satchler p-matrix ('pr','pi')                          scam-238
      do 26 i=1,nc                                                      scam-239
      do 25 j=1,nc                                                      scam-240
      p(i,j,1)=2.d0*(fai(i,j)+fai(j,i))                                 scam-241
      p(i,j,2)=0.d0                                                     scam-242
      p(i,j,3)=0.d0                                                     scam-243
      p(i,j,4)=0.d0                                                     scam-244
      do 24 k=1,nc                                                      scam-245
      p(i,j,1)=p(i,j,1)-4.d0*(far(i,k)*far(j,k)+fai(i,k)*fai(j,k))      scam-246
   24 p(i,j,2)=p(i,j,2)+4.d0*(far(i,k)*fai(j,k)-fai(i,k)*far(j,k))      scam-247
   25 continue                                                          scam-248
   26 p(i,i,3)=1.d0                                                     scam-249
      call diag(nc,nc,p,p(1,1,2),p(1,1,3),p(1,1,4),1.d-12,a1,ierr)      scam-250
      if (ierr.eq.0) go to 27                                           scam-251
      write (2,1006)                                                    scam-252
      lo(83)=.true.                                                     scam-253
      lo(183)=.false.                                                   scam-254
   27 bir=1.d-12+tg(1)+tg(2)                                            scam-255
      do 28 ic=1,jc                                                     scam-256
      if (lo(183).and.ic.le.nc) v(3,ic)=p(ic,ic,1)                      scam-257
      if (v(3,ic).lt.1d-20) v(3,ic)=1d-20                               scam-258
   28 bir=bir+v(3,ic)*v(2,ic)                                           scam-259
c fluctuation parameter nu=2*fnu, (p.a.m.,n.p.a344(1980)185)            scam-260
c common factor 'tp' of width fluct. integral (p.a.m.,prc 11(1975)426)  scam-261
      if (lo(87).or.(bir.lt.0.0001)) go to 38                           scam-262
      do 29 m=1,20                                                      scam-263
   29 tp(m)=1.d0                                                        scam-264
      if (bz2.ne.0.) go to 31                                           scam-265
      efb=dexp(-0.228d0*bir)                                            scam-266
      do 30 ic=1,jc                                                     scam-267
      v(4,ic)=0.5d0                                                     scam-268
      if (v(3,ic).gt.1d-6) v(4,ic)=(1.78+(v(3,ic)**1.212-0.78)*efb)/2.  scam-269
   30 continue                                                          scam-270
      go to 33                                                          scam-271
   31 do 32 ic=1,jc                                                     scam-272
   32 v(4,ic)=0.5d0*bz2                                                 scam-273
   33 do 35 ic=1,jc                                                     scam-274
      do 34 m=1,20                                                      scam-275
   34 tp(m)=tp(m)*((bir+x(m)*v(3,ic)/v(4,ic))/bir)**(v(4,ic)*v(2,ic))   scam-276
   35 continue                                                          scam-277
      do 37 i=1,2                                                       scam-278
      if (lg(i)) go to 37                                               scam-279
      do 36 m=1,20                                                      scam-280
   36 tp(m)=tp(m)*(1.d0+x(m)*tg(i)/(bir*fnu(i)))**fnu(i)                scam-281
   37 continue                                                          scam-282
c storage of compound terms                                             scam-283
   38 tq=0.d0                                                           scam-284
      if (lo(156)) go to 40                                             scam-285
      if (lo(83)) go to 39                                              scam-286
      write (2,1007) aj,ip(jpi+1)                                       scam-287
      go to 40                                                          scam-288
   39 write (2,1008) aj,ip(jpi+1)                                       scam-289
   40 ncx=nc                                                            scam-290
      if (lo(83)) ncx=ncin                                              scam-291
      do 61 ic=1,ncx                                                    scam-292
      g=1.d0                                                            scam-293
      bri=bir                                                           scam-294
      if (lo(87).and.(ic.le.ncin)) bri=bri+v(3,ic)*bz3                  scam-295
      if (lo(83)) go to 42                                              scam-296
      ar=0.d0                                                           scam-297
      do 41 ia=1,ncin                                                   scam-298
   41 ar=ar+(p(ia,ic,3)**2+p(ia,ic,4)**2)                               scam-299
      go to 43                                                          scam-300
   42 ar=1.d0                                                           scam-301
   43 do 56 icp=1,jc                                                    scam-302
      iv=v(1,icp)/1.d6                                                  scam-303
      if (lo(87).or.(bir.lt.0.0001)) go to 45                           scam-304
      g=0.d0                                                            scam-305
      do 44 m=1,20                                                      scam-306
   44 g=g+w(m)/(tp(m)*(1.d0+x(m)*v(3,ic)/(v(4,ic)*bri))*(1.d0+x(m)*v(3,iscam-307
     1cp)/(v(4,icp)*bri)))                                              scam-308
      if (icp.eq.ic) g=g+g/v(4,ic)                                      scam-309
   45 tq=v(3,ic)*v(3,icp)*g/bri                                         scam-310
      if (lo(87).and.(icp.eq.ic)) tq=tq+tq*bz3                          scam-311
      if ((icp.gt.nc1).or.lo(83)) go to 51                              scam-312
c inverse e-w transformation (p.a.m.,prc 12(1975)744)                   scam-313
      if (icp.gt.nc) go to 49                                           scam-314
      do 48 ia=1,ncin                                                   scam-315
      do 47 ib=1,nc                                                     scam-316
      ivp=mc(ib,1)                                                      scam-317
      if (wv(3,ivp).le.0.d0) go to 47                                   scam-318
      a1=p(ia,ic,3)*p(ib,icp,3)-p(ia,ic,4)*p(ib,icp,4)                  scam-319
      b1=p(ia,ic,3)*p(ib,icp,4)+p(ia,ic,4)*p(ib,icp,3)                  scam-320
      a2=a1                                                             scam-321
      b2=b1                                                             scam-322
      if (icp.eq.ic) go to 46                                           scam-323
      a2=a1+p(ia,icp,3)*p(ib,ic,3)-p(ia,icp,4)*p(ib,ic,4)               scam-324
      b2=b1+p(ia,icp,3)*p(ib,ic,4)+p(ia,icp,4)*p(ib,ic,3)               scam-325
   46 v(ia+4,ib)=v(ia+4,ib)+(a1*a2+b1*b2)*tq                            scam-326
   47 continue                                                          scam-327
   48 continue                                                          scam-328
      go to 52                                                          scam-329
   49 do 50 ia=1,ncin                                                   scam-330
   50 v(ia+4,icp)=v(ia+4,icp)+(p(ia,ic,3)**2+p(ia,ic,4)**2)*tq          scam-331
      go to 52                                                          scam-332
   51 v(5,icp)=v(5,icp)+ar*tq                                           scam-333
   52 if (ic.gt.ncin.or.(icp.le.nc.and.wv(3,iv).le.0.d0)) go to 56      scam-334
      if (lo(156)) go to 56                                             scam-335
      gnu=2.d0*v(4,icp)                                                 scam-336
      if (icp.gt.nc) go to 54                                           scam-337
      a1=-2.d0*fai(icp,ic)                                              scam-338
      if (ic.eq.icp) a1=a1+1.d0                                         scam-339
      b1=2.d0*far(icp,ic)                                               scam-340
      if (lo(83)) go to 53                                              scam-341
      write (2,1009) ic,icp,iv,mc(icp,2),cc(icp,3),a1,b1,v(3,icp)       scam-342
      go to 56                                                          scam-343
   53 write (2,1010) ic,icp,iv,mc(icp,2),cc(icp,3),a1,b1,v(3,icp),tq,gnuscam-344
     1,g                                                                scam-345
      go to 56                                                          scam-346
   54 l=(v(1,icp)-1.d6*dfloat(iv))/1.d3                                 scam-347
      fj=v(1,icp)-1.d6*dfloat(iv)-1.d3*dfloat(l)                        scam-348
      if (lo(83)) go to 55                                              scam-349
      write (2,1011) ic,icp,iv,l,fj,v(3,icp)                            scam-350
      go to 56                                                          scam-351
   55 write (2,1012) ic,icp,iv,l,fj,v(3,icp),tq,gnu,g                   scam-352
   56 continue                                                          scam-353
      if (lo(83).and.ic.gt.ncin) go to 61                               scam-354
      do 60 i=1,2                                                       scam-355
      if (lg(i)) go to 60                                               scam-356
      if (lo(87)) go to 58                                              scam-357
      g=0.d0                                                            scam-358
      do 57 m=1,20                                                      scam-359
   57 g=g+w(m)/(tp(m)*(1.d0+x(m)*v(3,ic)/(v(4,ic)*bri))*(1.d0+x(m)*tg(i)scam-360
     1/(bri*fnu(i))))                                                   scam-361
   58 a1=v(3,ic)*tg(i)*g/bri                                            scam-362
      sgf(i)=sgf(i)+a1*ar                                               scam-363
      if (lo(156)) go to 60                                             scam-364
      if (lo(83)) go to 59                                              scam-365
      if (ic.le.ncin) write (2,1013) al(i),tg(i)                        scam-366
      go to 60                                                          scam-367
   59 fn=2.d0*fnu(i)                                                    scam-368
      write (2,1014) al(i),tg(i),sgf(i),fn,g                            scam-369
   60 continue                                                          scam-370
   61 continue                                                          scam-371
      if (lo(56)) write (2,1015) bir                                    scam-372
      do 62 i=1,2                                                       scam-373
      if (lg(i)) go to 62                                               scam-374
      if (lo(233)) fcn(ipj,ndq+i)=fcn(ipj,ndq+i)+.25d0*sgf(i)           scam-375
      tx(ndp+i)=tx(ndp+i)+rz*sgf(i)                                     scam-376
   62 continue                                                          scam-377
      go to 67                                                          scam-378
c storage for simplified compound nucleus                               scam-379
   63 bir=bz3*bz3*(2.d0*aj+1.d0)*dexp(-aj*(aj+1.d0)/(2.d0*bz2*bz2))     scam-380
      do 64 ic=1,nc                                                     scam-381
   64 bir=bir+4.d0*v(3,ic)                                              scam-382
      if (lo(56)) write (2,1016) bir                                    scam-383
      do 66 ic=1,ncin                                                   scam-384
      nt=ns+ik(1,2*mc(ic,2),int(2.*cc(ic,3)+.1))*nct(nz+1)              scam-385
      do 65 icp=1,nc                                                    scam-386
      tq=v(3,ic)*v(3,icp)/bir                                           scam-387
      if (iv.eq.1) tq=tq*bz1*bz1                                        scam-388
   65 v(ic+4,icp)=v(ic+4,icp)+4.d0*tq                                   scam-389
   66 continue                                                          scam-390
c search of maximum value                                               scam-391
   67 r1(2)=dmax1(sgf(1),sgf(2))                                        scam-392
      do 69 ic=1,ncin                                                   scam-393
      do 68 icp=1,nc                                                    scam-394
   68 r1(2)=dmax1(dble(r1(2)),v(ic+4,icp))                              scam-395
   69 continue                                                          scam-396
   70 if (lo(55).and.lo(231)) write (2,1000) aj,ip(jpi+1),nc,ncin       scam-397
c storage of the amplitudes                                             scam-398
      ni=nci-ncin                                                       scam-399
      do 78 i1=1,nci                                                    scam-400
      nt=ns+ik(1,2*md(i1,2),int(2.*cd(i1,3)+.1))*nct(nz+1)              scam-401
      if (lo(231)) go to 71                                             scam-402
      j1=i1                                                             scam-403
      k1=j1                                                             scam-404
      go to 72                                                          scam-405
   71 j1=1                                                              scam-406
      k1=ncin                                                           scam-407
   72 ivs=0                                                             scam-408
      do 77 i2=1,nic                                                    scam-409
      iv=md(i2,1)                                                       scam-410
      if ((iv.ne.ivs).and.(iv.ne.1)) nt=nt+(ipi(2,ivs)*ipi(3,ivs)+nsy)/2scam-411
      nsy=mod(ipi(1,iv)+jpi+ipj+(ipi(2,iv)+ipi(3,iv))/2+1,2)            scam-412
      ivs=iv                                                            scam-413
      id=nt+ik(iv,2*md(i2,2),int(2.*cd(i2,3)+.1))+1                     scam-414
      if (lo(231).and.(i2.le.nci)) go to 73                             scam-415
      j2=i2-ni                                                          scam-416
      k2=j2                                                             scam-417
      go to 74                                                          scam-418
   73 j2=1                                                              scam-419
      k2=ncin                                                           scam-420
   74 ar=0.d0                                                           scam-421
      ai=0.d0                                                           scam-422
      do 76 l1=j1,k1                                                    scam-423
      a1=bz                                                             scam-424
      if (lo(231)) a1=a1*aa(i1,l1)                                      scam-425
      if (a1.eq.0.d0) go to 76                                          scam-426
      do 75 l2=j2,k2                                                    scam-427
      a2=1.d0                                                           scam-428
      if (lo(231).and.(l2.le.ncin)) a2=aa(i2,l2)                        scam-429
      if (a2.eq.0.d0) go to 75                                          scam-430
      ar=ar+far(l2,l1)*a1*a2                                            scam-431
      ai=ai+fai(l2,l1)*a1*a2                                            scam-432
   75 continue                                                          scam-433
   76 continue                                                          scam-434
      f(1,ipj,id)=ar                                                    scam-435
      f(2,ipj,id)=ai                                                    scam-436
      if (lo(155).or..not.lo(231)) go to 77                             scam-437
      a1=dsqrt(ar*ar+ai*ai)                                             scam-438
      a2=0.d0                                                           scam-439
      if (a1.ne.0.d0) a2=atan2(ai,ar)                                   scam-440
      write (2,1002) i2,i1,iv,md(i2,2),cd(i2,3),ar,ai,a1,a2             scam-441
   77 continue                                                          scam-442
   78 continue                                                          scam-443
      if (lo(232)) return                                               scam-444
c compound nucleus                                                      scam-445
      jcx=jc+ni                                                         scam-446
      iiv=ipi(2,1)-1                                                    scam-447
      iii=ipi(3,1)-1                                                    scam-448
      do 89 ic=1,nci                                                    scam-449
      la=2*md(ic,2)                                                     scam-450
      ja=2.*cd(ic,3)+.1                                                 scam-451
      nt=nss+ik(iv,la,ja)*nct(nz+5)                                     scam-452
      ivs=0                                                             scam-453
      call cocn(la,la,ja,ja,iii,iiv,iaj,ipj,q,q(ipj+1),idt-2*ipj)       scam-454
      if (lo(231)) go to 79                                             scam-455
      j1=ic                                                             scam-456
      k1=j1                                                             scam-457
      go to 80                                                          scam-458
   79 j1=1                                                              scam-459
      k1=ncin                                                           scam-460
   80 do 88 icp=1,jcx                                                   scam-461
      if (lo(231).and.(icp.le.nci)) go to 81                            scam-462
      j2=icp-ni                                                         scam-463
      k2=j2                                                             scam-464
      go to 82                                                          scam-465
   81 j2=1                                                              scam-466
      k2=ncin                                                           scam-467
   82 ar=0.d0                                                           scam-468
      do 84 l1=j1,k1                                                    scam-469
      a1=bz                                                             scam-470
      if (lo(231)) a1=a1*aa(i1,l1)                                      scam-471
      if (a1.eq.0.d0) go to 84                                          scam-472
      do 83 l2=j2,k2                                                    scam-473
      a2=1.d0                                                           scam-474
      if (lo(231).and.(l2.gt.ncin)) a2=aa(i2,l2)                        scam-475
      if (a2.eq.0.d0) go to 83                                          scam-476
      ar=ar+v(l1+4,l2)*a1*a2                                            scam-477
   83 continue                                                          scam-478
   84 continue                                                          scam-479
      if (ar.eq.0.d0) go to 89                                          scam-480
      iv=v(1,icp)/1.d6                                                  scam-481
      if ((iv.ne.ivs).and.(iv.ne.1)) nt=nt+(ipi(2,ivs)*ipi(3,ivs)+nsy)/2scam-482
      nsy=mod(ipi(1,iv)+jpi+ipj+(ipi(2,iv)+ipi(3,iv))/2+1,2)            scam-483
      ivs=iv                                                            scam-484
      tx(ncoll+iv+1)=tx(ncoll+iv+1)+ar*v(2,icp)*rz                      scam-485
      if (icp.gt.nc1) go to 87                                          scam-486
      lb=(v(1,icp)-1.d6*dfloat(iv))/.5d3                                scam-487
      jb=2.d0*v(1,icp)-2.d6*dfloat(iv)-1.d3*dfloat(lb)+.1d0             scam-488
      if (.not.lo(233)) go to 85                                        scam-489
      id=nt+ik(iv,lb,jb)+1                                              scam-490
      fcn(ipj,id)=fcn(ipj,id)+.25d0*ar                                  scam-491
   85 call cocn(lb,lb,jb,jb,ipi(3,iv)-1,ipi(2,iv)-1,iaj,ipj,q(ipj+1),q(2scam-492
     1*ipj+1),idt-3*ipj)                                                scam-493
      if ((iv.eq.1).and.(iii.ne.0).and.(icp.ne.ic)) call cocn(la,lb,ja,jscam-494
     1b,ipi(3,iv)-1,ipi(2,iv)-1,iaj,ipj,q(2*ipj+1),q(3*ipj+1),idt-4*ipj)scam-495
      do 86 ll=1,ipj                                                    scam-496
      ai=q(ll)*q(ll+ipj)                                                scam-497
      if ((iv.eq.1).and.(iii.ne.0).and.(icp.ne.ic)) ai=ai+q(ll+2*ipj)**2scam-498
   86 gcn(ll,iv)=gcn(ll,iv)+.25d0*ai*ar*xz                              scam-499
      go to 88                                                          scam-500
   87 if (.not.lo(233)) go to 88                                        scam-501
      j=iv+kba-ncols                                                    scam-502
      fcn(ipj,j)=fcn(ipj,j)+0.25d0*ar*v(2,icp)                          scam-503
   88 continue                                                          scam-504
   89 jcx=nc1+ni                                                        scam-505
      return                                                            scam-506
 1000 format (//26h channel spin and parity =,f7.1,a2,i10,21h coupled chscam-507
     1annels and,i3,10h solutions//21h  ic  icp n    l    j,19x,8hc matrscam-508
     2ix,20x,3h|c|,6x,5hphase)                                          scam-509
 1001 format (51h c matrix larger than 1 for aj ipi nc ncin ic icp =,f5.scam-510
     11,a2,4i3,2x,2d12.4)                                               scam-511
 1002 format (1x,i3,i4,i3,i5,f7.1,4x,1p,2d15.7,2h i,4x,0p,2f11.8)       scam-512
 1003 format (/56h transmission coefficients for channel spin and parityscam-513
     1 =,f7.1,a2/4(16h level   l     j,16x))                            scam-514
 1004 format (4(1x,i2,i4,f6.1,2x,1p,e14.7,0p,3x))                       scam-515
 1005 format (f5.1,a2,i3,1p,4e15.6)                                     scam-516
 1006 format (51h error in eigensystem.  e-w correction discontinued)   scam-517
 1007 format (//26h channel spin and parity =,f7.1,a2//21h  ic icp n    scam-518
     1 l    j,18x,8hs matrix,27x,32htl  in transformed channel space)   scam-519
 1008 format (//26h channel spin and parity =,f7.1,a2//21h  ic  icp n   scam-520
     1 l    j,18x,8hs matrix,27x,2htl,11x,2hhf,10x,2hnu,11x,1hg)        scam-521
 1009 format (1x,i3,i4,i3,i5,f7.1,4x,1p,2d15.7,11x,0p,f11.6)            scam-522
 1010 format (1x,i3,i4,i3,i5,f7.1,4x,1p,2d15.7,11x,0p,f11.6,3f12.4)     scam-523
 1011 format (1x,i3,i4,i3,i5,f7.1,45x,f11.6)                            scam-524
 1012 format (1x,i3,i4,i3,i5,f7.1,45x,f11.6,3f12.4)                     scam-525
 1013 format (60x,a8,f11.6)                                             scam-526
 1014 format (60x,a8,f11.6,3f12.4)                                      scam-527
 1015 format (65x,4hsum ,f10.6)                                         scam-528
 1016 format (60x,5hh.-f.,e20.6)                                        scam-529
      end                                                               scam-530
c 10/10/85  ibm version                                         ecis88  diag-000
      subroutine diag(n,nc,zr,zi,xr,xi,eps,ax,ier)                      diag-001
c diagonalisation of a hermitian complex matrix by an extension of the  diag-002
c jacobi's method                                                       diag-003
c input: zr,zi:  real and imaginary parts of the matrix                 diag-004
c        xr,xi:  real and imaginary parts of the unit matrix            diag-005
c        n:      first dimension of zr,zi,xr and xi                     diag-006
c        nc:     dimension of the matrix                                diag-007
c        eps:    value below which matrix elements are set to 0.        diag-008
c output:zr,zi:  the eigenvalues are on the diagonal of zr              diag-009
c                all the other elements are 0. if process succeeded     diag-010
c        xr,xi:  eigenvectors                                           diag-011
c        ax:     square of the norm of the largest non diagonal element diag-012
c        ier:    returns 0 or -1 after 4*nc**2 rotations                diag-013
c***********************************************************************diag-014
      implicit real*8 (a-h,o-z)                                         diag-015
      dimension zr(n,1),zi(n,1),xr(n,1),xi(n,1)                         diag-016
      ier=0                                                             diag-017
      nt=0                                                              diag-018
    1 nt=nt+1                                                           diag-019
      if (nt.gt.4*nc*nc) go to 6                                        diag-020
      ax=0                                                              diag-021
      l=1                                                               diag-022
      m=2                                                               diag-023
c symmetrisation and search for the largest non diagonal element        diag-024
      do 3 i=1,nc                                                       diag-025
      do 2 j=i,nc                                                       diag-026
      if (zr(j,i).eq.0.d0) zr(i,j)=0.d0                                 diag-027
      if (zi(j,i).eq.0.d0) zi(i,j)=0.d0                                 diag-028
      if (zr(i,j).eq.0.d0) zr(j,i)=0.d0                                 diag-029
      if (zi(i,j).eq.0.d0) zi(j,i)=0.d0                                 diag-030
      ar=(zr(i,j)+zr(j,i))/2.d0                                         diag-031
      ai=(zi(i,j)-zi(j,i))/2.d0                                         diag-032
      zr(j,i)=ar                                                        diag-033
      zr(i,j)=ar                                                        diag-034
      zi(i,j)=ai                                                        diag-035
      zi(j,i)=-ai                                                       diag-036
      if (i.eq.j) go to 2                                               diag-037
      ay=zr(i,j)**2+zi(i,j)**2                                          diag-038
      if (ax.gt.ay) go to 2                                             diag-039
      ax=ay                                                             diag-040
      l=i                                                               diag-041
      m=j                                                               diag-042
    2 continue                                                          diag-043
    3 continue                                                          diag-044
      if (ax.eq.0.d0) return                                            diag-045
c elementary transformation                                             diag-046
      u=datan2(-zi(l,m),zr(l,m))/2.d0                                   diag-047
      v=datan2(2.d0*dsqrt(zr(l,m)**2+zi(l,m)**2),zr(m,m)-zr(l,l))/2.d0  diag-048
      uc=dcos(u)                                                        diag-049
      us=dsin(u)                                                        diag-050
      tc=dcos(v)                                                        diag-051
      ts=-dsin(v)                                                       diag-052
      ucc=uc*tc                                                         diag-053
      ucs=uc*ts                                                         diag-054
      usc=us*tc                                                         diag-055
      uss=us*ts                                                         diag-056
c transformation of rows                                                diag-057
      do 4 i=1,nc                                                       diag-058
      ar=xr(i,l)*ucc+xi(i,l)*usc+xr(i,m)*ucs-xi(i,m)*uss                diag-059
      br=-xr(i,l)*ucs-xi(i,l)*uss+xr(i,m)*ucc-xi(i,m)*usc               diag-060
      ai=xi(i,l)*ucc-xr(i,l)*usc+xi(i,m)*ucs+xr(i,m)*uss                diag-061
      bi=-xi(i,l)*ucs+xr(i,l)*uss+xi(i,m)*ucc+xr(i,m)*usc               diag-062
      xr(i,l)=ar                                                        diag-063
      xr(i,m)=br                                                        diag-064
      xi(i,l)=ai                                                        diag-065
      xi(i,m)=bi                                                        diag-066
      ar=zr(i,l)*ucc+zi(i,l)*usc+zr(i,m)*ucs-zi(i,m)*uss                diag-067
      br=-zr(i,l)*ucs-zi(i,l)*uss+zr(i,m)*ucc-zi(i,m)*usc               diag-068
      ai=zi(i,l)*ucc-zr(i,l)*usc+zi(i,m)*ucs+zr(i,m)*uss                diag-069
      bi=-zi(i,l)*ucs+zr(i,l)*uss+zi(i,m)*ucc+zr(i,m)*usc               diag-070
      zr(i,l)=ar                                                        diag-071
      zr(i,m)=br                                                        diag-072
      zi(i,l)=ai                                                        diag-073
    4 zi(i,m)=bi                                                        diag-074
c transformation of columns                                             diag-075
      do 5 i=1,nc                                                       diag-076
      ar=zr(l,i)*ucc-zi(l,i)*usc+zr(m,i)*ucs+zi(m,i)*uss                diag-077
      br=-zr(l,i)*ucs+zi(l,i)*uss+zr(m,i)*ucc+zi(m,i)*usc               diag-078
      ai=zi(l,i)*ucc+zr(l,i)*usc+zi(m,i)*ucs-zr(m,i)*uss                diag-079
      bi=-zi(l,i)*ucs-zr(l,i)*uss+zi(m,i)*ucc-zr(m,i)*usc               diag-080
      if (dabs(ar).lt.eps) ar=0.d0                                      diag-081
      if (dabs(br).lt.eps) br=0.d0                                      diag-082
      if (dabs(ai).lt.eps) ai=0.d0                                      diag-083
      if (dabs(bi).lt.eps) bi=0.d0                                      diag-084
      zr(l,i)=ar                                                        diag-085
      zr(m,i)=br                                                        diag-086
      zi(l,i)=ai                                                        diag-087
    5 zi(m,i)=bi                                                        diag-088
      go to 1                                                           diag-089
    6 ier=-1                                                            diag-090
      return                                                            diag-091
      end                                                               diag-092
c 10/02/00  ibm version                                         ecis97  sche-000
      subroutine sche(f,jmax,kmax,ipi,mt1,mt2,mf,fm,tx,bm,mc,sp,fa,xg,lmsche-001
     1ax1,wv,kab,kba,kcb,aj,ipj,ipk,fn,ncoll,ncols,nct,fgn,am,jit,jti,nlsche-002
     2t,idmt,id1,lo)                                                    sche-003
c scattering coefficients in the helicity representation                sche-004
c input variables: f:     s-matrix                                      sche-005
c                  jmax:  maximum number of channel spins, dim. for f   sche-006
c                  kmax:  maximum number of comp. nucl, dim. for fn     sche-007
c                  ipi(1,iv):   parity of channel                       sche-008
c                  ipi(5/6,iv): first/last channel number. see deph     sche-009
c                  ipi(9,iv):   maximum angular momentum                sche-010
c                  mt1,mt2: maximum 2*spin+1 for part. and target       sche-011
c                  mf,fm: helicity numbers. see deph                    sche-012
c                  sp(1/2,iv): part. and target spin in state iv        sche-013
c                  tx:    total reaction cross section in mb            sche-014
c                         followed by the total cross section for each  sche-015
c                         level, the compound nucleus cross sections,   sche-016
c                         the fission and the gamma cross sections      sche-017
c                  xg:    coulomb phase-shifts                          sche-018
c                  lmax1: dimension for xg                              sche-019
c                  wv:    wave number and coulomb parameter.  see colf  sche-020
c                  kab:   dimension for fa                              sche-021
c                  kba:   number of independent amplitudes              sche-022
c                  kcb:   dimension for mc                              sche-023
c                  aj:    minimum channel spin                          sche-024
c                  ipj:   number of the channel spin                    sche-025
c                  ipk:   number of l values for compound nucleus       sche-026
c                  fn:    compound nucleus contribution                 sche-027
c                  ncoll: number of coupled levels                      sche-028
c                  ncols: number of levels with angular distribution    sche-029
c                  nct:   number of equ. and solutions for each parity  sche-030
c                  fgn:   coeff. of legendre polynomials for comp. nuc. sche-031
c                  jit:   number of different rates of interpolation    sche-032
c                  jti:   limits and steps of interpolation             sche-033
c                  nlt:   memories needed for legendre polynomials      sche-034
c                  idmt:  length of working space                       sche-035
c                  id1:   length available for bm as double precision   sche-036
c                  lo:    logical controls. if lo(220)=.true., compute  sche-037
c                            only the square roots and legendre coeffi. sche-038
c in common /dblpr/xz:    conversion factor to millibarns               sche-039
c in common /titr/ ncj:   number of factors 1/(-x*cos(theta))           sche-040
c in common /ncomp/nsp:   number of uncoupled states                    sche-041
c output variables:f:     helicity scattering coefficients              sche-042
c                  tx,fgn:with addition of interpolated values          sche-043
c  working field:  am(mt1,mt2,kab) for products of c.g. coefficients    sche-044
c                  fa:    for storage of s-matrix for a given total spinsche-045
c                  mc:    nuclear state numbers and angular momenta     sche-046
c                  bm:    for factors 1/(-x*cos(theta)), 3j coeff., etc sche-047
c***********************************************************************sche-048
      implicit real*8 (a-h,o-z)                                         sche-049
      logical lo(250)                                                   sche-050
      real*4 fm,sp,aj,acn,az,title,theta1,theta2,dtheta,dthe            sche-051
      dimension f(2,jmax,1),ipi(10,1),mf(9,1),fm(9,1),tx(1),bm(1),mc(kcbsche-052
     1,2,4),sp(3,1),fa(2,kab,1),xg(lmax1,1),wv(15,1),fn(kmax,1),nct(6),asche-053
     2m(mt1,mt2,1),jti(2,1),ip(2),fgn(kmax,1)                           sche-054
      common /dblpr/ chi2,chi2m,cm,ck,chb,cmb,ccz,xe,xm,xn,xz           sche-055
      common /titr/ title(18),theta1,theta2,dtheta,dthe,ncj,jmm(2),nl(3)sche-056
      common /ncomp/ nsp(3),nrd(4),acn(2),ncons(5),az(16)               sche-057
      data ip,pi,k2,k3,k4 /1h+,1h-,3.1415926535d0,3*0/                  sche-058
      if (lo(220)) go to 58                                             sche-059
      if (lo(219)) return                                               sche-060
c tables of quantum numbers                                             sche-061
      ipd=1                                                             sche-062
      if (lo(223)) ipd=2                                                sche-063
      ipz=2*ipd                                                         sche-064
      ija=int(2.*aj+.1)-ipz                                             sche-065
      iaj=ija                                                           sche-066
      do 4 jpi=1,2                                                      sche-067
      nc=0                                                              sche-068
      do 3 i=1,ncols                                                    sche-069
      nj1=ija-ipi(3,i)+1                                                sche-070
      nj=2.*sp(2,i)+1.1                                                 sche-071
      do 2 j=1,nj                                                       sche-072
      l1=nj1-ipi(2,i)+1                                                 sche-073
      nm=2*sp(1,i)+1.1                                                  sche-074
      do 1 k=1,nm                                                       sche-075
      if (mod(l1+2*ipi(1,i)+2*(jpi+ipd),4).eq.0) go to 1                sche-076
      nc=nc+1                                                           sche-077
      mc(nc,jpi,1)=i                                                    sche-078
      mc(nc,jpi,2)=l1                                                   sche-079
      mc(nc,jpi,3)=nj1                                                  sche-080
    1 l1=l1+2                                                           sche-081
    2 nj1=nj1+2                                                         sche-082
    3 continue                                                          sche-083
    4 continue                                                          sche-084
      nxy=0                                                             sche-085
      if (lo(81).and.lo(182)) nxy=nsp(3)+2                              sche-086
      if (lo(143)) go to 38                                             sche-087
c interpolation for the s-matrix                                        sche-088
      rz=4.d0*pi*xz*ipd                                                 sche-089
      i1=0                                                              sche-090
      i4=0                                                              sche-091
c loop on parities                                                      sche-092
      do 17 j=1,2                                                       sche-093
      i2=i1+nct(j)                                                      sche-094
      i3=nct(j+2)                                                       sche-095
      i1=i1+1                                                           sche-096
      if (i1.gt.i2) go to 17                                            sche-097
c loop on solutions                                                     sche-098
      do 16 k=1,i3                                                      sche-099
      ji4=(3+max0(ipi(3,1)-1-iaj-mc(k,j,3),ipi(2,1)-1-mc(k,j,2)-mc(k,j,3sche-100
     1),-2*mc(k,j,2),-2*mc(k,j,3)))/4-ipd+1                             sche-101
      i6=0                                                              sche-102
c loop on s matrix elements                                             sche-103
      do 15 i=i1,i2                                                     sche-104
      i4=i4+1                                                           sche-105
      i6=i6+1                                                           sche-106
      iv=mc(i6,j,1)                                                     sche-107
      ji3=(3+max0(ipi(3,iv)-1-iaj-mc(i6,j,3),ipi(2,iv)-1-mc(i6,j,2)-mc(ische-108
     16,j,3),-2*mc(i6,j,2),-2*mc(i6,j,3)))/4-ipd+1                      sche-109
      ji1=max0(ji3,ji4)                                                 sche-110
      jt1=min0(ipj,ipi(9,1)-mc(k,j,2)/2,ipi(9,iv)-mc(i,j,2)/2)          sche-111
      n1=0                                                              sche-112
      n3=1                                                              sche-113
    5 if (n3.lt.ji1) go to 6                                            sche-114
      n1=n1+1                                                           sche-115
      k1=k2                                                             sche-116
      k2=k3                                                             sche-117
      k3=k4                                                             sche-118
      k4=n3                                                             sche-119
      if (n1.gt.3) go to 9                                              sche-120
    6 do 7 l=1,jit                                                      sche-121
      if (n3.le.jti(1,l)) go to 8                                       sche-122
    7 n3=n3+jti(2,l)*ipd                                                sche-123
      l=jit                                                             sche-124
    8 n3=n3+ipd                                                         sche-125
      if (n3.le.jt1) go to 5                                            sche-126
      if (n3.gt.jti(1,l)+jti(2,l)*ipd+ipd) go to 14                     sche-127
      go to 67                                                          sche-128
    9 ji2=k3-ipd                                                        sche-129
      if (n3.eq.jt1) ji2=k4-ipd                                         sche-130
      if (ji1.gt.ji2) go to 14                                          sche-131
      m1=(k1-k2)*(k1-k3)*(k1-k4)                                        sche-132
      m2=(k2-k1)*(k2-k3)*(k2-k4)                                        sche-133
      m3=(k3-k1)*(k3-k2)*(k3-k4)                                        sche-134
      m4=(k4-k1)*(k4-k2)*(k4-k3)                                        sche-135
      n2=1                                                              sche-136
      do 13 n4=ji1,ji2,ipd                                              sche-137
      if (n4.eq.k1.or.n4.eq.k2.or.n4.eq.k3.or.n4.eq.k4) go to 13        sche-138
      if (n2.ne.1) go to 10                                             sche-139
      n2=3                                                              sche-140
      a2=f(1,k1,i4)**2+f(2,k1,i4)**2                                    sche-141
      b2=f(1,k2,i4)**2+f(2,k2,i4)**2                                    sche-142
      c2=f(1,k3,i4)**2+f(2,k3,i4)**2                                    sche-143
      d2=f(1,k4,i4)**2+f(2,k4,i4)**2                                    sche-144
      if (a2*b2*c2*d2.eq.0.d0) go to 10                                 sche-145
      a1=datan2(f(2,k1,i4),f(1,k1,i4))                                  sche-146
      b1=datan2(f(2,k2,i4),f(1,k2,i4))                                  sche-147
      c1=datan2(f(2,k3,i4),f(1,k3,i4))                                  sche-148
      d1=datan2(f(2,k4,i4),f(1,k4,i4))                                  sche-149
      if ((a1-b1)*(b1-c1).lt.0.d0.or.(b1-c1)*(c1-d1).lt.0.d0) go to 10  sche-150
      n2=2                                                              sche-151
      a2=dlog(a2)                                                       sche-152
      b2=dlog(b2)                                                       sche-153
      c2=dlog(c2)                                                       sche-154
      d2=dlog(d2)                                                       sche-155
   10 a3=dfloat((n4-k2)*(n4-k3)*(n4-k4))/dfloat(m1)                     sche-156
      b3=dfloat((n4-k1)*(n4-k3)*(n4-k4))/dfloat(m2)                     sche-157
      c3=dfloat((n4-k1)*(n4-k2)*(n4-k4))/dfloat(m3)                     sche-158
      d3=dfloat((n4-k1)*(n4-k2)*(n4-k3))/dfloat(m4)                     sche-159
      if (n2.eq.3) go to 11                                             sche-160
      a4=a1*a3+b1*b3+c1*c3+d1*d3                                        sche-161
      b4=dexp(0.5d0*(a2*a3+b2*b3+c2*c3+d2*d3))                          sche-162
      f(1,n4,i4)=b4*dcos(a4)                                            sche-163
      f(2,n4,i4)=b4*dsin(a4)                                            sche-164
      go to 12                                                          sche-165
   11 f(1,n4,i4)=f(1,k1,i4)*a3+f(1,k2,i4)*b3+f(1,k3,i4)*c3+f(1,k4,i4)*d3sche-166
      f(2,n4,i4)=f(2,k1,i4)*a3+f(2,k2,i4)*b3+f(2,k3,i4)*c3+f(2,k4,i4)*d3sche-167
   12 tx(iv+1)=tx(iv+1)+(f(1,n4,i4)**2+f(2,n4,i4)**2)*rz*(2*n4-1+2.*aj) sche-168
      if (i6.eq.k) tx(1)=tx(1)+f(2,n4,i4)*rz*(2*n4-1+2.*aj)             sche-169
   13 continue                                                          sche-170
   14 ji1=ji2+ipz                                                       sche-171
      if (ji1.lt.jt1) go to 6                                           sche-172
   15 continue                                                          sche-173
   16 continue                                                          sche-174
   17 i1=i2                                                             sche-175
      if (lo(181).or.(.not.lo(233))) go to 38                           sche-176
c interpolation for the compound nucleus                                sche-177
      i1=0                                                              sche-178
      i4=0                                                              sche-179
      do 37 j=1,3                                                       sche-180
      if (j.le.2) go to 18                                              sche-181
      if (nxy.eq.0) go to 37                                            sche-182
      i2=i1                                                             sche-183
      i3=nxy                                                            sche-184
      go to 19                                                          sche-185
   18 i2=i1+nct(j+4)                                                    sche-186
      i3=nct(j+2)                                                       sche-187
      i1=i1+1                                                           sche-188
   19 if (i1.gt.i2) go to 37                                            sche-189
      i6=0                                                              sche-190
c loop on solutions                                                     sche-191
      do 36 k=1,i3                                                      sche-192
      if (j.eq.3) go to 20                                              sche-193
      ji4=(3+max0(ipi(3,1)-1-iaj-mc(k,j,3),ipi(2,1)-1-mc(k,j,2)-mc(k,j,3sche-194
     1),-2*mc(k,j,2),-2*mc(k,j,3)))/4-ipd+1                             sche-195
   20 i6=0                                                              sche-196
c loop on s matrix elements                                             sche-197
      do 35 i=i1,i2                                                     sche-198
      i4=i4+1                                                           sche-199
      i6=i6+1                                                           sche-200
      ji1=1                                                             sche-201
      if (j.eq.3) go to 21                                              sche-202
      iv=mc(i6,j,1)                                                     sche-203
      ivl=iv+ncoll+1                                                    sche-204
      ji3=(3+max0(ipi(3,iv)-1-iaj-mc(i6,j,3),ipi(2,iv)-1-mc(i6,j,2)-mc(ische-205
     16,j,3),-2*mc(i6,j,2),-2*mc(i6,j,3)))/4-ipd+1                      sche-206
      ji1=max0(ji3,ji4)                                                 sche-207
      go to 22                                                          sche-208
   21 ivl=k+ncoll+ncols+1                                               sche-209
   22 nt=0                                                              sche-210
      jpj=0                                                             sche-211
      do 23 l=ji1,ipk                                                   sche-212
      if (abs(fn(l,i4)).lt.1.e-15) go to 23                             sche-213
      nt=nt+1                                                           sche-214
      jpj=l                                                             sche-215
   23 continue                                                          sche-216
      nt=min0(nt,4)-1                                                   sche-217
      if (nt.lt.1) go to 35                                             sche-218
      n1=0                                                              sche-219
      n3=1                                                              sche-220
   24 if (n3.lt.ji1) go to 25                                           sche-221
      n1=n1+1                                                           sche-222
      k1=k2                                                             sche-223
      k2=k3                                                             sche-224
      k3=k4                                                             sche-225
      k4=n3                                                             sche-226
      if (n1.gt.nt) go to 28                                            sche-227
   25 do 26 l=1,jit                                                     sche-228
      if (n3.le.jti(1,l)) go to 27                                      sche-229
   26 n3=n3+jti(2,l)*ipd                                                sche-230
      l=jit                                                             sche-231
   27 n3=n3+ipd                                                         sche-232
      if (n3.le.jpj) go to 24                                           sche-233
      if (n3.gt.jti(1,l)+jti(2,l)*ipd+ipd) go to 34                     sche-234
   28 ji2=k3-ipd                                                        sche-235
      if (n3.eq.jpj) ji2=k4-ipd                                         sche-236
      if (ji1.gt.ji2) go to 34                                          sche-237
      do 33 n4=ji1,ji2,ipd                                              sche-238
      if (n4.eq.k1.or.n4.eq.k2.or.n4.eq.k3.or.n4.eq.k4) go to 33        sche-239
      if (nt.lt.3) go to 29                                             sche-240
      a3=dfloat((n4-k2)*(n4-k3)*(n4-k4))/dfloat((k1-k2)*(k1-k3)*(k1-k4))sche-241
      b3=dfloat((n4-k1)*(n4-k3)*(n4-k4))/dfloat((k2-k1)*(k2-k3)*(k2-k4))sche-242
      c3=dfloat((n4-k1)*(n4-k2)*(n4-k4))/dfloat((k3-k1)*(k3-k2)*(k3-k4))sche-243
      d3=dfloat((n4-k1)*(n4-k2)*(n4-k3))/dfloat((k4-k1)*(k4-k2)*(k4-k3))sche-244
      fn(n4,i4)=abs(fn(k1,i4)*a3+fn(k2,i4)*b3+fn(k3,i4)*c3+fn(k4,i4)*d3)sche-245
      go to 31                                                          sche-246
   29 if (nt.eq.1) go to 30                                             sche-247
      b3=dfloat((n4-k3)*(n4-k4))/dfloat((k2-k3)*(k2-k4))                sche-248
      c3=dfloat((n4-k2)*(n4-k4))/dfloat((k3-k2)*(k3-k4))                sche-249
      d3=dfloat((n4-k2)*(n4-k3))/dfloat((k4-k2)*(k4-k3))                sche-250
      fn(n4,i4)=abs(fn(k2,i4)*b3+fn(k3,i4)*c3+fn(k4,i4)*d3)             sche-251
      go to 31                                                          sche-252
   30 c3=dfloat(n4-k4)/dfloat(k3-k4)                                    sche-253
      d3=dfloat(n4-k3)/dfloat(k4-k3)                                    sche-254
      fn(n4,i4)=abs(fn(k3,i4)*c3+fn(k4,i4)*d3)                          sche-255
   31 tx(ivl)=tx(ivl)+fn(n4,i4)*rz*(2*n4-1+2.*aj)                       sche-256
      if ((j.eq.3).or.(fn(n4,i4).eq.0.d0)) go to 33                     sche-257
      call cocn(mc(k,j,2)+ipz*n4,mc(k,j,2)+ipz*n4,mc(k,j,3)+ipz*n4,mc(k,sche-258
     1j,3)+ipz*n4,ipi(3,1)-1,ipi(2,1)-1,ija+ipz*n4,n4,bm,bm(n4+1),id1-n4sche-259
     2)                                                                 sche-260
      call cocn(mc(i6,j,2)+ipz*n4,mc(i6,j,2)+ipz*n4,mc(i6,j,3)+ipz*n4,mcsche-261
     1(i6,j,3)+ipz*n4,ipi(3,iv)-1,ipi(2,iv)-1,ija+ipz*n4,n4,bm(n4+1),bm(sche-262
     22*n4+1),id1-2*n4)                                                 sche-263
      if ((iv.eq.1).and.(ipi(3,1).gt.1).and.(k.ne.i6)) call cocn(mc(k,j,sche-264
     12)+ipz*n4,mc(i6,j,2)+ipz*n4,mc(k,j,3)+ipz*n4,mc(i6,j,3)+ipz*n4,ipische-265
     2(3,iv)-1,ipi(2,iv)-1,ija+ipz*n4,n4,bm(2*n4+1),bm(3*n4+1),id1-3*n4)sche-266
      do 32 ll=1,n4                                                     sche-267
      z=bm(ll)*bm(ll+n4)                                                sche-268
      if ((iv.eq.1).and.(ipi(3,1).gt.1).and.(k.ne.i6)) z=bm(ll+2*n4)**2+sche-269
     1z                                                                 sche-270
   32 fgn(ll,iv)=fgn(ll,iv)+z*fn(n4,i4)*xz                              sche-271
   33 continue                                                          sche-272
   34 ji1=ji2+ipz                                                       sche-273
      if (ji1.lt.jpj) go to 25                                          sche-274
   35 continue                                                          sche-275
   36 continue                                                          sche-276
   37 i1=i2                                                             sche-277
   38 ik=1                                                              sche-278
      do 57 ij=1,ipj,ipd                                                sche-279
c transfer of s matrix for a given angular momentum                     sche-280
      i1=0                                                              sche-281
      i4=0                                                              sche-282
      do 41 j=1,2                                                       sche-283
      i2=i1+nct(j+2)                                                    sche-284
      i1=i1+1                                                           sche-285
      if (i1.gt.i2) go to 41                                            sche-286
      i3=nct(j)                                                         sche-287
      do 40 i=i1,i2                                                     sche-288
      do 39 k=1,i3                                                      sche-289
      i4=i4+1                                                           sche-290
      fa(1,k,i)=f(1,ij,i4)                                              sche-291
   39 fa(2,k,i)=f(2,ij,i4)                                              sche-292
   40 continue                                                          sche-293
   41 i1=i2                                                             sche-294
      do 42 i=1,kba                                                     sche-295
      f(1,ij,i)=0.d0                                                    sche-296
   42 f(2,ij,i)=0.d0                                                    sche-297
      j1=0                                                              sche-298
      iaj=iaj+ipz                                                       sche-299
      aaj=iaj+1                                                         sche-300
      do 54 ji=1,2                                                      sche-301
      j2=j1+nct(ji+2)                                                   sche-302
      j1=j1+1                                                           sche-303
      if (j1.gt.j2) go to 54                                            sche-304
      nc1=0                                                             sche-305
      nc=nct(ji)                                                        sche-306
c  geometric coefficient for the transformation to helicity coefficientssche-307
      do 48 ic=1,nc                                                     sche-308
      mc(ic,ji,2)=mc(ic,ji,2)+ipz                                       sche-309
      mc(ic,ji,3)=mc(ic,ji,3)+ipz                                       sche-310
      iv=mc(ic,ji,1)                                                    sche-311
      ni=2.*sp(1,iv)+1.1                                                sche-312
      mi=2.*sp(2,iv)+1.1                                                sche-313
      mc(ic,1,4)=min0(mc(ic,ji,3)-iabs(iaj+1-mi),mc(ic,ji,2)-iabs(mc(ic,sche-314
     1ji,3)+1-ni))                                                      sche-315
      if (mc(ic,ji,2).gt.2*ipi(9,iv)) mc(ic,1,4)=-1                     sche-316
      if (mc(ic,1,4).lt.0) go to 48                                     sche-317
      if (iv.eq.1) nc1=nc1+1                                            sche-318
      a1=0.d0                                                           sche-319
      ym=mc(ic,ji,3)-ni+1                                               sche-320
      xb1=0.5d0*dfloat(ni**2+(mc(ic,ji,3)-mc(ic,ji,2))*(mc(ic,ji,2)+mc(ische-321
     1c,ji,3)+2)-1)                                                     sche-322
      c3=0.d0                                                           sche-323
c coupling for particle helicity                                        sche-324
      do 43 i1=1,ni                                                     sche-325
      bm(i1)=0.d0                                                       sche-326
      if (iabs(2*i1-ni-1).gt.mc(ic,ji,3)) go to 43                      sche-327
      n3=(mc(ic,ji,3)+2*i1-ni-1)*(mc(ic,ji,3)-2*i1+ni+3)*(i1-1)         sche-328
      if (n3.eq.0) bm(i1)=2*mod(i1,2)-1                                 sche-329
      if (n3.le.0) go to 43                                             sche-330
      c2=c3                                                             sche-331
      c3=dsqrt((ni-i1+1)*(i1-1)*(ym+2*i1-2)*(ym+2*ni-2*i1+2))           sche-332
      bm(i1)=(xb1-(2*i1-ni-3)**2)*bm(i1-1)/c3                           sche-333
      if (i1.ge.3) bm(i1)=bm(i1)-c2*bm(i1-2)/c3                         sche-334
   43 a1=a1+bm(i1)**2                                                   sche-335
      do 47 i1=1,ni                                                     sche-336
      a2=0.d0                                                           sche-337
      if (dabs(bm(i1)).lt.1.d-10) go to 45                              sche-338
      ia=2*i1-ni-1                                                      sche-339
      xb1=0.5d0*(mi**2+(iaj-mc(ic,ji,3))*(iaj+mc(ic,ji,3)+2)-1)         sche-340
      c3=0.d0                                                           sche-341
c coupling for target helicity                                          sche-342
      do 44 i2=1,mi                                                     sche-343
      bm(ni+i2)=0.d0                                                    sche-344
      if (iabs(2*i2-mi-1-ia).gt.iaj) go to 44                           sche-345
      n3=(iaj+ia-2*i2+mi+3)*(iaj-ia+2*i2-mi-1)*(i2-1)                   sche-346
      if (n3.eq.0) bm(ni+i2)=2*mod(i2,2)-1                              sche-347
      if (n3.le.0) go to 44                                             sche-348
      c2=c3                                                             sche-349
      ib=2*i2-mi-3                                                      sche-350
      c3=dsqrt((mi-i2+1)*(i2-1)*(aaj**2-(2*i1-2*i2+mi-ni+1)**2))        sche-351
      bm(ni+i2)=((xb1-ib*(ib-ia))*bm(ni+i2-1)-c2*bm(ni+i2-2))/c3        sche-352
   44 a2=a2+bm(ni+i2)**2                                                sche-353
      if (a2*a1.ne.0.d0) a2=(mod(1+mc(ic,ji,3)-iaj+mi,4)-1)*dsqrt(aaj/(asche-354
     11*a2))                                                            sche-355
   45 do 46 i2=1,mi                                                     sche-356
   46 am(i1,i2,ic)=bm(i1)*bm(ni+i2)*a2                                  sche-357
   47 continue                                                          sche-358
   48 continue                                                          sche-359
      if (nc1.eq.0) go to 54                                            sche-360
      ncin=nct(ji+2)                                                    sche-361
c transformation                                                        sche-362
      if (lo(156).or.ik.ne.ij) go to 49                                 sche-363
      bj=.5d0*dfloat(iaj)                                               sche-364
      jij=1+mod(ij+ji,2)                                                sche-365
      write (2,1000) bj,ip(jij)                                         sche-366
   49 nc1=0                                                             sche-367
      do 53 ic=1,ncin                                                   sche-368
      if (mc(ic,1,4).lt.0) go to 53                                     sche-369
      icx=ic                                                            sche-370
      nc1=nc1+1                                                         sche-371
      if (ji.eq.2) icx=icx+nct(3)                                       sche-372
      lci=mc(ic,ji,2)/2+1                                               sche-373
      nc2=0                                                             sche-374
      do 52 icp=1,nc                                                    sche-375
      if (mc(icp,1,4).lt.0) go to 52                                    sche-376
      lcp=mc(icp,ji,2)/2+1                                              sche-377
      iv=mc(icp,ji,1)                                                   sche-378
      nc2=nc2+1                                                         sche-379
      c1=xg(lci,1)+xg(lcp,iv)                                           sche-380
      if (lo(156).or.ik.ne.ij) go to 50                                 sche-381
      b1=-2.d0*fa(2,icp,icx)                                            sche-382
      if (ic.eq.icp) b1=b1+1.d0                                         sche-383
      b2=2.d0*fa(1,icp,icx)                                             sche-384
      b3=dsqrt(b1**2+b2**2)                                             sche-385
      d1=0.d0                                                           sche-386
      if (b3.ne.0.d0) d1=datan2(b2,b1)                                  sche-387
      d2=dmod(d1+c1+pi,2.d0*pi)-pi                                      sche-388
      lc=lcp-1                                                          sche-389
      bj=0.5d0*dfloat(mc(icp,ji,3))                                     sche-390
      write (2,1001) nc1,nc2,iv,lc,bj,b1,b2,b3,d1,d2                    sche-391
c multiplication by the coulomb phase                                   sche-392
   50 a1=dcos(c1)                                                       sche-393
      a2=dsin(c1)                                                       sche-394
      c2=fa(1,icp,icx)*a1-fa(2,icp,icx)*a2                              sche-395
      c3=fa(1,icp,icx)*a2+fa(2,icp,icx)*a1                              sche-396
      i1=ipi(5,iv)                                                      sche-397
      i2=ipi(6,iv)                                                      sche-398
c  helicity scattering coefficients                                     sche-399
      do 51 id=i1,i2                                                    sche-400
      mf1=mf(1,id)                                                      sche-401
      mf2=mf(2,id)                                                      sche-402
      mf3=mf(3,id)                                                      sche-403
      mf4=mf(4,id)                                                      sche-404
      c1=am(mf1,mf2,icp)*am(mf3,mf4,ic)                                 sche-405
      f(1,ij,id)=f(1,ij,id)+c2*c1                                       sche-406
   51 f(2,ij,id)=f(2,ij,id)+c3*c1                                       sche-407
   52 continue                                                          sche-408
   53 continue                                                          sche-409
   54 continue                                                          sche-410
      if (lo(143).or.ik.ne.ij) go to 56                                 sche-411
      do 55 l=1,jit                                                     sche-412
      if (ik.le.jti(1,l)) go to 56                                      sche-413
   55 ik=ik+jti(2,l)*ipd                                                sche-414
   56 ik=ik+ipd                                                         sche-415
   57 continue                                                          sche-416
   58 if (lo(165)) go to 59                                             sche-417
      nsa=7*(nlt+2*ipj+1)+1                                             sche-418
      if (nsa.gt.id1) call memo(idmt,idmt+2*nsa-2*id1,m,5,lo)           sche-419
      if (lo(216)) go to 69                                             sche-420
      call lcsp(f,fgn,jmax,kmax,ipi,ncoll,ncols,mf,fm,sp,wv,aj,ipj,ipj,xsche-421
     1z,bm,bm(nsa),idmt,idmt-2*nsa,lo)                                  sche-422
   59 if (lo(220).or.lo(141)) return                                    sche-423
c elimination of factors 1/(1-x*cos(theta))                             sche-424
      nji=2.*aj+.1                                                      sche-425
      ncj=min0(ncj,ipj-1)                                               sche-426
      if (ncj.eq.0) return                                              sche-427
      do 66 nj=1,ncj                                                    sche-428
      ipj=ipj-1                                                         sche-429
c loop on the independent amplitudes                                    sche-430
      do 65 k=1,kba                                                     sche-431
      if (abs(fm(7,k)).eq..25) go to 60                                 sche-432
      m1=2.0001*fm(6,k)                                                 sche-433
      m2=2.0001*fm(7,k)                                                 sche-434
      m3=((iabs(m1+m2)+iabs(m1-m2))/2-nji)/2+1                          sche-435
   60 b3=0.25d0*dfloat(m1*m2)                                           sche-436
      if (m3.gt.ipj) go to 68                                           sche-437
      d1=0.d0                                                           sche-438
      d2=0.d0                                                           sche-439
      mj=2*m3+nji-2                                                     sche-440
      c3=0.5d0*dfloat(mj)                                               sche-441
      f1=(mj+m2)/2+1-m3                                                 sche-442
      f2=(mj-m2)/2+1-m3                                                 sche-443
      f3=(mj+m1)/2+1-m3                                                 sche-444
      f4=(mj-m1)/2+1-m3                                                 sche-445
      c1=0.d0                                                           sche-446
      b1=0.d0                                                           sche-447
      a1=0.d0                                                           sche-448
      b4=0.d0                                                           sche-449
c calc. of x which minimises the differences with a weight (j+1)**2     sche-450
c for the 5 last one                                                    sche-451
      npj=ipj-5                                                         sche-452
      do 61 i=m3,ipj                                                    sche-453
      fi=i                                                              sche-454
      a2=a1                                                             sche-455
      b2=b1                                                             sche-456
      a1=f(1,i,k)                                                       sche-457
      b1=f(2,i,k)                                                       sche-458
      c3=c3+1.d0                                                        sche-459
      c2=c1                                                             sche-460
      c1=dsqrt((f1+fi)*(f2+fi)*(f3+fi)*(f4+fi))/(c3*(2.d0*c3+1.d0))     sche-461
      if (b3.ne.0.d0) b4=b3/(c3*c3-c3)                                  sche-462
      bm(2*i-1)=a1*b4+a2*c2+f(1,i+1,k)*c1                               sche-463
      bm(2*i)=b1*b4+b2*c2+f(2,i+1,k)*c1                                 sche-464
      if (i.le.npj) go to 61                                            sche-465
      d1=d1+c3*c3*(f(1,i,k)*bm(2*i-1)+f(2,i,k)*bm(2*i))                 sche-466
      d2=d2+c3*c3*(bm(2*i-1)**2+bm(2*i)**2)                             sche-467
   61 c1=c1*(c3+c3+1.d0)/(c3+c3-1.d0)                                   sche-468
      a3=.9999999                                                       sche-469
      if (lo(18)) go to 62                                              sche-470
      if (d2.ne.0.d0) a3=d1/d2                                          sche-471
      a4=a3                                                             sche-472
c x is fixed between +1 and -1                                          sche-473
      if (a4.gt..9999999d0) a4=.9999999d0                               sche-474
      if (a4.lt.-.9999999d0) a4=-.9999999d0                             sche-475
c calculation of the new scattering coefficients                        sche-476
      go to 63                                                          sche-477
   62 a4=a3*(2*mod(nj,2)-1)                                             sche-478
   63 do 64 i=m3,ipj                                                    sche-479
      f(1,i,k)=f(1,i,k)-a4*bm(2*i-1)                                    sche-480
   64 f(2,i,k)=f(2,i,k)-a4*bm(2*i)                                      sche-481
      if (.not.lo(215)) write (2,1002) k,a4,a3,f(1,ipj,k),f(2,ipj,k),f(1sche-482
     1,ipj+1,k),f(2,ipj+1,k)                                            sche-483
      f(1,ipj+1,k)=a4                                                   sche-484
   65 continue                                                          sche-485
   66 continue                                                          sche-486
      return                                                            sche-487
   67 write (2,1003) n1                                                 sche-488
      go to 70                                                          sche-489
   68 write (2,1004) nj                                                 sche-490
      go to 70                                                          sche-491
   69 write (2,1005)                                                    sche-492
   70 write (2,1006)                                                    sche-493
      stop                                                              sche-494
 1000 format (//26h channel spin and parity =,f7.1,a2//20h  ic icp n    sche-495
     1l    j,18x,8hs matrix,20x,3h|s|,7x,17hphase /with coul.)          sche-496
 1001 format (1x,3i3,i5,f7.1,4x,1p,2d15.7,2h i,4x,0p,3f11.8)            sche-497
 1002 format (12h amplitude =,i3,d15.7,2h (,d15.7,6h)  new,2d15.7,3x,3hosche-498
     1ld,2d15.7)                                                        sche-499
 1003 format (5x,i2,39h amplitudes unsufficient to interpolate)         sche-500
 1004 format (45h amplitudes unsufficient to factorise (1-cos),i2,6h timsche-501
     1es)                                                               sche-502
 1005 format (/47h **** working field too small to call lcsp ****/)     sche-503
 1006 format (24h in sche  .... stop ....)                              sche-504
      end                                                               sche-505
c 23/04/99  ibm version                                         ecis97  lcsp-000
      subroutine lcsp(f,fcn,jmax,kmax,ipi,ncoll,ncols,mf,fm,sp,wv,aj,ipjlcsp-001
     1,ipk,xz,a,ax,idmt,id,lo)                                          lcsp-002
c coefficients of legendre polynomials for cross-sections               lcsp-003
c scattering coefficients in the helicity representation                lcsp-004
c input variables: f:     s-matrix                                      lcsp-005
c                  fcn:   transmission coefficients                     lcsp-006
c                  jmax:  maximum number of channel spins, dim. for f   lcsp-007
c                  kmax:  maximum number l for comp. nuc., dim. for fcn lcsp-008
c                  ipi(5/6,iv): first/last channel number. see deph     lcsp-009
c                  ncoll: number of coupled levels                      lcsp-010
c                  ncols: number of levels with angular distribution    lcsp-011
c                  mf,fm: helicity numbers. see deph                    lcsp-012
c                  sp(1/2,iv): part. and target spin in state iv        lcsp-013
c                  wv:    wave number and coulomb parameter.  see colf  lcsp-014
c                  aj:    minimum channel spin                          lcsp-015
c                  ipj:   number of the channel spin                    lcsp-016
c                  ipk:   number of channel spin for compound nucleus   lcsp-017
c                  xz:    10/((2*spin(1)+1)*(2*ai(1)+1))/k**2           lcsp-018
c                  idmt:  dimension of total working field              lcsp-019
c                  id:    dimension of working field ax single precisionlcsp-020
c                  lo:    logical controls                              lcsp-021
c in common /titr/ nl:    indications for expansion of cross-sections   lcsp-022
c                         in legendre polynomials                       lcsp-023
c working field:   a(7,*) amplitude multiplied by a legendre polynomial lcsp-024
c                         alternatively in a(1-2,*) and a(3-4,*)        lcsp-025
c                         coefficients of recurrence in a(5-7,*)        lcsp-026
c                  ax:    1 to jml  legendre coefficients of cross-sect.lcsp-027
c                         jml+1 to jmt    for compound nucleus          lcsp-028
c                         jmt+1 to jmx    product spin rotation matriceslcsp-029
c***********************************************************************lcsp-030
      implicit real*8 (a-h,o-z)                                         lcsp-031
      logical lo(250),ls                                                lcsp-032
      real*4 fm,sp,aj,title,theta1,theta2,dtheta,dthe                   lcsp-033
      dimension f(2,jmax,1),fcn(kmax,1),ipi(10,1),fm(9,1),mf(9,1),sp(3,1lcsp-034
     1),wv(15,1),at(2),ndl(2),a(7,1),ax(1)                              lcsp-035
      common /titr/ title(18),theta1,theta2,dtheta,dthe,ncj,jmm(2),nl(3)lcsp-036
c determination of the number of legendre polynomials                   lcsp-037
      nji=2.*aj+.1                                                      lcsp-038
      ndl(1)=nl(2)                                                      lcsp-039
      ndl(2)=nl(3)                                                      lcsp-040
      if (ndl(1).eq.0) ndl(1)=(6*ipj-3+3*nji)/2                         lcsp-041
      if (ndl(2).eq.0) ndl(2)=2*ipj-1+nji                               lcsp-042
      write (2,1000)                                                    lcsp-043
c loop on levels                                                        lcsp-044
      do 35 jk=1,ncols                                                  lcsp-045
      if (jk.gt.ncoll) go to 32                                         lcsp-046
      if (wv(3,jk).lt.0.d0) go to 35                                    lcsp-047
      jk1=ipi(5,jk)                                                     lcsp-048
      jk2=ipi(6,jk)                                                     lcsp-049
      jml=ndl(2)                                                        lcsp-050
      ls=jk.eq.1.and.wv(5,1).ne.0.                                      lcsp-051
      if (ls) jml=ndl(1)                                                lcsp-052
      jmt=jml                                                           lcsp-053
      if (2*jmt.gt.id) call memo(idmt,idmt+2*jmt-id,m,5,lo)             lcsp-054
      if (lo(216)) go to 36                                             lcsp-055
      do 1 j=1,jmt                                                      lcsp-056
    1 ax(j)=0.d0                                                        lcsp-057
c loop on amplitudes                                                    lcsp-058
      do 29 i=jk1,jk2                                                   lcsp-059
      if (abs(fm(7,i)).eq..25) go to 3                                  lcsp-060
      m1=2.0001*fm(6,i)                                                 lcsp-061
      m2=2.0001*fm(7,i)                                                 lcsp-062
      m3=((iabs(m1+m2)+iabs(m1-m2))/2-nji)/2+1                          lcsp-063
      if (jk.gt.ncoll) go to 3                                          lcsp-064
      a1=0.25d0*(m1*m2)                                                 lcsp-065
      mj=2*m3+nji-2                                                     lcsp-066
      a2=0.5d0*mj                                                       lcsp-067
      x1=(mj+m2)/2+1-m3                                                 lcsp-068
      x2=(mj-m2)/2+1-m3                                                 lcsp-069
      x3=(mj+m1)/2+1-m3                                                 lcsp-070
      x4=(mj-m1)/2+1-m3                                                 lcsp-071
      a(7,m3)=0.d0                                                      lcsp-072
c coefficients of the recurrence                                        lcsp-073
      jm1=jml+ipj                                                       lcsp-074
      jm=jm1+1                                                          lcsp-075
      if (m3.gt.jm1) go to 3                                            lcsp-076
      do 2 j=m3,jm1                                                     lcsp-077
      xj=j                                                              lcsp-078
      a2=a2+1.d0                                                        lcsp-079
      a(6,j)=0.d0                                                       lcsp-080
      if (a1.ne.0.d0) a(6,j)=a1/(a2*a2-a2)                              lcsp-081
      a(5,j)=dsqrt((x1+xj)*(x2+xj)*(x3+xj)*(x4+xj))/(a2*(2.d0*a2+1.d0)) lcsp-082
    2 a(7,j+1)=a(5,j)*(a2+a2+1.d0)/(a2+a2-1.d0)                         lcsp-083
    3 if (m3.gt.jm) go to 29                                            lcsp-084
      do 4 j=m3,jm                                                      lcsp-085
      a(1,j)=0.d0                                                       lcsp-086
      a(2,j)=0.d0                                                       lcsp-087
      a(3,j)=0.d0                                                       lcsp-088
      if (j.gt.ipj) go to 4                                             lcsp-089
      a(1,j)=f(1,j,i)                                                   lcsp-090
      a(2,j)=f(2,j,i)                                                   lcsp-091
    4 a(4,j)=0.d0                                                       lcsp-092
      if (.not.ls) go to 24                                             lcsp-093
c coulomb amplitude                                                     lcsp-094
      ns1=2.001*sp(1,1)                                                 lcsp-095
      ns2=2.001*sp(2,1)                                                 lcsp-096
      nsm=iabs(ns1-ns2)-nji                                             lcsp-097
      nsp=ns1+ns2-nji                                                   lcsp-098
      xs3=ns1+ns2+2                                                     lcsp-099
      xs4=ns1-ns2                                                       lcsp-100
      nst=nsp/2+1                                                       lcsp-101
      jmx=jmt+nst                                                       lcsp-102
      jmy=jmx+2                                                         lcsp-103
      if (lo(18)) jmy=jmy+2*nl(1)                                       lcsp-104
      if (2*jmy.gt.id) call memo(idmt,idmt+2*jmy-id,m,5,lo)             lcsp-105
      if (lo(216)) go to 36                                             lcsp-106
      do 5 j=1,nst                                                      lcsp-107
    5 ax(jmt+j)=1.d0                                                    lcsp-108
c reduced rotation matrix element                                       lcsp-109
      do 9 i1=1,2                                                       lcsp-110
      ms1=2*mf(2*i1-1,i)-ns1-2                                          lcsp-111
      ms2=ns2-2*mf(2*i1,i)+2                                            lcsp-112
      msp=iabs(ms1+ms2)-nji                                             lcsp-113
      nsq=max0(nsm,msp)/2+1                                             lcsp-114
      xs=ms1+ms2                                                        lcsp-115
      at(i1)=1.d0                                                       lcsp-116
      if (nsq.eq.1) go to 7                                             lcsp-117
      do 6 j=2,nsq                                                      lcsp-118
    6 ax(jmt+j-1)=0.d0                                                  lcsp-119
    7 if (nsq.eq.nst) go to 9                                           lcsp-120
      ns=nsq+1                                                          lcsp-121
      a2=0.d0                                                           lcsp-122
      a1=1.d0                                                           lcsp-123
      b2=0.d0                                                           lcsp-124
      do 8 k=ns,nst                                                     lcsp-125
      a3=a2                                                             lcsp-126
      a2=a1                                                             lcsp-127
      b1=b2                                                             lcsp-128
      xj=2*k+nji-2                                                      lcsp-129
      b2=dsqrt((xj**2-xs**2)*(xs3**2-xj**2)*(xj**2-xs4**2)/(xj**2-1.d0))lcsp-130
     1/(2.d0*xj)                                                        lcsp-131
      b3=ms1-ms2                                                        lcsp-132
      if (xj.ne.2.d0) b3=b3-xs*xs3*xs4/(xj*(xj-2.d0))                   lcsp-133
      a1=(a2*b3-a3*b1)/b2                                               lcsp-134
      ax(jmt+k)=ax(jmt+k)*a1                                            lcsp-135
    8 at(i1)=at(i1)+a1**2                                               lcsp-136
    9 continue                                                          lcsp-137
      ijx=nl(1)                                                         lcsp-138
      a3=1.d0                                                           lcsp-139
      jp=ipj                                                            lcsp-140
c multiplication by (1-cos), (1-cos**2) or their squares                lcsp-141
   10 do 12 ij=1,ijx                                                    lcsp-142
      a1=0.d0                                                           lcsp-143
      b1=0.d0                                                           lcsp-144
      do 11 j=m3,jp                                                     lcsp-145
      a2=a1                                                             lcsp-146
      b2=b1                                                             lcsp-147
      a1=a(1,j)                                                         lcsp-148
      b1=a(2,j)                                                         lcsp-149
      a(1,j)=a1-a3*(a(7,j)*a2+a(6,j)*a1+a(5,j)*a(1,j+1))                lcsp-150
   11 a(2,j)=b1-a3*(a(7,j)*b2+a(6,j)*b1+a(5,j)*a(2,j+1))                lcsp-151
      jp=jp+1                                                           lcsp-152
      a(1,jp)=-a3*a1*a(6,jp)                                            lcsp-153
   12 a(2,jp)=-a3*b1*a(6,jp)                                            lcsp-154
      a3=-a3                                                            lcsp-155
      if (lo(18).and.a3.lt.0.d0) go to 10                               lcsp-156
c initialisation of coulomb phase shifts                                lcsp-157
      c1=dsqrt(at(1)*at(2))                                             lcsp-158
      if (ax(jmx).lt.0.d0) c1=-c1                                       lcsp-159
      c2=ijx                                                            lcsp-160
      c3=2.d0**(ijx-1)                                                  lcsp-161
      do 23 ik=1,2                                                      lcsp-162
      nx=0                                                              lcsp-163
      nst1=nst                                                          lcsp-164
      do 13 j=1,nst                                                     lcsp-165
      a1=2.d0*ax(jmt+j)/c1*(1-mod(j+ik,2))                              lcsp-166
      if (a1.ne.0.d0) nx=nx+1                                           lcsp-167
   13 a(3,j)=a1                                                         lcsp-168
      if (nx.eq.0) go to 23                                             lcsp-169
      ax(jmx+1)=-c2*c3*wv(5,1)/(c2*c2+wv(5,1)**2)                       lcsp-170
      ax(jmx+2)=-c3*wv(5,1)**2/(c2*c2+wv(5,1)**2)                       lcsp-171
      if (lo(118)) go to 15                                             lcsp-172
      ax(jmx+1)=4.d0*c3*ax(jmx+1)                                       lcsp-173
      ax(jmx+2)=4.d0*c3*ax(jmx+2)                                       lcsp-174
      do 14 j=1,ijx                                                     lcsp-175
      a2=dfloat(j)*(dfloat(j+ijx)**2+wv(5,1)**2)                        lcsp-176
      a1=-dfloat(ijx-j+1)*(dfloat(ijx+j)*dfloat(ijx+j-1)+wv(5,1)**2)/a2 lcsp-177
      b1=dfloat(ijx-j+1)*wv(5,1)/a2                                     lcsp-178
      ax(jmx+2*j+1)=ax(jmx+2*j-1)*a1-ax(jmx+2*j)*b1                     lcsp-179
   14 ax(jmx+2*j+2)=ax(jmx+2*j-1)*b1+ax(jmx+2*j)*a1                     lcsp-180
   15 i1=3                                                              lcsp-181
      do 21 l=1,jm                                                      lcsp-182
      b1=2*l-1                                                          lcsp-183
c coulomb phase shift                                                   lcsp-184
      a1=ax(jmx+1)                                                      lcsp-185
      a2=ax(jmx+2)                                                      lcsp-186
      if (lo(118)) go to 17                                             lcsp-187
      do 16 j=1,ijx                                                     lcsp-188
      a1=a1+ax(jmx+2*j+1)                                               lcsp-189
   16 a2=a2+ax(jmx+2*j+2)                                               lcsp-190
   17 do 18 j=1,nst1                                                    lcsp-191
      if (lo(18).and.mod(l+ik,2).eq.1) go to 18                         lcsp-192
      a(1,j)=a(1,j)+a1*a(i1,j)*b1                                       lcsp-193
      a(2,j)=a(2,j)+a2*a(i1,j)*b1                                       lcsp-194
   18 continue                                                          lcsp-195
      i2=7-i1                                                           lcsp-196
      if (l.eq.jm) go to 21                                             lcsp-197
c product of rotation matrix elements by next pl                        lcsp-198
      b2=-(b1-1.d0)/(b1+1.d0)                                           lcsp-199
      b3=2.d0*b1/(b1+1.d0)                                              lcsp-200
      a1=0.d0                                                           lcsp-201
      do 19 j=m3,nst1                                                   lcsp-202
      a2=a1                                                             lcsp-203
      a1=a(i1,j)                                                        lcsp-204
      a(i2,j)=b2*a(i2,j)+(a(7,j)*a2+a(6,j)*a1+a(5,j)*a(i1,j+1))*b3      lcsp-205
      if (dabs(a(i2,j)).lt.1.d-10) a(i2,j)=0.d0                         lcsp-206
   19 continue                                                          lcsp-207
      if (nst1.ne.jm) a(i2,nst1+1)=a(7,nst1+1)*a1*b3                    lcsp-208
      nst1=min0(nst1+1,jm)                                              lcsp-209
      a1=(b1+1.d0)*wv(5,1)                                              lcsp-210
      b2=2.d0*c2                                                        lcsp-211
      a3=.25d0*(b1+1.d0+b2)**2+wv(5,1)**2                               lcsp-212
      a2=.25d0*(b1+1.d0-b2)*(b1+1.d0+b2)-wv(5,1)**2                     lcsp-213
      b3=(ax(jmx+1)*a2-ax(jmx+2)*a1)/a3                                 lcsp-214
      ax(jmx+2)=(ax(jmx+1)*a1+ax(jmx+2)*a2)/a3                          lcsp-215
      ax(jmx+1)=b3                                                      lcsp-216
      if (lo(118)) go to 21                                             lcsp-217
      do 20 j=1,ijx                                                     lcsp-218
      b2=b2+2.d0                                                        lcsp-219
      a3=.25d0*(b1+1.d0+b2)**2+wv(5,1)**2                               lcsp-220
      a2=.25d0*(b1+1.d0-b2)*(b1+1.d0+b2)-wv(5,1)**2                     lcsp-221
      b3=(ax(jmx+2*j+1)*a2-ax(jmx+2*j+2)*a1)/a3                         lcsp-222
      ax(jmx+2*j+2)=(ax(jmx+2*j+1)*a1+ax(jmx+2*j+2)*a2)/a3              lcsp-223
   20 ax(jmx+2*j+1)=b3                                                  lcsp-224
   21 i1=i2                                                             lcsp-225
      do 22 j=m3,jm                                                     lcsp-226
      a(3,j)=0.d0                                                       lcsp-227
   22 a(4,j)=0.d0                                                       lcsp-228
   23 continue                                                          lcsp-229
   24 b3=nji+2*m3-1                                                     lcsp-230
      i1=1                                                              lcsp-231
      i2=3                                                              lcsp-232
c coefficient of other pl                                               lcsp-233
      do 28 l=1,jml                                                     lcsp-234
      a3=0.d0                                                           lcsp-235
      c1=b3                                                             lcsp-236
      if (lo(18).and.mod(l,2).ne.1) go to 26                            lcsp-237
      do 25 j=m3,ipj                                                    lcsp-238
      a3=a3+(f(1,j,i)*a(i1,j)+f(2,j,i)*a(i1+1,j))/c1                    lcsp-239
   25 c1=c1+2.d0                                                        lcsp-240
      if (fm(5,i).ne.0.) a3=a3+a3                                       lcsp-241
      ax(l)=ax(l)+a3*xz                                                 lcsp-242
   26 if (l.eq.jml) go to 28                                            lcsp-243
      c1=l                                                              lcsp-244
      c2=-(c1-1.d0)/c1                                                  lcsp-245
      c3=(2.d0*c1-1.d0)/c1                                              lcsp-246
      i1=i2                                                             lcsp-247
      i2=4-i1                                                           lcsp-248
      a1=0.d0                                                           lcsp-249
      b1=0.d0                                                           lcsp-250
      do 27 j=m3,jm1                                                    lcsp-251
      a2=a1                                                             lcsp-252
      b2=b1                                                             lcsp-253
      a1=a(i2,j)                                                        lcsp-254
      b1=a(i2+1,j)                                                      lcsp-255
      a(i1,j)=c2*a(i1,j)+(a(7,j)*a2+a(6,j)*a1+a(5,j)*a(i2,j+1))*c3      lcsp-256
   27 a(i1+1,j)=c2*a(i1+1,j)+(a(7,j)*b2+a(6,j)*b1+a(5,j)*a(i2+1,j+1))*c3lcsp-257
      a(i1,jm)=a(7,jm)*a1*c3                                            lcsp-258
      a(i1+1,jm)=a(7,jm)*b1*c3                                          lcsp-259
   28 continue                                                          lcsp-260
   29 continue                                                          lcsp-261
      if (ls) write (2,1001) jk,ijx,jml                                 lcsp-262
      if (.not.ls) write (2,1002) jk,jml                                lcsp-263
      do 30 ll=1,jml,5                                                  lcsp-264
      l=ll-1                                                            lcsp-265
      lm=min0(jml,ll+4)                                                 lcsp-266
   30 write (2,1003) l,(ax(m),m=ll,lm)                                  lcsp-267
      do 31 ll=1,jml                                                    lcsp-268
      l=ll-1                                                            lcsp-269
      if (ls) write (7,1004) jk,l,ax(ll),ijx                            lcsp-270
      if (.not.ls) write (7,1005) jk,l,ax(ll)                           lcsp-271
   31 continue                                                          lcsp-272
   32 if (lo(181)) go to 35                                             lcsp-273
      write (2,1006) jk,ipk                                             lcsp-274
      do 33 ll=1,ipk,10                                                 lcsp-275
      l=2*ll-2                                                          lcsp-276
      lm=min0(ipk,ll+8)                                                 lcsp-277
   33 write (2,1003) l,(fcn(m,jk),m=ll,lm,2)                            lcsp-278
      do 34 ll=1,ipk                                                    lcsp-279
      l=2*ll-2                                                          lcsp-280
   34 write (7,1007) jk,l,fcn(ll,jk)                                    lcsp-281
   35 continue                                                          lcsp-282
      return                                                            lcsp-283
   36 write (2,1008)                                                    lcsp-284
      stop                                                              lcsp-285
 1000 format (68h1 coefficients of legendre polynomials describing the clcsp-286
     1ross-sections)                                                    lcsp-287
 1001 format (/29h direct interaction for level,i2,32h multiplied by (1-lcsp-288
     1cos(theta))**(,i2,2h ),i4,13h coefficients/4x,1hl,8x,4hc(l),14x,6hlcsp-289
     2c(l+1),13x,6hc(l+2),13x,6hc(l+3),13x,6hc(l+4))                    lcsp-290
 1002 format (/29h direct interaction for level,i2,1h,,i4,13h coefficienlcsp-291
     1ts/4x,1hl,8x,4hc(l),14x,6hc(l+1),13x,6hc(l+2),13x,6hc(l+3),13x,6hclcsp-292
     2(l+4))                                                            lcsp-293
 1003 format (i5,1p,5e19.10)                                            lcsp-294
 1004 format (2i5,1p,e20.10,5x,17h*(1-cos(theta)**(,i2,2h ))            lcsp-295
 1005 format (2i5,1p,e20.10)                                            lcsp-296
 1006 format (/27h compound nucleus for level,i2,1h,,i4,40h coefficientslcsp-297
     1 (only even ones are given)/4x,1hl,8x,4hc(l),14x,6hc(l+2),13x,6hc(lcsp-298
     2l+4),13x,6hc(l+6),13x,6hc(l+8))                                   lcsp-299
 1007 format (2i5,1p,e20.10,5x,16hcompound nucleus)                     lcsp-300
 1008 format (36h not enough place in lcsp   ... stop)                  lcsp-301
      end                                                               lcsp-302
c 27/04/98  ibm version                                         ecis97  resu-000
      subroutine resu(sp,ipi,sr,tx,jmax,kmax,ncoll,ncols,fm,mf,ipj,ipk,dresu-001
     1onn,ncolr,nco,coe,wv,wvm,fcn,ncont,noi,xd,ajx,nrz,njc,res,am,ex,thresu-002
     2e,dxx,spg,nzz,idmt,lo)                                            resu-003
c computes cross-sections and polarisations - compare to experimental   resu-004
c results -   obtains experimental normalisations and partial chi2      resu-005
c input variables: sp(j,i): spins of the part. and the target for j=1,2 resu-006
c                  ipi(j,i):parity of the nuclear states (+/-) for j=1, resu-007
c                           first/last ampl. and observable for each    resu-008
c                           level for j=5 to 8. (see calx)              resu-009
c                  sr:      helicity scattering coefficients            resu-010
c                  tx:      inelastic cross-sections in millibarns      resu-011
c                           followed by hauser-feshbach coefficients    resu-012
c                  jmax:    maximum number of channel spins             resu-013
c                  kmax:    maximum number of l for compound nucleus    resu-014
c                  ncoll:   number of coupled channels                  resu-015
c                  ncols:   number of channels with angular distributionresu-016
c                  fm,mf:   tables of helicity, description of observa- resu-017
c                           bles ... etc     see deph and obse          resu-018
c                  ipj:     number of channel spins used                resu-019
c                  ipk:     number of l for compound nucleus            resu-020
c                  donn:    experimental data:angle, value, exper. errorresu-021
c                           ,ang. width, ang. error and calculated errorresu-022
c                  ncolr:   number of experimental angular distributionsresu-023
c                  nco,coe: indications for observables     see obse    resu-024
c                  wv(i,j): wave number and coulomb parameter           resu-025
c                  wvm:     same as wv for the continuum                resu-026
c                  fcn:     compound nucleus coefficients               resu-027
c                  ncont:   number of continua for compound nucleus     resu-028
c                  noi:     starting and final addresses for continua   resu-029
c                  xd:      energy step for the continua                resu-030
c                  ajx:     minimum channel spin                        resu-031
c                  nrz:     length of sr+tx to be saved for minimum chi2resu-032
c                  njc:     first dimension of working array ex         resu-033
c                  nzz:     total length of working field,returns space resu-034
c                           used. (single precision)                    resu-035
c                  idmt:    total length of working field starting by spresu-036
c                  lo:      logical controls                            resu-037
c output variables:res:     difference between experimental and calcula-resu-038
c                           ted value divided by error (function of fiteresu-039
c in common /dblpr/chi2:    (calculated in resu)                        resu-040
c                  chi2m:   smaller previous chi2                       resu-041
c                  cmb:     nuclear mass divided by h bar               resu-042
c                  xz:      conversion factor to millibarns             resu-043
c in common /ncomp/nsp:     number of uncoupled states for comp. nucleusresu-044
c                  ndp:     address of fission and gamma results        resu-045
c working space:   am:      for general purposes                        resu-046
c                  ex:      for observables                             resu-047
c                  the,dxx,spg  for plots                               resu-048
c informations are also in labelled common /titr/ title: head of output resu-049
c        theta1,theta2,dtheta,dthe for calculation at equidistant anglesresu-050
c        jmm:   save ipj,ipk for minimum chi2                           resu-051
c        ncj:   for elimination of factors 1/(1-x*cos(theta)            resu-052
c the common /resc/ is used to transfer informations to scat            resu-053
c    see description in scat                                            resu-054
c internal logical lt(3):                                               resu-055
c          lt(1) is .true. for cross-section in millibarns              resu-056
c          lt(2) is .true. for symmetrised chi2, cross-section and      resu-057
c                normalisation error                                    resu-058
c          lt(3) is .true. for graph of polarisation                    resu-059
c          lkt is .false. for angle in the laboratory system            resu-060
c***********************************************************************resu-061
      implicit real*8 (a-h,o-z)                                         resu-062
      logical lo(250),lt(3),lkt                                         resu-063
      real*4 sp,fm,donn,res,the,dxx,spg,ajx,acn,az,lg(10),sigm(2),title,resu-064
     1theta1,theta2,dtheta,dthe                                         resu-065
      dimension sp(3,1),ipi(10,1),sr(2,jmax,1),tx(2),fm(9,1),mf(9,1),donresu-066
     1n(6,1),nco(1),coe(1),wv(15,1),wvm(15,1),fcn(kmax,1),noi(2,1),xd(3,resu-067
     21),res(1),am(1),ex(njc,4),the(1),dxx(1),spg(1),zx(3),zy(3)        resu-068
      common /titr/ title(18),theta1,theta2,dtheta,dthe,ncj,jmm(2),nl(3)resu-069
      common /resc/ excn,xa,xb,jn1,jn2,ntt,mtt,mt2,mt3,mt4,nout,nix,nfx,resu-070
     1klt,lkt                                                           resu-071
      common /dblpr/ chi2,chi2m,cm,ck,chb,cmb,ccz,xe,xm,xn,xz           resu-072
      common /ncomp/ nsp(3),nrd(4),acn(2),ncons(3),ndp,ndq,az(16)       resu-073
      data sigm,lg,i3,i4,i5,i7,lt /1h+,1h-,4h com,4hpoun,4hd nu,4hcleu,2resu-074
     1hs ,4h    ,4h    ,4h   d,4hirec,2ht ,4*0,3*.false./               resu-075
      nesp=0                                                            resu-076
      mt3=ipi(2,1)                                                      resu-077
      mt4=ipi(3,1)                                                      resu-078
      if (.not.lo(218)) go to 2                                         resu-079
c copy the scattering coefficients obtained for minimum chi2            resu-080
      ipj=jmm(1)                                                        resu-081
      ipk=jmm(2)                                                        resu-082
      do 1 i=1,nrz                                                      resu-083
    1 sr(i,1,1)=sr(i+nrz,1,1)                                           resu-084
    2 if (lo(131)) go to 26                                             resu-085
c calculation at experimental angles                                    resu-086
      klt=1                                                             resu-087
      chi2=0.d0                                                         resu-088
      nout=0                                                            resu-089
      ki=ipi(8,ncoll)                                                   resu-090
      kz=ki+ncolr                                                       resu-091
      ji=1                                                              resu-092
      ka=0                                                              resu-093
c pseudo loop on the angular distributions                              resu-094
    3 aa=0.d0                                                           resu-095
      bb=0.d0                                                           resu-096
      cc=0.d0                                                           resu-097
      jim=ji                                                            resu-098
      jin=ji                                                            resu-099
    4 j1=mf(2,kz+ji)                                                    resu-100
      j2=mf(3,kz+ji)                                                    resu-101
      lkt=mf(4,kz+ji).ne.1                                              resu-102
      if (j2.ge.j1) go to 5                                             resu-103
      ji=ji+1                                                           resu-104
      go to 4                                                           resu-105
    5 jif=ji                                                            resu-106
      j=j1                                                              resu-107
c pseudo loop on the experimental data                                  resu-108
    6 donn(6,j)=donn(3,j)                                               resu-109
      kc=1                                                              resu-110
      theta=donn(1,j)                                                   resu-111
    7 ji=jim                                                            resu-112
      zx(kc)=0.d0                                                       resu-113
      zy(kc)=0.d0                                                       resu-114
      if (mf(1,ki+ji).ne.8) go to 54                                    resu-115
c data are total cross sections                                         resu-116
      nix=ki+ji                                                         resu-117
      kx=kz+ji                                                          resu-118
      i=donn(1,j)*1.0001                                                resu-119
      k=max0(i,1)+1                                                     resu-120
      zx(1)=tx(k)                                                       resu-121
      if (i.eq.-1) zx(1)=tx(1)                                          resu-122
      if (i.eq.0) zx(1)=tx(1)-tx(2)                                     resu-123
      go to 15                                                          resu-124
    8 if (lt(1)) ex(2,kc)=1.d0                                          resu-125
      zx(kc)=(zx(kc)*zy(kc)+ex(2,kc)*ex(1,kc))/(zy(kc)+ex(1,kc))        resu-126
      zy(kc)=zy(kc)+ex(1,kc)                                            resu-127
      if (ji.eq.jif) go to 9                                            resu-128
      ji=ji+1                                                           resu-129
      go to 54                                                          resu-130
    9 if (lt(1)) zx(kc)=zx(kc)*zy(kc)                                   resu-131
      go to ( 10 , 11 , 12 ),kc                                         resu-132
   10 if (donn(4,j).eq.0) go to 15                                      resu-133
      kc=2                                                              resu-134
      theta=donn(1,j)-donn(4,j)                                         resu-135
      go to 7                                                           resu-136
   11 kc=3                                                              resu-137
      theta=donn(1,j)+donn(4,j)                                         resu-138
      go to 7                                                           resu-139
   12 if (lt(1)) go to 13                                               resu-140
      zx(1)=(zx(1)*zy(1)+zx(2)*zy(2)+zx(3)*zy(3))/(zy(1)+zy(2)+zy(3))   resu-141
      go to 14                                                          resu-142
   13 zx(1)=(zx(1)+zx(2)+zx(3))/3.d0                                    resu-143
   14 if (donn(5,j).ne.0.) donn(6,j)=dsqrt(donn(3,j)*donn(3,j)+((zx(2)-zresu-144
     1x(3))*donn(2,j)*donn(5,j)/(2.d0*donn(4,j)*zx(1)))**2)             resu-145
   15 res(j)=zx(1)                                                      resu-146
      if (lt(2)) donn(6,j)=donn(6,j)*sqrt(fm(6,kx)*res(j)/donn(2,j))    resu-147
      xc=donn(6,j)**2/fm(5,kx)                                          resu-148
      aa=aa+res(j)**2/xc                                                resu-149
      bb=bb+res(j)*donn(2,j)/xc                                         resu-150
      cc=cc+donn(2,j)**2/xc                                             resu-151
      j=j+1                                                             resu-152
c end of the pseudo loop on experimental data                           resu-153
      if (j.le.j2) go to 6                                              resu-154
c computation of normalisation and chi2                                 resu-155
      if (fm(7,kx).eq.0.) go to 18                                      resu-156
      xa=fm(5,kx)/fm(7,kx)**2                                           resu-157
      aa=aa+xa                                                          resu-158
      xb=fm(6,kx)                                                       resu-159
      bb=bb+xa*xb                                                       resu-160
      cc=cc+xa*xb*xb                                                    resu-161
      if (ji.eq.ncolr) go to 16                                         resu-162
      if (fm(6,kx).ne.fm(6,kx+1).or.fm(7,kx).ne.fm(7,kx+1)) go to 16    resu-163
      if ((2*iabs(mf(1,nix))-3)*(2*iabs(mf(1,nix+1))-3).lt.0) go to 16  resu-164
      ji=ji+1                                                           resu-165
      jim=ji                                                            resu-166
      go to 4                                                           resu-167
   16 if (lt(2)) go to 17                                               resu-168
      fm(8,kx)=bb/aa                                                    resu-169
      go to 19                                                          resu-170
   17 fm(8,kx)=dsqrt(cc/aa)                                             resu-171
      go to 19                                                          resu-172
   18 fm(8,kx)=fm(6,kx)                                                 resu-173
   19 do 24 jj=jin,ji                                                   resu-174
      ky=kz+jj                                                          resu-175
      nix=ki+jj                                                         resu-176
      j1=mf(2,ky)                                                       resu-177
      j2=mf(3,ky)                                                       resu-178
      if (j1.gt.j2) go to 24                                            resu-179
      if (ky.ne.kx) fm(8,ky)=fm(8,kx)                                   resu-180
      if (lo(215)) go to 20                                             resu-181
c output of the calculated and the experimental values                  resu-182
      m=0                                                               resu-183
      write (2,1000) title                                              resu-184
      if (mf(1,nix).ne.8) write (2,1001) mf(1,ky)                       resu-185
      write (2,1002) (mf(j,nix),j=5,9)                                  resu-186
   20 a1=fm(8,ky)                                                       resu-187
      a6=sqrt(fm(5,ky))                                                 resu-188
      aa=0.d0                                                           resu-189
      if (fm(7,ky).eq.0.) go to 21                                      resu-190
      a2=(a1-fm(6,ky))/fm(7,ky)                                         resu-191
      aa=a2**2                                                          resu-192
      res(j2+1)=a2*a6                                                   resu-193
      chi2=chi2+res(j2+1)**2                                            resu-194
   21 do 23 j=j1,j2                                                     resu-195
      a2=donn(2,j)/a1                                                   resu-196
      a3=donn(6,j)/a1                                                   resu-197
      a4=((res(j)-a2)/a3)**2                                            resu-198
      if (lo(215)) go to 22                                             resu-199
      m=m+1                                                             resu-200
      a5=donn(3,j)/a1                                                   resu-201
      the(m)=donn(1,j)                                                  resu-202
      dxx(m)=a2                                                         resu-203
      spg(m)=res(j)                                                     resu-204
      write (2,1003) donn(1,j),res(j),a2,a5,a3,a4                       resu-205
   22 aa=aa+a4                                                          resu-206
      res(j)=(res(j)-a2)*a6/a3                                          resu-207
   23 chi2=chi2+res(j)**2                                               resu-208
      fm(9,ky)=aa                                                       resu-209
      if (lo(215)) go to 24                                             resu-210
      write (2,1004) (fm(j,ky),j=6,9)                                   resu-211
      if (mf(1,nix).eq.8) go to 24                                      resu-212
      if (lo(59)) call hora                                             resu-213
      lt(3)=.not.(lt(1).or.mf(1,nix).eq.1)                              resu-214
      if (lo(167)) call gral(the,spg,dxx,m,mf(1,nix),1,lt(3),.false.)   resu-215
      if (lo(59)) call hora                                             resu-216
   24 continue                                                          resu-217
      ji=ji+1                                                           resu-218
c end of the pseudo loop on angular distributions                       resu-219
      if (ji.le.ncolr) go to 3                                          resu-220
      if (.not.lo(215)) write (2,1005) chi2                             resu-221
      if (chi2.gt.chi2m.or.lo(132)) go to 26                            resu-222
      jmm(1)=ipj                                                        resu-223
      jmm(2)=ipk                                                        resu-224
      chi2m=chi2                                                        resu-225
c if the chi2 decreased, save the scattering coefficients               resu-226
      do 25 i=1,nrz                                                     resu-227
   25 sr(i+nrz,1,1)=sr(i,1,1)                                           resu-228
   26 if (lo(215)) go to 53                                             resu-229
      lkt=lo(191)                                                       resu-230
      if (lo(66).and.lo(181)) go to 53                                  resu-231
c computation at equidistant angles                                     resu-232
      write (2,1000) title                                              resu-233
      if (wv(5,1).eq.0.d0) write (2,1006) tx(1)                         resu-234
      if (lo(90).and.wv(5,1).eq.0.d0) write (3,'(e12.5)') tx(1)         ak000000
      rx=tx(1)-tx(2)                                                    resu-235
      if (lo(181)) write (2,1007) rx                                    resu-236
      if (lo(70)) write (3,'(e12.5)') rx                                ak000000
      if (lo(181)) go to 36                                             resu-237
c compound nucleus results                                              resu-238
      write (2,1008) rx                                                 resu-239
      ndp=2*ncoll+nsp(1)+1                                              resu-240
      rx=rx-tx(ncoll+2)                                                 resu-241
      write (2,1009) rx                                                 resu-242
      if (lo(85)) write (2,1010) tx(ndp+1)                              resu-243
      if (lo(86)) write (2,1011) tx(ndp+2)                              resu-244
      rx=tx(ndp+1)+tx(ndp+2)                                            resu-245
      write (2,1012)                                                    resu-246
      ry=0.d0                                                           resu-247
      do 27 i=1,ncoll                                                   resu-248
      ii=ipi(1,i)+1                                                     resu-249
      ry=ry+tx(ncoll+i+1)                                               resu-250
   27 write (2,1013) i,sp(2,i),sigm(ii),wv(3,i),tx(ncoll+i+1)           resu-251
      write (2,1014) ry                                                 resu-252
      rx=rx+ry                                                          resu-253
      if (lo(184)) go to 35                                             resu-254
      if (ncoll.eq.ncols) go to 29                                      resu-255
      write (2,1015)                                                    resu-256
      ry=0.d0                                                           resu-257
      n1=ncoll+1                                                        resu-258
      do 28 i=n1,ncols                                                  resu-259
      ii=ipi(1,i)+1                                                     resu-260
      ry=ry+tx(ncoll+i+1)                                               resu-261
   28 write (2,1013) i,sp(2,i),sigm(ii),wv(3,i),tx(ncoll+i+1)           resu-262
      write (2,1014) ry                                                 resu-263
      rx=rx+ry                                                          resu-264
   29 nsp1=nsp(3)                                                       resu-265
      if (ncont.ne.0) nsp1=nsp1-ncons(2)                                resu-266
      if (nsp1.lt.1) go to 31                                           resu-267
      write (2,1016)                                                    resu-268
      ry=0.d0                                                           resu-269
      do 30 i=1,nsp1                                                    resu-270
      j=i+ncols                                                         resu-271
      ii=ipi(1,j)+1                                                     resu-272
      ry=ry+tx(ncoll+j+1)                                               resu-273
   30 write (2,1013) j,sp(2,j),sigm(ii),wv(3,j),tx(ncoll+j+1)           resu-274
      write (2,1014) ry                                                 resu-275
      rx=rx+ry                                                          resu-276
   31 if (ncont.eq.0) go to 35                                          resu-277
      do 34 i=1,ncont                                                   resu-278
      ij=noi(1,i)                                                       resu-279
      ji=noi(2,i)                                                       resu-280
      if (ij.gt.ji) go to 34                                            resu-281
      ry=0.d0                                                           resu-282
      do 32 ii=ij,ji                                                    resu-283
   32 ry=ry+tx(ncoll+ncols+nsp1+ii+1)                                   resu-284
      write (2,1017) i,ry                                               resu-285
      rx=rx+ry                                                          resu-286
      do 33 ii=ij,ji                                                    resu-287
      ry=tx(ncoll+ncols+nsp1+ii+1)/xd(2,ii)                             resu-288
   33 write (2,1018) ii,wvm(3,ii),xd(2,ii),tx(ncoll+ncols+nsp1+ii+1),ry resu-289
   34 continue                                                          resu-290
   35 write (2,1019) rx                                                 resu-291
      write (2,1000) title                                              resu-292
   36 iniv=1                                                            resu-293
      write (2,1020) sp(2,iniv),sigm(ipi(1,iniv)+1)                     resu-294
      nout=0                                                            resu-295
      klt=2                                                             resu-296
      j=int((theta2-theta1)/dtheta+1.5)                                 resu-297
c pseudo do loop on levels                                              resu-298
   37 if (wv(3,iniv).gt.0.d0) go to 38                                  resu-299
      write (2,1021) iniv                                               resu-300
      go to 49                                                          resu-301
   38 if (iniv.ne.1.and.lo(166)) write (2,1000) title                   resu-302
      if (iniv.ne.1) write (2,1022) iniv,sp(2,iniv),sigm(ipi(1,iniv)+1) resu-303
      if (iniv.eq.1.and.wv(5,1).ne.0.d0) go to 39                       resu-304
      rx=tx(iniv+1)                                                     resu-305
      if (lo(81)) rx=rx+tx(ncoll+iniv+1)                                resu-306
      if (iniv.eq.1) write (2,1023) rx                                  resu-307
      if (lo(90).and.iniv.eq.1) write (3,'(e12.5)') rx                  ak000000
      if (iniv.ne.1) write (2,1024) rx                                  resu-308
      if (lo(80).and.iniv.ne.1) write (3,'(e12.5,i3)') rx,iniv-1        ak000000
      if (lo(81)) write (2,1025) tx(iniv+1)                             resu-309
   39 if (lo(81)) write (2,1026) tx(ncoll+iniv+1)                       resu-310
      if (lo(66)) go to 53                                              resu-311
      if (j.le.0) go to 49                                              resu-312
      thetb=theta1                                                      resu-313
      ij=0                                                              resu-314
      ii=1                                                              resu-315
c pseudo do loop on angles                                              resu-316
   40 the(ii)=thetb                                                     resu-317
      theta=thetb                                                       resu-318
      kc=1                                                              resu-319
      go to 55                                                          resu-320
   41 dxx(ii)=ex(i5,1)                                                  resu-321
      if (lo(81)) go to 42                                              resu-322
      i1=min0(i3,7)                                                     resu-323
      write (2,1027) thetb,(ex(k,1),k=2,i1)                             resu-324
      go to 43                                                          resu-325
   42 i1=min0(i3,5)                                                     resu-326
      if (i1.lt.3) go to 44                                             resu-327
      write (2,1027) thetb,ex(2,1),ex(i3+1,1),ex(i4,1),(ex(k,1),k=3,i1) resu-328
   43 if (i1.ge.i3) go to 45                                            resu-329
      i2=i1+1                                                           resu-330
      i1=min0(i1+5,i3)                                                  resu-331
      write (2,1028) (ex(k,1),k=i2,i1)                                  resu-332
      go to 43                                                          resu-333
   44 write (2,1027) thetb,ex(2,1),ex(i3+1,1),ex(i4,1)                  resu-334
   45 if (lo(164)) go to 46                                             resu-335
      if (lo(60)) then                                                  ak000000
c       write (7,1029) (mf(1,nix+k-2),theta,ex(k,1),k=2,i3)             resu-336
        write (7,9999) (mf(1,nix+k-2),theta,ex(k,1),iniv-1,k=2,3)       ak000000
      else                                                              ak000000
        write (7,9999) mf(1,nix),theta,ex(2,1),iniv-1                   ak000000
      endif                                                             ak000000
      if (lo(81)) write (7,1030) theta,ex(i3+1,1),theta,ex(i4,1)        resu-337
   46 if (i7.le.0) go to 48                                             resu-338
      do 47 k=1,i7                                                      resu-339
      ij=ij+1                                                           resu-340
   47 spg(ij)=ex(k+i5,1)                                                resu-341
   48 thetb=thetb+dtheta                                                resu-342
      ii=ii+1                                                           resu-343
c end of the pseudo do loop on angles                                   resu-344
      if (ii.le.j) go to 40                                             resu-345
      if (lo(168))call gral(the,dxx,dxx,j,mf(1,nfx-i7),1,.false.,.true.)resu-346
      if (lo(169).and.i7.gt.0) call gral(the,spg,dxx,j,mf(1,nix+i5-1),i7resu-347
     1,.true.,.true.)                                                   resu-348
      if (lo(59)) call hora                                             resu-349
   49 iniv=iniv+1                                                       resu-350
c end of the pseudo do loop on levels                                   resu-351
      if (iniv.le.ncoll) go to 37                                       resu-352
      if (lo(181)) go to 53                                             resu-353
      jn2=ncoll                                                         resu-354
      klt=3                                                             resu-355
   50 jn1=jn2+1                                                         resu-356
      jn2=min0(jn1+5,ncols)                                             resu-357
      is=jn1-1                                                          resu-358
      if (jn1.gt.jn2) go to 53                                          resu-359
      write (2,1000) title                                              resu-360
      write (2,1031) jn1,jn2,(i,sp(2,i),sigm(ipi(1,i)+1),i=jn1,jn2)     resu-361
      thetb=theta1                                                      resu-362
      go to 52                                                          resu-363
   51 write (2,1032) thetb,(ex(i-is,1),i=jn1,jn2)                       resu-364
      thetb=thetb+dtheta                                                resu-365
   52 theta=thetb                                                       resu-366
      kc=1                                                              resu-367
      if (thetb.le.theta2) go to 63                                     resu-368
      go to 50                                                          resu-369
   53 nzz=4*nesp                                                        resu-370
      return                                                            resu-371
c for experimental data                                                 resu-372
   54 kx=kz+ji                                                          resu-373
      if (kx.eq.ka) go to 63                                            resu-374
      iniv=mf(1,kx)                                                     resu-375
      ka=kx                                                             resu-376
      go to 56                                                          resu-377
c for equidistant angles                                                resu-378
   55 if (iniv.eq.nout) go to 63                                        resu-379
   56 nout=iniv                                                         resu-380
c change of level                                                       resu-381
      jn1=ipi(5,nout)                                                   resu-382
      jn2=ipi(6,nout)                                                   resu-383
      mt1=ipi(2,nout)                                                   resu-384
      mt2=ipi(3,nout)                                                   resu-385
      ntt=jn2+1-jn1                                                     resu-386
      mtt=mt1*mt2*mt3*mt4                                               resu-387
      m2=1+2*mtt                                                        resu-388
      m3=m2+2*ntt                                                       resu-389
      m4=m3+ipj+ncj                                                     resu-390
      if (lo(226)) m4=max0(m4,6*mtt)                                    resu-391
      nesp=max0(nesp,m4)                                                resu-392
      if (4*m4.gt.nzz) call memo(idmt,idmt+4*m4-nzz,nzz,5,lo)           resu-393
      if (lo(216)) go to 73                                             resu-394
      if (lkt) go to 58                                                 resu-395
      if (lo(8)) go to 57                                               resu-396
      xa=1.d0                                                           resu-397
      xb=wv(4,1)*wv(1,nout)/(wv(4,nout)*wv(2,1))                        resu-398
      go to 58                                                          resu-399
   57 xa=dsqrt(1.d0+(wv(4,1)/(cmb*wv(2,1)))**2)                         resu-400
      xb=dsqrt(wv(1,nout)**2+(wv(4,nout)/cmb)**2)*wv(4,1)/(wv(4,nout)*wvresu-401
     1(2,1))                                                            resu-402
   58 if (klt.eq.2) go to 59                                            resu-403
c for experimental data                                                 resu-404
      nix=ki+ji                                                         resu-405
      nfx=nix                                                           resu-406
      lt(1)=mf(1,nix).eq.0                                              resu-407
      lt(2)=lo(33).and.(iabs(mf(1,nix)).le.1.and.fm(7,kx).eq.0.)        resu-408
      go to 63                                                          resu-409
c for equidistant angles                                                resu-410
   59 nix=ipi(7,iniv)                                                   resu-411
      nfx=ipi(8,iniv)                                                   resu-412
      i4=2+nfx-nix                                                      resu-413
      i3=i4                                                             resu-414
      i5=2                                                              resu-415
      if (i4.gt.2.and.mf(1,nix+1).eq.1) i5=3                            resu-416
      i7=i4-i5                                                          resu-417
      if (lo(81)) go to 60                                              resu-418
      ngx=min0(nfx,nix+5)                                               resu-419
      write (2,1033) ((fm(l,k),l=5,9),k=nix,ngx)                        resu-420
      go to 62                                                          resu-421
   60 i4=i4+2                                                           resu-422
      ngx=min0(nfx,nix+3)                                               resu-423
      njx=nix+1                                                         resu-424
      if (ngx.ge.njx) go to 61                                          resu-425
      write (2,1033) (fm(l,nix),l=5,9),lg                               resu-426
      go to 62                                                          resu-427
   61 write (2,1033) (fm(l,nix),l=5,9),lg,((fm(l,k),l=5,9),k=njx,ngx)   resu-428
   62 if (ngx.eq.nfx) go to 63                                          resu-429
      njx=ngx+1                                                         resu-430
      ngx=min0(nfx,njx+4)                                               resu-431
      write (2,1034) ((fm(l,k),l=5,9),k=njx,ngx)                        resu-432
      if (ngx.lt.nfx) go to 62                                          resu-433
   63 call scat(sr,mf,fm,jmax,kmax,theta,fcn,ipj,ipk,cmb,nco,coe,sp,mt1,resu-434
     1am,am(m2),am(m3),ex(1,kc),wv,ncj,ajx,xz,lo)                       resu-435
      go to ( 8 , 64 , 65 ) , klt                                       resu-436
   64 if (lo(181)) go to 65                                             resu-437
      ex(i4-1,kc)=excn                                                  resu-438
      ex(i4,kc)=ex(2,kc)-excn                                           resu-439
   65 if (dthe.eq.0.) go to ( 41 , 41 , 51 ) , klt                      resu-440
      go to ( 66 , 67 , 68 ),kc                                         resu-441
   66 kc=2                                                              resu-442
      theta=thetb-dthe                                                  resu-443
      go to 63                                                          resu-444
   67 kc=3                                                              resu-445
      theta=thetb+dthe                                                  resu-446
      go to 63                                                          resu-447
   68 if (klt.eq.3) go to 71                                            resu-448
      aa=ex(1,1)+ex(1,2)+ex(1,3)                                        resu-449
      do 70 k=2,i4                                                      resu-450
      if ((k.gt.i5).and.(k.le.i3)) go to 69                             resu-451
      ex(k,1)=(ex(k,1)+ex(k,2)+ex(k,3))/3.d0                            resu-452
      go to 70                                                          resu-453
   69 ex(k,1)=(ex(k,1)*ex(1,1)+ex(k,2)*ex(1,2)+ex(k,3)*ex(1,3))/aa      resu-454
   70 continue                                                          resu-455
      go to 41                                                          resu-456
   71 do 72 k=jn1,jn2                                                   resu-457
   72 ex(k-is,1)=(ex(k-is,1)+ex(k-is,2)+ex(k-is,3))/3.d0                resu-458
      go to 51                                                          resu-459
   73 write (2,1035)                                                    resu-460
      go to 53                                                          resu-461
 1000 format (1h1,5x,18a4//)                                            resu-462
 1001 format (//30x,18h**********   state,i5,14h    **********//)       resu-463
 1002 format (//42x,5a4//10x,5hangle,10x,10hcalc. val.,11x,9hexp. val.,1resu-464
     10x,10hexp. error,10x,10hcor. error,13x,4hchi2/)                   resu-465
 1003 format (6x,f10.3,5e20.5)                                          resu-466
 1004 format (//27h experimental normalisation,e15.5/20h normalisation eresu-467
     1rror,e22.5/25h calculated normalisation,e17.5//13h ***** chi2 =,e1resu-468
     25.6,8h   *****/)                                                  resu-469
 1005 format (/29h ************ chi2 **********,d20.10//)               resu-470
 1006 format (6x,25h==> total cross section =,f14.6,11h millibarns)     resu-471
 1007 format (31h total reaction cross section =,f14.6,11h millibarns)  resu-472
 1008 format (31h total reaction cross section =,f14.6,11h millibarns,11resu-473
     1x,30h( including compound elastic ))                              resu-474
 1009 format (38h total direct reaction cross section =,f14.6,11h millibresu-475
     1arns,4x,28h( without compound elastic ))                          resu-476
 1010 format (8x,23hfission cross section =,f14.6,11h millibarns)       resu-477
 1011 format (6x,25hgamma ray cross section =,f14.6,11h millibarns)     resu-478
 1012 format (/57h  compound cross section for scattering to coupled levresu-479
     1els/57h  =======================================================//resu-480
     250h   level     spin       energy       cross section/)           resu-481
 1013 format (i5,f9.1,a1,5h   at,f10.5,4h mev,f14.5)                    resu-482
 1014 format (/30h sum of compound contributions,f14.6,11h millibarns)  resu-483
 1015 format (/85h  compound cross section for scattering to uncoupled lresu-484
     1evels with angular distribution/85h  =============================resu-485
     2======================================================//50h   leveresu-486
     3l     spin       energy       cross section/)                     resu-487
 1016 format (/78h  compound cross section for scattering to levels withresu-488
     1out angular distribution/78h  ====================================resu-489
     2========================================//50h   level     spin    resu-490
     3   energy       cross section/)                                   resu-491
 1017 format (/10h continuum,i4/40h total compound reaction cross sectioresu-492
     1n =,f14.6,11h millibarns//8x,57h energy     step     contribution resu-493
     2 value (millibarns/mev)/)                                         resu-494
 1018 format (2x,i3,2f10.5,2f15.5)                                      resu-495
 1019 format (/36h total sum of compound contributions,f14.6,11h millibaresu-496
     1rns)                                                              resu-497
 1020 format (/49h elastic scattering on the target state of spin =,f5.1resu-498
     1,a1)                                                              resu-499
 1021 format (//36h closed channel for the target state,i3)             resu-500
 1022 format (/41h inelastic scattering to the target state,i3,8h  spin resu-501
     1=,f5.1,a1)                                                        resu-502
 1023 format (/31h  total elastic cross section =,f14.6,11h millibarns) resu-503
 1024 format (/6x,25hinelastic cross section =,f14.6,11h millibarns)    resu-504
 1025 format (9x,22hdirect cross section =,f14.6,11h millibarns)        resu-505
 1026 format (7x,24hcompound cross section =,f14.6,11h millibarns)      resu-506
 1027 format (1x,f10.3,e16.5,2x,5f18.7)                                 resu-507
 1028 format (29x,5f18.7)                                               resu-508
 1029 format (i3,2e12.5)                                                resu-509
 9999 format (i3,2e12.5,i3)                                             ak000000
 1030 format (3h -4,2e12.5/3h -5,2e12.5)                                resu-510
 1031 format (/54h angular distribution of compound scattering on levelsresu-511
     1,i3,3h to,i3//6x,5hangle,6(i6,6h-level,f5.1,a1))                  resu-512
 1032 format (1x,f10.3,6f18.7)                                          resu-513
 1033 format (/6x,6hangle ,6(4a4,a2))                                   resu-514
 1034 format (30x,5(4a4,a2))                                            resu-515
 1035 format (//67h **** not enough storage for the computation of crossresu-516
     1-sections ****//)                                                 resu-517
      end                                                               resu-518
c 27/04/98  ibm version                                         ecis97  scat-000
      subroutine scat(fr,mf,fm,jmax,kmax,theta,fcn,ipj,ipk,cmb,nco,coe,sscat-001
     1p,mt1,ab,a,b,ex,wv,ncj,ajx,xz,lo)                                 scat-002
c computation of observables                                            scat-003
c input variables: fr:    scattering coeff. in the helicity formalism   scat-004
c                  mf,fm: tables of helicity,description of observables,scat-005
c                         .... etc   see deph and obse                  scat-006
c                  jmax:  dimension for fr                              scat-007
c                  kmax:  dimension for fcn                             scat-008
c                  theta: scattering angle                              scat-009
c                  fcn:   compound nucleus coefficients                 scat-010
c                  ipj:   number of j values used for scattering        scat-011
c                  ipk:   number of l values used for compound nucleus  scat-012
c                  cmb:   atomic mass unit divided by hbar              scat-013
c                  nco,coe:   loops and coeff. for observables  see obsescat-014
c                  sp:    spins for incident and target nucleus         scat-015
c                  mt1:   multiplicity of the outgoing particle         scat-016
c                         second dimension of the working space ab      scat-017
c                  wv:    masses, energies, etc..    see calx           scat-018
c                  ncj:   number of factorisations of 1/(1-x*cos(theta))scat-019
c                  ajx:   minimum of the total spin                     scat-020
c                  xz:    conversion factor to millibarns               scat-021
c                  lo:    logical controls                              scat-022
c output variables:ex:    differ. cross-section followed by observables scat-023
c working space:   ab:    amplitudes in the c. m. or the lab. system    scat-024
c                  a:     for independent amplitudes                    scat-025
c                  b:     to store the rotation matrix elements         scat-026
c other input by common /resc/                                          scat-027
c                  excn:   compound-nucleus cross-section               scat-028
c                  xa,xb:  constants for change to laboratory system    scat-029
c                  jn1,jn2:first and last amplitude in:the table        scat-030
c                  ntt:    number of independent amplitudes             scat-031
c                  mtt:    total number of amplitudes                   scat-032
c                  mt2:    multiplicity of the residual target          scat-033
c                  mt3:    multiplicity of the incident particle        scat-034
c                  mt4:    multiplicity of the initial target           scat-035
c                  nout:   nuclear state considered                     scat-036
c                  nix,nfx:first and last observable in the table       scat-037
c                  klt:    1 for experimental data                      scat-038
c                          2 for equidistant angles                     scat-039
c                          3 for pure compound nucleus                  scat-040
c                  lkt:    .true. for center of mass system             scat-041
c***********************************************************************scat-042
      implicit real*8 (a-h,o-z)                                         scat-043
      logical lo(250),ltt(6),lxy,lkt                                    scat-044
      real*4 fm,ajx,sp,sm1,sm2,sm3,sm4                                  scat-045
      dimension fr(2,jmax,1),fm(9,1),mf(9,1),nco(20,1),coe(1),sp(3,1),abscat-046
     1(2,mt1,1),a(2,1),b(2),ex(2),wv(15,1),mo(18),fcn(kmax,1)           scat-047
      equivalence (mo(1),mi1),(mo(2),mp1),(mo(3),n1),(mo(4),l1),(mo(5),mscat-048
     1i2),(mo(6),mp2),(mo(7),n2),(mo(8),l2),(mo(9),mi3),(mo(10),mp3),(moscat-049
     2(11),n3),(mo(12),l3),(mo(13),mi4),(mo(14),mp4),(mo(15),n4),(mo(16)scat-050
     3,l4),(mo(17),jq),(mo(18),jp)                                      scat-051
      common /resc/ excn,xa,xb,jn1,jn2,ntt,mtt,mt2,mt3,mt4,nout,nix,nfx,scat-052
     1klt,lkt                                                           scat-053
      thet=1.74532925d-02*theta                                         scat-054
      if (klt.eq.3) go to 56                                            scat-055
c for experimental data or equidistant angles                           scat-056
      w6=dcos(thet)                                                     scat-057
      w7=dsin(thet)                                                     scat-058
      if (lkt) go to 1                                                  scat-059
      xc=(xa**2-xb**2)*w7**2+w6**2                                      scat-060
      if (xc.gt.0.d0) xc=dsqrt(xc)                                      scat-061
      a3=xc*w6-xa*xb*w7**2                                              scat-062
      w7=w7*(xb*w6+xc*xa)                                               scat-063
      w6=a3                                                             scat-064
    1 if (lo(181)) go to 3                                              scat-065
c compound nucleus contribution                                         scat-066
      excn=fcn(1,nout)                                                  scat-067
      if (ipk.eq.1) go to 3                                             scat-068
      u1=0.d0                                                           scat-069
      u2=1.d0                                                           scat-070
      do 2 j=2,ipk                                                      scat-071
      u1=((4*j-7)*u2*w6-(2*j-4)*u1)/dfloat(2*j-3)                       scat-072
      u2=((4*j-5)*u1*w6-(2*j-3)*u2)/dfloat(2*j-2)                       scat-073
    2 excn=excn+u2*fcn(j,nout)*dfloat(4*j-3)                            scat-074
c direct interaction contribution                                       scat-075
    3 w3=1.d0                                                           scat-076
      x2=dsqrt(.5d0*(1.d0+w6))                                          scat-077
      x3=dsqrt(.5d0*(1.d0-w6))                                          scat-078
      do 4 i=1,ntt                                                      scat-079
      a(1,i)=0.d0                                                       scat-080
    4 a(2,i)=0.d0                                                       scat-081
      if (nout.ne.1) go to 7                                            scat-082
c computation of coulomb amplitudes for the elastic channel             scat-083
      if (wv(5,1).eq.0..or.x3.lt.1.e-20) go to 7                        scat-084
      w2=2.d0*wv(5,1)*dlog(x3)                                          scat-085
      w3=-0.5d0*wv(5,1)/(x3*x3)                                         scat-086
      w4=w3*dcos(w2)                                                    scat-087
      w5=-w3*dsin(w2)                                                   scat-088
      w3=w3**2                                                          scat-089
      if (lo(118)) go to 5                                              scat-090
c symmetrisation between projectile and target                          scat-091
      fs=1.-amod(4.*sp(1,1),4.)                                         scat-092
      y2=2.d0*wv(5,1)*dlog(x2)                                          scat-093
      y1=-0.5d0*wv(5,1)/(x2*x2)                                         scat-094
      y4=y1*dcos(y2)                                                    scat-095
      y5=-y1*dsin(y2)                                                   scat-096
      w3=w4**2+w5**2+y4**2+y5**2+fs*(w4*y4+w5*y5)/(sp(1,1)+.5)          scat-097
c transformation of the coulomb amplitudes to the helicity formalism    scat-098
    5 do 6 i=1,ntt                                                      scat-099
      sm1=mf(1,i)-1-sp(1,1)                                             scat-100
      sm2=sp(2,1)-mf(2,i)+1                                             scat-101
      sm3=mf(3,i)-1-sp(1,1)                                             scat-102
      sm4=sp(2,1)-mf(4,i)+1                                             scat-103
      call emro(sp(1,1),sm3,sm1,w6,x2,x3,b,1)                           scat-104
      call emro(sp(2,1),sm4,sm2,w6,x2,x3,b(2),1)                        scat-105
      w1=b(1)*b(2)                                                      scat-106
      a(1,i)=w4*w1                                                      scat-107
      a(2,i)=w5*w1                                                      scat-108
      if (lo(118)) go to 6                                              scat-109
      call emro(sp(1,1),sm3,sm2,w6,x2,x3,b,1)                           scat-110
      call emro(sp(2,1),sm4,sm1,w6,x2,x3,b(2),1)                        scat-111
      y1=b(1)*b(2)*fs                                                   scat-112
      a(1,i)=a(1,i)+y4*y1                                               scat-113
      a(2,i)=a(2,i)+y5*y1                                               scat-114
    6 continue                                                          scat-115
      w3=w3/wv(4,1)**2                                                  scat-116
c computation of the nuclear amplitudes                                 scat-117
    7 do 13 i=jn1,jn2                                                   scat-118
      ij=i-jn1+1                                                        scat-119
      w5=1.d0                                                           scat-120
      jn=ipj                                                            scat-121
      if (lo(141)) go to 9                                              scat-122
c factorisation of 1/(1-x*cos(theta)) with x after the scat. coeff.     scat-123
      do 8 j=1,ncj                                                      scat-124
      jn=jn+1                                                           scat-125
    8 w5=w5/(1.d0-fr(1,jn,i)*w6)                                        scat-126
    9 if (abs(fm(7,i)).eq..25) go to 10                                 scat-127
      call emro(ajx,fm(6,i),fm(7,i),w6,x2,x3,b,jn)                      scat-128
      w1=w5                                                             scat-129
      go to 11                                                          scat-130
c rotation matrix elements are the same as for the last amplitude       scat-131
   10 w1=w5*fm(7,i)/abs(fm(7,i))                                        scat-132
   11 do 12 j=1,ipj                                                     scat-133
      a(1,ij)=a(1,ij)+fr(1,j,i)*w1*b(j)                                 scat-134
   12 a(2,ij)=a(2,ij)+fr(2,j,i)*w1*b(j)                                 scat-135
c construction of the total amplitude matrix                            scat-136
      k1=mf(8,i)                                                        scat-137
      ab(1,k1,1)=a(1,ij)                                                scat-138
      ab(2,k1,1)=a(2,ij)                                                scat-139
      if (fm(5,i).eq.0.) go to 13                                       scat-140
      w1=fm(5,i)                                                        scat-141
      k1=mf(9,i)                                                        scat-142
      ab(1,k1,1)=w1*a(1,ij)                                             scat-143
      ab(2,k1,1)=w1*a(2,ij)                                             scat-144
   13 continue                                                          scat-145
c cross-section                                                         scat-146
      dz=0.d0                                                           scat-147
      if (lo(81)) dz=excn/xz                                            scat-148
      do 14 i1=1,mtt                                                    scat-149
   14 dz=dz+ab(1,i1,1)*ab(1,i1,1)+ab(2,i1,1)*ab(2,i1,1)                 scat-150
      ex(1)=dz*xz                                                       scat-151
      lx1=0                                                             scat-152
      lx2=0                                                             scat-153
      jex=1                                                             scat-154
c loop on the observables                                               scat-155
      do 54 iex=nix,nfx                                                 scat-156
      jex=jex+1                                                         scat-157
      if (mf(1,iex).gt.1) go to 21                                      scat-158
      if (mf(1,iex)) 17 , 15 , 16                                       scat-159
c cross section                                                         scat-160
   15 ex(jex)=ex(1)                                                     scat-161
      go to 54                                                          scat-162
c cross section divided by rutherford's cross-section                   scat-163
   16 ex(jex)=ex(1)/(10.d0*w3)                                          scat-164
      go to 54                                                          scat-165
   17 ex(jex)=0.d0                                                      scat-166
      if (mf(1,iex).eq.-3) go to 19                                     scat-167
      mtp=mt1*mt2*mt4                                                   scat-168
c vector analysing power for spin 1/2 or 1                              scat-169
      do 18 i1=1,mtp                                                    scat-170
      i2=i1+mtp                                                         scat-171
   18 ex(jex)=ex(jex)+ab(2,i2,1)*ab(1,i1,1)-ab(1,i2,1)*ab(2,i1,1)       scat-172
      ex(jex)=2.d0*ex(jex)*xz/ex(1)                                     scat-173
      if (mt3.eq.3) ex(jex)=1.22474487d0*ex(jex)                        scat-174
      go to 54                                                          scat-175
c vector polarisation for spin 1/2 or 1                                 scat-176
   19 do 20 i1=1,mtt,mt1                                                scat-177
   20 ex(jex)=ex(jex)+ab(1,i1+1,1)*ab(2,i1,1)-ab(2,i1+1,1)*ab(1,i1,1)   scat-178
      ex(jex)=2.d0*ex(jex)*xz/ex(1)                                     scat-179
      if (mt1.eq.3) ex(jex)=1.22474487d0*ex(jex)                        scat-180
      go to 54                                                          scat-181
c all the other observables                                             scat-182
   21 ex(jex)=0.d0                                                      scat-183
      k1=mf(3,iex)                                                      scat-184
      k2=mf(4,iex)                                                      scat-185
c loop on the components of the description of the observable           scat-186
      do 53 ii=k1,k2                                                    scat-187
      ix=1                                                              scat-188
      ixy=1                                                             scat-189
      ixx=ixy+mt2*mt3*mt4                                               scat-190
      do 22 i=1,18                                                      scat-191
   22 mo(i)=nco(i,ii)                                                   scat-192
      do 23 ij=1,6                                                      scat-193
      ltt(ij)=mod(jq,2).eq.1                                            scat-194
   23 jq=jq/2                                                           scat-195
c computation of the angle for a change of frame                        scat-196
      if (mod(jp,1000).eq.0) go to 46                                   scat-197
      lxy=.true.                                                        scat-198
      if (lx1.eq.mod(jp,1000)) go to 45                                 scat-199
      lx1=mod(jp,1000)                                                  scat-200
      lx2=0                                                             scat-201
      n=mt1                                                             scat-202
      if (lx1.eq.1) go to 26                                            scat-203
      go to 25                                                          scat-204
   24 if (jp/1000.eq.0) go to 46                                        scat-205
      lxy=.false.                                                       scat-206
      if (jp/1000.eq.lx2) go to 45                                      scat-207
      lx2=jp/1000                                                       scat-208
      n=mt2                                                             scat-209
      if (lx2.eq.1) go to 27                                            scat-210
   25 if (dabs(w7).lt.1.d-5.or.n.eq.1) go to 43                         scat-211
      w1=w6                                                             scat-212
      w2=-w7                                                            scat-213
      go to 31                                                          scat-214
c transformation to the laboratory system for the particle              scat-215
   26 w1=wv(1,nout)                                                     scat-216
      go to 28                                                          scat-217
c transformation to the laboratory system for the target                scat-218
   27 w1=-wv(2,nout)                                                    scat-219
   28 if (n.eq.1) go to 43                                              scat-220
      if (lo(108)) go to 29                                             scat-221
      w1=wv(4,nout)/(cmb*w1)                                            scat-222
      w2=cmb*wv(2,1)/wv(4,1)                                            scat-223
      w3=datan(-w7/(w6*dsqrt(w1*w1+1.d0)+w1*dsqrt(w2*w2+1.d0)))         scat-224
      go to 30                                                          scat-225
   29 w3=datan(-w7/(wv(4,nout)*wv(2,1)/(wv(4,1)*w1)+w6))                scat-226
   30 if (dabs(w3).lt.1.d-5.or.n.eq.1) go to 43                         scat-227
      w1=dcos(w3)                                                       scat-228
      w2=dsin(w3)                                                       scat-229
   31 do 32 i=1,mtt                                                     scat-230
      ab(1,i,ixx)=0.d0                                                  scat-231
   32 ab(2,i,ixx)=0.d0                                                  scat-232
      w3=dsqrt(.5d0*(1.d0-w1))                                          scat-233
      w5=1.d0                                                           scat-234
      do 33 i=2,n                                                       scat-235
   33 w5=-w5*w3                                                         scat-236
      if (dabs(w5).lt.1.d-30) go to 43                                  scat-237
      w4=0.d0                                                           scat-238
      w8=.5d0*(n-1)                                                     scat-239
      mty=mt3*mt4                                                       scat-240
      x3=-w8                                                            scat-241
c transformation of the amplitude matrix                                scat-242
      do 42 i=1,n                                                       scat-243
      if (i.eq.1) go to 34                                              scat-244
      w3=w4                                                             scat-245
      if (i.ne.2) w3=w3*dsqrt(dfloat((i-2)*(n+2-i)))                    scat-246
      w4=w5                                                             scat-247
      w5=(2.d0*(x3*w1-w8)*w4/w2-w3)/dsqrt(dfloat((i-1)*(n+1-i)))        scat-248
      x3=x3+1.d0                                                        scat-249
   34 x2=0.d0                                                           scat-250
      x5=w5                                                             scat-251
      x4=w8                                                             scat-252
      do 41 j=i,n                                                       scat-253
      if (j.eq.i) go to 35                                              scat-254
      x1=x2                                                             scat-255
      if (j.ne.i+1) x1=x1*dsqrt(dfloat((j-i-1)*(n+1-j+i)))              scat-256
      x2=x5                                                             scat-257
      x5=(2.d0*(x3-x4*w1)*x2/w2-x1)/dsqrt(dfloat((j-i)*(n+i-j)))        scat-258
      x4=x4-1.d0                                                        scat-259
   35 x=x5                                                              scat-260
      l=1+j-i                                                           scat-261
      m=n+1-i                                                           scat-262
      do 40 k=1,2                                                       scat-263
      do 39 i1=1,mty                                                    scat-264
      if (lxy) go to 37                                                 scat-265
      ixi=ixx+(i1-1)*mt2+l-1                                            scat-266
      ixj=ixy+(i1-1)*mt2+m-1                                            scat-267
      do 36 i4=1,mt1                                                    scat-268
      ab(1,i4,ixi)=ab(1,i4,ixi)+x*ab(1,i4,ixj)                          scat-269
   36 ab(2,i4,ixi)=ab(2,i4,ixi)+x*ab(2,i4,ixj)                          scat-270
      go to 39                                                          scat-271
   37 ixi=mt1*(ixx+(i1-1)*mt2-1)+l                                      scat-272
      ixj=mt1*(ixy+(i1-1)*mt2-1)+m                                      scat-273
      do 38 i4=1,mt2                                                    scat-274
      ab(1,ixi,i4)=ab(1,ixi,i4)+x*ab(1,ixj,i4)                          scat-275
   38 ab(2,ixi,i4)=ab(2,ixi,i4)+x*ab(2,ixj,i4)                          scat-276
   39 continue                                                          scat-277
      if (j.eq.n) go to 41                                              scat-278
      ml=l                                                              scat-279
      l=m                                                               scat-280
      m=ml                                                              scat-281
      if (mod(j+n,2).ne.0) x=-x                                         scat-282
   40 continue                                                          scat-283
   41 continue                                                          scat-284
   42 continue                                                          scat-285
      go to 45                                                          scat-286
   43 do 44 i=1,mtt                                                     scat-287
      ab(1,i,ixx)=ab(1,i,ixy)                                           scat-288
   44 ab(2,i,ixx)=ab(2,i,ixy)                                           scat-289
   45 ix=ix+1                                                           scat-290
      ixy=ixx                                                           scat-291
      ixx=ixy+mt2*mt3*mt4                                               scat-292
      if (lxy) go to 24                                                 scat-293
   46 if (ltt(5)) go to 52                                              scat-294
      x=0.d0                                                            scat-295
c the four do loops                                                     scat-296
      do 51 i1=mi1,mp1                                                  scat-297
      j1=i1-n1                                                          scat-298
      x1=coe(10*ii)                                                     scat-299
      if (ltt(1)) x1=coe(10*ii)*coe(i1+l1)                              scat-300
      do 50 i2=mi2,mp2                                                  scat-301
      j2=i2-n2                                                          scat-302
      x2=x1                                                             scat-303
      if (ltt(2)) x2=x1*coe(l2-i2)                                      scat-304
      do 49 i3=mi3,mp3                                                  scat-305
      j3=i3-n3                                                          scat-306
      x3=x2                                                             scat-307
      if (ltt(3)) x3=x2*coe(i3+l3)                                      scat-308
      do 48 i4=mi4,mp4                                                  scat-309
      j4=i4-n4                                                          scat-310
      x4=x3                                                             scat-311
      iij=i4+mt2*(j2-1+mt4*(j1-1+mt3*(ix-1)))                           scat-312
      iii=j4+mt2*(i2-1+mt4*(i1-1+mt3*(ix-1)))                           scat-313
      if (ltt(4)) x4=x3*coe(l4-i4)                                      scat-314
      if (ltt(6)) go to 47                                              scat-315
      x=x+(ab(1,i3,iij)*ab(1,j3,iii)+ab(2,i3,iij)*ab(2,j3,iii))*x4      scat-316
      go to 48                                                          scat-317
   47 x=x+(ab(2,i3,iij)*ab(1,j3,iii)-ab(1,i3,iij)*ab(2,j3,iii))*x4      scat-318
   48 continue                                                          scat-319
   49 continue                                                          scat-320
   50 continue                                                          scat-321
   51 continue                                                          scat-322
      go to 53                                                          scat-323
   52 x=coe(10*ii)*dz                                                   scat-324
   53 ex(jex)=ex(jex)+x                                                 scat-325
      ex(jex)=ex(jex)/dz                                                scat-326
   54 continue                                                          scat-327
      if (lkt) go to 55                                                 scat-328
      xc=dsqrt((xa*w6+xb)**2+w7**2)**3/dabs(xa+xb*w6)                   scat-329
      ex(1)=ex(1)*xc                                                    scat-330
   55 if (klt.eq.1.or.lkt) return                                       scat-331
      ex(2)=ex(2)*xc                                                    scat-332
      if (lo(81)) excn=excn*xc                                          scat-333
      return                                                            scat-334
c pure compound nucleus for levels jn1 to jn2                           scat-335
   56 is=jn1-1                                                          scat-336
      do 63 iv=jn1,jn2                                                  scat-337
      ex(iv-is)=fcn(1,iv)                                               scat-338
      if (ipk.eq.1) go to 62                                            scat-339
      if (lkt) go to 59                                                 scat-340
      if (lo(8)) go to 57                                               scat-341
      xa=1.d0                                                           scat-342
      xb=wv(4,1)*wv(1,iv)/(wv(4,iv)*wv(2,1))                            scat-343
      go to 58                                                          scat-344
   57 xa=dsqrt(1.d0+(wv(4,1)/(cmb*wv(2,1)))**2)                         scat-345
      xb=dsqrt(wv(1,iv)**2+(wv(4,iv)/cmb)**2)*wv(4,1)/(wv(4,iv)*wv(2,1))scat-346
   58 w6=dcos(thet)                                                     scat-347
      w7=dsin(thet)                                                     scat-348
      xc=(xa**2-xb**2)*w7**2+w6**2                                      scat-349
      if (xc.gt.0.d0) xc=dsqrt(xc)                                      scat-350
      w6=xc*w6-xa*xb*w7**2                                              scat-351
      go to 60                                                          scat-352
   59 w6=dcos(thet)                                                     scat-353
   60 u1=0.d0                                                           scat-354
      u2=1.d0                                                           scat-355
      do 61 j=2,ipk                                                     scat-356
      u1=((4*j-7)*u2*w6-(2*j-4)*u1)/dfloat(2*j-3)                       scat-357
      u2=((4*j-5)*u1*w6-(2*j-3)*u2)/dfloat(2*j-2)                       scat-358
   61 ex(iv-is)=ex(iv-is)+u2*fcn(j,iv)*(4*j-3)                          scat-359
   62 if (.not.lkt) ex(iv-is)=ex(iv-is)*dsqrt((xa*w6+xb)**2+1.d0-w6**2)*scat-360
     1*3/dabs(xa+xb*w6)                                                 scat-361
   63 continue                                                          scat-362
      return                                                            scat-363
      end                                                               scat-364
c 26/03/96  ibm and cdc version                                 ecis96  gral-000
      subroutine gral(tgr,grr,frr,mteta,mf,id1,lt1,lt2)                 gral-001
c plots of cross-section and polarisations with or without exper. data  gral-002
c input variables: tgr(i):    angles for i=1,mteta                      gral-003
c                  grr(j,i):  calc. values for j=1,id1 and i=1,mteta    gral-004
c                  frr(i):    exper. values for i=1,mteta               gral-005
c                  mteta:     number of angles                          gral-006
c                  mf:        description of data    see obse           gral-007
c                  id1:       number of different polarisations         gral-008
c                  lt1:       .true. for polarisation,                  gral-009
c                             .false. for cross section                 gral-010
c                  lt2:       .true. if there are no experimental data  gral-011
c mf(i,j) is a title for i=5,9                                          gral-012
c mf(2,j) is the number of power of 10 in a line for cross sections     gral-013
c  and must be 1 to plot a polarisation (always between -1 and 1)       gral-014
c***********************************************************************gral-015
      logical lt1,lt2                                                   gral-016
      dimension tgr(1),grr(id1,1),mf(9,1),frr(1),vgr(112),gra(17)       gral-017
      data  gra /1h+,1h*,1h,,1h:,1h-,1h1,1h2,1h3,1h4,1h5,1h6,1h7,1h8,1h9gral-018
     1,1h0,1h ,1h./                                                     gral-019
      if (lt1) go to 14                                                 gral-020
c cross sections                                                        gral-021
      if ((mf(2,1).le.0).or.(mf(2,1).gt.50)) return                     gral-022
      na2=100/mf(2,1)                                                   gral-023
      aa2=na2                                                           gral-024
      write (2,1000)                                                    gral-025
      write (2,1001) gra(1),(mf(j,1),j=5,9)                             gral-026
      if (.not.lt2) write (2,1007)                                      gral-027
      aa3=aa2*((mf(2,1)+1)/2)                                           gral-028
      aa1=aa2/alog(10.)                                                 gral-029
      na1=101-mf(2,1)*na2                                               gral-030
      a5=101.5                                                          gral-031
      do 1 i=1,112                                                      gral-032
    1 vgr(i)=gra(16)                                                    gral-033
      do 2 i=na1,112,na2                                                gral-034
    2 vgr(i)=gra(6)                                                     gral-035
      write (2,1002) vgr                                                gral-036
      do 3 i=1,112                                                      gral-037
    3 vgr(i)=gra(17)                                                    gral-038
      do 4 i=na1,112,na2                                                gral-039
    4 vgr(i)=gra(2)                                                     gral-040
      write (2,1002) vgr                                                gral-041
      do 11 i=1,mteta                                                   gral-042
      do 5 j=2,111                                                      gral-043
    5 vgr(j)=gra(16)                                                    gral-044
      do 6 j=na1,111,na2                                                gral-045
    6 vgr(j)=gra(17)                                                    gral-046
      if (grr(1,i).lt.0.) go to 27                                      gral-047
      a4=aa1*alog(grr(1,i))+a5                                          gral-048
      ng=0                                                              gral-049
    7 if (ng.gt.20) go to 28                                            gral-050
      ng=ng+1                                                           gral-051
      if (a4.gt.2.) go to 8                                             gral-052
      a4=a4+aa3                                                         gral-053
      a5=a5+aa3                                                         gral-054
      write (2,1003)                                                    gral-055
      go to 7                                                           gral-056
    8 if (a4.lt.112.) go to 9                                           gral-057
      a4=a4-aa3                                                         gral-058
      a5=a5-aa3                                                         gral-059
      write (2,1004)                                                    gral-060
      go to 8                                                           gral-061
    9 l=a4                                                              gral-062
      vgr(l)=gra(1)                                                     gral-063
      if (lt2) go to 10                                                 gral-064
c experimental data                                                     gral-065
      if (frr(i).lt.0.) go to 29                                        gral-066
      l=aa1*alog(frr(i))+a5                                             gral-067
      if (l.gt.1.and.l.lt.112) vgr(l)=gra(2)                            gral-068
   10 write (2,1005) tgr(i),vgr                                         gral-069
   11 continue                                                          gral-070
      do 12 i=1,112                                                     gral-071
   12 vgr(i)=gra(17)                                                    gral-072
      do 13 i=na1,112,na2                                               gral-073
   13 vgr(i)=gra(2)                                                     gral-074
      write (2,1002) vgr                                                gral-075
      return                                                            gral-076
c polarisation                                                          gral-077
   14 if (lt2) go to 15                                                 gral-078
      write (2,1000)                                                    gral-079
      write (2,1001) gra(1),(mf(j,1),j=5,9)                             gral-080
      write (2,1007)                                                    gral-081
      go to 17                                                          gral-082
   15 nk=0                                                              gral-083
      do 16 k=1,id1                                                     gral-084
      if (mf(2,k).ne.1) go to 16                                        gral-085
      kn=mod(nk,15)+1                                                   gral-086
      nk=nk+1                                                           gral-087
      if (nk.eq.1) write (2,1000)                                       gral-088
      write (2,1001) gra(kn),(mf(j,k),j=5,9)                            gral-089
   16 continue                                                          gral-090
      if (nk.eq.0) return                                               gral-091
   17 write (2,1006)                                                    gral-092
      do 18 i=1,112                                                     gral-093
   18 vgr(i)=gra(16)                                                    gral-094
      do 19 i=1,103                                                     gral-095
   19 vgr(i)=gra(17)                                                    gral-096
      do 20 i=2,102,10                                                  gral-097
   20 vgr(i)=gra(2)                                                     gral-098
      write (2,1002) vgr                                                gral-099
      do 24 i=1,mteta                                                   gral-100
      do 21 m=2,102                                                     gral-101
   21 vgr(m)=gra(16)                                                    gral-102
      vgr(52)=gra(17)                                                   gral-103
      nk=0                                                              gral-104
      do 22 k=1,id1                                                     gral-105
      if (mf(2,k).ne.1) go to 22                                        gral-106
      nk=mod(nk,15)+1                                                   gral-107
      m=50.*grr(k,i)+52.5                                               gral-108
      if (m.gt.1.and.m.le.102) vgr(m)=gra(nk)                           gral-109
   22 continue                                                          gral-110
      if (lt2) go to 23                                                 gral-111
      m=50.*frr(i)+52.5                                                 gral-112
      if (m.gt.1.and.m.le.102) vgr(m)=gra(2)                            gral-113
   23 write (2,1005) tgr(i),vgr                                         gral-114
   24 continue                                                          gral-115
      do 25 i=1,103                                                     gral-116
   25 vgr(i)=gra(17)                                                    gral-117
      do 26 i=2,102,10                                                  gral-118
   26 vgr(i)=gra(2)                                                     gral-119
      write (2,1002) vgr                                                gral-120
      return                                                            gral-121
   27 write (2,1008) i,grr(1,i)                                         gral-122
      go to 30                                                          gral-123
   28 write (2,1009) i,grr(1,i)                                         gral-124
      go to 30                                                          gral-125
   29 write (2,1010) i,frr(i)                                           gral-126
   30 write (2,1011)                                                    gral-127
      return                                                            gral-128
 1000 format (1h1)                                                      gral-129
 1001 format (45x,a1,4x,5a4/)                                           gral-130
 1002 format (7x,112a1)                                                 gral-131
 1003 format (40(3h -*))                                                gral-132
 1004 format (40(3h *-))                                                gral-133
 1005 format (f7.2,112a1)                                               gral-134
 1006 format (//6x,3h -1,7x,4h -.8,6x,4h -.6,6x,4h -.4,6x,4h -.2,7x,2h 0gral-135
     1,8x,3h .2,7x,3h .4,7x,3h .6,7x,3h .8,7x,2h 1)                     gral-136
 1007 format (45x,21h+    calculated value/45x,23h*    experimental valugral-137
     1e/)                                                               gral-138
 1008 format (8h for the,i4,27hth line, calculated value =,e15.8)       gral-139
 1009 format (8h for the,i4,54hth line, more than 20 translations. calcugral-140
     1lated value =,e15.8)                                              gral-141
 1010 format (8h for the,i4,29hth line, experimental value =,e15.8)     gral-142
 1011 format (//25h **** graph canceled ****)                           gral-143
      end                                                               gral-144
c 27/04/98  ibm version                                         ecis97  emro-000
      subroutine emro(a,f1,f2,x1,x2,x3,res,nx)                          emro-001
c  calculates the nx                                                    emro-002
c            a          a+1                     a+n-1                   emro-003
c           r (theta), r (theta) ............. r (theta)                emro-004
c            f1,f2      f1,f2                   f1,f2                   emro-005
c in the array res                                                      emro-006
c it uses the recurrence relation obtained from                         emro-007
c                      j                   j'                           emro-008
c        cos(theta) * r (theta)  = sum  r (theta)                       emro-009
c                      f1,f2       on j'   f1,f2                        emro-010
c theta is given by x1=cos(theta),x2=cos(0.5*theta),x3=sin(0.5*theta)   emro-011
c***********************************************************************emro-012
      implicit real*8 (o-z)                                             emro-013
      dimension res(1)                                                  emro-014
      nr=1                                                              emro-015
      aj=a                                                              emro-016
      m1=abs(f1+f2)+0.1                                                 emro-017
      m2=abs(f1-f2)+0.1                                                 emro-018
      xj=m1+m2                                                          emro-019
    1 if (xj.gt.2.*aj+.1) go to 9                                       emro-020
      s1=0.d0                                                           emro-021
      s2=0.d0                                                           emro-022
      s3=1.d0                                                           emro-023
      if (xj.eq.0.d0) go to 13                                          emro-024
c the magnetic quantum numbers are not both zeros                       emro-025
    3 if (m1.eq.m2) go to 10                                            emro-026
c no magnetic quantum number is zero                                    emro-027
      if (m2.eq.0) go to 5                                              emro-028
      do 4 i=1,m2                                                       emro-029
    4 s3=s3*x3*dsqrt(dfloat(m1+i)/dfloat(i))                            emro-030
    5 if (m1.eq.0) go to 7                                              emro-031
      do 6 m=1,m1                                                       emro-032
    6 s3=s3*x2                                                          emro-033
    7 if ((f1.gt.f2).and.(2*(m2/2).ne.m2)) s3=-s3                       emro-034
      kx=1                                                              emro-035
      sj=0.5d0*xj                                                       emro-036
      x4=0.d0                                                           emro-037
      z1=m1                                                             emro-038
      z2=m2                                                             emro-039
      sl=0.5d0*(z1-z2)/(sj+1.d0)                                        emro-040
    8 if (aj.le.sj+.1d0) go to 15                                       emro-041
c recurrence                                                            emro-042
      sj=sj+1.d0                                                        emro-043
      s2=s3                                                             emro-044
      z1=z1+1.d0                                                        emro-045
      z2=z2+1.d0                                                        emro-046
      xj=xj+1.d0                                                        emro-047
      x4=x4+1.d0                                                        emro-048
      y2=dsqrt(z1*z2*xj*x4)                                             emro-049
      s3=(2.d0*sj-1.d0)*sj*((x1-sl)*s2-s1)/y2                           emro-050
      s1=y2*s2/((2.d0*sj+1.d0)*sj)                                      emro-051
      sl=sl*(sj-1.d0)/(sj+1.d0)                                         emro-052
      go to 8                                                           emro-053
    9 res(nr)=0.d0                                                      emro-054
      nr=nr+1                                                           emro-055
      if (nr.gt.nx) go to 16                                            emro-056
      aj=aj+1.                                                          emro-057
      go to 1                                                           emro-058
c a magnetic quantum number is zero                                     emro-059
   10 do 11 i=1,m1                                                      emro-060
   11 s3=s3*x3*x2*dsqrt(dfloat(m1+i)/dfloat(i))                         emro-061
      kx=2                                                              emro-062
      if (f1.gt.f2.and.(2*(m2/2).ne.m2)) s3=-s3                         emro-063
      x4=0                                                              emro-064
      sj=m1                                                             emro-065
   12 if (aj.le.sj+.1d0) go to 15                                       emro-066
c recurrence                                                            emro-067
      sj=sj+1.d0                                                        emro-068
      s2=s3                                                             emro-069
      xj=xj+1.d0                                                        emro-070
      x4=x4+1.d0                                                        emro-071
      y2=dsqrt(xj*x4)                                                   emro-072
      s3=((2.d0*sj-1.d0)*x1*s2-s1)/y2                                   emro-073
      s1=y2*s2                                                          emro-074
      go to 12                                                          emro-075
c the magnetic quantum numbers are both zeros                           emro-076
   13 kx=3                                                              emro-077
      sj=0.d0                                                           emro-078
   14 if (aj.le.sj+.1d0) go to 15                                       emro-079
c recurrence                                                            emro-080
      sj=sj+1.d0                                                        emro-081
      s2=s3                                                             emro-082
      s3=((2.d0*sj-1.d0)*x1*s2-s1)/sj                                   emro-083
      s1=s2*sj                                                          emro-084
      go to 14                                                          emro-085
c storage                                                               emro-086
   15 res(nr)=s3                                                        emro-087
      nr=nr+1                                                           emro-088
      if (nr.gt.nx) go to 16                                            emro-089
      aj=aj+1.                                                          emro-090
      go to ( 8 , 12 , 14 ),kx                                          emro-091
   16 return                                                            emro-092
      end                                                               emro-093
c 30/04/98  ibm version   cdc with 'c' to double precision      ecis97  vari-000
      subroutine vari(kf,ke,index,nrec,val,nval,npp,beta,nbta,nbet,var,nvari-001
     1nva,ele,nel,scn,res,ntot,fm,ncolr,iw,w,x,wv,ipp,ivy,lo)           vari-002
c it assigns the values of the variable parameters and                  vari-003
c  prints the output during the search.                                 vari-004
c  kf=1 before the call to the search subroutines                       vari-005
c    at the first call(ke=0) defines the variables in search            vari-006
c    at any call,print chi2 and variables                               vari-007
c  kf=0 after the call to the search subroutines                        vari-008
c    at any call sets parameters to their value for next evaluation     vari-009
c    at the last call(ke/=0) print errors and parameters                vari-010
c input values: ke:        return code of search                        vari-011
c               index,nrec:indications on parameters in search, number  vari-012
c               val,npp:   optical model parameters and their number    vari-013
c               nval:      in equivalence by call with val              vari-014
c               beta,nbta,nbet: deformations and their number           vari-015
c               var,nnva:  nuclear parameters and their number          vari-016
c               ele,nel:   nuclear matrix elements and their number     vari-017
c               scn:       level density description for comp. nucleus  vari-018
c               res,ntot:  difference between exp. and calc. values and vari-019
c                               their number                            vari-020
c               fm,ncolr:  descr. of exp. distributions and their numbervari-021
c               iw,w:      integer and floating points results of searchvari-022
c                                  (see fite)                           vari-023
c               x:         variables in search                          vari-024
c               wv,ipp:    masses, spins, ....   see calx               vari-025
c               ivy:       table of form factors  (see redm)            vari-026
c               lo:        logical controls                             vari-027
c by common /ncomp/ ncont: number of continuum for compound nucleus     vari-028
c                   ncons: number of level densities needed             vari-029
c                   az(i): spin orbit parametrisation for i-1 to 6      vari-030
c                          hauser feshbach parameters for j=7 to 9      vari-031
c                          giant dipole resonance for i=10 to 14        vari-032
c           /dblpr/ : current and minimum chi-square                    vari-033
c                                                                       vari-034
c parameters in search are given by index(i)                            vari-035
c   positive value: parameter defined by index(i)                       vari-036
c   negative value -l: parameters defined by index(j) for j=l+1 to      vari-037
c     j=l+index(l) are defined as the same variable                     vari-038
c      1-1000      optical model,folding parameters                     vari-039
c   1001-2000      deformations for a given potential   - lo(211)=.true.vari-040
c   2001-3000      deformations for a given multipole   - lo(211)=.true.vari-041
c   3001-4000      individual deformation               - lo(211)=.true.vari-042
c   4001-5000      nuclear model parameter              - lo(212)=.true.vari-043
c   5001-6000      nuclear matrix element               - lo(213)=.true.vari-044
c   6001-7000      spin-orbit and c. n. parametrisation - lo(214)=.true.vari-045
c  10001-99999     external optical model (parameters above 1000)       vari-046
c it stops the calculation for an index of parameter out of range       vari-047
c***********************************************************************vari-048
      logical lo(250)                                                   vari-049
      double precision chi2,chi2m,wv,cm,ck,chb,cmb,ccz,xe,xm,xn,xz      vari-050
      dimension index(1),ele(4,1),var(1),beta(10,1),iw(4),fm(9,1),val(34vari-051
     1,1),ipp(11,1),r0(8),nval(200),x(1),res(1),w(4),nbta(10,1),wv(15,1)vari-052
     2,ity(10),itz(5),ivy(7,1),scn(1)                                   vari-053
      common /ncomp/ nsp(7),acn(2),ncons,nco(4),az(16)                  vari-054
      common /dblpr/ chi2,chi2m,cm,ck,chb,cmb,ccz,xe,xm,xn,xz           vari-055
      data ity /6,6,6,6,7,9,6,7,9,9/                                    vari-056
      data itz /0,2,10,22,12/                                           vari-057
      nvat=34*npp                                                       vari-058
c transfer between variables and parameters                             vari-059
      if (kf.eq.1.and.ke.ne.0) go to 29                                 vari-060
      do 28 i=1,nrec                                                    vari-061
      j=index(i)                                                        vari-062
      jj=iabs(j)                                                        vari-063
      if (j.ne.jj) go to 1                                              vari-064
      j1=i                                                              vari-065
      j2=i                                                              vari-066
      go to 2                                                           vari-067
    1 j1=jj+1                                                           vari-068
      j2=j1+index(jj)-1                                                 vari-069
    2 do 27 k=j1,j2                                                     vari-070
      j=index(k)                                                        vari-071
      if ((j.gt.1000).and.(j.le.10000)) go to 7                         vari-072
c optical model and folding parameters                                  vari-073
      if (j.gt.10000) j=j-9000                                          vari-074
      if (lo(7)) go to 3                                                vari-075
      if (j.gt.nvat.or.mod(j,34).eq.19) go to 59                        vari-076
      go to 5                                                           vari-077
c external optical parameters                                           vari-078
    3 i1=nval(1)-2                                                      vari-079
      do 4 l=2,i1,2                                                     vari-080
      if (j.ge.nval(l).and.j.le.nval(l+1)) go to 5                      vari-081
    4 continue                                                          vari-082
      go to 59                                                          vari-083
    5 if (kf.ne.0) go to 6                                              vari-084
      if (k.eq.j1) rap=x(i)/val(j,1)                                    vari-085
      val(j,1)=rap*val(j,1)                                             vari-086
      go to 27                                                          vari-087
    6 x(i)=val(j,1)                                                     vari-088
      go to 28                                                          vari-089
    7 j=j-1000                                                          vari-090
      if (j.gt.1000) go to 12                                           vari-091
      if (j.gt.6) go to 59                                              vari-092
c  deformations for a given potential                                   vari-093
      lo(211)=.true.                                                    vari-094
      do 8 k1=1,nbet                                                    vari-095
      if (lo(1).and.lo(3).and.nbta(10,k1).ne.0) go to 8                 vari-096
      if (beta(j,k1).ne.0.) go to 9                                     vari-097
    8 continue                                                          vari-098
      write (2,1000) i,index(k),j                                       vari-099
      go to 60                                                          vari-100
    9 if (kf.eq.0) go to 10                                             vari-101
      x(i)=beta(j,k1)                                                   vari-102
      go to 28                                                          vari-103
   10 if (k.eq.j1) rap=x(i)/beta(j,k1)                                  vari-104
      do 11 l=k1,nbet                                                   vari-105
      if (lo(1).and.lo(3).and.nbta(10,k1).ne.0) go to 11                vari-106
      beta(j,l)=beta(j,l)*rap                                           vari-107
   11 continue                                                          vari-108
      go to 27                                                          vari-109
   12 j=j-1000                                                          vari-110
      if (j.gt.1000) go to 17                                           vari-111
c deformations for a given multipole                                    vari-112
      if (j.gt.nbet) go to 59                                           vari-113
      lo(211)=.true.                                                    vari-114
      do 13 k1=1,8                                                      vari-115
      if (beta(k1,j).ne.0.) go to 14                                    vari-116
   13 continue                                                          vari-117
      write (2,1001) i,index(k),j                                       vari-118
      go to 60                                                          vari-119
   14 if (kf.eq.0) go to 15                                             vari-120
      x(i)=beta(k1,j)                                                   vari-121
      go to 28                                                          vari-122
   15 if (k.eq.j1) rap=x(i)/beta(k1,j)                                  vari-123
      do 16 l=k1,8                                                      vari-124
   16 beta(l,j)=beta(l,j)*rap                                           vari-125
      go to 27                                                          vari-126
   17 j=j-1000                                                          vari-127
      if (j.gt.1000) go to 19                                           vari-128
c individual deformations                                               vari-129
      if ((j.gt.10*nbet).or.(mod(j,10).gt.8)) go to 59                  vari-130
      lo(211)=.true.                                                    vari-131
      if (kf.ne.0) go to 18                                             vari-132
      if (k.eq.j1) rap=x(i)/beta(j,1)                                   vari-133
      beta(j,1)=rap*beta(j,1)                                           vari-134
      go to 27                                                          vari-135
   18 x(i)=beta(j,1)                                                    vari-136
      go to 28                                                          vari-137
   19 j=j-1000                                                          vari-138
      if (j.gt.1000) go to 21                                           vari-139
c  nuclear parameters                                                   vari-140
      if (j.gt.nnva) go to 59                                           vari-141
      lo(212)=.true.                                                    vari-142
      if (kf.ne.0) go to 20                                             vari-143
      if (k.eq.j1) rap=x(i)/var(j)                                      vari-144
      var(j)=rap*var(j)                                                 vari-145
      go to 27                                                          vari-146
   20 x(i)=var(j)                                                       vari-147
      go to 28                                                          vari-148
   21 j=j-1000                                                          vari-149
      if (j.gt.1000) go to 23                                           vari-150
c  nuclear matrix elements                                              vari-151
      if (j.gt.nel) go to 59                                            vari-152
      lo(213)=.true.                                                    vari-153
      if (kf.ne.0) go to 22                                             vari-154
      if (k.eq.j1) rap=x(i)/ele(4,j)                                    vari-155
      ele(4,j)=rap*ele(4,j)                                             vari-156
      go to 27                                                          vari-157
   22 x(i)=ele(4,j)                                                     vari-158
      go to 28                                                          vari-159
   23 j=j-1000                                                          vari-160
c  spin-orbit and h. f. parametrisation                                 vari-161
      if (j.gt.14+6*ncons) go to 59                                     vari-162
      if (lo(181).and.j.gt.6) go to 59                                  vari-163
      lo(214)=.true.                                                    vari-164
      if (j.gt.14) go to 25                                             vari-165
      if ((lo(82).or.lo(186)).and.j.gt.9) go to 59                      vari-166
      if (lo(182).and.(j.eq.7.or.j.eq.9).and.lo(87)) go to 59           vari-167
      if (lo(182).and.(j.eq.8.or.j.eq.9).and.lo(187)) go to 59          vari-168
      if (kf.ne.0) go to 24                                             vari-169
      if (k.eq.j1) rap=x(i)/az(j)                                       vari-170
      az(j)=rap*az(j)                                                   vari-171
      go to 27                                                          vari-172
   24 x(i)=az(j)                                                        vari-173
      go to 28                                                          vari-174
   25 jk=j-14+2*((j-15)/6)                                              vari-175
      if (kf.eq.0) go to 26                                             vari-176
      x(i)=scn(jk)                                                      vari-177
      go to 28                                                          vari-178
   26 if (k.eq.j1) rap=x(i)/scn(jk)                                     vari-179
      scn(jk)=rap*scn(jk)                                               vari-180
   27 continue                                                          vari-181
   28 continue                                                          vari-182
   29 if (kf.eq.0) go to 31                                             vari-183
      write (2,1002) iw(3),iw(2),chi2,(w(i),i=1,3)                      vari-184
      write (2,1003)                                                    vari-185
      do 30 i=1,ncolr                                                   vari-186
   30 write (2,1004) i,(fm(j,i),j=5,9)                                  vari-187
      write (2,1005) (i,x(i),i=1,nrec)                                  vari-188
      if (lo(178)) write (2,1006) (i,res(i),i=1,ntot)                   vari-189
      return                                                            vari-190
   31 if (ke.eq.1) return                                               vari-191
      write (2,1007) iw(3),iw(2),chi2,ke,w(1)                           vari-192
      if (ke*(ke-3).ne.0.or.w(4).le.0.) go to 33                        vari-193
      write (2,1008) iw(4),w(3),(w(3+i),i=1,nrec)                       vari-194
      write (2,1009) (w(3+nrec+i),i=1,nrec)                             vari-195
      write (2,1010)                                                    vari-196
      l=3+2*nrec                                                        vari-197
      do 32 i=1,nrec                                                    vari-198
      k=l+1                                                             vari-199
      l=l+i                                                             vari-200
   32 write (2,1011) (w(j),j=k,l)                                       vari-201
      go to 34                                                          vari-202
   33 write (2,1012)                                                    vari-203
   34 if (ke.eq.0) write (2,1013)                                       vari-204
      if (ke.eq.2) write (2,1014)                                       vari-205
      if (ke.eq.3) write (2,1015)                                       vari-206
      if (ke.eq.4) write (2,1016)                                       vari-207
      if (ke.eq.5) write (2,1017) iw(4)                                 vari-208
      if (ke.eq.6) write (2,1018) iw(3),iw(4)                           vari-209
      if (ke.eq.7) write (2,1019) ntot,nrec                             vari-210
c end of the search                                                     vari-211
      lo(215)=.false.                                                   vari-212
      lo(218)=.true.                                                    vari-213
      if (lo(76)) go to 36                                              vari-214
      do 35 i=51,65                                                     vari-215
      lo(i)=lo(i+185)                                                   vari-216
   35 lo(i+100)=.not.lo(i)                                              vari-217
   36 lo(220)=lo(153).and.lo(155).and.lo(156).and.lo(157).and.lo(158).anvari-218
     1d.lo(162).and.lo(164)                                             vari-219
      if (lo(41)) lo(220)=lo(220).and.lo(165)                           vari-220
      lo(219)=lo(220).and.lo(151).and.lo(164).and.lo(165)               vari-221
      lo(220)=chi2.eq.chi2m.and.lo(220)                                 vari-222
c output of final parameters                                            vari-223
      write (2,1020) (lo(j),j=1,100)                                    vari-224
      if (lo(7)) go to 39                                               vari-225
      do 38 j=1,npp                                                     vari-226
      ij=ipp(1,j)                                                       vari-227
      am3=wv(2,ij)**.33333333333333d0                                   vari-228
      if (lo(16)) am3=am3+wv(1,ij)**.33333333333333d0                   vari-229
      write (2,1021) j,am3                                              vari-230
      do 37 i=1,8                                                       vari-231
   37 r0(i)=val(3*i-1,j)/am3                                            vari-232
      write (2,1022) (val(3*i-2,j),val(3*i-1,j),r0(i),val(3*i,j),i=1,8),vari-233
     1val(25,j)                                                         vari-234
      if (lo(17)) write (2,1023) (val(i,j),i=26,34)                     vari-235
   38 continue                                                          vari-236
      go to 50                                                          vari-237
   39 nvma=nval(1)                                                      vari-238
      write (2,1024)                                                    vari-239
   40 if (nvma.ge.nval(2)) go to 49                                     vari-240
      i1=nval(nvma)                                                     vari-241
      iv=nval(nvma+1)                                                   vari-242
      if (iv.eq.16) go to 48                                            vari-243
      it1=mod(i1-1,8)+1                                                 vari-244
      j1=(i1-1)/8                                                       vari-245
      if (iv.ge.0) go to 41                                             vari-246
      nvma=nvma+6                                                       vari-247
      nvmb=nvma+1-2*iv                                                  vari-248
      write (2,1025) it1,j1,nvma,nvmb,(val(i,1),i=nvma,nvmb)            vari-249
      go to 48                                                          vari-250
   41 nb=nval(nvma+5)                                                   vari-251
      nst=nval(nvma+4)                                                  vari-252
      nvma=nvma+ity(iv)                                                 vari-253
      if (iv.lt.9) go to 42                                             vari-254
      nvmb=nvma+nb+1                                                    vari-255
      write (2,1026) it1,j1,iv,nvma,nvmb,(val(i,1),i=nvma,nvmb)         vari-256
      go to 48                                                          vari-257
   42 nvmb=nvma                                                         vari-258
      if (iv.gt.6) go to 47                                             vari-259
      nvmb=nvmb+3                                                       vari-260
      if (it1.gt.6) nvmb=nvmb+1                                         vari-261
      write (2,1027) it1,j1,iv,nvma,nvmb,(val(i,1),i=nvma,nvmb)         vari-262
      if (nst.gt.0) go to 44                                            vari-263
      k=iabs(nst)                                                       vari-264
      ex=wv(2,k)**.33333333333333d0                                     vari-265
      ey=ex                                                             vari-266
      if (lo(16)) ex=ex+wv(1,k)**.33333333333333d0                      vari-267
      ey=ey/ex                                                          vari-268
      ex=val(nvma+1,1)/ex                                               vari-269
      ez=val(nvma,1)                                                    vari-270
      if (lo(116).or.j1.le.npp) go to 43                                vari-271
      ityz=iv                                                           vari-272
      if (ityz.ge.5) ityz=ityz-4                                        vari-273
      ityw=1                                                            vari-274
      if (it1.gt.6) ityw=ityw*ivy(7,j1-npp)                             vari-275
      if (lo(6)) ityw=ityw-1                                            vari-276
      if (ityz.gt.1) ez=ez/ey**((ityz-1)*ityw)                          vari-277
   43 write (2,1028) ez,ex                                              vari-278
   44 if ((iv.ne.5).and.(iv.ne.6)) go to 48                             vari-279
      nvma=nvmb+1                                                       vari-280
      nvmb=nvmb+nb                                                      vari-281
      write (2,1029) nvma,nvmb,(val(i,1),i=nvma,nvmb)                   vari-282
      if (nst.gt.0) go to 48                                            vari-283
      write (2,1030)                                                    vari-284
      nmb=0                                                             vari-285
   45 nma=nvma                                                          vari-286
      do 46 i=nvma,nvmb                                                 vari-287
      nmb=nmb+1                                                         vari-288
      j=i-nma                                                           vari-289
      if (it1.lt.7) j=0                                                 vari-290
      if (lo(106)) j=j+1                                                vari-291
   46 r0(nmb)=val(i,1)/ey**j                                            vari-292
      write (2,1011) (r0(i),i=1,nmb)                                    vari-293
      nvma=nvma+8                                                       vari-294
      if (nvma.le.nvmb) go to 45                                        vari-295
      go to 48                                                          vari-296
   47 nb=nval(nvmb-1)                                                   vari-297
      nvma=nvmb+5                                                       vari-298
      if (nb.gt.1) nvma=nvma+4                                          vari-299
      if (iv.eq.8) nb=nb+2                                              vari-300
      nvmb=nvma+itz(nb)                                                 vari-301
      write (2,1027) it1,j1,iv,nvma,nvmb,(val(i,1),i=nvma,nvmb)         vari-302
   48 nvma=nval(2*i1-13)+1                                              vari-303
      go to 40                                                          vari-304
   49 nvmb=nval(3)                                                      vari-305
      if (nvma.lt.nvmb) write (2,1031) (val(i,1),i=nvma,nvmb)           vari-306
   50 if (.not.lo(211)) go to 58                                        vari-307
      write (2,1032) (i,nbta(9,i),nbta(10,i),(beta(j,i),j=1,8),i=1,nbet)vari-308
      if (lo(116)) go to 58                                             vari-309
      dm=wv(2,1)**.33333333333333d0/(wv(1,1)**.33333333333333d0+wv(2,1)*vari-310
     1*.33333333333333d0)                                               vari-311
      write (2,1033)                                                    vari-312
      do 57 i=1,nbet                                                    vari-313
      k1=0                                                              vari-314
      k2=0                                                              vari-315
      if (lo(3)) go to 52                                               vari-316
   51 k1=1                                                              vari-317
      k2=nbta(9,i)                                                      vari-318
      go to 54                                                          vari-319
   52 if (lo(1)) go to 53                                               vari-320
      k1=i-1                                                            vari-321
      k2=k1*nbta(9,i)                                                   vari-322
      go to 54                                                          vari-323
   53 if (nbta(10,i).eq.0) go to 51                                     vari-324
   54 if (lo(106)) go to 55                                             vari-325
      k2=k2-k1                                                          vari-326
      k1=0                                                              vari-327
   55 do 56 j=1,6                                                       vari-328
   56 r0(j)=beta(j,i)/dm**k1                                            vari-329
      r0(7)=beta(7,i)/dm**k2                                            vari-330
      r0(8)=beta(8,i)/dm**k2                                            vari-331
   57 write (2,1034) i,nbta(9,i),nbta(10,i),r0                          vari-332
   58 if (lo(212)) write (2,1035) (var(i),i=1,nnva)                     vari-333
      if (lo(213)) write (2,1036) (ele(4,i),i=1,nel)                    vari-334
      if (lo(214)) write (2,1037) (az(i),i=1,16)                        vari-335
      return                                                            vari-336
   59 write (2,1038) i,index(k),j                                       vari-337
   60 write (2,1039)                                                    vari-338
      stop                                                              vari-339
 1000 format (13h the variable,i3,24h cannot be used because ,i5,49h  isvari-340
     1 a variation of the deformations of potential,i3,15h which are zervari-341
     1o)                                                                vari-342
 1001 format (13h the variable,i3,24h cannot be used because ,i5,38h  isvari-343
     1 a variation for a given multipole,i3,18h and they are zero)      vari-344
 1002 format (/4h run,i4,8h   max =,i4,15h   ***** chi2 =,d18.10,6h ****vari-345
     1*,5x,6hw(1) =,f10.2,5x,6hw(2) =,f5.2,5x,6hw(3) =,f10.5)           vari-346
 1003 format (/21x,6hweight,12x,10hexp. norm.,10x,10herr. norm.,10x,11hcvari-347
     1alc. norm.,12x,4hchi2)                                            vari-348
 1004 format (5x,i5,1p,5e20.6)                                          vari-349
 1005 format (/14h *** variables//(6(1x,i3,1p,e16.6)))                  vari-350
 1006 format (/14h *** functions//(6(1x,i3,1p,e16.6)))                  vari-351
 1007 format (/4h run,i4,8h   max =,i4,15h   ***** chi2 =,d18.10,6h ****vari-352
     1*,5x,4hke =,i2,5x,6hw(1) =,f12.4)                                 vari-353
 1008 format (//66h standard errors (variance at best fit equal to degrevari-354
     1e of freedom:,i6,23h.renormalisation factor,d15.6,2h )/(1p,8d15.6)vari-355
     2)                                                                 vari-356
 1009 format (/49h error enhancements (multi/single variable error)/(1p,vari-357
     18d15.6))                                                          vari-358
 1010 format (/25h error correlation matrix)                            vari-359
 1011 format (1p,8e15.6)                                                vari-360
 1012 format (//25h no information on errors)                           vari-361
 1013 format (//28h search ended without errors)                        vari-362
 1014 format (//27h search interrupted by user)                         vari-363
 1015 format (//38h search ended by number of evaluations)              vari-364
 1016 format (//33h search ended for rounding errors)                   vari-365
 1017 format (//65h search ended because the functions do not depend on vari-366
     1the variable,i6)                                                  vari-367
 1018 format (//31h search ended because variables,2i6,33h are useless ivari-368
     1n preparatory calls)                                              vari-369
 1019 format (//46h search ended because the number of parameters,i4,34hvari-370
     1 is larger than the number of data,i4)                            vari-371
 1020 format (1h1/30h ******* final results *******//29h **** first contvari-372
     1rol card ****,2x,2h1 ,9(2h 1),3h 2 ,9(2h 2),3h 3 ,9(2h 3),3h 4 ,9(vari-373
     22h 4),2h 5/11x,5(21h  1 2 3 4 5 6 7 8 9 0)/11x,5(1x,10l2)//29h ***vari-374
     3 second control card ****,2x,2h1 ,9(2h 1),3h 2 ,9(2h 2),3h 3 ,9(2hvari-375
     4 3),3h 4 ,9(2h 4),2h 5/11x,5(21h  1 2 3 4 5 6 7 8 9 0)/11x,5(1x,10vari-376
     5l2)/)                                                             vari-377
 1021 format (/23h optical potentials  **,i3,38h **     reduced radius mvari-378
     1ultiplied by  ,e15.6/)                                            vari-379
 1022 format (22h volume real potential,11x,5hdepth,f12.6,12h mev  radiuvari-380
     1s,f10.6,15h fermi (reduced,f9.6,14h)  diffuseness,f9.6,6h fermi/27vari-381
     2h volume imaginary potential,6x,5hdepth,f12.6,12h mev  radius,f10.vari-382
     36,15h fermi (reduced,f9.6,14h)  diffuseness,f9.6,6h fermi/23h surfvari-383
     4ace real potential,10x,5hdepth,f12.6,12h mev  radius,f10.6,15h fervari-384
     5mi (reduced,f9.6,14h)  diffuseness,f9.6,6h fermi/28h surface imagivari-385
     6nary potential,5x,5hdepth,f12.6,12h mev  radius,f10.6,15h fermi (rvari-386
     7educed,f9.6,14h)  diffuseness,f9.6,6h fermi/26h real spin-orbit povari-387
     8tential,7x,5hdepth,f12.6,12h mev  radius,f10.6,15h fermi (reduced,vari-388
     9f9.6,14h)  diffuseness,f9.6,6h fermi/38h imaginary spin-orbit potevari-389
     antial  depth,f12.6,12h mev  radius,f10.6,15h fermi (reduced,f9.6,1vari-390
     b4h)  diffuseness,f9.6,6h fermi/38h coulomb potential  product of cvari-391
     charges,f12.6,6x,6hradius,f10.6,15h fermi (reduced,f9.6,14h)  diffuvari-392
     dseness,f9.6,6h fermi/38h spin-orbit coulomb potential    depth,f12vari-393
     e.6,6x,6hradius,f10.6,15h fermi (reduced,f9.6,14h)  diffuseness,f9.vari-394
     f6,6h fermi/14x,22hthird charge parameter,f9.6)                    vari-395
 1023 format (/22h *** folding model ***/10h real part,10x,3hv =,f10.4,6vari-396
     1x,3hr =,f10.4,6x,3ha =,f10.4/15h imaginary part,6x,3hv =,f10.4,6x,vari-397
     23hr =,f10.4,6x,3ha =,f10.4/13h coulomb part,7x,3hv =,f10.4,6x,3hr vari-398
     3=,f10.4,6x,3ha =,f10.4)                                           vari-399
 1024 format (/40h **** external potential parameters ****/)            vari-400
 1025 format (2h (,i1,1h,,i2,42h) given by points with the parameters frvari-401
     1om,i4,3h to,i4/1p,2e15.6/(1p,8e15.6))                             vari-402
 1026 format (2h (,i1,1h,,i2,6h) type,i3,5h from,i4,3h to,i4/1p,2e15.6/(vari-403
     21p,8e15.6))                                                       vari-404
 1027 format (2h (,i1,1h,,i2,6h) type,i3,5h from,i4,3h to,i4,4x,6e14.6/(vari-405
     17x,8e14.6))                                                       vari-406
 1028 format (13h values read:,f12.6,3x,f9.6)                           vari-407
 1029 format (30h deformations: parameters from,i4,4h to ,i4,10x,4e18.6/vari-408
     1(52x,4e18.6))                                                     vari-409
 1030 format (19h deformations read:)                                   vari-410
 1031 format (20h folding parameters:,3f10.5/(20x,3f10.5))              vari-411
 1032 format (/21h beta(i,j) for  l   k,9x,1hv,9x,1hw,8x,2hvs,8x,2hws,7xvari-412
     1,3hvso,7x,3hwso,6x,14hcoul s.o. coul/(5x,i5,5x,i2,2x,i2,2x,8f10.5)vari-413
     2)                                                                 vari-414
 1033 format (/10x,28hwithout heavy ion correction/)                    vari-415
 1034 format (5x,i5,5x,i2,2x,i2,2x,8f10.5)                              vari-416
 1035 format (/26h *** nuclear variables ***//(1x,6f20.6))              vari-417
 1036 format (/32h *** nuclear matrix elements ***//(1x,6f20.6))        vari-418
 1037 format (/36h *** spin-orbit and c.-n. param. ***//1x,6f20.6/1x,6f2vari-419
     10.6/1x,4f20.6)                                                    vari-420
 1038 format (9h variable,i3,11h defined by,i5,i4,15h cannot be used)   vari-421
 1039 format (/19h in vari  ...  stop)                                  vari-422
      end                                                               vari-423
c 27/04/98  ibm version                                         ecis97  eval-000
      subroutine eval(wv,ipp,val,nval,npp,beta,nbta,nbet,var,nva,ele,neleval-001
     1,scn,nci,xd,ind,x,idt,idmt,w,iw,ivy,lo)                           eval-002
c this subroutine changes some parameters to do a new calculation.      eval-003
c the values read here are absolute changes ( nex=0 ),                  eval-004
c relative changes ( nex>0 ) or percentages ( nex<0 ).                  eval-005
c if the laboratory energy is changed, coulomb functions and reduced    eval-006
c nuclear matrix elements are recalculated even if they are not modifiedeval-007
c if nuclear parameters are changed, reduced nuclear matrix elements areeval-008
c calculated again. in all the others cases, the computation restarts   eval-009
c with the computation of potentials.                                   eval-010
c indexes for parameters are the ones used in search (see vari)         eval-011
c however 0 means energy in the laboratory system.                      eval-012
c input variables:wv,ipp:   description of levels (see calx)            eval-013
c                 val,npp:  optical model and folding and their number  eval-014
c                 nval:     equivalent by call with val                 eval-015
c                 beta,nbta,nbet:deformations and their number          eval-016
c                 var,nva:  nuclear parameters:their number is nva      eval-017
c                 ele,nel:  reduced nuclear matrix elements,number      eval-018
c                 scn:      description of level densities              eval-019
c                 nci:      table for discretisation of continuum       eval-020
c                 xd:       weights and steps for continuum             eval-021
c                 idt:      available working space                     eval-022
c                 idmt:     total working space                         eval-023
c                 w:        first step size of search in w(1)           eval-024
c                 iw:       maximum number of runs for a search in iw(2)eval-025
c                 ivy:      table of form factors  (see redm)           eval-026
c                 lo: logical controls,returns lo(222)=.true. if energy eval-027
c working space:  ind,x:    for input                                   eval-028
c common /ncomp/ncont: number of continuum for compound nucleus         eval-029
c               ncons: number of level densities needed                 eval-030
c               ncolx: total number of levels without discretisation    eval-031
c               az(i): spin orbit parametrisation for i-1 to 6          eval-032
c                      hauser feshbach parameters for j=7 to 9          eval-033
c                      giant dipole resonance description for i=10 to 14eval-034
c        is changed and lo(212)=.true. if nuclear parameters are changedeval-035
c it stops the calculation for an index of parameter out of range       eval-036
c working space: ind,x equivalent by call                               eval-037
c***********************************************************************eval-038
      logical lo(250)                                                   eval-039
      dimension ind(2,1),x(2,1),ele(4,1),var(1),beta(10,1),val(1),ipp(11eval-040
     1,1),aa(2),nval(3),nbta(10,1),w(3),iw(3),ivy(7,1),scn(1),nci(2,1)  eval-041
      double precision wv(15,1),chi2,chi2m,cm,ck,chb,cmb,ccz,xe,xm,xn,bbeval-042
     1(2,2),xd(3,1),de,ex,ey,fx,fy,xz                                   eval-043
      common /ncomp/ nsp(5),ncont,ncoj,ac(2),ncons,nco,ncolx,nr(2),az(16eval-044
     1)                                                                 eval-045
      common /dblpr/ chi2,chi2m,cm,ck,chb,cmb,ccz,xe,xm,xn,xz           eval-046
      data aa /4h new,4hlast/                                           eval-047
      data bb /8hincrease,8hs )     ,8hnew valu,8hes )    /             eval-048
      nvat=34*npp                                                       eval-049
      lo(37)=.false.                                                    eval-050
      read (1,1000) lo(37),nin,nex,ech                                  eval-051
      lo(137)=.not.lo(37)                                               eval-052
      nx=min0(1,max0(nex,-1))+2                                         eval-053
      i1=1                                                              eval-054
      i2=1                                                              eval-055
      if (lo(137)) i1=2                                                 eval-056
      if (nx.eq.2) i2=2                                                 eval-057
      write (2,1001) aa(i1),nin,bb(1,i2),bb(2,i2)                       eval-058
      if (nx.eq.1) write (2,1002)                                       eval-059
      lo(212)=.false.                                                   eval-060
      lo(222)=.false.                                                   eval-061
      if (2*nin.gt.idt) call memo(idmt,idmt+2*nin-idt,idt,3,lo)         eval-062
      if (lo(216)) go to 52                                             eval-063
      read (1,1003) (ind(1,i),i=1,nin)                                  eval-064
      read (1,1004) (x(2,i),i=1,nin)                                    eval-065
      do 47 i=1,nin                                                     eval-066
      ind(1,i)=max0(0,ind(1,i))                                         eval-067
      j=mod(ind(1,i),1000)                                              eval-068
      ik=(ind(1,i)+1999)/1000                                           eval-069
      ey=x(2,i)                                                         eval-070
      if (ik.ne.1) go to 10                                             eval-071
c energy in the laboratory system                                       eval-072
      lo(222)=.true.                                                    eval-073
      ex=wv(3,1)                                                        eval-074
      if (nx.ne.2) go to 9                                              eval-075
    1 if (lo(8)) go to 2                                                eval-076
      wv(3,1)=ey*wv(2,1)/(wv(1,1)+wv(2,1))                              eval-077
      go to 3                                                           eval-078
c relativistic c.-m. energy ecm=sqrt((m1+m2)**2+2*m2*elab))-m1-m2       eval-079
    2 wv(3,1)=cm*(dsqrt((wv(1,1)+wv(2,1))**2+2.d0*wv(2,1)*ey/cm)-wv(1,1)eval-080
     1-wv(2,1))                                                         eval-081
    3 write (2,1005) i,j,ey,x(2,i),wv(3,1),ex                           eval-082
      if (ncolx.eq.1) go to 5                                           eval-083
      do 4 j=2,ncolx                                                    eval-084
    4 wv(3,j)=wv(3,j)+wv(3,1)-ex                                        eval-085
    5 if (ncont.eq.0) go to 47                                          eval-086
      ie=0                                                              eval-087
      do 8 j=1,ncont                                                    eval-088
      je=ie                                                             eval-089
      ii=nci(1,j)                                                       eval-090
      ij=nci(2,j)                                                       eval-091
      de=0.d0                                                           eval-092
      do 6 l=ii,ij                                                      eval-093
      ie=ie+1                                                           eval-094
    6 de=de+xd(2,ie)                                                    eval-095
      de=1.d0+(wv(3,1)-ex)/de                                           eval-096
      do 7 l=ii,ij                                                      eval-097
      je=je+2                                                           eval-098
      xd(2,ie)=de*xd(2,ie)                                              eval-099
    7 wv(3,l)=de*wv(3,l)                                                eval-100
    8 continue                                                          eval-101
      go to 47                                                          eval-102
    9 if (nex.lt.0) ey=.01d0*ey*ex                                      eval-103
      ey=ex+ey                                                          eval-104
      go to ( 1 , 19 , 24 , 30 , 35 , 37 , 39 , 41 ),ik                 eval-105
   10 if (ik.gt.11) go to 11                                            eval-106
      if (ik.gt.8) go to 50                                             eval-107
      go to ( 12 , 12 , 20 , 26 , 32 , 36 , 38 , 40 ),ik                eval-108
   11 ik=2                                                              eval-109
      j=ind(1,i)-9000                                                   eval-110
   12 if (lo(7)) go to 14                                               eval-111
c optical model and folding parameters                                  eval-112
      n=1+mod(j-1,34)                                                   eval-113
      m=1+(j-1)/34                                                      eval-114
      k=ipp(1,m)                                                        eval-115
      if (mod(n,3).ne.2.or.n.gt.24) go to 13                            eval-116
      ex=wv(2,k)**.33333333333333d0                                     eval-117
      if (lo(16)) ex=ex+wv(1,k)**.33333333333333d0                      eval-118
      ey=ey*ex                                                          eval-119
   13 if (j.gt.nvat.or.n.eq.19) go to 50                                eval-120
      ex=val(j)                                                         eval-121
      if (nx.ne.2) go to 9                                              eval-122
      go to 19                                                          eval-123
c external optical parameters                                           eval-124
   14 i1=nval(1)                                                        eval-125
      do 15 l=2,i1,2                                                    eval-126
      if (j.ge.nval(l).and.j.le.nval(l+1)) go to 16                     eval-127
   15 continue                                                          eval-128
      go to 51                                                          eval-129
   16 ex=val(j)                                                         eval-130
      if (l.eq.2) go to 18                                              eval-131
      m=nval(l)                                                         eval-132
      n=nval(m-1)                                                       eval-133
      iv=nval(n+1)                                                      eval-134
      if (iv.lt.1.or.iv.gt.6) go to 18                                  eval-135
      nst=nval(n+4)                                                     eval-136
      if (nst.gt.0) go to 18                                            eval-137
      it1=mod(nval(n)-1,8)+1                                            eval-138
      j1=(nval(n)-1)/8                                                  eval-139
      j2=4                                                              eval-140
      if (it1.gt.6) j2=5                                                eval-141
      if (j-m.gt.1.and.j-m.lt.j2) go to 18                              eval-142
      k=iabs(nst)                                                       eval-143
      fx=wv(2,k)**.33333333333333d0                                     eval-144
      fy=fx                                                             eval-145
      if (lo(16)) fx=fx+wv(1,k)**.33333333333333d0                      eval-146
c transformation of depth and radius                                    eval-147
      if (j-m.eq.1) ey=ey*fx                                            eval-148
      fy=fy/fx                                                          eval-149
      if (j.gt.m+2) go to 17                                            eval-150
      if (lo(116).or.j1.le.npp.or.j.ne.m) go to 18                      eval-151
      ityz=iv                                                           eval-152
      if (ityz.ge.5) ityz=ityz-4                                        eval-153
      ityw=1                                                            eval-154
      if (it1.gt.6) ityw=ityw*ivy(7,j1-npp)                             eval-155
      if (lo(6)) ityw=ityw-1                                            eval-156
      if (ityz.gt.1) ey=ey*fy**((ityz-1)*ityw)                          eval-157
      go to 18                                                          eval-158
c transformation of deformations                                        eval-159
   17 j3=j-m-j2                                                         eval-160
      if (it1.lt.7) j3=0                                                eval-161
      if (lo(106)) j3=j3+1                                              eval-162
      ey=ey*fy**j3                                                      eval-163
   18 if (nx.ne.2) go to 9                                              eval-164
   19 if (lo(107)) write (2,1006) i,j,n,m,ey,x(2,i),val(j)              eval-165
      if (lo(7)) write (2,1007) i,j,ey,x(2,i),val(j)                    eval-166
      val(j)=ey                                                         eval-167
      go to 47                                                          eval-168
   20 if (j.gt.8) go to 50                                              eval-169
c  deformations for a given potential                                   eval-170
      k2=j                                                              eval-171
      do 21 k1=1,nbet                                                   eval-172
      if (lo(1).and.lo(3).and.nbta(10,k1).ne.0) go to 21                eval-173
      if (beta(k2,k1).ne.0.) go to 22                                   eval-174
   21 continue                                                          eval-175
      write (2,1008) i,ind(1,i),k2                                      eval-176
      go to 52                                                          eval-177
   22 ey=ey/beta(k2,k1)                                                 eval-178
      k3=1                                                              eval-179
      if ((nx.ne.1).and.lo(16)) go to 33                                eval-180
   23 ex=1                                                              eval-181
      if (nx.ne.2) go to 9                                              eval-182
   24 write (2,1009) i,ind(1,i),k2,k1,ey,x(2,i)                         eval-183
      do 25 l=k1,nbet                                                   eval-184
      if (lo(1).and.lo(3).and.nbta(10,k1).ne.0) go to 25                eval-185
      ex=beta(k2,l)*ey                                                  eval-186
      write (2,1010) k2,l,ex,beta(k2,l)                                 eval-187
      beta(k2,l)=ex                                                     eval-188
   25 continue                                                          eval-189
      go to 47                                                          eval-190
c deformations for a given multipole                                    eval-191
   26 k1=j                                                              eval-192
      if (j.gt.nbet) go to 50                                           eval-193
      do 27 k2=1,8                                                      eval-194
      if (beta(k2,k1).ne.0.) go to 28                                   eval-195
   27 continue                                                          eval-196
      write (2,1011) i,ind(1,i),k1                                      eval-197
      go to 52                                                          eval-198
   28 ey=ey/beta(k2,k1)                                                 eval-199
      k3=2                                                              eval-200
      if ((nx.ne.1).and.lo(16)) go to 33                                eval-201
   29 ex=1                                                              eval-202
      if (nx.ne.2) go to 9                                              eval-203
   30 write (2,1009) i,ind(1,i),k2,k1,ey,x(2,i)                         eval-204
      do 31 l=k2,8                                                      eval-205
      ex=beta(l,k1)*ey                                                  eval-206
      write (2,1010) l,k1,ex,beta(l,k1)                                 eval-207
   31 beta(l,k1)=ex                                                     eval-208
      go to 47                                                          eval-209
c individual deformations                                               eval-210
   32 if (j.gt.10*nbet) go to 50                                        eval-211
      k1=1+(j-1)/10                                                     eval-212
      k2=1+mod(j-1,10)                                                  eval-213
      if (k2.gt.8) go to 50                                             eval-214
      k3=3                                                              eval-215
      if (lo(116)) go to 34                                             eval-216
c search of the corrections for heavy ions                              eval-217
   33 ex=wv(2,1)**.33333333333333d0/(wv(2,1)**.33333333333333d0+wv(1,1)*eval-218
     1*.33333333333333d0)                                               eval-219
      jk=1                                                              eval-220
      if (lo(101).and.lo(3)) jk=k1-1                                    eval-221
      k=jk                                                              eval-222
      if (k1.gt.6) k=k*nbta(10,k1)                                      eval-223
      if (lo(6)) k=k-jk                                                 eval-224
      ey=ey*ex**k                                                       eval-225
      if (k3-2) 23 , 29 , 34                                            eval-226
   34 ex=beta(k2,k1)                                                    eval-227
      if (nx.ne.2) go to 9                                              eval-228
   35 write (2,1012) i,ind(1,i),k2,k1,ey,x(2,i),beta(k2,k1)             eval-229
      beta(k2,k1)=ey                                                    eval-230
      go to 47                                                          eval-231
   36 if (j.gt.nva) go to 50                                            eval-232
      ex=var(j)                                                         eval-233
      if (nx.ne.2) go to 9                                              eval-234
   37 write (2,1013) i,ind(1,i),j,ey,x(2,i),var(j)                      eval-235
      var(j)=ey                                                         eval-236
      go to 47                                                          eval-237
c  nuclear matrix elements                                              eval-238
   38 if (j.gt.nel) go to 50                                            eval-239
      ex=ele(4,j)                                                       eval-240
      lo(212)=.true.                                                    eval-241
      if (nx.ne.2) go to 9                                              eval-242
   39 write (2,1014) i,ind(1,i),j,ey,x(2,i),ele(4,j)                    eval-243
      ele(4,j)=ey                                                       eval-244
      go to 47                                                          eval-245
c  spin-orbit and h. f. parametrisation                                 eval-246
   40 if (j.gt.6*ncons+14) go to 50                                     eval-247
      if (lo(181).and.j.gt.6) go to 50                                  eval-248
      if (j.gt.14) go to 45                                             eval-249
      if ((lo(82).or.lo(186)).and.j.gt.9) go to 50                      eval-250
      if (lo(182).and.(j.eq.7.or.j.eq.9).and.lo(87)) go to 50           eval-251
      if (lo(182).and.(j.eq.8.or.j.eq.9).and.lo(187)) go to 50          eval-252
      ex=az(j)                                                          eval-253
      if (nx.ne.2) go to 9                                              eval-254
   41 if (j.gt.14) go to 46                                             eval-255
      if (j.gt.6) go to 42                                              eval-256
      write (2,1015) i,ind(1,i),j,ey,x(2,i),az(j)                       eval-257
      go to 44                                                          eval-258
   42 k=j-6                                                             eval-259
      if (k.gt.3) go to 43                                              eval-260
      write (2,1016) i,ind(1,i),k,ey,x(2,i),az(j)                       eval-261
      go to 44                                                          eval-262
   43 k=j-3                                                             eval-263
      write (2,1017) i,ind(1,i),k,ey,x(2,i),az(j)                       eval-264
   44 az(j)=ey                                                          eval-265
      go to 47                                                          eval-266
   45 jj=j-14+2*((j-15)/6)                                              eval-267
      ex=scn(jj)                                                        eval-268
      if (nx.ne.2) go to 9                                              eval-269
   46 k=1+(j-15)/ncons                                                  eval-270
      l=1+mod(j-15,ncons)                                               eval-271
      write (2,1018) i,ind(1,i),l,k,ey,x(2,i),scn(jj)                   eval-272
      scn(jj)=ey                                                        eval-273
   47 continue                                                          eval-274
      do 48 i=215,220                                                   eval-275
   48 lo(i)=.false.                                                     eval-276
      if (lo(132)) return                                               eval-277
      chi2m=1.d35                                                       eval-278
      if (ech.eq.0.) ech=20.                                            eval-279
      w(1)=ech                                                          eval-280
      w(3)=0.                                                           eval-281
      iw(2)=iw(2)-iw(3)                                                 eval-282
      iw(3)=1                                                           eval-283
      write (2,1019) iw(2),w(1)                                         eval-284
      if (iw(2).le.0) go to 52                                          eval-285
      if (lo(76).or.lo(175)) return                                     eval-286
      do 49 i=51,65                                                     eval-287
      lo(i+185)=lo(i)                                                   eval-288
      lo(i)=.false.                                                     eval-289
   49 lo(i+100)=.true.                                                  eval-290
      lo(215)=.true.                                                    eval-291
      return                                                            eval-292
   50 write (2,1020) i,ind(1,i),ik,j,x(2,i)                             eval-293
      go to 52                                                          eval-294
   51 if (j.gt.nval(3)) go to 50                                        eval-295
      write (2,1021) i,ey,j,nval(j)                                     eval-296
   52 write (2,1022)                                                    eval-297
      stop                                                              eval-298
 1000 format (l1,i4,i5,f10.5)                                           eval-299
 1001 format (1h1,a4,17h computation with,i4,16h  new parameters,10x,11heval-300
     1( input of ,2a8)                                                  eval-301
 1002 format (20x,35h*** values given as percentages ***)               eval-302
 1003 format (14i5)                                                     eval-303
 1004 format (7f10.5)                                                   eval-304
 1005 format (2x,i2,7h param.,i5,3x,15hnew lab. energy,e15.8,2h (,e15.8,eval-305
     11h),3x,21hcenter of mass energy,e15.6,5x,9hold value,e15.6)       eval-306
 1006 format (2x,i2,7h param.,i5,3x,19hvalue of v-optical(,i2,1h,,i2,3h)eval-307
     1 =,e15.6,2h (,e15.6,1h),3x,9hold value,e15.6)                     eval-308
 1007 format (2x,i2,7h param.,i5,32hth value of external potential =,e15eval-309
     1.6,2h (,e15.6,1h),3x,9hold value,e15.6)                           eval-310
 1008 format (13h the variable,i3,24h cannot be used because ,i5,49h  iseval-311
     1 a variation of the deformations of potential,i3,15h which are zereval-312
     1o)                                                                eval-313
 1009 format (2x,i2,7h param.,i5,3x,21hproportional to beta(,i2,1h,,i2,1eval-314
     13h)  with ratio,e15.6,2h (,e15.6,1h))                             eval-315
 1010 format (15x,5hbeta(,i2,1h,,i2,3h) =,e15.6,5x,9hold value,e15.6)   eval-316
 1011 format (13h the variable,i3,24h cannot be used because ,i5,38h  iseval-317
     1 a variation for a given multipole,i3,18h and they are zero)      eval-318
 1012 format (2x,i2,7h param.,i5,3x,5hbeta(,i2,1h,,i2,3h) =,e15.6,2h (,eeval-319
     115.6,1h),3x,9hold value,e15.6)                                    eval-320
 1013 format (2x,i2,7h param.,i5,3x,4hvar(,i2,3h) =,e15.6,2h (,e15.6,1h)eval-321
     1,3x,9hold value,e15.6)                                            eval-322
 1014 format (2x,i2,7h param.,i5,3x,4ht(4,,i3,3h) =,e15.6,2h (,e15.6,1h)eval-323
     1,3x,9hold value,e15.6)                                            eval-324
 1015 format (2x,i2,7h param.,i5,3x,3haz(,i1,3h) =,e15.6,2h (,e15.6,1h),eval-325
     13x,9hold value,e15.6)                                             eval-326
 1016 format (2x,i2,7h param.,i5,3x,3hbz(,i1,3h) =,e15.6,2h (,e15.6,1h),eval-327
     13x,9hold value,e15.6)                                             eval-328
 1017 format (2x,i2,7h param.,i5,3x,16hgiant resonance(,i1,3h) =,e15.6,2eval-329
     1h (,e15.6,1h),3x,9hold value,e15.6)                               eval-330
 1018 format (2x,i2,7h param.,i5,3x,4hscn(,i3,1h,,i3,3h) =,e15.6,2h (,e1eval-331
     15.6,1h),3x,9hold value,e15.6)                                     eval-332
 1019 format (28h new maximum number of runs:,i6,10x,14hstarting scale,feval-333
     110.2)                                                             eval-334
 1020 format (9h variable,i3,11h defined by,i5,2h (,i2,i5,1h),12h with veval-335
     1alue ,e15.6,15h cannot be used)                                   eval-336
 1021 format (9h variable,i3,e15.6,11h defined by,i5,60h cannot be used eval-337
     1for the parameter which is the integer value,i10)                 eval-338
 1022 format (/19h in eval  ...  stop)                                  eval-339
      end                                                               eval-340
c 15/04/97  ibm version                                         ecis96  rest-000
      subroutine rest(kf,nw,w,lo,idmx)                                  rest-001
c if kf=0                                                               rest-002
c it saves on tape 8 all the data needed to re-start a                  rest-003
c search stopped by the number of evaluations (by time if lo(34)=.true.)rest-004
c it is called only if lo(35)=.true.                                    rest-005
c if kf.ne.0                                                            rest-006
c it reads on tape 8 to re-start the search                             rest-007
c it is called only if lo(36)=.true.                                    rest-008
c***********************************************************************rest-009
      logical lo(250)                                                   rest-010
      dimension w(1),nw(1),t(18)                                        rest-011
      common /titr/title(18),n1(10)/dblpr/n2(22)/decou/n3(110)/ncomp/n4(rest-012
     130)/pote1/n5(22)/pote2/n6(12)                                     rest-013
      idmy=idmx                                                         rest-014
      rewind 8                                                          rest-015
      if (kf.ne.0) go to 1                                              rest-016
c writes commons first and w after                                      rest-017
      write (8) idmx,lo,n1,n2,n3,n4,n5,n6,title                         rest-018
c n3(46) is nrco,n3(98) is nplace,n3(52) is idmt                        rest-019
      i1=n3(46)                                                         rest-020
      write (2,1000) i1                                                 rest-021
      write (8) (w(i),i=1,i1)                                           rest-022
      rewind 8                                                          rest-023
      return                                                            rest-024
c read commons,computes limits of w and read w                          rest-025
    1 read (8) idmz,lo,n1,n2,n3,n4,n5,t                                 rest-026
      i1=n3(46)                                                         rest-027
      n3(52)=idmy                                                       rest-028
      write (2,1001) title,t,n3(52)                                     rest-029
      call memo(n3(52),0,m,1,lo)                                        rest-030
      call memo(n3(52),n3(98),m,5,lo)                                   rest-031
      if (lo(216)) go to 5                                              rest-032
      read (8) (w(i),i=1,i1)                                            rest-033
      rewind 8                                                          rest-034
c reads on 5 if save has to be done again and the new number of eval.   rest-035
c any modification of the search can be read at this place if they      rest-036
c do not spoil the search                                               rest-037
      lo(35)=.false.                                                    rest-038
      read (1,1002) lo(35),n,nsec,ech,rap                               rest-039
c n3(17) is niw, n3(92) is nrec                                         rest-040
      if (n.eq.0) n=n3(92)+2                                            rest-041
      lo(135)=.not.lo(35)                                               rest-042
      m=n3(17)+1                                                        rest-043
      nw(m)=nw(m)+n                                                     rest-044
      write (2,1003) i1                                                 rest-045
      write (2,1004) n,nw(m)                                            rest-046
      if (lo(35)) write (2,1005)                                        rest-047
      if (lo(135)) write (2,1006)                                       rest-048
      if (nsec.eq.0) go to 2                                            rest-049
      n3(43)=nsec                                                       rest-050
      write (2,1007) nsec                                               rest-051
    2 n=n3(14)                                                          rest-052
      if (ech.lt.1.) go to 3                                            rest-053
      write (2,1008) w(n),ech                                           rest-054
      w(n)=ech                                                          rest-055
    3 if (rap.lt.1.) go to 4                                            rest-056
      write (2,1009) w(n+1),rap                                         rest-057
      w(n+1)=rap                                                        rest-058
    4 return                                                            rest-059
    5 write (2,1010) n3(52),n3(98)                                      rest-060
      stop                                                              rest-061
 1000 format (///38h output on tape 8 of w from w(1) to w(,i6,1h)///)   rest-062
 1001 format (1h1//1x,18a4//23h restart of computation//16h last title :rest-063
     1 '',18a4,2h''//24h available working space,i8/)                   rest-064
 1002 format (l1,i4,i5,2f10.5)                                          rest-065
 1003 format (39h input from tape 8 of w from w(1) to w(,i6,1h)//)      rest-066
 1004 format (/43h maximum number of evaluations increased by,i4,5x,9hnerest-067
     1w value,i6)                                                       rest-068
 1005 format (28h save on tape 8 if necessary)                          rest-069
 1006 format (18h no save on tape 8)                                    rest-070
 1007 format (5x,i5,44h hund of second spared at the end of the job)    rest-071
 1008 format (19h change of ech from,f10.5,3h to,f10.5)                 rest-072
 1009 format (19h change of rap from,f10.5,3h to,f10.5)                 rest-073
 1010 format (14h working space,i6,16h is unsufficient,10x,i6,7h needed)rest-074
      end                                                               rest-075
c 13/03/86  ibm version                                         ecis88  fite-000
      subroutine fite(ke,m,n,f,x,e,w,nw,iz,wa,chi2)                     fite-001
c  chisquare minimising subroutine written by g. schweimer in karlsruhe.fite-002
c simplified for the use of ecis (no gradient)                          fite-003
c  solves the nonlinear least squares problem                           fite-004
c  using a least squares interpolation between variables and functions  fite-005
c  called subroutines: fit2 /.true./ (linear least squares problem)     fite-006
c                      fit2 /.false./(inversion of a(transposed)*a)     fite-007
c                      fit1(one dimensional minimum search)             fite-008
c  calling sequence                                                     fite-009
c     ke=0                                                              fite-010
c     m=number of functions, m ge n                                     fite-011
c     n=number of variables, n ge 1                                     fite-012
c     do 1 i=1,n                                                        fite-013
c     x(i)=starting values of the variables                             fite-014
c   1 e(i)=absolute search accuracies for the variables                 fite-015
c     w(1)=first step size in units of e(i)                             fite-016
c     w(2)=half of the success multiplication factor for step size      fite-017
c         the step size is divided by 4 times its square after unsuccessfite-018
c     iz(1)=number of points to be remembered, if le n iz(1) = n+1      fite-019
c     iz(2)=maximum number of function evaluations, if 0 iz(2)=2*iz(1)  fite-020
c   2 chi2=0.                                                           fite-021
c     do 3 i=1,m                                                        fite-022
c     f(i)=function values at the point x                               fite-023
c   3 chi2=chi2+f(i)*f(i)                                               fite-024
c     call fite(ke,m,n,f,x,e,w,w,iz,wa,chi2)                            fite-025
c     if(ke.eq.1) go to 2                                               fite-026
c     w(1)=step size  maximum change of a variable is 2*w(1)            fite-027
c     w(3)=error renormalisation factor when ke=0,2 or 3. (square root  fite-028
c                of variance at best fit divided by degree of freedom)  fite-029
c         =changed x value in preparatory calls                         fite-030
c         =ratio step/distance of minimum after preparatory calls       fite-031
c              or 0. for random prediction                              fite-032
c     x=minimum point                                                   fite-033
c     f=functions at the minimum point                                  fite-034
c     ke=error code    ke=0: without errors                             fite-035
c                      ke=2: user interrupt                             fite-036
c                      ke=3: maximum number of function evaluations     fite-037
c                      ke=4: rounding errors                            fite-038
c                      ke=5: the functions do not depend on x(iz(4))    fite-039
c                      ke=6: useless variables in the preparatory calls,fite-040
c                            the labels of the variables are iz(3),iz(4)fite-041
c                      ke=7: m lt n                                     fite-042
c     w(3+i)=standard errors of the variables. (for a variance at best  fite-043
c                      fit equal to degree of freedom)                  fite-044
c     w(3+n+i)=error enhancements. (many/single variable result)        fite-045
c     w(3+n+n+i+(j*(j-1))/2)=error correlation between x(i) and x(j) i<jfite-046
c     iz(3): number of function evaluations                             fite-047
c     iz(4): number of degrees of freedom if ke=0,2,3 or 4              fite-048
c            place of useless variable if ke=5 or 6                     fite-049
c            eventually indications for one dimensional search if ke=1  fite-050
c  working field:  iz: length 4+k with k = iz(1)                        fite-051
c     w: length 3+max(14+n+k*(m+n+1),(n*(n+5))/2)                       fite-052
c     nw: equivalent by call with w                                     fite-053
c     wa: length (m+1)*(n+1)+(n*(n+1))/2                                fite-054
c                  addresses in iz                                      fite-055
c                      4+l: labels of the quadratic sums                fite-056
c                  addresses in w during search                         fite-057
c                      4 to 17 ,eventually, indications for one dimen-  fite-058
c                            sionnal search.                            fite-059
c                      from max(18,n+4),k sets(functions+variables+chi2)fite-060
c                  addresses in w after the search  see above           fite-061
c                  addresses in wa                                      fite-062
c                      from 1 gradient or matrix a followed by central  fite-063
c                              functions                                fite-064
c                      from 1+m*(n+1)  central variables                fite-065
c                      from (n+1)*(m+1) matrix d                        fite-066
c  the working fields iz and w contain all information to continue      fite-067
c  the search. this allows a search within another search just changing fite-068
c  the working fields                                                   fite-069
c***********************************************************************fite-070
      dimension f(m),x(n),e(n),w(20),iz(5),wa(1),nw(20)                 fite-071
      double precision chi2,s,t,u,v,eps                                 fite-072
      data eps /1.d-5/                                                  fite-073
      jd=(m+1)*(n+1)-1                                                  fite-074
      js=17+n                                                           fite-075
      lm=m+n+1                                                          fite-076
      k=iz(1)                                                           fite-077
      if (ke.ne.0) go to 2                                              fite-078
      if (m.lt.n) go to 39                                              fite-079
      iz(3)=1                                                           fite-080
      iz(4)=0                                                           fite-081
      do 1 l=1,k                                                        fite-082
      iz(l+4)=1+k-l                                                     fite-083
    1 w(js+lm*l)=7.e35                                                  fite-084
      if (w(2).lt.1.) w(2)=1.                                           fite-085
      ke=1                                                              fite-086
    2 jm=js+lm*iz(5)-lm                                                 fite-087
      j3=m*n                                                            fite-088
      kv=k                                                              fite-089
      if (chi2.le.0.d0) go to 38                                        fite-090
c  row of matrix s to be replaced by new values                         fite-091
      l=iz(k+4)                                                         fite-092
      if (w(js+lm*l).eq.7.e35) kv=l-1                                   fite-093
      do 3 i=1,k                                                        fite-094
      j1=js+lm*iz(i+4)                                                  fite-095
      if (chi2.lt.w(j1)) go to 4                                        fite-096
    3 continue                                                          fite-097
c  one dimensional search is necessary                                  fite-098
      go to 30                                                          fite-099
    4 if (i.gt.max0(n+1,kv)) go to 30                                   fite-100
c  vector of labels of the quadratic sums                               fite-101
      if (kv.lt.k) kv=kv+1                                              fite-102
      i1=k+4                                                            fite-103
      i2=k-i                                                            fite-104
      if ((iz(3).gt.n+1).and.(i.ne.1)) w(1)=w(1)/(4.*w(2)**3)           fite-105
      if (i2.eq.0) go to 6                                              fite-106
      do 5 j=1,i2                                                       fite-107
      i1=i1-1                                                           fite-108
    5 iz(i1+1)=iz(i1)                                                   fite-109
      iz(i1)=l                                                          fite-110
      jm=js+lm*iz(5)-lm                                                 fite-111
c  new row                                                              fite-112
    6 j1=js+lm*(l-1)                                                    fite-113
      do 7 i=1,m                                                        fite-114
      j1=j1+1                                                           fite-115
    7 w(j1)=f(i)                                                        fite-116
      do 8 i=1,n                                                        fite-117
      j1=j1+1                                                           fite-118
    8 w(j1)=x(i)                                                        fite-119
      w(j1+1)=chi2                                                      fite-120
      if (iz(3).ge.iz(2)) go to 43                                      fite-121
      if (n.eq.1) go to 35                                              fite-122
      if (iz(3).gt.n+1) go to 13                                        fite-123
c  preparatory function evaluations                                     fite-124
      mf=iz(3)                                                          fite-125
      if (mf.eq.1) go to 12                                             fite-126
c significance of the new variable                                      fite-127
      x(mf-1)=w(3)                                                      fite-128
      s=0.d0                                                            fite-129
      do 9 i=1,m                                                        fite-130
      t=f(i)-w(js+i)                                                    fite-131
    9 s=s+t*t                                                           fite-132
      j=2                                                               fite-133
      if (s.lt.eps*eps*w(js+lm)) go to 41                               fite-134
      w(3)=s                                                            fite-135
      w(mf+2)=sqrt(w(3))                                                fite-136
      if (mf.le.2) go to 12                                             fite-137
c independence of the new variable                                      fite-138
      do 11 j=3,mf                                                      fite-139
      i2=js+lm*(j-2)                                                    fite-140
      s=0.d0                                                            fite-141
      do 10 i=1,m                                                       fite-142
   10 s=s+(w(i2+i)-w(js+i))*(f(i)-w(js+i))                              fite-143
      if (dabs(w(mf+2)*w(j+1)-dabs(s)).lt.eps*dabs(s)) go to 40         fite-144
   11 continue                                                          fite-145
   12 if (mf.eq.n+1) go to 13                                           fite-146
      w(3)=x(mf)                                                        fite-147
      x(mf)=x(mf)+w(1)*e(mf)                                            fite-148
      go to 65                                                          fite-149
c  end of preparatory function evaluations                              fite-150
c  sum of inverses of the quadratic sums                                fite-151
   13 s=0.d0                                                            fite-152
      do 14 l=1,kv                                                      fite-153
      t=w(js+lm*l)                                                      fite-154
   14 s=s+1.d0/(t*t)                                                    fite-155
      wja=1.d0/s                                                        fite-156
c  centre of the variables and functions                                fite-157
      i1=m+n                                                            fite-158
      do 16 i=1,i1                                                      fite-159
      j1=js                                                             fite-160
      s=0.d0                                                            fite-161
      do 15 l=1,kv                                                      fite-162
      t=w(j1+lm)                                                        fite-163
      s=s+w(j1+i)/(t*t)                                                 fite-164
   15 j1=j1+lm                                                          fite-165
   16 wa(j3+i)=s*wja                                                    fite-166
      if (ke.ne.1) go to 47                                             fite-167
c the linear approximation means that the difference with central value fite-168
c f(i,k)-f(i) = sum f(i,j)*(x(j,k)-x(j)) where f(i),x(j) are mean valuesfite-169
c and f(i,j) is the first derivative with respect to x(j).              fite-170
c using the matrix d(i,j) = weighted sum on (x(i,k)-x(i))*(x(j,k)-x(j)) fite-171
c and writing the change dx = d*y, the best fit is obtained for         fite-172
c ||f-a*y||=min(y) with a(i,j)=weighted sum(f(i,k)-f(i)*(x(j,k)-x(j))   fite-173
c  matrix a                                                             fite-174
   17 j1=0                                                              fite-175
      do 19 i=1,n                                                       fite-176
      u=wa(j3+m+i)                                                      fite-177
      do 19 j=1,m                                                       fite-178
      j1=j1+1                                                           fite-179
      j2=js                                                             fite-180
      s=0.d0                                                            fite-181
      t=wa(j3+j)                                                        fite-182
      do 18 l=1,kv                                                      fite-183
      v=w(j2+lm)                                                        fite-184
      s=s+(w(j2+j)-t)*(w(j2+m+i)-u)/(v*v)                               fite-185
   18 j2=j2+lm                                                          fite-186
   19 wa(j1)=s*wja                                                      fite-187
      if (ke.ne.1) go to 50                                             fite-188
c  linear least squares problem                                         fite-189
      call fit2(m,n,wa,x,nw(4),ir,.true.)                               fite-190
      if (ir) 42 , 20 , 28                                              fite-191
c  matrix d                                                             fite-192
   20 j1=jd                                                             fite-193
      ja=j3+m                                                           fite-194
      do 23 i=1,n                                                       fite-195
      t=wa(ja+i)                                                        fite-196
      do 22 j=1,i                                                       fite-197
      j1=j1+1                                                           fite-198
      j2=js+m                                                           fite-199
      s=0.d0                                                            fite-200
      u=wa(ja+j)                                                        fite-201
      do 21 l=1,kv                                                      fite-202
      v=w(j2+n+1)                                                       fite-203
      s=s+(w(j2+i)-t)*(w(j2+j)-u)/(v*v)                                 fite-204
   21 j2=j2+lm                                                          fite-205
   22 wa(j1)=s*wja                                                      fite-206
   23 continue                                                          fite-207
c  new variables                                                        fite-208
      do 25 i=1,n                                                       fite-209
      i2=1                                                              fite-210
      j1=jd+(i*i-i)/2                                                   fite-211
      s=0.d0                                                            fite-212
      do 24 j=1,n                                                       fite-213
      j1=j1+i2                                                          fite-214
      if (j.ge.i) i2=j                                                  fite-215
   24 s=s+wa(j1)*x(j)                                                   fite-216
   25 wa(i)=wa(ja+i)-s                                                  fite-217
c  test of convergence                                                  fite-218
      a=0.                                                              fite-219
      do 26 i=1,n                                                       fite-220
      w(i+3)=wa(i)-w(jm+m+i)                                            fite-221
   26 a=amax1(a,abs(w(i+3)/e(i)))                                       fite-222
      w(1)=w(1)*w(2)                                                    fite-223
      if (a.lt.1..or.w(1).lt.1.) go to 38                               fite-224
      w(3)=1.                                                           fite-225
c  step size limitation                                                 fite-226
      if (a.gt.2.*w(1)) w(3)=2.*w(1)/a                                  fite-227
      do 27 i=1,n                                                       fite-228
   27 x(i)=w(jm+m+i)+w(3)*w(i+3)                                        fite-229
      iz(4)=0                                                           fite-230
      w(1)=a*w(3)                                                       fite-231
      go to 65                                                          fite-232
c  random prediction                                                    fite-233
   28 do 29 i=1,n                                                       fite-234
   29 x(i)=w(jm+m+i)+w(1)*e(i)*(mod(iabs(nw(jm+i)),200)-100)/100.       fite-235
      w(3)=0.                                                           fite-236
      go to 65                                                          fite-237
c  one dimensional search                                               fite-238
   30 if (n.eq.1) go to 36                                              fite-239
      if (iz(3).ge.iz(2)) go to 43                                      fite-240
      if (iz(4).eq.2) go to 32                                          fite-241
      iz(4)=2                                                           fite-242
      do 31 i=1,n                                                       fite-243
   31 w(i+17)=x(i)-w(jm+m+i)                                            fite-244
      nw(4)=3                                                           fite-245
      nw(5)=20                                                          fite-246
      w(7)=0.5                                                          fite-247
      w(10)=0.                                                          fite-248
      w(11)=0.                                                          fite-249
      w(12)=0.                                                          fite-250
      w(13)=1.                                                          fite-251
      w(15)=w(jm+lm)                                                    fite-252
      w(16)=chi2                                                        fite-253
      go to 33                                                          fite-254
   32 w(8)=chi2                                                         fite-255
      call fit1(ke,nw(4),w(7))                                          fite-256
   33 do 34 i=1,n                                                       fite-257
   34 x(i)=w(jm+m+i)+w(7)*w(i+17)                                       fite-258
      if (ke.eq.3) ke=2                                                 fite-259
      if (ke.eq.2) go to 43                                             fite-260
      ke=1                                                              fite-261
      w(3)=w(7)                                                         fite-262
      go to 65                                                          fite-263
c  only one variable x                                                  fite-264
   35 if (iz(3).gt.1) go to 36                                          fite-265
      ke=0                                                              fite-266
      w(9)=w(1)*e(1)                                                    fite-267
      w(10)=e(1)                                                        fite-268
      w(11)=0.                                                          fite-269
   36 nw(5)=iz(2)                                                       fite-270
      w(7)=x(1)                                                         fite-271
      w(8)=chi2                                                         fite-272
      call fit1(ke,nw(4),w(7))                                          fite-273
      iz(4)=2                                                           fite-274
      x(1)=w(7)                                                         fite-275
      if (ke.eq.1) go to 65                                             fite-276
      if (ke.gt.0) ke=ke+1                                              fite-277
      w(3)=0.                                                           fite-278
      w(4)=0.                                                           fite-279
      do 37 j=1,m                                                       fite-280
   37 f(j)=w(jm+i)                                                      fite-281
      chi2=w(jm+lm)                                                     fite-282
      x(1)=w(jm+lm-1)                                                   fite-283
      if (nw(5).ne.0) go to 64                                          fite-284
      w(4)=sqrt(abs((w(12)-w(14))/((w(15)-w(16))/(w(12)-w(13))-(w(16)-  fite-285
     1w(17))/(w(13)-w(14)))))                                           fite-286
      w(5)=1.                                                           fite-287
      w(6)=1.                                                           fite-288
      go to 61                                                          fite-289
c  end of search                                                        fite-290
   38 ke=0                                                              fite-291
      if (chi2.eq.0..or.iz(2).lt.0) go to 65                            fite-292
      go to 44                                                          fite-293
c  error code definition                                                fite-294
   39 ke=ke+1                                                           fite-295
   40 ke=ke+1                                                           fite-296
   41 ke=ke+1                                                           fite-297
   42 ke=ke+1                                                           fite-298
   43 ke=ke+1                                                           fite-299
      ke=ke+1                                                           fite-300
c  restore optimum values to x and f                                    fite-301
   44 do 45 i=1,m                                                       fite-302
   45 f(i)=w(jm+i)                                                      fite-303
      do 46 i=1,n                                                       fite-304
      x(i)=w(jm+m+i)                                                    fite-305
   46 w(i+3)=0.                                                         fite-306
      w(3)=0.                                                           fite-307
      chi2=w(jm+lm)                                                     fite-308
      if (ke*(ke-3).ne.0.or.(ke.eq.3.and.((w(3).eq.0..and.iz(3).le.n))))fite-309
     1 go to 64                                                         fite-310
c computation of the errors of the variables - restore matrix g         fite-311
      kv=min0(k,iz(3))                                                  fite-312
      go to 13                                                          fite-313
c  inverse of matrix d                                                  fite-314
   47 t=sqrt(wja)                                                       fite-315
      j1=0                                                              fite-316
      do 49 i=1,n                                                       fite-317
      s=wa(j3+m+i)                                                      fite-318
      j2=js+i-lm+m                                                      fite-319
      do 48 l=1,kv                                                      fite-320
      j1=j1+1                                                           fite-321
   48 wa(j1)=t*(w(j2+l*lm)-s)/w(js+l*lm)                                fite-322
   49 continue                                                          fite-323
      call fit2(kv,n,wa,wa(jd+1),nw(4),ir,.false.)                      fite-324
      if (ir) 64 , 17 , 64                                              fite-325
c  matrix g = a*inverse of d                                            fite-326
   50 do 54 l=1,m                                                       fite-327
      j1=l-m                                                            fite-328
      do 52 i=1,n                                                       fite-329
      i1=jd+(i*i-i)/2                                                   fite-330
      i2=1                                                              fite-331
      s=0.d0                                                            fite-332
      do 51 j=1,n                                                       fite-333
      i1=i1+i2                                                          fite-334
      if (j.ge.i) i2=j                                                  fite-335
   51 s=s+wa(i1)*dble(wa(j1+j*m))                                       fite-336
   52 w(3+i)=s                                                          fite-337
      do 53 j=1,n                                                       fite-338
   53 wa(j1+j*m)=w(3+j)                                                 fite-339
   54 continue                                                          fite-340
c  diagonal elements of g(t)*g                                          fite-341
      j1=0                                                              fite-342
      do 56 i=1,n                                                       fite-343
      s=0.d0                                                            fite-344
      do 55 l=1,m                                                       fite-345
      j1=j1+1                                                           fite-346
   55 s=s+wa(j1)*dble(wa(j1))                                           fite-347
   56 w(3+n+i)=dsqrt(s)                                                 fite-348
c  standard errors and error correlations                               fite-349
      call fit2(m,n,wa,w(2*n+4),nw(4),ir,.false.)                       fite-350
      if (ir.ne.0) go to 64                                             fite-351
      do 58 i=1,n                                                       fite-352
      jdi=2*n+3+(i*i+i)/2                                               fite-353
      w(i+3)=sqrt(w(jdi))                                               fite-354
   58 w(3+n+i)=w(i+3)*w(3+n+i)                                          fite-355
      j1=2*n+3                                                          fite-356
      do 60 i=1,n                                                       fite-357
      do 59 j=1,i                                                       fite-358
      j1=j1+1                                                           fite-359
   59 w(j1)=w(j1)/(w(i+3)*w(j+3))                                       fite-360
   60 continue                                                          fite-361
c  error renormalisation factor                                         fite-362
   61 s=0.d0                                                            fite-363
      do 62 i=1,m                                                       fite-364
   62 s=s+f(i)                                                          fite-365
      w(3)=dsqrt(dabs(chi2-s*s/m)/max0(m-n-1,1))                        fite-366
      do 63 i=1,n                                                       fite-367
   63 w(i+3)=w(i+3)*w(3)                                                fite-368
   64 iz(4)=m-n-1                                                       fite-369
      if ((ke-5)*(ke-6).ne.0) go to 65                                  fite-370
      iz(3)=j-2                                                         fite-371
      iz(4)=mf-1                                                        fite-372
   65 if (ke.eq.1) iz(3)=iz(3)+1                                        fite-373
      return                                                            fite-374
      end                                                               fite-375
c 10/03/79  ibm and cdc version                                 ecis88  fit1-000
      subroutine fit1(ke,i,w)                                           fit1-001
c  minimisation of a function f(x) of one variable x                    fit1-002
c  calling sequence                                                     fit1-003
c     ke=0                                                              fit1-004
c     i(2)=maximum number of function evaluations                       fit1-005
c     w(1)=start value of x                                             fit1-006
c     w(3)=first step size                                              fit1-007
c     w(4)=absolute search accuracy                                     fit1-008
c     w(5)=relative search accuracy                                     fit1-009
c   1 w(2)=function value f(x) at x=w(1)                                fit1-010
c     call fit1(ke,i,w)                                                 fit1-011
c     if(ke.eq.1) go to 1                                               fit1-012
c     xmin=w(1)                                                         fit1-013
c     fmin=w(2)                                                         fit1-014
c  ke = error code: ke=0 no errors, ke=                                 fit1-015
c   2 maximum number of function evaluations                            fit1-016
c   3 rounding errors, probably because both w(4) and w(5) are too smallfit1-017
c  the working fields i and w have the length 3 and 11 respectively     fit1-018
c  they contain all information for the continuation of the search      fit1-019
c  therefore a search within another search can be done just changing   fit1-020
c  the working fields                                                   fit1-021
c  if 2 function values f1 and f2 are known for x = x1 and x2 respectivefit1-022
c  ly with x1 ne x2 enter the calling sequence after defining :         fit1-023
c  ke = 1; i(1) = 3; w(6) = x1; w(7) = x2; w(9) = f1; w(10) = f2 and    fit1-024
c  w(1) = users choice                                                  fit1-025
c  working field variables:                                             fit1-026
c  i(1): current number of function evaluations                         fit1-027
c  i(2): maximum number of function evaluations                         fit1-028
c  i(3): minimum pointer, the minimum function value is at w(7+i(3))    fit1-029
c  w(1): current value of x                                             fit1-030
c  w(2): user supplied function value                                   fit1-031
c  w(3): first step size                                                fit1-032
c  w(4 and 5): search accuracies                                        fit1-033
c  w(6, 7 and 8): x1, x2 and x3 with x1 < x2 < x3                       fit1-034
c  w(9, 10 and 11): function values at x1, x2 and x3 respectively       fit1-035
c***********************************************************************fit1-036
      dimension i(3),w(11)                                              fit1-037
      if (ke.eq.1) go to 2                                              fit1-038
      ke=1                                                              fit1-039
      i(1)=1                                                            fit1-040
      i(3)=-1                                                           fit1-041
      w(6)=w(1)                                                         fit1-042
      w(9)=w(2)                                                         fit1-043
    1 w(1)=w(1)+w(3)                                                    fit1-044
      go to 11                                                          fit1-045
    2 if (i(1).gt.2) go to 3                                            fit1-046
      i(3)=0                                                            fit1-047
      w(7)=w(1)                                                         fit1-048
      w(10)=w(2)                                                        fit1-049
      if (w(2).le.w(9)) go to 1                                         fit1-050
      i(3)=-1                                                           fit1-051
      w(1)=w(6)-w(3)                                                    fit1-052
      go to 11                                                          fit1-053
    3 if (i(1).gt.3) go to 5                                            fit1-054
      w(8)=w(1)                                                         fit1-055
      w(11)=w(2)                                                        fit1-056
c  ordering of the 3 first values of x: w(6) < w(7) < w(8)              fit1-057
      do 4 j=1,3                                                        fit1-058
      k=7-mod(j,2)                                                      fit1-059
      if (w(k).le.w(k+1)) go to 4                                       fit1-060
      w(1)=w(k)                                                         fit1-061
      w(k)=w(k+1)                                                       fit1-062
      w(k+1)=w(1)                                                       fit1-063
      k=k+3                                                             fit1-064
      w(1)=w(k)                                                         fit1-065
      w(k)=w(k+1)                                                       fit1-066
      w(k+1)=w(1)                                                       fit1-067
    4 continue                                                          fit1-068
      i(3)=0                                                            fit1-069
      if (w(9).lt.w(10).and.w(9).lt.w(11)) i(3)=-1                      fit1-070
      if (w(11).lt.w(10).and.w(11).lt.w(9)) i(3)=1                      fit1-071
      go to 9                                                           fit1-072
c  sort in the new values of x and f                                    fit1-073
    5 if (i(3).eq.0) go to 6                                            fit1-074
      j=i(3)                                                            fit1-075
      w(7-j)=w(7)                                                       fit1-076
      w(10-j)=w(10)                                                     fit1-077
      if ((w(7+j)-w(1))*(w(1)-w(7)).gt.0.) go to 7                      fit1-078
      w(7)=w(7+j)                                                       fit1-079
      w(10)=w(10+j)                                                     fit1-080
      w(7+j)=w(1)                                                       fit1-081
      w(10+j)=w(2)                                                      fit1-082
      if (w(2).ge.w(10)) i(3)=0                                         fit1-083
      go to 9                                                           fit1-084
    6 j=-1                                                              fit1-085
      if (w(1).lt.w(7)) j=1                                             fit1-086
      if (w(2).gt.w(10)) go to 8                                        fit1-087
      w(7+j)=w(7)                                                       fit1-088
      w(10+j)=w(10)                                                     fit1-089
    7 w(7)=w(1)                                                         fit1-090
      w(10)=w(2)                                                        fit1-091
      i31=i(3)+10                                                       fit1-092
      if (w(2).le.w(i31)) i(3)=0                                        fit1-093
      go to 9                                                           fit1-094
    8 w(7-j)=w(1)                                                       fit1-095
      w(10-j)=w(2)                                                      fit1-096
    9 j=7+i(3)                                                          fit1-097
c  error tests                                                          fit1-098
      if (w(6).eq.w(7).or.w(7).eq.w(8).or.(w(9).eq.w(10).and.w(10).eq.w(fit1-099
     111))) go to 14                                                    fit1-100
      if (i(1).ge.i(2)) go to 15                                        fit1-101
      if (i(3).eq.0) go to 10                                           fit1-102
c  step size limitation                                                 fit1-103
      w(1)=w(j)+(2*i(3))*abs(w(6)-w(8))                                 fit1-104
      go to 11                                                          fit1-105
c  prediction of the position of the minimum (parabolic approximation)  fit1-106
   10 w(1)=((w(9)-w(10))/(w(6)-w(7))-(w(10)-w(11))/(w(7)-w(8)))/(w(6)-w(fit1-107
     18))                                                               fit1-108
      w(1)=.5*(w(6)+w(8)+(w(11)-w(9))/(w(1)*(w(6)-w(8))))               fit1-109
c  test of convergence                                                  fit1-110
      w(2)=abs(w(1)-w(j))                                               fit1-111
      if (w(2).lt.abs(w(4)).or.w(2).lt.abs(w(5)*w(j))) go to 12         fit1-112
   11 i(1)=i(1)+1                                                       fit1-113
      return                                                            fit1-114
   12 ke=0                                                              fit1-115
   13 i37=i(3)+7                                                        fit1-116
      w(1)=w(i37)                                                       fit1-117
      i31=i(3)+10                                                       fit1-118
      w(2)=w(i31)                                                       fit1-119
      return                                                            fit1-120
   14 ke=ke+1                                                           fit1-121
   15 ke=ke+1                                                           fit1-122
      go to 13                                                          fit1-123
      end                                                               fit1-124
c 13/03/86  ibm version                                         ecis88  fit2-000
      subroutine fit2(m,n,a,d,ip,ir,llo)                                fit2-001
c if llo=.true. ex subroutine lilesq written by schweimer.              fit2-002
c  linear least squares problem ||b-a*d||=min(d)                        fit2-003
c  solved by householder transformations                                fit2-004
c  input variables:m: number of rows of a and b                         fit2-005
c                  n: number of columns of a and rows of d              fit2-006
c                  a: m*n matrix followed by the vector b of m compo-   fit2-007
c                                  nents (destroyed)                    fit2-008
c  output variables: d: vector of variables, the redundant variables arefit2-009
c                    set to zero. the ||d||=min is not used because the fit2-010
c                    components of d are assumed to be not commensurablefit2-011
c                  ip: permutation vector of n components, it contains  fit2-012
c                    the column labels of matrix a ordered according    fit2-013
c                    their importance in reducing the euclidean norm    fit2-014
c                  a: the upper part contains the transformed input a   fit2-015
c                    a(2,1) contains the square of the euclidean norm   fit2-016
c                  ir: error code                                       fit2-017
c                    ir=0 no error                                      fit2-018
c                    ir=-1 all components of d are zero and may be      fit2-019
c                    redundant                                          fit2-020
c                    ir>0 the first ir components of ip contain the     fit2-021
c                    labels of the nonzero components of d, the remai-  fit2-022
c                    ning components of d are zero and may be redundant fit2-023
c  note: all arithmetic operations are performed in double precision,   fit2-024
c  an iterative improvement is impossible without saving a and b.       fit2-025
c  the round off error of ||b-a*d||**2 is approximately given by        fit2-026
c  ||b(initial)||**2 - ||b(transformed)||**2                            fit2-027
c                                                                       fit2-028
c if llo=.false. ex subroutine invata written by schweimer.             fit2-029
c  inversion of the product matrix a(transposed)*a                      fit2-030
c  the matrix a is reduced to an upper triangular matrix r by           fit2-031
c  householder transformations. the remaining computation is straight   fit2-032
c  forward.                                                             fit2-033
c  input variables: n: number of columns of matrix a                    fit2-034
c                  m: number of rows of matrix a, m >= n > 0            fit2-035
c                  a: input matrix (destroyed)                          fit2-036
c  output variables: ir: error code                                     fit2-037
c                    ir=-1 rank of matrix a is zero                     fit2-038
c                    ir=0 no error, rank of matrix a is n               fit2-039
c                    ir>0 rank of matrix a is ir, the inverse of a(t)*a fit2-040
c                    is computed considering the ir columns of a indica-fit2-041
c                    ted by the first ir components of ip               fit2-042
c                  a: triangular matrix r, r=a(i,j) i<=j=1,n            fit2-043
c                  d: vector of length (n*(n+1))/2, it contains the     fit2-044
c                    upper triangular part of the inverse of a(t)*a     fit2-045
c                  ip: permutation vector of length n, its first ir     fit2-046
c                    components contain the labels of the useful        fit2-047
c                    columns of a, the last components contain the      fit2-048
c                    labels of the columns which are linear combinationsfit2-049
c                    of the first.                                      fit2-050
c***********************************************************************fit2-051
      dimension a(m,n),d(n),ip(n)                                       fit2-052
      real*8 s,t,u,v,sig                                                fit2-053
      logical llo                                                       fit2-054
      ir=0                                                              fit2-055
      n1=n                                                              fit2-056
      if (llo) n1=n+1                                                   fit2-057
      do 1 j=1,n                                                        fit2-058
    1 ip(j)=j                                                           fit2-059
c  rotation loop                                                        fit2-060
      do 13 k=1,n                                                       fit2-061
c  pivot element    column j which generates the largest new b(k) and   fit2-062
c   and line i of the largest element of column j if llo=.true.         fit2-063
c  column and line of largest element if llo=.false.                    fit2-064
      u=0.d0                                                            fit2-065
      do 7 j=k,n                                                        fit2-066
      c=0.                                                              fit2-067
      do 2 i=k,m                                                        fit2-068
      if (abs(a(i,j)).le.abs(c)) go to 2                                fit2-069
      l2=i                                                              fit2-070
      c=a(i,j)                                                          fit2-071
    2 continue                                                          fit2-072
      if (c.eq.0.) go to 7                                              fit2-073
      s=0.d0                                                            fit2-074
      if (llo) go to 4                                                  fit2-075
      if (abs(c).lt.u) go to 7                                          fit2-076
      u=abs(c)                                                          fit2-077
      do 3 i=k,m                                                        fit2-078
      v=dble(a(i,j))/dble(c)                                            fit2-079
    3 s=s+v*v                                                           fit2-080
      go to 6                                                           fit2-081
    4 t=0.d0                                                            fit2-082
      do 5 i=k,m                                                        fit2-083
      v=dble(a(i,j))/dble(c)                                            fit2-084
      s=s+v*v                                                           fit2-085
    5 t=t+v*dble(a(i,n1))                                               fit2-086
      if (u.ge.t*(t/s)) go to 7                                         fit2-087
      u=t*(t/s)                                                         fit2-088
    6 sig=dble(c)*dsqrt(s)                                              fit2-089
      l=j                                                               fit2-090
      l1=l2                                                             fit2-091
    7 continue                                                          fit2-092
      if (u.eq.0.d0) go to 14                                           fit2-093
c  permute lines of a(k)                                                fit2-094
      i=ip(l)                                                           fit2-095
      ip(l)=ip(k)                                                       fit2-096
      ip(k)=i                                                           fit2-097
      do 8 i=1,m                                                        fit2-098
      c=a(i,l)                                                          fit2-099
      a(i,l)=a(i,k)                                                     fit2-100
    8 a(i,k)=c                                                          fit2-101
c  permute lines of a(k)                                                fit2-102
      do 9 j=k,n1                                                       fit2-103
      c=a(k,j)                                                          fit2-104
      a(k,j)=a(l1,j)                                                    fit2-105
    9 a(l1,j)=c                                                         fit2-106
c  rotation of the lower column fragment of a(k) and b(k)               fit2-107
      u=sig+dble(a(k,k))                                                fit2-108
      v=dble(a(k,k))/sig                                                fit2-109
      a(k,k)=-sig                                                       fit2-110
      l=k+1                                                             fit2-111
      if (l.gt.m) a(k,l)=-a(k,l)                                        fit2-112
      if (l.gt.n1.or.l.gt.m) go to 13                                   fit2-113
      do 12 j=l,n1                                                      fit2-114
      s=v*dble(a(k,j))                                                  fit2-115
      do 10 i=l,m                                                       fit2-116
      t=dble(a(i,k))/sig                                                fit2-117
   10 s=s+t*dble(a(i,j))                                                fit2-118
      t=(dble(a(k,j))+s)/u                                              fit2-119
      a(k,j)=-s                                                         fit2-120
      do 11 i=l,m                                                       fit2-121
   11 a(i,j)=dble(a(i,j))-t*dble(a(i,k))                                fit2-122
   12 continue                                                          fit2-123
   13 continue                                                          fit2-124
c  end of rotation loop                                                 fit2-125
      k=n                                                               fit2-126
      go to 15                                                          fit2-127
   14 k=k-1                                                             fit2-128
      ir=k                                                              fit2-129
   15 if (llo) go to 22                                                 fit2-130
      if (k.eq.0) go to 29                                              fit2-131
c  inverse of the triangular matrix r stored in d                       fit2-132
      do 18 j=1,k                                                       fit2-133
      d(j)=a(j,j)                                                       fit2-134
      a(j,j)=1./d(j)                                                    fit2-135
      if (j.eq.1) go to 18                                              fit2-136
      i=j                                                               fit2-137
      do 17 l=2,j                                                       fit2-138
      i1=i                                                              fit2-139
      i=i-1                                                             fit2-140
      s=0.d0                                                            fit2-141
      do 16 l1=i1,j                                                     fit2-142
   16 s=s+dble(a(i,l1))*dble(a(j,l1))                                   fit2-143
   17 a(j,i)=-s/dble(d(i))                                              fit2-144
   18 continue                                                          fit2-145
c  inverse of the product matrix                                        fit2-146
      do 21 j=1,k                                                       fit2-147
      do 20 i=1,j                                                       fit2-148
      l=max0(ip(j),ip(i))                                               fit2-149
      ij=ip(i)+ip(j)+(l*(l-3))/2                                        fit2-150
      s=0.d0                                                            fit2-151
      do 19 l1=j,k                                                      fit2-152
   19 s=s+dble(a(l1,i))*dble(a(l1,j))                                   fit2-153
   20 d(ij)=s                                                           fit2-154
   21 continue                                                          fit2-155
      go to 30                                                          fit2-156
c  square of the euclidean norm                                         fit2-157
   22 s=0.d0                                                            fit2-158
      l=k+1                                                             fit2-159
      if (k.eq.m) go to 24                                              fit2-160
      do 23 i=l,m                                                       fit2-161
   23 s=s+dble(a(i,n1))*dble(a(i,n1))                                   fit2-162
   24 a(2,1)=s                                                          fit2-163
      if (k.eq.n) go to 26                                              fit2-164
c  components of d which do not reduce the euclidean norm               fit2-165
      do 25 j=l,n                                                       fit2-166
      ij=ip(j)                                                          fit2-167
   25 d(ij)=0.                                                          fit2-168
      if (k.eq.0) go to 29                                              fit2-169
c  computation of d                                                     fit2-170
   26 ij=ip(k)                                                          fit2-171
      d(ij)=dble(a(k,n1))/dble(a(k,k))                                  fit2-172
      if (k.eq.1) go to 30                                              fit2-173
      do 28 j=2,k                                                       fit2-174
      l=k+2-j                                                           fit2-175
      s=a(l-1,n1)                                                       fit2-176
      do 27 i=l,k                                                       fit2-177
      ij=ip(i)                                                          fit2-178
   27 s=s-dble(a(l-1,i))*dble(d(ij))                                    fit2-179
      ij=ip(l-1)                                                        fit2-180
   28 d(ij)=s/dble(a(l-1,l-1))                                          fit2-181
      go to 30                                                          fit2-182
c  error code                                                           fit2-183
   29 ir=-1                                                             fit2-184
   30 return                                                            fit2-185
      end                                                               fit2-186
c 27/04/98  ibm version                                         ecis97  cocn-000
      subroutine cocn(la,lb,ja,jb,iw,iv,ij,ip,rb,rc,nt)                 cocn-001
c computation of coefficient foa angular distribution of compoubd       cocn-002
c nucleus cross-sections.                                               cocn-003
c input variables:  la,lb,ja,jb,iw,iv,ij: integer double values         cocn-004
c                   ip:   number of coefficients requested              cocn-005
c                   nt:   size of the working space rc                  cocn-006
c output variable:  rb:   in rb(i), value of                            cocn-007
c                ( ll  la  lb )  ( ja  jb  ll )  ( la  lb  ll )         cocn-008
c                (            )  )            (  )            (         cocn-009
c                (  0   0   0 )  ( ij  ij  iw )  ( jb  ja  iv )         cocn-010
c        * (2 ij + 1) * sqrt ((2 la + 1)(2 lb + 1)(2 ja + 1)(2 jb + 1)) cocn-011
c                         for even values of ll, from ll=0 with positivecocn-012
c                         or null value for ll=0                        cocn-013
c working space:    rc:   for all the non-zero 6-j coefficients with    cocn-014
c                         even and odd values of ll, starting with the  cocn-015
c                         largest value of ll in rc(2)                  cocn-016
c***********************************************************************cocn-017
      implicit real*8 (a-h,o-z)                                         cocn-018
      dimension rb(1),rc(1),j(5)                                        cocn-019
      ld=iabs(la-lb)                                                    cocn-020
      lp=(la+lb)/4+1                                                    cocn-021
      lm=ld/4+1                                                         cocn-022
      ad=ld**2                                                          cocn-023
      ap=(la+lb+2)**2                                                   cocn-024
      jt=max0(ip,lp)                                                    cocn-025
      if (jt.gt.nt) go to 7                                             cocn-026
      ti=0.d0                                                           cocn-027
c recurrence computation of 3-j coefficients for even values of ll      cocn-028
      do 2 i=1,jt                                                       cocn-029
      al=4*i-4                                                          cocn-030
      rc(i)=0.d0                                                        cocn-031
      if (i.lt.lm.or.i.gt.lp) go to 2                                   cocn-032
      if (i.gt.lm) go to 1                                              cocn-033
      rc(i)=1.d0                                                        cocn-034
      go to 2                                                           cocn-035
    1 rc(i)=-rc(i-1)*dsqrt(((al-2.d0)**2-ad)*(ap-(al-2.d0)**2)/((al**2-acocn-036
     1d)*(ap-al**2)))                                                   cocn-037
    2 ti=ti+rc(i)**2*(al+1)                                             cocn-038
      ti=dsqrt(ti)                                                      cocn-039
      do 3 i=1,ip                                                       cocn-040
    3 rb(i)=rc(i)                                                       cocn-041
c quantum numbers of the first 6-j coefficient                          cocn-042
      j(1)=la                                                           cocn-043
      j(2)=ja                                                           cocn-044
      j(3)=iv                                                           cocn-045
      j(4)=jb                                                           cocn-046
      j(5)=lb                                                           cocn-047
      do 5 k=1,2                                                        cocn-048
      ji=max0(iabs(j(1)-j(5)),iabs(j(2)-j(4)))                          cocn-049
      jf=min0(j(1)+j(5),j(2)+j(4))                                      cocn-050
      jt=(jf-ji)/2+2                                                    cocn-051
      if (jt.gt.nt) go to 7                                             cocn-052
      at=jf+1                                                           cocn-053
      call dx6j(rc,at,j,jt)                                             cocn-054
      ti=ti*dsqrt(at*(j(3)+1))                                          cocn-055
      do 4 i=1,ip                                                       cocn-056
      ll=4*i-4                                                          cocn-057
      lk=1                                                              cocn-058
      if (ll.ge.ji.and.ll.le.jf) lk=2+(jf-ll)/2                         cocn-059
      rb(i)=rc(lk)*rb(i)                                                cocn-060
    4 continue                                                          cocn-061
c quantum numbers of the second 6-j coefficient                         cocn-062
      j(1)=ij                                                           cocn-063
      j(3)=iw                                                           cocn-064
    5 j(5)=ij                                                           cocn-065
c normalisation                                                         cocn-066
      ti=dsqrt(dfloat(la+1)*dfloat(lb+1)*dfloat(ja+1)*dfloat(jb+1))*(ij+cocn-067
     11)/ti                                                             cocn-068
      if (rb(1).lt.0.d0) ti=-ti                                         cocn-069
      do 6 i=1,ip                                                       cocn-070
    6 rb(i)=rb(i)*ti                                                    cocn-071
      return                                                            cocn-072
    7 write (2,1000) nt,jt                                              cocn-073
      stop                                                              cocn-074
 1000 format (33h working space too small in cocn:,i5,10h available,i6,1cocn-075
     10h requested/13h ... stop ...)                                    cocn-076
      end                                                               cocn-077
